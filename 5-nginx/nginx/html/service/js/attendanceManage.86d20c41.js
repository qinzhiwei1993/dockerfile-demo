(window.webpackJsonp=window.webpackJsonp||[]).push([["attendanceManage"],{"0dc1":function(t,e,a){"use strict";e.a={data:function(){return{stuDetail:{show:!1,cityCode:"",uid:""}}},methods:{showStuDetail:function(t,e){this.stuDetail.cityCode=t,this.stuDetail.uid=e,this.stuDetail.show=!0}}}},"102b":function(t,e,a){"use strict";a.r(e);a("097d"),a("ac6a"),a("96cf");var i=a("3b8d"),s=(a("28a5"),a("f751"),a("fa7d")),r=a("a36e"),n=a("2801"),c=a("7014"),o=a("0dc1"),l=a("e0a5"),d=a("2fd4"),u=a("2472"),m=a("867e"),h=a("a78e"),f=a.n(h),g={cityCode:"",year:(new Date).getFullYear()+"",gradeTypeId:"",termId:"",gradeId:"",subjectId:"",levelId:"",studentCard:"",studentName:"",teacherId:"",areaId:"",serviceCenterId:"",venueId:"",classtimeTimeClassify:"",classtimeTimePeriod:""},v={name:"stuAttendance",mixins:[r.a,n.a,c.a,o.a],data:function(){var t=this;return{empNo:"",formData:Object.assign({},g),loading1:!1,tableLoading:!1,oldSearchName:"",currentPageNum:1,currentPageSize:10,pageTotal:0,cityWithoutAllCity:[],allCityList:[],termList:[],gradeTypeList:[],subjectList:[],gradeList:[],levelList:[],teacherNameList:[],areaList:[],serviceCenterList:[],venueList:[],ruleForm:{cityCode:[{required:!0,message:"分校不能为空",trigger:"change"}],year:[{required:!0,message:"年份不能为空",trigger:"change"}],termId:[{required:!0,message:"学期不能为空",trigger:"change"}],areaId:[{required:!0,message:"区域不能为空",trigger:"change"}],serviceCenterId:[{required:!0,message:"服务中心不能为空",trigger:"change"}]},tableData:[],tableColumns:[{title:"序号",type:"index",align:"center"},{title:"操作",align:"center",width:"200px",slot:"operation"},{title:"学员编号",key:"studentCard",align:"center"},{title:"学员名称",key:"studentName",align:"center",render:function(e,a){return e("div",[e("a",{style:{display:"block",color:"#008CF8"},on:{click:function(){t.showStuDetail(t.formData.cityCode,a.row.studentUid)}}},a.row.studentName)])}},{title:"班级名称",key:"className",align:"center",width:160,render:function(e,a){return e("div",[e("div",{style:{"text-align":"right"}},[e("Tag",{style:{display:1===a.row.businessType?"inline-block":"none"},props:{color:"green"}},"全国班")]),e("a",{on:{click:function(){t.showClassDetail(a.row.classId)}}},a.row.className)])}},{title:"服务中心",key:"serviceCenterName",align:"center"},{title:"教师姓名",key:"teacherNames",align:"center",render:function(e,a){var i=a.row.teacherNames.split(","),s=a.row.teacherIds.split(",");return e("div",i.map((function(a,i){return e("a",{on:{click:function(){t.showTeacherDetail(t.formData.cityCode,s[i],"0")}}},a+" ")})))}},{title:"上课时间",key:"classtimeNames",width:"120",align:"center",render:function(e,a){return e("a",{on:{click:(r=Object(i.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.showSchooltime({cityId:t.formData.cityCode,id:a.row.classId});case 1:case"end":return e.stop()}}),e)}))),function(){return r.apply(this,arguments)})}},Object(s.g)(a.row.classtimeNames,15,!0));var r}},{title:"开课日期",key:"startDate",align:"center"},{title:"结课日期",key:"endDate",align:"center"},{title:"总课次",key:"classCount",align:"center"},{title:"教材领取",slot:"isReceiptBooks",align:"center"}],row:{},attendanceCols:[{title:"课次",key:"curriculumNum",align:"center"},{title:"上课日期",key:"classDate",align:"center"},{title:"电子考勤记录",align:"center",render:function(t,e){switch(e.row.attendanceType){case 0:return t("div",[t("span",{style:{marginRight:"10px"}},"正常"),t("span",e.row.empModifyDate||e.row.attendanceTime)]);case 1:return t("div",[t("span",{style:{marginRight:"10px",color:"red"}},"迟到"),t("span",e.row.empModifyDate||e.row.attendanceTime)]);case 2:return t("span",{style:{color:"red"}},"缺勤");default:return t("span",{style:{color:"red"}},"无数据")}}},{title:"ITS考勤记录",align:"center",render:function(t,e){switch(e.row.itsAttendanceType){case 0:return t("div",[t("span",{style:{marginRight:"10px"}},"正常"),t("span",e.row.itsAttendanceTime)]);case 1:return t("div",[t("span",{style:{marginRight:"10px",color:"red"}},"迟到  "),t("span",e.row.itsAttendanceTime)]);case 2:return t("span",{style:{color:"red"}},"缺勤");default:return t("span",{style:{color:"red"}},"无数据")}}},{title:"转班调课",align:"center",render:function(t,e){switch(e.row.changeType){case 0:return t("span",{style:{color:"#000000"}},"正常");case 1:return t("span",{style:{color:"#008CF8"}},"转班");case 2:return t("span",{style:{color:"#008CF8"}},"调课");default:return t("span","")}}}],attendanceData:[],attendanceShow:!1,editAttendanceShow:!1,attendLoading:!1}},created:function(){this.getYearListHandler(),this.getCityListHandler(),this.getTimeTypeListHandler(),this.getTimeListHandler(),this.empNo=JSON.parse(f.a.get("columbusUserInfo")).id,Object(m.w)({apiName:"stuAttendancePage"})},watch:{allCityList:function(t){t&&t.length&&(this.formData.cityCode=t[0].id,this.cityYearChange(this.formData.cityCode)),this.cityWithoutAllCity=t.filter((function(t){return"1111"!==t.id}))}},methods:{getBaseData:function(){var t=this,e={cityCode:this.formData.cityCode};this.getAreaListHandler(e).then((function(e){t.areaList=e,Object(u.e)({cityCode:t.formData.cityCode,empNo:t.empNo}).then((function(e){t.formData.areaId=e.areaId,t.changeArea(e.areaId,e.serviceCenterId)})).catch((function(e){t.$Message.error("获取当前所在服务中心失败:"+e.message)}))})).catch((function(e){t.$Message.error("获取区域失败:"+e.message)}))},clearList:function(t){switch(t){case"school":this.termList=[],this.formData.termId="",this.gradeTypeList=[],this.formData.gradeTypeId="",this.gradeList=[],this.formData.gradeId="",this.subjectList=[],this.formData.subjectId="",this.levelList=[],this.formData.levelId="",this.formData.areaId="",this.areaList=[],this.formData.serviceCenterId="",this.serviceCenterList=[],this.formData.venueId="",this.venueList=[];break;case"term":this.formData.gradeTypeId="",this.formData.gradeId="",this.formData.subjectId="",this.formData.levelId="",this.gradeTypeList=[],this.gradeList=[],this.subjectList=[],this.levelList=[];break;case"gradeType":this.formData.gradeId="",this.formData.subjectId="",this.formData.levelId="",this.gradeList=[],this.subjectList=[],this.levelList=[];break;case"grade":this.formData.subjectId="",this.formData.levelId="",this.subjectList=[],this.levelList=[];break;case"subject":this.formData.levelId="",this.levelList=[]}},cityYearChange:function(t){var e=this;if(this.clearList("school"),!t)return!1;if(!this.formData.cityCode)return this.$Message.warning("请选择城市"),!1;this.getBaseData();var a={cityCode:this.formData.cityCode,years:this.formData.year,queryType:"t"};this.getLinkageHandler(a).then((function(t){e.termList=t})).catch((function(t){e.$Message.error("获取学期失败:"+t.message)}))},termChange:function(t){var e=this;if(this.clearList("term"),t){var a={cityCode:this.formData.cityCode,years:this.formData.year,termIds:this.formData.termId,queryType:"gt"};this.getLinkageHandler(a).then((function(t){e.gradeTypeList=t})).catch((function(t){e.$Message.error("获取年部失败:"+t.message)}))}},gradeTypeChange:function(t){var e=this;if(this.clearList("gradeType"),t){var a={cityCode:this.formData.cityCode,years:this.formData.year,termIds:this.formData.termId,gtIds:this.formData.gradeTypeId,queryType:"g"};this.getLinkageHandler(a).then((function(t){e.gradeList=t})).catch((function(t){e.$Message.error("获取年级失败:"+t.message)}))}},gradeChange:function(t){var e=this;if(this.clearList("grade"),t){var a={cityCode:this.formData.cityCode,years:this.formData.year,termIds:this.formData.termId,gtIds:this.formData.gradeTypeId,gradeIds:this.formData.gradeId,queryType:"s"};this.getLinkageHandler(a).then((function(t){e.subjectList=t})).catch((function(t){e.$Message.error("获取学科失败:"+t.message)}))}},subjectChange:function(t){var e=this;if(this.clearList("subject"),t){var a={cityCode:this.formData.cityCode,years:this.formData.year,termIds:this.formData.termId,gtIds:this.formData.gradeTypeId,gradeIds:this.formData.gradeId,subjectId:this.formData.subjectId,queryType:"c"};this.getLinkageHandler(a).then((function(t){e.levelList=t})).catch((function(t){e.$Message.error("获取班次失败:"+t.message)}))}},getTeacher:function(t){var e=this;if(this.formData.cityCode){if((t=t.trim())&&t!==this.oldSearchName){this.loading1=!0,this.teacherNameList=[];var a={sysName:t,teacherType:0,cityCode:this.formData.cityCode,businessType:this.formData.teacherType,pageNo:1,pageSize:20};this.getTeacherByNameFuzzyHandler(a).then((function(t){e.teacherNameList=t.records,e.loading1=!1})).catch((function(t){e.loading1=!1,e.$Message.error("获取主讲老师姓名失败:"+t.message)}))}}else this.$Message.warning("未选择城市")},optionChange:function(t){t&&t.label&&(this.oldSearchName=t.label)},clearTeacher:function(){this.oldSearchName="",this.formData.teacherId&&(this.formData.teacherId="")},changeArea:function(t,e){var a=this;if(this.serviceCenterList=[],this.formData.serviceCenterId="",!t)return!1;var i={cityCode:this.formData.cityCode,areaId:this.formData.areaId};this.getServiceCenterListHandler(i).then((function(t){a.serviceCenterList=t,a.serviceCenterList.forEach((function(t){t.address||(t.address="")})),e&&(a.formData.serviceCenterId=e,a.changeService(e))})).catch((function(t){a.$Message.warning("获取服务中心失败:"+t.message)}))},changeService:function(t){var e=this;if(this.venueList=[],this.formData.venueId="",!t)return!1;var a={cityCode:this.formData.cityCode,serviceId:this.formData.serviceCenterId};this.getVenueListHandler(a).then((function(t){e.venueList=t})).catch((function(t){e.$Message.warning("获取教学点失败:"+t.message)}))},search:function(t){this.currentPageNum=1,this.getTableData(t)},resetField:function(){this.formData=Object.assign({},g),this.cityWithoutAllCity&&(this.formData.cityCode=this.cityWithoutAllCity[0].id,this.cityYearChange(this.formData.cityCode)),this.$refs.form.resetFields()},changePage:function(t){this.currentPageNum=t,this.getTableData("form")},pageSizeChange:function(t){this.currentPageNum=1,this.currentPageSize=t,this.getTableData("form")},getTableData:function(t){var e=this;this.$refs[t].validate((function(t){t&&(e.formData.pageSize=e.currentPageSize,e.formData.pageNo=e.currentPageNum,e.tableLoading=!0,Object(l.i)(e.formData).then((function(t){0===t.records.length&&(e.tableData=[],e.$Message.warning("暂无数据")),e.pageTotal=t.totalCount,e.tableData=t.records,e.tableLoading=!1})).catch((function(t){e.tableLoading=!1,e.pageTotal=0,e.tableData=[],e.currentPageNum=1,e.currentPageSize=10,e.$Message.warning({content:"获取数据失败:"+t.message,duration:5})})))}))},showAttendance:function(t,e){var a=this;this.row=t,Object(d.h)({cityCode:this.formData.cityCode,registId:t.id}).then((function(t){a.attendanceData=t,e?a.editAttendanceShow=!0:a.attendanceShow=!0})).catch((function(t){a.$Message.warning({content:"获取数据失败:"+t.message,duration:5})}))},changeAttendanceType:function(t){this.$set(t,"isChange",!0)},saveAttendance:function(){var t=this,e=this.attendanceData.filter((function(t){return t.isChange})).map((function(e){return{attendanceType:e.modifyType,curriculumId:e.curriculumId,studentId:t.row.studentId}}));this.attendLoading=!0,Object(d.a)({cityCode:this.formData.cityCode,attendanceList:e}).then((function(){t.$Message.success({content:"修改考勤成功",duration:5}),t.editAttendanceShow=!1})).catch((function(e){t.$Message.error({content:"修改考勤失败："+e.message,duration:5})})).finally((function(){t.attendLoading=!1}))},curriculumEditAble:function(t){return(new Date).getTime()<new Date(t.classDate).getTime()||null===t.modifyType}}},p=(a("be6c"),a("2877")),y=Object(p.a)(v,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Layout",{staticClass:"gary",staticStyle:{width:"100%"},attrs:{id:"TalClassAttendance"}},[a("div",{staticClass:"container"},[a("Form",{ref:"form",staticClass:"ivu-common-shadow",staticStyle:{"padding-top":"18px",background:"#fff"},attrs:{model:t.formData,rules:t.ruleForm,"label-position":"right","label-width":90,inline:""}},[a("FormItem",{attrs:{prop:"cityCode",label:"城市"}},[a("Select",{staticStyle:{width:"120px"},attrs:{filterable:""},on:{"on-change":t.cityYearChange},model:{value:t.formData.cityCode,callback:function(e){t.$set(t.formData,"cityCode",e)},expression:"formData.cityCode"}},t._l(t.cityWithoutAllCity,(function(e,i){return a("Option",{key:i,attrs:{value:e.id}},[t._v(t._s(e.name))])})),1)],1),t._v(" "),a("FormItem",{attrs:{prop:"year",label:"年份"}},[a("Select",{staticStyle:{width:"120px"},on:{"on-change":t.cityYearChange},model:{value:t.formData.year,callback:function(e){t.$set(t.formData,"year",e)},expression:"formData.year"}},t._l(t.yearList,(function(e,i){return a("Option",{key:i,attrs:{value:e}},[t._v(t._s(e))])})),1)],1),t._v(" "),a("FormItem",{attrs:{prop:"termId",label:"学期"}},[a("Select",{staticStyle:{width:"120px"},on:{"on-change":t.termChange},model:{value:t.formData.termId,callback:function(e){t.$set(t.formData,"termId",e)},expression:"formData.termId"}},t._l(t.termList,(function(e,i){return a("Option",{key:i,attrs:{value:e.id}},[t._v(t._s(e.name))])})),1)],1),t._v(" "),a("FormItem",{attrs:{prop:"gradeTypeId",label:"年部"}},[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:""},on:{"on-change":t.gradeTypeChange},model:{value:t.formData.gradeTypeId,callback:function(e){t.$set(t.formData,"gradeTypeId",e)},expression:"formData.gradeTypeId"}},t._l(t.gradeTypeList,(function(e,i){return a("Option",{key:i,attrs:{value:e.id}},[t._v(t._s(e.name))])})),1)],1),t._v(" "),a("FormItem",{attrs:{label:"年级"}},[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:""},on:{"on-change":t.gradeChange},model:{value:t.formData.gradeId,callback:function(e){t.$set(t.formData,"gradeId",e)},expression:"formData.gradeId"}},t._l(t.gradeList,(function(e,i){return a("Option",{key:i,attrs:{value:e.id}},[t._v(t._s(e.name))])})),1)],1),t._v(" "),a("FormItem",{attrs:{label:"学科"}},[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:"",filterable:""},on:{"on-change":t.subjectChange},model:{value:t.formData.subjectId,callback:function(e){t.$set(t.formData,"subjectId",e)},expression:"formData.subjectId"}},t._l(t.subjectList,(function(e,i){return a("Option",{key:i,attrs:{value:e.id}},[t._v(t._s(e.name))])})),1)],1),t._v(" "),a("FormItem",{attrs:{label:"班次"}},[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:"",filterable:""},model:{value:t.formData.levelId,callback:function(e){t.$set(t.formData,"levelId",e)},expression:"formData.levelId"}},t._l(t.levelList,(function(e,i){return a("Option",{key:i,attrs:{value:e.id}},[t._v(t._s(e.name))])})),1)],1),t._v(" "),a("FormItem",{attrs:{label:"学员编号"}},[a("Input",{staticStyle:{width:"120px"},attrs:{clearable:"",placeholder:"请输入"},model:{value:t.formData.studentCard,callback:function(e){t.$set(t.formData,"studentCard","string"==typeof e?e.trim():e)},expression:"formData.studentCard"}})],1),t._v(" "),a("FormItem",{attrs:{label:"学员姓名"}},[a("Input",{staticStyle:{width:"120px"},attrs:{clearable:"",placeholder:"请输入"},model:{value:t.formData.studentName,callback:function(e){t.$set(t.formData,"studentName","string"==typeof e?e.trim():e)},expression:"formData.studentName"}})],1),t._v(" "),a("FormItem",{attrs:{label:"老师姓名"}},[a("Select",{staticStyle:{width:"120px"},attrs:{filterable:"",clearable:"",remote:"","remote-method":t.getTeacher,"label-in-value":"",loading:t.loading1},on:{"on-change":t.optionChange,"on-clear":t.clearTeacher},model:{value:t.formData.teacherId,callback:function(e){t.$set(t.formData,"teacherId",e)},expression:"formData.teacherId"}},t._l(t.teacherNameList,(function(e){return a("Option",{key:e.teaId,attrs:{value:e.teaId}},[t._v(t._s(e.sysName))])})),1)],1),t._v(" "),a("FormItem",{attrs:{prop:"areaId",label:"区域"}},[a("Select",{staticStyle:{width:"120px"},attrs:{filterable:""},on:{"on-change":t.changeArea},model:{value:t.formData.areaId,callback:function(e){t.$set(t.formData,"areaId",e)},expression:"formData.areaId"}},t._l(t.areaList,(function(e){return a("Option",{key:e.schoolId,attrs:{value:e.schoolId}},[t._v(t._s(e.name))])})),1)],1),t._v(" "),a("FormItem",{attrs:{prop:"serviceCenterId",label:"服务中心"}},[a("Select",{staticStyle:{width:"120px"},attrs:{filterable:""},on:{"on-change":t.changeService},model:{value:t.formData.serviceCenterId,callback:function(e){t.$set(t.formData,"serviceCenterId",e)},expression:"formData.serviceCenterId"}},t._l(t.serviceCenterList,(function(e,i){return a("Option",{key:i,attrs:{value:e.schoolId}},[t._v(t._s(e.name)+"\n          ")])})),1)],1),t._v(" "),a("FormItem",{attrs:{label:"教学点"}},[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:"",filterable:""},model:{value:t.formData.venueId,callback:function(e){t.$set(t.formData,"venueId",e)},expression:"formData.venueId"}},t._l(t.venueList,(function(e,i){return a("Option",{key:i,attrs:{value:e.schoolId}},[t._v(t._s(e.name))])})),1)],1),t._v(" "),a("FormItem",{attrs:{label:"上课时间类型"}},[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:""},model:{value:t.formData.classtimeTimeClassify,callback:function(e){t.$set(t.formData,"classtimeTimeClassify",e)},expression:"formData.classtimeTimeClassify"}},t._l(t.classtimeTypeList,(function(e,i){return a("Option",{key:i,attrs:{value:e.name}},[t._v(t._s(e.name))])})),1)],1),t._v(" "),a("FormItem",{attrs:{label:"上课时间"}},[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:""},model:{value:t.formData.classtimeTimePeriod,callback:function(e){t.$set(t.formData,"classtimeTimePeriod",e)},expression:"formData.classtimeTimePeriod"}},t._l(t.classtimeList,(function(e,i){return a("Option",{key:i,attrs:{value:e.name}},[t._v(t._s(e.name))])})),1)],1),t._v(" "),a("div",{staticStyle:{"text-align":"right",background:"#ffffff"}},[a("FormItem",[a("Button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary"},on:{click:function(e){return t.search("form")}}},[t._v("查询班级")]),t._v(" "),a("Button",{staticStyle:{"margin-right":"10px"},on:{click:t.resetField}},[t._v("重置")])],1)],1)],1),t._v(" "),a("div",{staticStyle:{"margin-top":"9px"}},[a("Table",{ref:"selection",staticStyle:{width:"100%"},attrs:{columns:t.tableColumns,data:t.tableData,loading:t.tableLoading},scopedSlots:t._u([{key:"operation",fn:function(e){var i=e.row;return[a("a",{staticStyle:{"margin-right":"10px"},on:{click:function(e){return t.showAttendance(i,!1)}}},[t._v("查看学员考勤单")]),t._v(" "),a("a",{on:{click:function(e){return t.showAttendance(i,!0)}}},[t._v("修改考勤")])]}},{key:"isReceiptBooks",fn:function(e){var a=e.row;return[t._v("\n          "+t._s(0===a.isReceiptBooks?"未领取":"已领取")+"\n        ")]}}])})],1),t._v(" "),a("div",{class:{"page-fix":t.tableData.length<3},staticStyle:{margin:"10px"}},[a("div",{staticStyle:{float:"right"}},[a("Page",{attrs:{total:t.pageTotal,"page-size":t.currentPageSize,current:t.currentPageNum,"show-elevator":"","show-sizer":"","show-total":""},on:{"on-page-size-change":t.pageSizeChange,"on-change":t.changePage}})],1)])],1),t._v(" "),a("tal-class-detail",{attrs:{show:t.classDetail.show,classId:t.classDetail.id},on:{close:function(e){t.classDetail.show=!1}}}),t._v(" "),a("tal-teacher-details",{ref:"teacherRef",attrs:{schoolCode:t.teacherDetail.cityCode,teacherId:t.teacherDetail.id,type:t.teacherDetail.type,creatorEmpNo:t.teacherDetail.empNo}}),t._v(" "),a("Modal",{attrs:{"mask-closable":!1,title:"学员详情","footer-hide":!0,width:"960px"},model:{value:t.stuDetail.show,callback:function(e){t.$set(t.stuDetail,"show",e)},expression:"stuDetail.show"}},[t.stuDetail.show?a("tal-stu-details",{attrs:{cityCode:t.stuDetail.cityCode,uid:t.stuDetail.uid},on:{close:function(e){t.stuDetail.show=!1}}}):t._e()],1),t._v(" "),a("Modal",{attrs:{"mask-closable":!1,title:"考勤查看","footer-hide":!0,width:"960px"},model:{value:t.attendanceShow,callback:function(e){t.attendanceShow=e},expression:"attendanceShow"}},[a("div",{staticStyle:{"margin-bottom":"10px"}},[a("Row",{staticStyle:{"margin-bottom":"10px"},attrs:{gutter:10}},[a("Col",{attrs:{span:"6"}},[t._v("学员编号："),a("span",{staticStyle:{color:"#2d8cf0"}},[t._v(t._s(t.row.studentCard))])]),t._v(" "),a("Col",{attrs:{span:"6"}},[t._v("学员姓名："),a("span",{staticStyle:{color:"#2d8cf0"}},[t._v(t._s(t.row.studentName))])]),t._v(" "),a("Col",{attrs:{span:"6"}},[t._v("班级："),a("span",{staticStyle:{color:"#2d8cf0"}},[t._v(t._s(t.row.className))])]),t._v(" "),a("Col",{attrs:{span:"6"}},[t._v("学科："),a("span",{staticStyle:{color:"#2d8cf0"}},[t._v(t._s(t.row.subjectNames))])])],1),t._v(" "),a("Row",{attrs:{gutter:10}},[a("Col",{attrs:{span:"6"}},[t._v("上课时间："),a("span",{staticStyle:{color:"#2d8cf0"}},[t._v(t._s(t.row.classtimeNames))])]),t._v(" "),a("Col",{attrs:{span:"6"}},[t._v("开课日期："),a("span",{staticStyle:{color:"#2d8cf0"}},[t._v(t._s(t.row.startDate))])]),t._v(" "),a("Col",{attrs:{span:"6"}},[t._v("结课日期："),a("span",{staticStyle:{color:"#2d8cf0"}},[t._v(t._s(t.row.endDate))])]),t._v(" "),a("Col",{attrs:{span:"3"}},[t._v("总课次："),a("span",{staticStyle:{color:"#2d8cf0"}},[t._v(t._s(t.row.classCount))])]),t._v(" "),a("Col",{attrs:{span:"3"}},[t._v("已上课次："),a("span",{staticStyle:{color:"#2d8cf0"}},[t._v(t._s(t.row.passedCount))])])],1)],1),t._v(" "),a("Table",{staticStyle:{width:"100%"},attrs:{columns:t.attendanceCols,data:t.attendanceData}})],1),t._v(" "),a("Modal",{attrs:{"mask-closable":!1,width:"1200",title:"修改考勤记录"},model:{value:t.editAttendanceShow,callback:function(e){t.editAttendanceShow=e},expression:"editAttendanceShow"}},[a("div",{staticStyle:{"margin-bottom":"10px"}},[a("Row",{staticStyle:{"margin-bottom":"10px"},attrs:{gutter:10}},[a("Col",{attrs:{span:"6"}},[t._v("学员编号："),a("span",{staticStyle:{color:"#2d8cf0"}},[t._v(t._s(t.row.studentCard))])]),t._v(" "),a("Col",{attrs:{span:"6"}},[t._v("学员姓名："),a("span",{staticStyle:{color:"#2d8cf0"}},[t._v(t._s(t.row.studentName))])]),t._v(" "),a("Col",{attrs:{span:"6"}},[t._v("班级："),a("span",{staticStyle:{color:"#2d8cf0"}},[t._v(t._s(t.row.className))])]),t._v(" "),a("Col",{attrs:{span:"6"}},[t._v("学科："),a("span",{staticStyle:{color:"#2d8cf0"}},[t._v(t._s(t.row.subjectNames))])])],1),t._v(" "),a("Row",{attrs:{gutter:10}},[a("Col",{attrs:{span:"6"}},[t._v("上课时间："),a("span",{staticStyle:{color:"#2d8cf0"}},[t._v(t._s(t.row.classtimeNames))])]),t._v(" "),a("Col",{attrs:{span:"6"}},[t._v("开课日期："),a("span",{staticStyle:{color:"#2d8cf0"}},[t._v(t._s(t.row.startDate))])]),t._v(" "),a("Col",{attrs:{span:"6"}},[t._v("结课日期："),a("span",{staticStyle:{color:"#2d8cf0"}},[t._v(t._s(t.row.endDate))])]),t._v(" "),a("Col",{attrs:{span:"3"}},[t._v("总课次："),a("span",{staticStyle:{color:"#2d8cf0"}},[t._v(t._s(t.row.classCount))])]),t._v(" "),a("Col",{attrs:{span:"3"}},[t._v("已上课次："),a("span",{staticStyle:{color:"#2d8cf0"}},[t._v(t._s(t.row.passedCount))])])],1)],1),t._v(" "),a("div",{staticClass:"ivu-table ivu-table-default ivu-table-wrapper"},[t.attendLoading?a("Spin",{attrs:{size:"large",fix:""}}):t._e(),t._v(" "),a("div",{staticClass:"ivu-table-body"},[a("table",{staticStyle:{width:"100%"},attrs:{cellspacing:"0",cellpadding:"0",border:"0"}},[a("thead",[a("tr",{staticClass:"ivu-table-row"},[a("th",{staticClass:"ivu-table-column-center"},[a("div",{staticClass:"ivu-table-cell"},[t._v("课次")])]),t._v(" "),a("th",{staticClass:"ivu-table-column-center"},[a("div",{staticClass:"ivu-table-cell"},[t._v("上课日期")])]),t._v(" "),a("th",{staticClass:"ivu-table-column-center",attrs:{width:"200px"}},[a("div",{staticClass:"ivu-table-cell"},[t._v("考勤状态")])]),t._v(" "),a("th",{staticClass:"ivu-table-column-center"},[a("div",{staticClass:"ivu-table-cell"},[t._v("考勤时间")])]),t._v(" "),a("th",{staticClass:"ivu-table-column-center"},[a("div",{staticClass:"ivu-table-cell"},[t._v("最后修改人")])]),t._v(" "),a("th",{staticClass:"ivu-table-column-center"},[a("div",{staticClass:"ivu-table-cell"},[t._v("修改时间")])]),t._v(" "),a("th",{staticClass:"ivu-table-column-center"},[a("div",{staticClass:"ivu-table-cell"},[t._v("是否有考勤")])])])]),t._v(" "),a("tbody",{staticClass:"ivu-table-tbody"},[t._l(t.attendanceData,(function(e){return t.attendanceData&&t.attendanceData.length>0?a("tr",{key:e.id,staticClass:"ivu-table-row"},[a("td",{staticClass:"ivu-table-column-center",class:{"is-change":e.isChange}},[a("div",{staticClass:"ivu-table-cell"},[t._v(t._s(e.curriculumNum))])]),t._v(" "),a("td",{staticClass:"ivu-table-column-center",class:{"is-change":e.isChange}},[a("div",{staticClass:"ivu-table-cell"},[t._v(t._s(e.classDate))])]),t._v(" "),a("td",{staticClass:"ivu-table-column-center",class:{"is-change":e.isChange}},[a("div",{staticClass:"ivu-table-cell"},[a("RadioGroup",{on:{"on-change":function(a){return t.changeAttendanceType(e)}},model:{value:e.modifyType,callback:function(a){t.$set(e,"modifyType",a)},expression:"item.modifyType"}},[a("Radio",{attrs:{label:0,disabled:t.curriculumEditAble(e)}},[t._v("准时上课")]),t._v(" "),a("Radio",{attrs:{label:1,disabled:t.curriculumEditAble(e)}},[t._v("迟到")]),t._v(" "),a("Radio",{attrs:{label:2,disabled:t.curriculumEditAble(e)}},[t._v("缺课")])],1)],1)]),t._v(" "),a("td",{staticClass:"ivu-table-column-center",class:{"is-change":e.isChange}},[a("div",{staticClass:"ivu-table-cell"},[t._v(t._s(e.lastModifyDate))])]),t._v(" "),a("td",{staticClass:"ivu-table-column-center",class:{"is-change":e.isChange}},[a("div",{staticClass:"ivu-table-cell"},[t._v(t._s(e.empName))])]),t._v(" "),a("td",{staticClass:"ivu-table-column-center",class:{"is-change":e.isChange}},[a("div",{staticClass:"ivu-table-cell"},[t._v(t._s(e.empModifyDate))])]),t._v(" "),a("td",{staticClass:"ivu-table-column-center",class:{"is-change":e.isChange}},[a("div",{staticClass:"ivu-table-cell"},[null===e.modifyType?a("span",{staticStyle:{color:"red"}},[t._v("无")]):a("span",[t._v("有")])])])]):t._e()})),t._v(" "),t.attendanceData&&t.attendanceData.length?t._e():a("tr",[a("td",{staticClass:"ivu-table-column-center",attrs:{colspan:"7"}},[a("div",{staticClass:"ivu-table-cell"},[t._v("暂无数据")])])])],2)])])],1),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"primary",disabled:!this.attendanceData.filter((function(t){return t.isChange})).length},on:{loading:t.attendLoading,click:t.saveAttendance}},[t._v("提交")]),t._v(" "),a("Button",{on:{click:function(e){t.editAttendanceShow=!1}}},[t._v("取消")])],1)]),t._v(" "),a("TalSchooltime",{ref:"talSchooltime"})],1)}),[],!1,null,"74c019c4",null);e.default=y.exports},1472:function(t,e,a){"use strict";var i=a("2981");a.n(i).a},"24c6":function(t,e,a){t.exports=a.p+"img/WechatIMG286.bb9f5ac2.jpeg"},2801:function(t,e,a){"use strict";a("96cf");var i,s=a("3b8d");e.a={data:function(){return{classDetail:{id:"",show:!1}}},methods:{showClassDetail:function(t){var e=this;this.classDetail.id=t,this.$nextTick((function(){e.classDetail.show=!0}))},showSchooltime:(i=Object(s.a)(regeneratorRuntime.mark((function t(e){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.$refs.talSchooltime.seeDetail(e);case 2:(a=t.sent)&&this.$Message.error({content:"获取上课时间失败: ".concat(a)});case 4:case"end":return t.stop()}}),t,this)}))),function(t){return i.apply(this,arguments)})}}},2981:function(t,e,a){},"2fd4":function(t,e,a){"use strict";a.d(e,"g",(function(){return s})),a.d(e,"f",(function(){return r})),a.d(e,"e",(function(){return n})),a.d(e,"i",(function(){return c})),a.d(e,"b",(function(){return o})),a.d(e,"c",(function(){return l})),a.d(e,"j",(function(){return d})),a.d(e,"a",(function(){return u})),a.d(e,"k",(function(){return m})),a.d(e,"d",(function(){return h})),a.d(e,"l",(function(){return f})),a.d(e,"h",(function(){return g}));var i=a("66df");function s(t){return i.a.request({url:"attendance/getAttendanceByDate",method:"get",params:t})}function r(t){return i.a.request({url:"attendance/getAttendanceByCurriculumId",method:"get",params:t})}function n(t){return i.a.request({url:"attendance/getAllCardType",method:"get",params:t})}function c(t){return i.a.request({url:"attendance/getUnUsedAttendanceCard",method:"get",params:t})}function o(t){return i.a.request({url:"attendance/bindAttendanceCard",method:"post",data:t})}function l(t){return i.a.request({url:"attendance/changeAttendanceCard",method:"post",data:t})}function d(t){return i.a.request({url:"attendance/printAttendance",method:"get",params:t})}function u(t){return i.a.request({url:"attendance/batchModifyAttend",method:"post",data:t})}function m(t){return i.a.request({url:"attendanceReturn/queryAttendanceReturn",method:"POST",data:t})}function h(t){return i.a.request({url:"attendanceReturn/editAttendanceReturn",method:"POST",data:t})}function f(t){return i.a.request({url:"attendanceReturn/queryElectronAttendReturn",method:"POST",data:t})}function g(t){return i.a.request({url:"attendance/getStudentAttendanceByRegistId",method:"get",params:t})}},"2fe9":function(t,e,a){t.exports=a.p+"img/WechatIMG292.f9565553.png"},"33ce":function(t,e,a){"use strict";var i=a("8403");a.n(i).a},"36c0":function(t,e,a){},"3e7f":function(t,e,a){"use strict";var i=a("bdaf");a.n(i).a},"41c4":function(t,e,a){"use strict";a.r(e);var i=a("2472"),s=a("fa7d"),r={data:function(){return{dataList:[],now:Object(s.d)(new Date)}},mounted:function(){var t=this;document.documentElement.className="printPage",document.body.className="printPage";var e={cityCode:this.$route.query.cityCode,classIds:this.$route.query.classIds,lessonNum:this.$route.query.curriculumId};Object(i.c)(e).then((function(e){e&&e.length?(t.dataList=e,setTimeout((function(){window.print()}),500)):t.dataList=[]})).catch((function(e){t.$Message.error({content:"获取点名册信息失败："+e.message,duration:5})}))}},n=(a("1472"),a("58a8"),a("2877")),c=Object(n.a)(r,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"wrapper"},t._l(t.dataList,(function(e,i){return a("div",{key:i,staticClass:"class"},[a("div",{staticStyle:{"text-align":"right"}},[t._v("打印时间："+t._s(t.now))]),t._v(" "),a("div",{staticClass:"class-name"},[t._v(t._s(e.className))]),t._v(" "),a("div",{staticClass:"class-info"},[a("div",{staticClass:"info"},[t._v("课次：第"+t._s(e.curriculumNo)+"次课")]),t._v(" "),a("div",{staticClass:"info"},[t._v("服务中心："+t._s(e.serviceCenterName))]),t._v(" "),a("div",{staticClass:"info"},[t._v("教学点："+t._s(e.venueName))]),t._v(" "),a("div",{staticClass:"info"},[t._v("教室："+t._s(e.classroomName))]),t._v(" "),a("div",{staticClass:"info"},[t._v("主讲老师："+t._s(e.teacherNames))]),t._v(" "),a("div",{staticClass:"info"},[t._v("开课时间："+t._s(e.startDate?e.startDate.split(" ")[0]:"")+" 至 "+t._s(e.endDate?e.endDate.split(" ")[0]:""))]),t._v(" "),a("div",{staticClass:"info"},[t._v("上课时间："+t._s(e.classtimeNames)+" "),a("span",[t._v("("+t._s(e.classDate)+")")])]),t._v(" "),a("div",{staticClass:"info"},[t._v("教师签字：")])]),t._v(" "),a("table",{staticStyle:{border:"1px solid #000","border-collapse":"collapse"},attrs:{border:"1",width:"100%",cellspacing:"0",cellpadding:"0",bgcolor:"#ffffff",bordercolordark:"#ffffff",bordercolorlight:"#000000"}},[t._m(0,!0),t._v(" "),t._m(1,!0),t._v(" "),t._l(e.studentNameList,(function(e,i){return a("tr",{key:i},[a("td",{attrs:{align:"center"}},[t._v(t._s(i+1))]),t._v(" "),a("td",{attrs:{align:"center"}},[t._v(t._s(e))]),t._v(" "),a("td",{attrs:{align:"center"}})])}))],2),t._v(" "),t.dataList.length!=i+1?a("div",{staticClass:"page-break"}):t._e()])})),0)}),[function(){var t=this.$createElement,e=this._self._c||t;return e("tr",[e("td",{attrs:{colspan:"3",align:"center"}},[this._v("上课学员名单")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("tr",[e("td",{attrs:{align:"center",width:"60px"}},[this._v("编号")]),this._v(" "),e("td",{attrs:{align:"center",width:"100px"}},[this._v("学员姓名")]),this._v(" "),e("td",{attrs:{align:"center"}},[this._v("考勤")])])}],!1,null,"122bf2ba",null);e.default=c.exports},"45e8":function(t,e,a){"use strict";var i=a("c56e");a.n(i).a},"49e5":function(t,e,a){"use strict";a.d(e,"b",(function(){return s})),a.d(e,"c",(function(){return r})),a.d(e,"d",(function(){return n})),a.d(e,"a",(function(){return c}));var i=a("66df"),s=function(t){return i.a.request({url:"/student/getStudentDetail",params:t,method:"get"})},r=function(t){return i.a.request({url:"/student/getUserInfo",params:t,method:"get"})},n=function(t){return i.a.request({url:"/student/recentAttentionOfStudent",params:t,method:"get"})},c=function(t){return i.a.request({url:"/student/abilityStudentLevel",data:t,method:"post"})}},"58a8":function(t,e,a){"use strict";var i=a("6278");a.n(i).a},"5d04":function(t,e,a){"use strict";var i=a("36c0");a.n(i).a},6278:function(t,e,a){},"684f":function(t,e,a){"use strict";var i=a("9848");a.n(i).a},"6ec6":function(t,e,a){"use strict";a("96cf");var i,s=a("3b8d"),r=a("2472");e.a={data:function(){return{queryData:{card:"",cityCode:""},classInfo:{type:Object,default:function(){return{}}}}},mounted:function(){this.initStu()},methods:{initStu:(i=Object(s.a)(regeneratorRuntime.mark((function t(){var e=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!this.$route.query){t.next=9;break}if(this.$route.query.card&&"undefined"!==this.$route.query.card&&(this.queryData.card=String(this.$route.query.card)),this.$route.query.cityCode&&"undefined"!==this.$route.query.cityCode&&(this.queryData.cityCode=String(this.$route.query.cityCode)),!this.$route.query.classId){t.next=8;break}return t.next=7,Object(r.d)({classId:this.$route.query.classId});case 7:this.classInfo=t.sent;case 8:this.queryData.card&&this.queryData.cityCode&&this.$nextTick((function(){e.$refs.stuSearch.searchStuByUid({card:e.queryData.card,realName:"",phone:"",cityCode:e.queryData.cityCode,current:1})}));case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(0),this.$Message.error("初始化错误："+t.t0||!1);case 14:case"end":return t.stop()}}),t,this,[[0,11]])}))),function(){return i.apply(this,arguments)})}}},7014:function(t,e,a){"use strict";var i=a("a78e"),s=a.n(i);e.a={data:function(){return{teacherDetail:{cityCode:"",id:"",type:"",empNo:"",show:!1}}},mounted:function(){this.teacherDetail.empNo=JSON.parse(s.a.get("columbusUserInfo")).id},methods:{showTeacherDetail:function(t,e,a){var i=this;this.teacherDetail.show=!0,this.teacherDetail.cityCode=t,this.teacherDetail.id=e,this.teacherDetail.type=a||"0",this.$nextTick((function(){i.$refs.teacherRef.show()}))}}}},7701:function(t,e,a){"use strict";var i=a("bc76");a.n(i).a},8403:function(t,e,a){},"8f23":function(t,e,a){t.exports=a.p+"img/WechatIMG285.1b56f904.png"},"945f":function(t,e,a){"use strict";a.r(e);a("ac6a"),a("c5f6"),a("55dd"),a("097d"),a("96cf");var i=a("3b8d"),s=(a("28a5"),a("7f7f"),a("fa7d")),r=a("2801"),n=a("7014"),c=a("a36e"),o=a("867e"),l=a("2472"),d=a("2fd4"),u={name:"classAttendance",mixins:[c.a,r.a,n.a],data:function(){var t=this;return{confirmCurriculumModal:!1,printCurriculum:null,creatorEmpNo:"",studentDetail:{cityCode:"",cityName:"",studentId:""},tableLoading:!1,currentPageNum:1,currentPageSize:10,pageTotal:0,oldSearchName:"",formData:{cityCode:"",year:(new Date).getFullYear()+"",termId:"",gradeTypeId:"",gradeId:"",subjectIds:"",levelId:"",areaId:"",serviceCenterId:"",venueId:"",teacherId:"",tutorId:"",classtimeTimeClassify:"",classtimeTimePeriod:"",passCountStart:null,passCountEnd:null,startDate:"",startDateVal:"",endDate:"",endDateVal:""},formData2:{cityCode:"",year:(new Date).getFullYear()+"",termId:"",gradeTypeId:"",gradeId:"",subjectIds:"",levelId:"",areaId:"",serviceCenterId:"",venueId:"",teacherId:"",tutorId:"",classtimeTimeClassify:"",classtimeTimePeriod:"",passCountStart:null,passCountEnd:null,startDate:"",startDateVal:"",endDate:"",endDateVal:""},tableData:[],loading1:!1,termList:[],gradeTypeList:[],subjectList:[],gradeList:[],levelList:[],areaList:[],serviceCenterList:[],venueList:[],teacherNameList:[],tutorNameList:[],tableColumns:[{type:"selection",width:60,align:"center"},{title:"操作",align:"center",width:100,render:function(e,a){return e("div",[1===a.row.businessType?"":e("a",{style:{display:"block",color:"#008CF8"},on:{click:function(){t.showCurriculum(a.row)}}},"查看")])}},{title:"班级名称",key:"name",align:"center",width:150,render:function(e,a){return e("div",[e("div",{style:{"text-align":"right"}},[e("Tag",{style:{display:1===a.row.businessType?"inline-block":"none"},props:{color:"green"}},"全国班")]),e("a",{on:{click:function(){t.showClassDetail(a.row.id)}}},a.row.name)])}},{title:"主讲教师",key:"teacherNames",align:"center",render:function(e,a){var i=a.row.teacherNames.split(","),s=a.row.teacherIds.split(",");return e("div",i.map((function(a,i){return e("a",{on:{click:function(){t.showTeacherDetail(t.formData.cityCode,s[i],"0")}}},a)})))}},{title:"服务中心",key:"serviceCenterName",align:"center"},{title:"教室",key:"classroomName",align:"center"},{title:"上课时间",key:"classtimeNames",align:"center",render:function(e,a){return e("a",{on:{click:(r=Object(i.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.showSchooltime({cityId:t.formData.cityCode,id:a.row.id});case 1:case"end":return e.stop()}}),e)}))),function(){return r.apply(this,arguments)})}},Object(s.g)(a.row.classtimeNames,15,!0));var r}},{title:"开课日期",key:"startDate",align:"center"},{title:"结课日期",key:"endDate",align:"center"},{title:"总课次",key:"classCount",align:"center"},{title:"已上课次",key:"passedCount",align:"center"}],classTypeMap:{1:"在线",2:"双师",4:"面授"},curriculumModal:!1,curriculumLoading:!1,attendModal:!1,attendLoading:!1,curriculumCols:[{type:"selection",width:60,align:"center"},{title:"操作",align:"center",width:220,render:function(e,a){return e("div",[e("a",{style:{marginRight:"10px"},on:{click:function(){t.printCurriculumAttendance(a.row.id)}}},"打印考勤单"),1===a.row.businessType?"":e("a",{style:{marginRight:"10px"},on:{click:function(){t.showAttendance(a.row.id,!1)}}},"考勤查看"),e("a",{on:{click:function(){t.showAttendance(a.row.id,!0)}}},"修改考勤记录")])}},{title:"课次",key:"classNum",align:"center"},{title:"上课日期",key:"classDate",align:"center"},{title:"上课时间",key:"classtimeNames",align:"center"},{title:"是否上课",key:"status",align:"center",render:function(t,e){return t("div",[0===e.row.status?"未上课":"已上课"])}}],curriculumData:[],attendCols:[{title:"学员姓名",key:"studentRealName",align:"center"},{title:"学员编号",key:"studentCard",align:"center"},{title:"电子考勤记录",align:"center",render:function(t,e){switch(e.row.attendanceType){case 0:return t("div",[t("span",{style:{marginRight:"10px"}},"正常"),t("span",e.row.empModifyDate||e.row.attendanceTime)]);case 1:return t("div",[t("span",{style:{marginRight:"10px",color:"red"}},"迟到"),t("span",e.row.empModifyDate||e.row.attendanceTime)]);case 2:return t("span",{style:{color:"red"}},"缺勤");default:return t("span",{style:{color:"red"}},"无数据")}}},{title:"ITS考勤记录",align:"center",render:function(t,e){switch(e.row.itsAttendanceType){case 0:return t("div",[t("span",{style:{marginRight:"10px"}},"正常"),t("span",e.row.itsAttendanceTime)]);case 1:return t("div",[t("span",{style:{marginRight:"10px",color:"red"}},"迟到  "),t("span",e.row.itsAttendanceTime)]);case 2:return t("span",{style:{color:"red"}},"缺勤");default:return t("span",{style:{color:"red"}},"无数据")}}},{title:"调课",align:"center",render:function(t,e){return t("span",0===e.row.isChangeCourse?"否":"是")}},{title:"转班",align:"center",render:function(t,e){return t("span",0===e.row.isChangeClass?"否":"是")}}],editAttendModal:!1,editAttendCols:[{type:"selection",width:60,align:"center"},{title:"学员姓名",key:"studentRealName",align:"center"},{title:"学员编号",key:"studentCard",align:"center"},{title:"考勤状态",align:"center",width:"200px",slot:"attendanceType"},{title:"考勤时间",align:"center",key:"attendanceTime"},{title:"最后修改人",align:"center",key:"empName"},{title:"修改时间",align:"center",key:"empModifyDate"},{title:"修改时间",align:"center",slot:"hasAttendance"}],attendData:[],row:{},selectedRows:[],selectedCurriculums:[]}},methods:{showCurriculum:function(t){var e=this;this.row=t,this.curriculumModal=!0,this.curriculumLoading=!0,Object(l.b)({cityCode:t.cityCode,classId:t.id}).then((function(t){e.curriculumData=t.sort((function(t,e){return Number(t.classNum)-Number(e.classNum)}))})).catch((function(t){e.curriculumData=[],e.$Message.error({content:"获取课次信息失败：".concat(t.message),duration:5}),e.curriculumModal=!1})).finally((function(){e.curriculumLoading=!1}))},showAttendance:function(t,e){var a=this;this.attendLoading=!0,this.curriculumId=t,Object(d.f)({cityCode:this.row.cityCode,curriculumId:t}).then((function(t){a.attendData=t,e?a.editAttendModal=!0:(a.selectedCurriculums=[],a.attendModal=!0)})).catch((function(t){a.attendData=[],a.$Message.error({content:"获取班次考勤信息失败：".concat(t.message),duration:5}),a.attendModal=!1})).finally((function(){a.attendLoading=!1}))},getClassTypeName:function(t){return this.classTypeMap[t]},search:function(){this.currentPageNum=1,this.getTableData()},getTableData:function(){var t=this;this.formData.cityCode?this.formData.year?this.formData.termId?(this.formData.pageSize=this.currentPageSize,this.formData.pageNo=this.currentPageNum,this.formData.passCountEnd=this.formData.passCountStart,this.tableLoading=!0,Object(l.f)(this.formData).then((function(e){t.selectedRows=[],0===e.records.length&&(t.tableData=[],t.$Message.warning("暂无数据")),t.pageTotal=e.totalCount,t.studentDetail={cityCode:t.formData.cityCode},t.tableData=e.records,t.tableLoading=!1})).catch((function(e){t.tableData=[],t.pageTotal=0,t.currentPageSize=10,t.currentPageNum=1,t.tableLoading=!1,t.$Message.warning({content:"获取数据失败:"+e.message,duration:5})}))):this.$Message.warning("请选择学期"):this.$Message.warning("请选择年份"):this.$Message.warning("请选择所在城市")},getBaseData:function(){var t=this,e={cityCode:this.formData.cityCode};this.getAreaListHandler(e).then((function(e){t.areaList=e,Object(l.e)({cityCode:t.formData.cityCode,empNo:t.$store.state.user.userInfo.id}).then((function(e){t.formData.areaId=e.areaId,t.changeArea(e.areaId,e.serviceCenterId)})).catch((function(e){t.$Message.error("获取当前所在服务中心失败:"+e.message)}))})).catch((function(e){t.$Message.error("获取区域失败:"+e.message)}))},cityYearChange:function(t){var e=this;if(this.formData.termId="",this.formData.gradeTypeId="",this.formData.gradeId="",this.formData.subjectIds="",this.formData.levelId="",this.formData.areaId="",this.formData.serviceCenterId="",this.formData.venueId="",this.formData.classtimeTimePeriod="",this.formData.classtimeTimeClassify="",this.termList=[],this.gradeTypeList=[],this.gradeList=[],this.subjectList=[],this.levelList=[],this.areaList=[],this.serviceCenterList=[],this.venueList=[],!t)return!1;if(!this.formData.cityCode)return this.$Message.warning("请选择城市"),!1;this.getBaseData();var a={cityCode:this.formData.cityCode,years:this.formData.year,queryType:"t"};this.getLinkageHandler(a).then((function(t){e.termList=t})).catch((function(t){e.$Message.error("获取学期失败:"+t.message)}))},termChange:function(t){var e=this;if(this.formData.gradeTypeId="",this.formData.gradeId="",this.formData.subjectIds="",this.formData.levelId="",this.gradeTypeList=[],this.gradeList=[],this.subjectList=[],this.levelList=[],!t)return!1;var a={cityCode:this.formData.cityCode,years:this.formData.year,termIds:this.formData.termId,queryType:"gt"};this.getLinkageHandler(a).then((function(t){e.gradeTypeList=t})).catch((function(t){e.$Message.error("获取年部失败:"+t.message)}))},gradeTypeChange:function(t){var e=this;if(this.formData.gradeId="",this.formData.subjectIds="",this.formData.levelId="",this.gradeList=[],this.subjectList=[],this.levelList=[],!t)return!1;var a={cityCode:this.formData.cityCode,years:this.formData.year,termIds:this.formData.termId,gtIds:this.formData.gradeTypeId,queryType:"g"};this.getLinkageHandler(a).then((function(t){e.gradeList=t})).catch((function(t){e.$Message.error("获取年级失败:"+t.message)}))},gradeChange:function(t){var e=this;if(this.formData.subjectIds="",this.formData.levelId="",this.subjectList=[],this.levelList=[],!t)return!1;var a={cityCode:this.formData.cityCode,years:this.formData.year,termIds:this.formData.termId,gtIds:this.formData.gradeTypeId,gradeIds:this.formData.gradeId,queryType:"s"};this.getLinkageHandler(a).then((function(t){e.subjectList=t})).catch((function(t){e.$Message.error("获取学科失败:"+t.message)}))},subjectChange:function(t){var e=this;if(this.formData.levelId="",this.levelList=[],!t)return!1;var a={cityCode:this.formData.cityCode,years:this.formData.year,termIds:this.formData.termId,gtIds:this.formData.gradeTypeId,gradeIds:this.formData.gradeId,subjectIds:this.formData.subjectIds,queryType:"c"};this.getLinkageHandler(a).then((function(t){e.levelList=t})).catch((function(t){e.$Message.error("获取班次失败:"+t.message)}))},changeArea:function(t,e){var a=this;if(this.serviceCenterList=[],this.formData.service="",!t)return!1;var i={cityCode:this.formData.cityCode,areaId:this.formData.areaId};this.getServiceCenterListHandler(i).then((function(t){a.serviceCenterList=t,a.serviceCenterList.forEach((function(t){t.address||(t.address="")})),e&&(a.formData.serviceCenterId=e,a.changeService(e))})).catch((function(t){a.$Message.warning("获取服务中心失败:"+t.message)}))},changeService:function(t){var e=this;if(this.venueList=[],this.formData.venueId="",!t)return!1;var a={cityCode:this.formData.cityCode,serviceId:this.formData.serviceCenterId};this.getVenueListHandler(a).then((function(t){e.venueList=t})).catch((function(t){e.$Message.warning("获取教学点失败:"+t.message)}))},getTeacher:function(t){var e=this;if(this.formData.cityCode){if((t=t.trim())&&t!==this.oldSearchName){this.loading1=!0,this.teacherNameList=[];var a={sysName:t,teacherType:0,cityCode:this.formData.cityCode,businessType:this.formData.teacherType,pageNo:1,pageSize:20};this.getTeacherByNameFuzzyHandler(a).then((function(t){e.teacherNameList=t.records,e.loading1=!1})).catch((function(t){e.loading1=!1,e.$Message.error("获取主讲老师姓名失败:"+t.message)}))}}else this.$Message.warning("未选择城市")},getTutor:function(t){var e=this;if(this.formData.cityCode){if((t=t.trim())&&t!==this.oldSearchName){this.loading1=!0,this.tutorNameList=[];var a={sysName:t,teacherType:1,cityCode:this.formData.cityCode,businessType:this.formData.teacherType,pageNo:1,pageSize:20};this.getTeacherByNameFuzzyHandler(a).then((function(t){e.tutorNameList=t.records,e.loading1=!1})).catch((function(t){e.loading1=!1,e.$Message.error("获取辅导老师姓名失败:"+t.message)}))}}else this.$Message.warning("未选择城市")},optionChange:function(t){t&&t.label&&(this.oldSearchName=t.label)},resetFields:function(){Object(s.e)(this.formData,this.formData2)},changePage:function(t){this.currentPageNum=t,this.getTableData()},pageSizeChange:function(t){this.currentPageNum=1,this.currentPageSize=t,this.getTableData()},selectionChange:function(t){this.selectedRows=t},selectionCurriculumChange:function(t){this.selectedCurriculums=t},startDateChange:function(t){if(this.formData.endDate&&new Date(t).getTime()>new Date(this.formData.endDate).getTime())return this.$Message.warning({content:"结束时间不得小于开始时间",duration:5}),this.formData.startDate="",void(this.formData.startDateVal="");this.formData.startDate=t},endDateChange:function(t){if(this.formData.startDate&&new Date(this.formData.startDate).getTime()>new Date(t).getTime())return this.$Message.warning({content:"结束时间不得小于开始时间",duration:5}),this.formData.endDate="",void(this.formData.endDateVal="");this.formData.endDate=t},printStudentNames:function(){top.open("/service/printStudentNames?cityCode=".concat(this.formData.cityCode,"&classIds=").concat(this.selectedRows.map((function(t){return t.id})).join(","),"&print=true"))},printCurrentCurriculumAttendance:function(){this.formData.passCountStart&&this.formData.passCountEnd?top.open("/service/printCurriculumAttendance?cityCode=".concat(this.formData.cityCode,"&classIds=").concat(this.selectedRows.map((function(t){return t.id})).join(","),"&classNum=").concat(this.formData.passCountStart,"&print=true")):this.$Message.warning({content:"请输入大于0的已上课次并进行搜索",duration:5})},printOneCurriculumStudentNames:function(){this.printCurriculum=null,this.confirmCurriculumModal=!0},confirmPrintStuNames:function(){var t=this,e=this.selectedRows.filter((function(e){return e.classCount<t.printCurriculum}));e.length>0?this.$Message.warning({content:"您所选择的班级 ".concat(e.map((function(t){return"【"+t.name+"】"})).join("、")," 总课次小于要打印的课次，请重新输入课次"),duration:5}):(top.open("/service/printOneCurriculumStudentNames?cityCode=".concat(this.formData.cityCode,"&classIds=").concat(this.selectedRows.map((function(t){return t.id})).join(","),"&curriculumId=").concat(this.printCurriculum,"&print=true")),this.confirmCurriculumModal=!1)},printSelectedCurriculumAttendance:function(){top.open("/service/printCurriculumAttendance?cityCode=".concat(this.formData.cityCode,"&classIds=").concat(this.row.id,"&curriculumId=").concat(this.selectedCurriculums.map((function(t){return t.id})).join(","),"&print=true"))},printCurriculumAttendance:function(t){top.open("/service/printCurriculumAttendance?cityCode=".concat(this.formData.cityCode,"&classIds=").concat(this.row.id,"&curriculumId=").concat(t,"&print=true"))},changeAttendanceType:function(t){this.$set(t,"isChange",!0)},saveAttendance:function(){var t=this,e=this.attendData.filter((function(t){return t.isChange})).map((function(e){return{attendanceType:e.modifyType,curriculumId:t.curriculumId,studentId:e.studentId}}));this.attendLoading=!0,Object(d.a)({cityCode:this.formData.cityCode,attendanceList:e}).then((function(){t.$Message.success({content:"修改考勤成功",duration:5}),t.editAttendModal=!1})).catch((function(e){t.$Message.error({content:"修改考勤失败："+e.message,duration:5})})).finally((function(){t.attendLoading=!1}))},curriculumSelectable:function(t){var e="".concat(t.classDate," 00:00:00");return(new Date).getTime()>new Date(e).getTime()}},watch:{allCityList:function(t){1===t.length&&(this.formData.cityCode=t[0].id,this.formData2.cityCode=t[0].id,this.cityYearChange(this.formData.cityCode))}},mounted:function(){this.getYearListHandler(),this.getCityListHandler(),this.getClassTypeHandler(),this.getTimeTypeListHandler(),this.getTimeListHandler(),Object(o.w)({apiName:"classAttendancePage"})}},m=(a("5d04"),a("2877")),h=Object(m.a)(u,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Layout",{staticClass:"gary",attrs:{id:"TalClassAttendance"}},[a("div",{staticClass:"class_nav"},[a("Form",{ref:"form",staticClass:"ivu-common-shadow",attrs:{model:t.formData,"label-position":"right","label-width":90,inline:""}},[a("div",{staticClass:"class_top"},[a("FormItem",{attrs:{label:"城市",required:""}},[a("Select",{staticStyle:{width:"120px"},attrs:{filterable:""},on:{"on-change":t.cityYearChange},model:{value:t.formData.cityCode,callback:function(e){t.$set(t.formData,"cityCode",e)},expression:"formData.cityCode"}},t._l(t.allCityList,(function(e,i){return a("Option",{key:i,attrs:{value:e.id}},[t._v(t._s(e.name))])})),1)],1),t._v(" "),a("FormItem",{attrs:{label:"年份",required:""}},[a("Select",{staticStyle:{width:"120px"},on:{"on-change":t.cityYearChange},model:{value:t.formData.year,callback:function(e){t.$set(t.formData,"year",e)},expression:"formData.year"}},t._l(t.yearList,(function(e,i){return a("Option",{key:i,attrs:{value:e}},[t._v(t._s(e))])})),1)],1),t._v(" "),a("FormItem",{attrs:{label:"学期",required:""}},[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:""},on:{"on-change":t.termChange},model:{value:t.formData.termId,callback:function(e){t.$set(t.formData,"termId",e)},expression:"formData.termId"}},t._l(t.termList,(function(e,i){return a("Option",{key:i,attrs:{value:e.id}},[t._v(t._s(e.name))])})),1)],1),t._v(" "),a("FormItem",{attrs:{label:"年部"}},[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:""},on:{"on-change":t.gradeTypeChange},model:{value:t.formData.gradeTypeId,callback:function(e){t.$set(t.formData,"gradeTypeId",e)},expression:"formData.gradeTypeId"}},t._l(t.gradeTypeList,(function(e,i){return a("Option",{key:i,attrs:{value:e.id}},[t._v(t._s(e.name))])})),1)],1),t._v(" "),a("FormItem",{attrs:{label:"年级"}},[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:""},on:{"on-change":t.gradeChange},model:{value:t.formData.gradeId,callback:function(e){t.$set(t.formData,"gradeId",e)},expression:"formData.gradeId"}},t._l(t.gradeList,(function(e,i){return a("Option",{key:i,attrs:{value:e.id}},[t._v(t._s(e.name))])})),1)],1),t._v(" "),a("FormItem",{attrs:{label:"学科"}},[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:"",filterable:""},on:{"on-change":t.subjectChange},model:{value:t.formData.subjectIds,callback:function(e){t.$set(t.formData,"subjectIds",e)},expression:"formData.subjectIds"}},t._l(t.subjectList,(function(e,i){return a("Option",{key:i,attrs:{value:e.id}},[t._v(t._s(e.name))])})),1)],1),t._v(" "),a("FormItem",{attrs:{label:"班次"}},[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:""},model:{value:t.formData.levelId,callback:function(e){t.$set(t.formData,"levelId",e)},expression:"formData.levelId"}},t._l(t.levelList,(function(e,i){return a("Option",{key:i,attrs:{value:e.id}},[t._v(t._s(e.name))])})),1)],1),t._v(" "),a("FormItem",{attrs:{label:"区域"}},[a("Select",{staticStyle:{width:"120px"},attrs:{filterable:"",clearable:""},on:{"on-change":t.changeArea},model:{value:t.formData.areaId,callback:function(e){t.$set(t.formData,"areaId",e)},expression:"formData.areaId"}},t._l(t.areaList,(function(e){return a("Option",{key:e.schoolId,attrs:{value:e.schoolId}},[t._v(t._s(e.name))])})),1)],1),t._v(" "),a("FormItem",{attrs:{label:"服务中心"}},[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:"",filterable:""},on:{"on-change":t.changeService},model:{value:t.formData.serviceCenterId,callback:function(e){t.$set(t.formData,"serviceCenterId",e)},expression:"formData.serviceCenterId"}},t._l(t.serviceCenterList,(function(e,i){return a("Option",{key:i,attrs:{value:e.schoolId}},[t._v(t._s(e.name))])})),1)],1),t._v(" "),a("FormItem",{attrs:{label:"教学点"}},[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:"",filterable:""},model:{value:t.formData.venueId,callback:function(e){t.$set(t.formData,"venueId",e)},expression:"formData.venueId"}},t._l(t.venueList,(function(e,i){return a("Option",{key:i,attrs:{value:e.schoolId}},[t._v(t._s(e.name))])})),1)],1),t._v(" "),a("FormItem",{attrs:{label:"老师姓名"}},[a("Select",{staticStyle:{width:"120px"},attrs:{filterable:"",clearable:"",remote:"","remote-method":t.getTeacher,"label-in-value":"",loading:t.loading1},on:{"on-change":t.optionChange},model:{value:t.formData.teacherId,callback:function(e){t.$set(t.formData,"teacherId",e)},expression:"formData.teacherId"}},t._l(t.teacherNameList,(function(e){return a("Option",{key:e.teaId,attrs:{value:e.teaId}},[t._v(t._s(e.sysName))])})),1)],1),t._v(" "),a("FormItem",{attrs:{label:"辅导老师"}},[a("Select",{staticStyle:{width:"120px"},attrs:{filterable:"",clearable:"",remote:"","remote-method":t.getTutor,"label-in-value":"",loading:t.loading1},on:{"on-change":t.optionChange},model:{value:t.formData.tutorId,callback:function(e){t.$set(t.formData,"tutorId",e)},expression:"formData.tutorId"}},t._l(t.tutorNameList,(function(e){return a("Option",{key:e.teaId,attrs:{value:e.teaId}},[t._v(t._s(e.sysName))])})),1)],1),t._v(" "),a("FormItem",{attrs:{label:"时间类型"}},[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:""},model:{value:t.formData.classtimeTimeClassify,callback:function(e){t.$set(t.formData,"classtimeTimeClassify",e)},expression:"formData.classtimeTimeClassify"}},t._l(t.classtimeTypeList,(function(e,i){return a("Option",{key:i,attrs:{value:e.name}},[t._v(t._s(e.name))])})),1)],1),t._v(" "),a("FormItem",{attrs:{label:"上课时间"}},[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:""},model:{value:t.formData.classtimeTimePeriod,callback:function(e){t.$set(t.formData,"classtimeTimePeriod",e)},expression:"formData.classtimeTimePeriod"}},t._l(t.classtimeList,(function(e,i){return a("Option",{key:i,attrs:{value:e.name}},[t._v(t._s(e.name))])})),1)],1),t._v(" "),a("FormItem",{attrs:{label:"已上课次"}},[a("InputNumber",{staticStyle:{width:"120px"},attrs:{clearable:"",min:0},model:{value:t.formData.passCountStart,callback:function(e){t.$set(t.formData,"passCountStart",e)},expression:"formData.passCountStart"}})],1),t._v(" "),a("FormItem",{attrs:{label:"开课日期"}},[a("DatePicker",{staticStyle:{width:"120px"},attrs:{editable:!1,type:"date"},on:{"on-change":t.startDateChange},model:{value:t.formData.startDateVal,callback:function(e){t.$set(t.formData,"startDateVal",e)},expression:"formData.startDateVal"}}),t._v("\n            至  \n          "),a("DatePicker",{staticStyle:{width:"120px"},attrs:{editable:!1,type:"date"},on:{"on-change":t.endDateChange},model:{value:t.formData.endDateVal,callback:function(e){t.$set(t.formData,"endDateVal",e)},expression:"formData.endDateVal"}})],1),t._v(" "),a("div",{staticStyle:{"text-align":"right"}},[a("Button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary"},on:{click:t.search}},[t._v("查询班级")]),t._v(" "),a("Button",{staticStyle:{"margin-right":"10px"},on:{click:t.resetFields}},[t._v("重置")])],1)],1)]),t._v(" "),a("div",{staticStyle:{"margin-top":"9px"}},[a("Table",{ref:"selection",staticStyle:{width:"100%"},attrs:{columns:t.tableColumns,data:t.tableData,loading:t.tableLoading},on:{"on-selection-change":t.selectionChange}})],1),t._v(" "),a("div",{class:{"page-fix":t.tableData.length<3},staticStyle:{margin:"10px",display:"flex","justify-content":"space-between"}},[a("div",[a("Button",{staticStyle:{"margin-right":"10px"},attrs:{disabled:!t.selectedRows.length},on:{click:t.printStudentNames}},[t._v("打印选中班级学员点名册")]),t._v(" "),a("Button",{staticStyle:{"margin-right":"10px"},attrs:{disabled:!t.selectedRows.length},on:{click:t.printCurrentCurriculumAttendance}},[t._v("打印选中班当次课考勤名单")]),t._v(" "),a("Button",{staticStyle:{"margin-right":"10px"},attrs:{disabled:!t.selectedRows.length},on:{click:t.printOneCurriculumStudentNames}},[t._v("按课次打印点名册")])],1),t._v(" "),a("Page",{attrs:{total:t.pageTotal,"page-size":t.currentPageSize,current:t.currentPageNum,"show-elevator":"","show-sizer":"","show-total":""},on:{"on-page-size-change":t.pageSizeChange,"on-change":t.changePage}})],1),t._v(" "),a("Modal",{attrs:{"mask-closable":!1,width:"1200","footer-hide":!0,title:"课次查看"},model:{value:t.curriculumModal,callback:function(e){t.curriculumModal=e},expression:"curriculumModal"}},[a("div",{staticClass:"info"},[a("span",[t._v("班级名称："+t._s(t.row.name))]),t._v(" "),a("span",[t._v("学科："+t._s(t.row.subjectNames))]),t._v(" "),a("span",[t._v("老师："+t._s(t.row.teacherNames))])]),t._v(" "),a("el-table",{staticStyle:{width:"100%","margin-bottom":"10px"},attrs:{data:t.curriculumData},on:{"selection-change":t.selectionCurriculumChange}},[a("el-table-column",{attrs:{type:"selection",align:"center",selectable:t.curriculumSelectable,width:"60"}}),t._v(" "),a("el-table-column",{attrs:{label:"操作",align:"center",width:"260px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("a",{staticStyle:{"margin-right":"10px"},attrs:{disabled:!t.curriculumSelectable(e.row)},on:{click:function(a){return t.printCurriculumAttendance(e.row.id)}}},[t._v("打印考勤单")]),t._v(" "),a("a",{staticStyle:{"margin-right":"10px"},attrs:{disabled:!t.curriculumSelectable(e.row)},on:{click:function(a){return t.showAttendance(e.row.id,!1)}}},[t._v("考勤查看")]),t._v(" "),a("a",{attrs:{disabled:!t.curriculumSelectable(e.row)},on:{click:function(a){return t.showAttendance(e.row.id,!0)}}},[t._v("修改考勤记录")])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"classNum",align:"center",label:"课次"}}),t._v(" "),a("el-table-column",{attrs:{prop:"classDate",align:"center",label:"上课日期"}}),t._v(" "),a("el-table-column",{attrs:{prop:"classtimeNames",align:"center",label:"上课时间"}}),t._v(" "),a("el-table-column",{attrs:{label:"是否已上课",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n            "+t._s(0===e.row.status?"未上课":"已上课")+"\n          ")]}}])})],1),t._v(" "),a("div",[a("Button",{attrs:{disabled:!t.selectedCurriculums.length},on:{click:t.printSelectedCurriculumAttendance}},[t._v("打印选中项考勤单")])],1),t._v(" "),a("Modal",{attrs:{"mask-closable":!1,width:"1200","footer-hide":!0,title:"考勤查看"},model:{value:t.attendModal,callback:function(e){t.attendModal=e},expression:"attendModal"}},[a("Table",{attrs:{columns:t.attendCols,data:t.attendData,loading:t.attendLoading}})],1),t._v(" "),a("Modal",{attrs:{"mask-closable":!1,width:"1200",title:"修改考勤记录"},model:{value:t.editAttendModal,callback:function(e){t.editAttendModal=e},expression:"editAttendModal"}},[a("div",{staticClass:"ivu-table ivu-table-default ivu-table-wrapper"},[t.attendLoading?a("Spin",{attrs:{size:"large",fix:""}}):t._e(),t._v(" "),a("div",{staticClass:"ivu-table-body"},[a("table",{staticStyle:{width:"100%"},attrs:{cellspacing:"0",cellpadding:"0",border:"0"}},[a("thead",[a("tr",{staticClass:"ivu-table-row"},[a("th",{staticClass:"ivu-table-column-center"},[a("div",{staticClass:"ivu-table-cell"},[t._v("序号")])]),t._v(" "),a("th",{staticClass:"ivu-table-column-center"},[a("div",{staticClass:"ivu-table-cell"},[t._v("学员姓名")])]),t._v(" "),a("th",{staticClass:"ivu-table-column-center"},[a("div",{staticClass:"ivu-table-cell"},[t._v("学员编号")])]),t._v(" "),a("th",{staticClass:"ivu-table-column-center",attrs:{width:"200px"}},[a("div",{staticClass:"ivu-table-cell"},[t._v("考勤状态")])]),t._v(" "),a("th",{staticClass:"ivu-table-column-center"},[a("div",{staticClass:"ivu-table-cell"},[t._v("考勤时间")])]),t._v(" "),a("th",{staticClass:"ivu-table-column-center"},[a("div",{staticClass:"ivu-table-cell"},[t._v("最后修改人")])]),t._v(" "),a("th",{staticClass:"ivu-table-column-center"},[a("div",{staticClass:"ivu-table-cell"},[t._v("修改时间")])]),t._v(" "),a("th",{staticClass:"ivu-table-column-center"},[a("div",{staticClass:"ivu-table-cell"},[t._v("是否有考勤")])])])]),t._v(" "),a("tbody",{staticClass:"ivu-table-tbody"},[t._l(t.attendData,(function(e,i){return t.attendData&&t.attendData.length>0?a("tr",{key:e.id,staticClass:"ivu-table-row"},[a("td",{staticClass:"ivu-table-column-center",class:{"is-change":e.isChange}},[a("div",{staticClass:"ivu-table-cell"},[t._v(t._s(i+1))])]),t._v(" "),a("td",{staticClass:"ivu-table-column-center",class:{"is-change":e.isChange}},[a("div",{staticClass:"ivu-table-cell"},[t._v(t._s(e.studentRealName))])]),t._v(" "),a("td",{staticClass:"ivu-table-column-center",class:{"is-change":e.isChange}},[a("div",{staticClass:"ivu-table-cell"},[t._v(t._s(e.studentCard))])]),t._v(" "),a("td",{staticClass:"ivu-table-column-center",class:{"is-change":e.isChange}},[a("div",{staticClass:"ivu-table-cell"},[a("RadioGroup",{on:{"on-change":function(a){return t.changeAttendanceType(e)}},model:{value:e.modifyType,callback:function(a){t.$set(e,"modifyType",a)},expression:"item.modifyType"}},[a("Radio",{attrs:{label:0}},[t._v("准时上课")]),t._v(" "),a("Radio",{attrs:{label:1}},[t._v("迟到")]),t._v(" "),a("Radio",{attrs:{label:2}},[t._v("缺课")])],1)],1)]),t._v(" "),a("td",{staticClass:"ivu-table-column-center",class:{"is-change":e.isChange}},[a("div",{staticClass:"ivu-table-cell"},[t._v(t._s(e.lastModifyDate))])]),t._v(" "),a("td",{staticClass:"ivu-table-column-center",class:{"is-change":e.isChange}},[a("div",{staticClass:"ivu-table-cell"},[t._v(t._s(e.empName))])]),t._v(" "),a("td",{staticClass:"ivu-table-column-center",class:{"is-change":e.isChange}},[a("div",{staticClass:"ivu-table-cell"},[t._v(t._s(e.empModifyDate))])]),t._v(" "),a("td",{staticClass:"ivu-table-column-center",class:{"is-change":e.isChange}},[a("div",{staticClass:"ivu-table-cell"},[null===e.modifyType?a("span",{staticStyle:{color:"red"}},[t._v("无")]):a("span",[t._v("有")])])])]):t._e()})),t._v(" "),t.attendData&&t.attendData.length?t._e():a("tr",[a("td",{staticClass:"ivu-table-column-center",attrs:{colspan:"7"}},[a("div",{staticClass:"ivu-table-cell"},[t._v("暂无数据")])])])],2)])])],1),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"primary",disabled:!this.attendData.filter((function(t){return t.isChange})).length},on:{loading:t.attendLoading,click:t.saveAttendance}},[t._v("提交")]),t._v(" "),a("Button",{on:{click:function(e){t.editAttendModal=!1}}},[t._v("取消")])],1)])],1),t._v(" "),a("tal-class-detail",{attrs:{show:t.classDetail.show,classId:t.classDetail.id},on:{close:function(e){t.classDetail.show=!1}}}),t._v(" "),a("tal-teacher-details",{ref:"teacherRef",attrs:{schoolCode:t.teacherDetail.cityCode,teacherId:t.teacherDetail.id,type:t.teacherDetail.type,stuId:t.studentDetail.studentId,stuSchoolCode:t.studentDetail.cityCode,creatorEmpNo:t.teacherDetail.empNo}}),t._v(" "),a("Modal",{attrs:{"mask-closable":!1,width:"300",title:"打印课次"},model:{value:t.confirmCurriculumModal,callback:function(e){t.confirmCurriculumModal=e},expression:"confirmCurriculumModal"}},[t._v("\n      请输入打印课次："),a("InputNumber",{attrs:{min:1},model:{value:t.printCurriculum,callback:function(e){t.printCurriculum=e},expression:"printCurriculum"}}),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"primary",disabled:!t.printCurriculum||t.printCurriculum<0},on:{click:t.confirmPrintStuNames}},[t._v("打印")]),t._v(" "),a("Button",{on:{click:function(e){t.confirmCurriculumModal=!1}}},[t._v("取消")])],1)],1)],1),t._v(" "),a("TalSchooltime",{ref:"talSchooltime"})],1)}),[],!1,null,"1a19a992",null);e.default=h.exports},"95ee":function(t,e,a){"use strict";a.r(e);a("ac6a"),a("cadf"),a("456d");var i=a("2fd4"),s=a("fa7d"),r={data:function(){return{dataList:[],now:Object(s.d)(new Date)}},methods:{getKaoQinText:function(t){var e="";switch(t.modifyType){case 0:e="准时上课";break;case 1:e="迟到";break;case 2:e="缺勤";break;default:e="无数据"}return"".concat(e," ").concat(t.lastModifyDate?t.lastModifyDate:"")}},mounted:function(){var t=this;document.documentElement.className="printPage",document.body.className="printPage";var e={cityCode:this.$route.query.cityCode,classId:this.$route.query.classIds};this.$route.query.classNum&&(e.classNum=this.$route.query.classNum),this.$route.query.curriculumId&&(e.curriculumId=this.$route.query.curriculumId),Object(i.j)(e).then((function(e){if(e&&e.length){if(1===e.length){var a=Object.keys(e[0].stringListMap);e=a.map((function(t){return{classDetail:e[0].classDetail,passedCount:t,classStudents:e[0].stringListMap[t]}}))}else e=e.map((function(t){var e=Object.keys(t.stringListMap);return{classDetail:t.classDetail,passedCount:e[0],classStudents:t.stringListMap[e[0]]}}));t.dataList=e,setTimeout((function(){window.print()}),500)}else t.dataList=[]})).catch((function(e){t.$Message.error({content:"获取班级考勤信息失败："+e.message,duration:5})}))}},n=(a("33ce"),a("7701"),a("2877")),c=Object(n.a)(r,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"wrapper"},t._l(t.dataList,(function(e,i){return a("div",{key:i,staticClass:"class"},[a("div",{staticStyle:{"text-align":"right"}},[t._v("打印时间："+t._s(t.now))]),t._v(" "),a("div",{staticClass:"class-name"},[t._v(t._s(e.classDetail.name))]),t._v(" "),a("div",{staticClass:"class-info"},[a("div",{staticClass:"info"},[t._v("课次：第"+t._s(e.passedCount)+"次课")]),t._v(" "),a("div",{staticClass:"info"},[t._v("服务中心："+t._s(e.classDetail.serviceCenterName))]),t._v(" "),a("div",{staticClass:"info"},[t._v("教学点："+t._s(e.classDetail.venueName))]),t._v(" "),a("div",{staticClass:"info"},[t._v("教室："+t._s(e.classDetail.classroomName))]),t._v(" "),a("div",{staticClass:"info"},[t._v("主讲老师："+t._s(e.classDetail.teacherNames))]),t._v(" "),a("div",{staticClass:"info"},[t._v("开课时间："+t._s(e.classDetail.startDate?e.classDetail.startDate.split(" ")[0]:"")+" 至 "+t._s(e.classDetail.endDate?e.classDetail.endDate.split(" ")[0]:""))]),t._v(" "),a("div",{staticClass:"info"},[t._v("上课时间："+t._s(e.classDetail.classtimeNames)+" "),a("span",[t._v("("+t._s(e.classDetail.classDate)+")")])]),t._v(" "),a("div",{staticClass:"info"},[t._v("教师签字：")])]),t._v(" "),a("table",{staticStyle:{border:"1px solid #000","border-collapse":"collapse"},attrs:{border:"1",width:"100%",cellspacing:"0",cellpadding:"0",bgcolor:"#ffffff",bordercolordark:"#ffffff",bordercolorlight:"#000000"}},[t._m(0,!0),t._v(" "),t._m(1,!0),t._v(" "),t._l(e.classStudents,(function(e,i){return a("tr",{key:i},[a("td",{attrs:{align:"center"}},[t._v(t._s(i+1))]),t._v(" "),a("td",{attrs:{align:"center"}},[t._v(t._s(e.studentRealName))]),t._v(" "),a("td",{attrs:{align:"center"}},[t._v(t._s(t.getKaoQinText(e)))])])}))],2),t._v(" "),t.dataList.length!=i+1?a("div",{staticClass:"page-break"}):t._e()])})),0)}),[function(){var t=this.$createElement,e=this._self._c||t;return e("tr",[e("td",{attrs:{colspan:"3",align:"center"}},[this._v("上课学员考勤单")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("tr",[e("td",{attrs:{align:"center",width:"60px"}},[this._v("编号")]),this._v(" "),e("td",{attrs:{align:"center",width:"100px"}},[this._v("学员姓名")]),this._v(" "),e("td",{attrs:{align:"center"}},[this._v("考勤")])])}],!1,null,"64f6b7dc",null);e.default=c.exports},9773:function(t,e,a){t.exports=a.p+"img/WechatIMG288.ba9a3838.png"},9848:function(t,e,a){},"9b07":function(t,e,a){"use strict";var i=a("d114");a.n(i).a},"9e7c":function(t,e,a){},a36e:function(t,e,a){"use strict";a("0d6d");var i=a("867e");e.a={data:function(){return{allCityList:[],allCityMap:{},classtimeList:[],classtimeTypeList:[],classTypeList:[],isSchoolTestList:[],yearList:[]}},methods:{isSchoolTestHandler:function(){var t=this;Object(i.r)({}).then((function(e){t.isSchoolTestList=Object.freeze(e)})).catch((function(e){console.log(e),t.$Message.warning({content:"获取是否入学测试失败:"+e.message,duration:5})}))},getAreaListHandler:function(t){return Object(i.c)(t)},getCityListHandler:function(){var t=this;Object(i.d)().then((function(e){t.allCityList=e})).catch((function(e){t.$Message.warning({content:"获取所有城市失败:"+e.message,duration:5})}))},getClassTypeHandler:function(){var t=this;Object(i.e)({}).then((function(e){t.classTypeList=Object.freeze(e)})).catch((function(e){t.$Message.warning({content:"获取授课类型失败:"+e.message,duration:5})}))},getLinkageHandler:function(t){return Object(i.h)(t)},getServiceCenterListHandler:function(t){return Object(i.j)(t)},getTeacherByNameFuzzyHandler:function(t){return Object(i.l)(t)},getTimeTypeListHandler:function(){var t=this;Object(i.n)({}).then((function(e){t.classtimeTypeList=Object.freeze(e)})).catch((function(e){t.$Message.warning({content:"获取上课时间类型失败:"+e.message,duration:5})}))},getTimeListHandler:function(){var t=this;Object(i.m)({}).then((function(e){t.classtimeList=Object.freeze(e)})).catch((function(e){t.$Message.warning({content:"获取上课时间失败:"+e.message,duration:5})}))},getVenueListHandler:function(t){return Object(i.p)(t)},getYearListHandler:function(){var t=this;Object(i.q)().then((function(e){t.yearList=Object.freeze(e)})).catch((function(e){t.$Message.warning({content:"获取年份失败:"+e.message,duration:5})}))}}}},bc76:function(t,e,a){},bdaf:function(t,e,a){},be6c:function(t,e,a){"use strict";var i=a("9e7c");a.n(i).a},beff:function(t,e,a){"use strict";a.r(e);var i={name:"teacherAttendance",data:function(){return{}},mounted:function(){}},s=(a("45e8"),a("2877")),r=Object(s.a)(i,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"wrapper"},[e("TalTeacherAttendance")],1)}),[],!1,null,"723fd52a",null);e.default=r.exports},c110:function(t,e,a){"use strict";var i=a("e269");a.n(i).a},c56e:function(t,e,a){},d114:function(t,e,a){},d8b4:function(t,e,a){"use strict";a.r(e);var i=a("2472"),s=a("fa7d"),r={data:function(){return{dataList:[],now:Object(s.d)(new Date)}},mounted:function(){var t=this;document.documentElement.className="printPage",document.body.className="printPage",Object(i.a)({cityCode:this.$route.query.cityCode,classIds:this.$route.query.classIds}).then((function(e){t.dataList=e.map((function(t){return t.classCount=t.classCount>40?40:t.classCount,t})),setTimeout((function(){window.print()}),500)})).catch((function(e){t.$Message.error({content:"获取班级点名册信息失败："+e.message,duration:5})}))}},n=(a("fd68"),a("3e7f"),a("2877")),c=Object(n.a)(r,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"wrapper"},t._l(t.dataList,(function(e,i){return a("div",{key:e.classId,staticClass:"class"},[a("div",{staticStyle:{"text-align":"right"}},[t._v("打印时间："+t._s(t.now))]),t._v(" "),a("div",{staticClass:"class-name"},[t._v(t._s(e.className))]),t._v(" "),a("div",{staticClass:"class-info"},[a("div",{staticClass:"info"},[t._v("服务中心："+t._s(e.serviceCenterName))]),t._v(" "),a("div",{staticClass:"info"},[t._v("教学点："+t._s(e.venueName))]),t._v(" "),a("div",{staticClass:"info"},[t._v("教室："+t._s(e.classroomName))]),t._v(" "),a("div",{staticClass:"info"},[t._v("主讲老师："+t._s(e.teacherNames))]),t._v(" "),a("div",{staticClass:"info"},[t._v("辅导老师："+t._s(e.tutorRealName))]),t._v(" "),a("div",{staticClass:"info"},[t._v("开课时间："+t._s(e.startDate?e.startDate.split(" ")[0]:"")+" 至 "+t._s(e.endDate?e.endDate.split(" ")[0]:""))]),t._v(" "),a("div",{staticClass:"info"},[t._v("上课时间："+t._s(e.classtimeNames))]),t._v(" "),a("div",{staticClass:"info"},[t._v("教师签字：")])]),t._v(" "),a("table",{staticStyle:{"table-layout":"fixed",border:"1px solid #000","border-collapse":"collapse"},attrs:{border:"1",width:"100%",cellspacing:"0",cellpadding:"0",bgcolor:"#ffffff",bordercolordark:"#ffffff",bordercolorlight:"#000000"}},[a("tr",[a("td",{attrs:{rowspan:"2",align:"center",width:"40px"}},[t._v("编号")]),t._v(" "),a("td",{attrs:{rowspan:"2",align:"center",width:"60px"}},[t._v("学员姓名")]),t._v(" "),a("td",{staticStyle:{"font-weight":"bold"},attrs:{colspan:e.classCount,align:"center"}},[t._v("准时出勤："),a("Icon",{attrs:{type:"md-checkmark"}}),t._v("，迟到："),a("Icon",{attrs:{type:"md-close"}}),t._v("，缺勤：O，资料领取：Y")],1)]),t._v(" "),a("tr",t._l(e.classCount,(function(i){return a("td",{key:e.classId+i,attrs:{align:"center"}},[t._v(t._s(i))])})),0),t._v(" "),t._l(e.studentNameList,(function(i,s){return a("tr",{key:s},[a("td",{attrs:{align:"center"}},[t._v(t._s(s+1))]),t._v(" "),a("td",{attrs:{align:"center"}},[t._v(t._s(i))]),t._v(" "),t._l(e.classCount,(function(t){return a("td",{key:e.classId+t})}))],2)}))],2),t._v(" "),a("table",{staticStyle:{"table-layout":"fixed",border:"1px solid #000","border-collapse":"collapse","margin-top":"20px"},attrs:{border:"1",width:"100%",cellspacing:"0",cellpadding:"0",bgcolor:"#ffffff",bordercolordark:"#ffffff",bordercolorlight:"#000000"}},[t._m(0,!0),t._v(" "),t._m(1,!0),t._v(" "),t._l(e.classCount,(function(i){return a("tr",{key:e.classId+i},[a("td",{attrs:{align:"center"}},[t._v(t._s(i))]),t._v(" "),a("td",{attrs:{align:"center"}})])}))],2),t._v(" "),t.dataList.length!=i+1?a("div",{staticClass:"page-break"}):t._e()])})),0)}),[function(){var t=this.$createElement,e=this._self._c||t;return e("tr",[e("td",{attrs:{rowspan:"2",align:"center",width:"100px"}},[this._v("临时调课课次")]),this._v(" "),e("td",{staticStyle:{"font-weight":"bold"},attrs:{align:"center"}},[this._v("临时调课次数由任课老师根据实际调课次数填写。最后一次课调课学员，仅发给优秀奖")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("tr",[e("td",{attrs:{align:"center"}},[this._v("临时调课学员名单")])])}],!1,null,"17f85eb0",null);e.default=c.exports},e0a5:function(t,e,a){"use strict";a.d(e,"j",(function(){return s})),a.d(e,"e",(function(){return r})),a.d(e,"h",(function(){return n})),a.d(e,"l",(function(){return c})),a.d(e,"b",(function(){return o})),a.d(e,"n",(function(){return l})),a.d(e,"m",(function(){return d})),a.d(e,"a",(function(){return u})),a.d(e,"c",(function(){return m})),a.d(e,"i",(function(){return h})),a.d(e,"g",(function(){return f})),a.d(e,"f",(function(){return g})),a.d(e,"k",(function(){return v})),a.d(e,"d",(function(){return p}));var i=a("66df"),s=function(t){return i.a.request({url:"/register/querySourceClass",data:t,method:"post"})},r=function(t){return i.a.request({url:"/register/getChangeClassType",params:t,method:"get"})};var n=function(t){return i.a.request({url:"/register/queryRegisterClassList",data:t,method:"post"})},c=function(t){return i.a.request({url:"register/queryWaitClassList",params:t,method:"get"})},o=function(t){return i.a.request({url:"/register/deleteAlternateRecord",data:t,method:"post"})},l=function(t){return i.a.request({url:"register/recoverCancelRegisters",params:t,method:"GET"})},d=function(t){return i.a.request({url:"register/queryWaitList",data:t,method:"post"})},u=function(t){return i.a.request({url:"register/batchRemoveWait",data:t,method:"post"})},m=function(t){return i.a.request({url:"register/exportWaitListExportExcel",data:t,method:"post",responseType:"blob"})},h=function(t){return i.a.request({url:"register/queryRegisterList",data:t,method:"post"})},f=function(t){return i.a.request({url:"register/queryRegisterClassGeneral",data:t,method:"post"})},g=function(t){return i.a.request({url:"register/getNotPayClassList",params:t,method:"get"})},v=function(t){return i.a.request({url:"register/queryWaitClassGeneral",params:t,method:"get"})},p=function(t){return i.a.request({url:"register/getCancellationsClassPage",data:t,method:"post"})}},e269:function(t,e,a){},f9b4:function(t,e,a){"use strict";a.r(e);a("097d"),a("0d6d");var i=a("fa7d"),s=a("2fd4"),r=a("49e5"),n=a("867e"),c={name:"attendanceCardMgt",mixins:[a("6ec6").a],data:function(){return{styleIndex:0,styleConfig:[{m_name_config:"635,434,850,500,6",m_cardnum_config:"630,474,850,520,6",m_img_config:"500,120,190,190"},{m_name_config:"500,200,850,500,14",m_cardnum_config:"500,270,850,520,8",m_img_config:"500,120,190,190"},{m_name_config:"500,200,850,500,14",m_cardnum_config:"500,270,850,520,8",m_img_config:"500,120,190,190"},{m_name_config:"60,200,850,500,14",m_cardnum_config:"60,270,850,520,8",m_img_config:"500,120,190,190"}],cols:Object.freeze([{title:"操作",align:"center",slot:"operation"},{title:"学员姓名",align:"center",key:"realName"},{title:"学员编号",align:"center",key:"card"},{title:"性别",align:"center",slot:"sexName"},{title:"年级",align:"center",key:"gradeName"},{title:"状态",align:"center",slot:"status"},{title:"考勤卡编号",align:"center",key:"oldCardNum"}]),studentDetail:{},tableData:[],tableLoading:!1,cardModal:!1,change:!1,cardTypes:[],formData:{cardNo:"",cardTypeId:""},printModal:!1,formValidate:{cardTypeId:[{required:!0,message:"请选择",trigger:"change",type:"string"}],cardNo:[{required:!0,message:"无卡号",trigger:"blur",type:"string"}]},logModal:!1,logColumns:Object.freeze([{title:"日期",key:"createDate",align:"center"},{title:"操作人",key:"empName",align:"center"},{title:"操作",key:"operateOverview",align:"center"},{title:"考勤卡编号",key:"businessId",align:"center"}]),logData:[],printerWS:null,isPrinterWSOpen:0,wsCount:0}},methods:{showLog:function(){var t=this;Object(n.b)({cityCode:this.studentDetail.cityCode,uid:this.studentDetail.uid,operateType:"attendance"}).then((function(e){t.logModal=!0,e&&e.length>0?t.logData=e:t.logData=[]})).catch((function(e){t.$Message.warning({content:"获取数据失败:"+e.message,duration:5})}))},closeLogModal:function(){this.logModal=!1,this.logData=[]},setStuInfo:function(t){this.tableData=[t],this.studentDetail=t,this.getCardType()},openCardModal:function(t){this.cardModal=!0,this.change=1===t,this.formData.cardTypeId="",this.formData.cardNo=""},writeCard:function(){var t=this;try{this.$refs.form.validate((function(e){e&&t.$refs.stuSearch.sendMsgToCard(t.formData.cardNo,2)}))}catch(t){console.log("写卡异常"),console.error(t)}},writeCardSuccess:function(){var t=this;this.change?Object(s.c)({cityCode:this.studentDetail.cityCode,stuId:this.studentDetail.studentId,uid:this.studentDetail.uid,stuUid:this.studentDetail.uid,typeId:this.formData.cardTypeId,typeName:this.cardTypes.filter((function(e){return e.typeId===t.formData.cardTypeId}))[0].typeName,cardNum:this.formData.cardNo,oldCardNum:this.studentDetail.oldCardNum}).then((function(e){t.$Modal.success({title:"提示",content:"考勤卡换卡成功",onOk:function(){t.cardModal=!1}}),t.update()})).catch((function(e){t.$Modal.error({title:"提示",content:"考勤卡换卡失败：".concat(e.message,"，请重试")})})):Object(s.b)({cityCode:this.studentDetail.cityCode,stuId:this.studentDetail.studentId,uid:this.studentDetail.uid,stuUid:this.studentDetail.uid,typeId:this.formData.cardTypeId,typeName:this.cardTypes.filter((function(e){return e.typeId===t.formData.cardTypeId}))[0].typeName,cardNum:this.formData.cardNo}).then((function(e){t.$Modal.success({title:"提示",content:"考勤卡绑定成功",onOk:function(){t.cardModal=!1}}),t.update()})).catch((function(e){t.$Modal.error({title:"提示",content:"考勤卡绑定失败：".concat(e.message,"，请重试")})}))},openPrintModal:function(){this.printModal=!0},printCard:function(){var t=this.styleConfig[this.styleIndex];console.log(t);var e=JSON.stringify({Name_Config:t.m_name_config,Name:this.studentDetail.realName,CardNum_Config:t.m_cardnum_config,CardNum:this.studentDetail.card,Img_Config:t.m_img_config,ImgUrl:""});this.sendPrintCardMsg(e)},getCardType:function(){var t=this;Object(s.e)({cityCode:this.studentDetail.cityCode}).then((function(e){t.cardTypes=[e]})).catch((function(e){t.$Message.error({content:"获取卡类型失败：".concat(e.message),duration:5})}))},cardTypeChange:function(t){var e=this;t&&Object(s.i)({cityCode:this.studentDetail.cityCode,typeId:t}).then((function(t){e.formData.cardNo=t.cardNum})).catch((function(t){e.$Message.error({content:"获取未使用考勤卡号失败：".concat(t.message),duration:5})}))},update:function(){var t=this;this.tableLoading=!0,setTimeout((function(){Object(r.b)({cityCode:t.studentDetail.cityCode,uid:t.studentDetail.uid}).then((function(e){t.studentDetail=e,t.tableData=[e]})).catch((function(e){t.$Message.warning({content:e.message,duration:5})})).finally((function(){t.tableLoading=!1}))}),2e3)},initPrinterWS:function(){var t=this,e=Object(i.a)().ie?"127.0.0.1":"localhost";this.printerWS=new WebSocket("wss://".concat(e,":11311/Printer")),this.printerWS.onopen=function(e){t.isPrinterWSOpen=1,console.log("Openened connection to websocket"),console.log(e)},this.printerWS.onclose=function(){console.log("Close connection to websocket"),t.isPrinterWSOpen=0,t.wsCount+=1,t.wsCount<10&&t.initPrinterWS()},this.printerWS.onmessage=function(e){var a=JSON.parse(e.data);switch(a.command){case 3:1===a.result?(t.$Message.success({content:"打印成功",duration:5}),t.printModal=!1):t.$Message.error({content:"打印失败："+a.content,duration:5});break;default:t.$Message.error({content:"打印错误："+a.content,duration:5})}}},sendPrintCardMsg:function(t){this.printerWS.send(JSON.stringify({content:t,command:3,order:-1}))}},mounted:function(){Object(n.w)({apiName:"attendanceManagePage"}),this.initPrinterWS()}},o=(a("c110"),a("2877")),l=Object(o.a)(c,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("Layout",{staticClass:"gary",attrs:{id:"TalAttendanceCardMgt"}},[i("TalStuSearch",{ref:"stuSearch",attrs:{"show-detail":!1,"stu-card":t.queryData.card,"stu-city-code":t.queryData.cityCode},on:{writeSuccess:t.writeCardSuccess,stuInfo:t.setStuInfo}}),t._v(" "),i("Table",{staticStyle:{width:"100%","margin-top":"10px"},attrs:{loading:t.tableLoading,columns:t.cols,data:t.tableData},scopedSlots:t._u([{key:"operation",fn:function(e){return[e.row.oldCardNum?i("a",{staticStyle:{"margin-right":"5px"},on:{click:function(e){return t.openCardModal(1)}}},[t._v("换卡")]):i("a",{staticStyle:{"margin-right":"5px"},on:{click:t.openCardModal}},[t._v("绑定")]),t._v(" "),i("a",{staticStyle:{"margin-right":"5px"},on:{click:t.openPrintModal}},[t._v("打印学员信息")]),t._v(" "),i("a",{on:{click:t.showLog}},[t._v("日志")])]}},{key:"status",fn:function(e){var a=e.row;return[t._v("\n      "+t._s(a.oldCardNum?"已绑定":"未绑定")+"\n    ")]}},{key:"sexName",fn:function(e){var a=e.row;return[t._v("\n      "+t._s(0===a.sex||2===a.sex?"女":"男")+"\n    ")]}}])}),t._v(" "),i("Modal",{attrs:{"mask-closable":!1,title:t.change?"换卡":"绑定新卡",width:"400px"},model:{value:t.cardModal,callback:function(e){t.cardModal=e},expression:"cardModal"}},[i("div",[i("div",[i("span",{staticStyle:{"margin-right":"50px"}},[t._v("学员姓名："+t._s(t.studentDetail.realName))]),i("span",[t._v("学员编号："+t._s(t.studentDetail.card))])]),t._v(" "),t.change?i("div",{staticStyle:{"margin-top":"30px"}},[i("div",[t._v("卡类型："+t._s(t.studentDetail.attendanceCardStyle))]),t._v(" "),i("div",{staticStyle:{"margin-top":"10px"}},[t._v("卡编号："+t._s(t.studentDetail.oldCardNum))])]):t._e(),t._v(" "),i("Form",{ref:"form",staticStyle:{"margin-top":"30px"},attrs:{model:t.formData,rules:t.formValidate}},[i("FormItem",{attrs:{label:"卡类型",required:"",prop:"cardTypeId"}},[i("Select",{staticStyle:{width:"200px"},on:{"on-change":t.cardTypeChange},model:{value:t.formData.cardTypeId,callback:function(e){t.$set(t.formData,"cardTypeId",e)},expression:"formData.cardTypeId"}},t._l(t.cardTypes,(function(e){return i("Option",{key:e.typeId,attrs:{value:e.typeId}},[t._v(t._s(e.typeName))])})),1)],1),t._v(" "),i("FormItem",{attrs:{label:"卡编号",required:"",prop:"cardNo"}},[i("Input",{staticStyle:{width:"200px"},attrs:{disabled:""},model:{value:t.formData.cardNo,callback:function(e){t.$set(t.formData,"cardNo",e)},expression:"formData.cardNo"}})],1)],1)],1),t._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"},[t.change?i("Button",{attrs:{type:"primary"},on:{click:t.writeCard}},[t._v("换卡")]):i("Button",{attrs:{type:"primary"},on:{click:t.writeCard}},[t._v("绑卡")])],1)]),t._v(" "),i("Modal",{attrs:{"mask-closable":!1,title:"打印卡片",width:"700px"},model:{value:t.printModal,callback:function(e){t.printModal=e},expression:"printModal"}},[i("div",[i("div",{staticStyle:{"margin-bottom":"10px"}},[i("h4",{staticStyle:{"margin-bottom":"10px"}},[t._v("学员信息")]),t._v(" "),i("div",[t._v("学员姓名："+t._s(t.studentDetail.realName))]),t._v(" "),i("div",[t._v("学员编号："+t._s(t.studentDetail.card))])]),t._v(" "),i("div",[i("h4",{staticStyle:{"margin-bottom":"10px"}},[t._v("请选择打印卡片样式")]),t._v(" "),i("RadioGroup",{model:{value:t.styleIndex,callback:function(e){t.styleIndex=e},expression:"styleIndex"}},[i("Radio",{attrs:{label:0}},[i("img",{attrs:{width:"300",height:"100",src:a("24c6")}})]),t._v(" "),i("Radio",{attrs:{label:1}},[i("img",{attrs:{width:"300",height:"100",src:a("8f23")}})]),t._v(" "),i("Radio",{attrs:{label:2}},[i("img",{attrs:{width:"300",height:"100",src:a("9773")}})]),t._v(" "),i("Radio",{attrs:{label:3}},[i("img",{attrs:{width:"300",height:"100",src:a("2fe9")}})])],1)],1)]),t._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("Button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary"},on:{click:t.printCard}},[t._v("打印")])],1)]),t._v(" "),i("Modal",{attrs:{"mask-closable":!1,title:"操作记录",width:"960px"},model:{value:t.logModal,callback:function(e){t.logModal=e},expression:"logModal"}},[i("Table",{staticStyle:{"margin-top":"20px"},attrs:{stripe:"",columns:t.logColumns,data:t.logData}}),t._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("Button",{on:{click:t.closeLogModal}},[t._v("关闭")])],1)],1)],1)}),[],!1,null,"0cc6784c",null);e.default=l.exports},fc4f:function(t,e,a){"use strict";a.r(e);a("ac6a"),a("96cf");var i=a("3b8d"),s=(a("f751"),a("fa7d")),r=a("90de"),n=a("a36e"),c=a("2801"),o=a("7014"),l=a("2fd4"),d=a("2472"),u=a("867e"),m=a("7618"),h={name:"td-button",props:{type:String,disabled:Boolean,text:String},methods:{handleClick:function(){this.$emit("click")}}},f=a("2877"),g=Object(f.a)(h,(function(){var t=this.$createElement;return(this._self._c||t)("Button",{attrs:{disabled:this.disabled,type:this.type,size:"small"},on:{click:this.handleClick}},[this._v(this._s(this.text))])}),[],!1,null,"e89249bc",null).exports,v={name:"js-table",props:{bgColor:String,tableData:{type:Array,default:function(){return[]}},config:{type:Object,default:function(){return{columns:[{label:"",align:"center",width:"",field:"",format:{},type:"text",action:function(t){},buttons:[{authKey:"",label:"",icon:"",checkValid:function(t,e,a){},action:function(t){}}]}]}}}},components:{TbButton:g},data:function(){return{}},methods:{getCellText:function(t,e){if(t.linkLabel)return t.linkLabel;var a=e[t.field];if(t.format){if("function"==typeof t.format)return t.format(a,e,t);if("object"===Object(m.a)(t.format)){if("time"===t.format.type)return Object(s.d)(a,"yyyy-MM-dd HH:mm:ss");if("date"===t.format.type)return Object(s.d)(a,"yyyy-MM-dd")}}return a},checkIsValid:function(t,e,a){return!a.checkValid||a.checkValid(t,e,a)},disabledStatus:function(t,e,a){return!!a.disabled&&a.disabled(e)},handleRowEvent:function(t,e){"function"==typeof t?t(e):this.$emit("rowEvent",t,e)}}},p=(a("684f"),Object(f.a)(v,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"ivu-table ivu-table-default ivu-table-border"},[a("div",{staticClass:"ivu-table-body"},[a("table",{staticStyle:{width:"100%"},attrs:{cellspacing:"0",cellpadding:"0",border:"0"}},[a("thead",[a("tr",{staticClass:"ivu-table-row"},t._l(t.config.columns,(function(e,i){return a("th",{key:i,staticClass:"ivu-table-column-center",style:{width:e.width+"px",backgroundColor:t.bgColor}},["index"==e.type?a("div",{staticClass:"ivu-table-cell ivu-columns-center"},[t._v(t._s(e.label))]):"selection"==e.type?a("div",{staticClass:"ivu-table-cell  ivu-columns-center"},[a("input",{attrs:{type:"checkbox"}})]):("link"==e.type||e.type,a("div",{staticClass:"ivu-table-cell ivu-columns-center"},[t._v(t._s(e.label))]))])})),0)]),t._v(" "),a("tbody",{staticClass:"ivu-table-tbody"},[t._l(t.tableData,(function(e,i){return a("tr",{key:i,staticClass:"ivu-table-row"},t._l(t.config.columns,(function(s,r){return a("td",{key:r},["index"==s.type?a("div",{staticClass:"ivu-table-cell ivu-columns-center"},[t._v(t._s(i+1))]):"selection"==s.type?a("div",{staticClass:"ivu-table-cell ivu-columns-center"},[a("input",{attrs:{type:"checkbox"}})]):"link"==s.type?a("div",{staticClass:"ivu-table-cell ivu-columns-center",on:{click:function(t){return s.action(e)}}},[t._v(t._s(t.getCellText(s,e)))]):"button"==s.type?a("div",{staticClass:"ivu-table-cell ivu-columns-center",staticStyle:{padding:"10px"}},[t._l(s.buttons,(function(r,n){return["text"==r.type?[t.checkIsValid(s,e,r)?a("span",{key:i+""+n,class:r.class},[t._v(t._s(r.label))]):t._e()]:[t.checkIsValid(s,e,r)?a("tb-button",{key:i+""+n,staticStyle:{"margin-left":"10px",cursor:"pointer","margin-top":"10px"},attrs:{type:r.type,text:r.label,disabled:t.disabledStatus(s,e,r)},on:{click:function(a){return t.handleRowEvent(r.action,e)}}}):t._e()]]}))],2):a("div",{staticClass:"ivu-table-cell ivu-columns-center"},[a("span",[t._v(t._s(t.getCellText(s,e)))])])])})),0)}))],2)]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!t.tableData.length,expression:"!tableData.length"}]},[t._m(0)]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!t.tableData.length,expression:"!tableData.length"}],staticClass:"ivu-line"})])])])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("p",{staticStyle:{"text-align":"center","line-height":"50px",width:"100%"}},[e("span",[this._v("暂无数据")])])}],!1,null,"a02f93c0",null).exports),y=a("a78e"),_=a.n(y),b={year:(new Date).getFullYear()+"",cityCode:"",termId:"",gradeTypeId:"",gradeId:"",subjectId:"",levelId:"",studentCard:"",studentName:"",teacherName:"",teacherId:"",className:"",classNum:null,isReturnVisit:null,autoCallStatus:null,areaId:"",serviceCenterId:"",venueId:"",classDate:"",minStartTime:"",maxStartTime:""},D={0:"未回访",1:"已回访"},C={0:"否",1:"是"},I={name:"studentAttendanceReply",mixins:[n.a,c.a,o.a],components:{JsTable:p},data:function(){var t=this;return{formData:Object.assign({},b),loading1:!1,tableLoading:!1,spinShow:!1,visitLoad:!1,studentReplyModel:!1,intervalTime:[],visitData:{returnDate:Object(r.a)((new Date).getTime()+1e3,"yyyy-MM-dd"),visitTime:"",remark:"",currentPageNum:1,currentPageSize:5,pageTotal:0},currentPageNum:1,currentPageSize:10,pageTotal:0,cityWithoutAllCity:[],allCityList:[],allCityMap:{},termList:[],gradeTypeList:[],subjectList:[],gradeList:[],levelList:[],teacherNameList:[],areaList:[],serviceCenterList:[],venueList:[],replyList:[{value:0,label:"未回访"},{value:1,label:"已回访"}],visitStatusList:[{value:3,label:"已接通"},{value:4,label:"未接通"}],ruleForm:{cityCode:[{required:!0,message:"分校不能为空",trigger:"change"}],year:[{required:!0,message:"年份不能为空",trigger:"change"}],termId:[{required:!0,message:"学期不能为空",trigger:"change"}],gradeTypeId:[{required:!0,message:"学部不能为空",trigger:"change"}],areaId:[{required:!0,message:"地区不能为空",trigger:"change"}],serviceCenterId:[{required:!0,message:"服务中心不能为空",trigger:"change"}],classDate:[{required:!0,message:"上课日期不能为空",trigger:"change"}]},tableData:[],tableColumns:[{title:"序号",key:"count",align:"center"},{title:"学员编号",key:"studentCard",align:"center"},{title:"学员姓名",key:"studentName",align:"center"},{title:"班级名称",key:"className",align:"center",width:160,render:function(e,a){return e("div",[e("div",{style:{"text-align":"right"}},[e("Tag",{style:{display:1===a.row.businessType?"inline-block":"none"},props:{color:"green"}},"全国班")]),e("a",{on:{click:function(){t.showClassDetail(a.row.classId)}}},a.row.className)])}},{title:"服务中心",key:"serviceCenterName",align:"center"},{title:"教学点",key:"venueName",align:"center"},{title:"教师名称",align:"center",render:function(e,a){return e("a",{on:{click:function(){t.showTeacherDetail(t.formData.cityCode,a.row.teacherId,"0")}}},a.row.teacherName)}},{title:"上课时间",key:"classTimeName",width:"120",align:"center",render:function(e,a){return e("a",{on:{click:(r=Object(i.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.showSchooltime({cityId:t.formData.cityCode,id:a.row.classId});case 1:case"end":return e.stop()}}),e)}))),function(){return r.apply(this,arguments)})}},Object(s.g)(a.row.classtimeNames,15,!0));var r}},{title:"开课日期",key:"startDate",align:"center"},{title:"结课日期",key:"endDate",align:"center"},{title:"课次",key:"curriculumNum",align:"center"},{title:"是否有考勤",align:"center",render:function(t,e){return t("span",C[e.row.isAttend])}},{title:"是否回访",align:"center",render:function(t,e){return t("span",{style:{color:1===e.row.isVisit?"#000":"red"}},D[e.row.isVisit])}},{title:"自动回访",align:"center",render:function(t,e){return t("span",3===e.row.autoCallStatus?"已接通":4===e.row.autoCallStatus?"未接通":"--")}},{title:"自动回访时间",key:"callTime",align:"center"},{title:"操作",align:"center",width:100,render:function(e,a){return e("div",[e("Button",{props:{type:"info",size:"small"},on:{click:function(){t.seeReply(a.row)}}},"查看")])}}],curriculumCols:{columns:[{label:"回访人",field:"employeeName"},{label:"回访日期",field:"returnDate"},{label:"回访备注",field:"remark"},{label:"所在班级",field:"className"},{label:"创建时间",width:"100",field:"createDate"}]},bgColor:"#F8F8F9",curriculumData:[],chooseData:{},visitDetail:{},uid:"",changeCourseData:{0:"否",1:"是"}}},created:function(){this.getYearListHandler(),this.getCityListHandler(),Object(u.w)({apiName:"stuAttendanceVisitPage"})},watch:{allCityList:function(t){t&&t.length&&(this.formData.cityCode=t[0].id,this.cityYearChange(this.formData.cityCode)),this.cityWithoutAllCity=t.filter((function(t){return"1111"!==t.id}))}},methods:{getBaseData:function(){var t=this,e={cityCode:this.formData.cityCode};this.getAreaListHandler(e).then((function(e){t.areaList=e,Object(d.e)({cityCode:t.formData.cityCode,empNo:JSON.parse(_.a.get("columbusUserInfo")).id}).then((function(e){t.formData.areaId=e.areaId,t.changeArea(e.areaId,e.serviceCenterId)})).catch((function(e){t.$Message.error("获取当前所在服务中心失败:"+e.message)}))})).catch((function(e){t.$Message.error("获取区域失败:"+e.message)}))},changeClassDate:function(t){this.formData.classDate=t},changeVisitDate:function(t){this.visitData.returnDate=t,this.visitData.visitTime=t},clearList:function(t){switch(t){case"school":this.termList=[],this.formData.termId="",this.gradeTypeList=[],this.formData.gradeTypeId="",this.gradeList=[],this.formData.gradeId="",this.subjectList=[],this.formData.subjectId="",this.levelList=[],this.formData.levelId="",this.formData.areaId="",this.areaList=[],this.formData.serviceCenterId="",this.serviceCenterList=[],this.formData.venueId="",this.venueList=[];break;case"term":this.formData.gradeTypeId="",this.formData.gradeId="",this.formData.subjectId="",this.formData.levelId="",this.gradeTypeList=[],this.gradeList=[],this.subjectList=[],this.levelList=[];break;case"gradeType":this.formData.gradeId="",this.formData.subjectId="",this.formData.levelId="",this.gradeList=[],this.subjectList=[],this.levelList=[];break;case"grade":this.formData.subjectId="",this.formData.levelId="",this.subjectList=[],this.levelList=[];break;case"subject":this.formData.levelId="",this.levelList=[]}},cityYearChange:function(t){var e=this;if(this.clearList("school"),!t)return!1;if(!this.formData.cityCode)return this.$Message.warning("请选择城市"),!1;this.getBaseData();var a={cityCode:this.formData.cityCode,years:this.formData.year,queryType:"t"};this.getLinkageHandler(a).then((function(t){e.termList=t})).catch((function(t){e.$Message.error("获取学期失败:"+t.message)}))},termChange:function(t){var e=this;if(this.clearList("term"),t){var a={cityCode:this.formData.cityCode,years:this.formData.year,termIds:this.formData.termId,queryType:"gt"};this.getLinkageHandler(a).then((function(t){e.gradeTypeList=t})).catch((function(t){e.$Message.error("获取年部失败:"+t.message)}))}},gradeTypeChange:function(t){var e=this;if(this.clearList("gradeType"),t){var a={cityCode:this.formData.cityCode,years:this.formData.year,termIds:this.formData.termId,gtIds:this.formData.gradeTypeId,queryType:"g"};this.getLinkageHandler(a).then((function(t){e.gradeList=t})).catch((function(t){e.$Message.error("获取年级失败:"+t.message)}))}},gradeChange:function(t){var e=this;if(this.clearList("grade"),t){var a={cityCode:this.formData.cityCode,years:this.formData.year,termIds:this.formData.termId,gtIds:this.formData.gradeTypeId,gradeIds:this.formData.gradeId,queryType:"s"};this.getLinkageHandler(a).then((function(t){e.subjectList=t})).catch((function(t){e.$Message.error("获取学科失败:"+t.message)}))}},subjectChange:function(t){var e=this;if(this.clearList("subject"),t){var a={cityCode:this.formData.cityCode,years:this.formData.year,termIds:this.formData.termId,gtIds:this.formData.gradeTypeId,gradeIds:this.formData.gradeId,subjectId:this.formData.subjectId,queryType:"c"};this.getLinkageHandler(a).then((function(t){e.levelList=t})).catch((function(t){e.$Message.error("获取班次失败:"+t.message)}))}},getTeacher:function(t){var e=this;if(this.formData.cityCode){if((t=t.trim())&&t!==this.oldSearchName){this.loading1=!0,this.teacherNameList=[];var a={sysName:t,teacherType:0,cityCode:this.formData.cityCode,businessType:this.formData.teacherType,pageNo:1,pageSize:20};this.getTeacherByNameFuzzyHandler(a).then((function(t){e.teacherNameList=t.records,e.loading1=!1})).catch((function(t){e.loading1=!1,e.$Message.error("获取主讲老师姓名失败:"+t.message)}))}}else this.$Message.warning("未选择城市")},optionChange:function(t){t&&t.label&&(this.oldSearchName=t.label)},changeDateTime:function(t){t&&(this.formData.minStartTime=t[0],this.formData.maxStartTime=t[1])},clearTeacher:function(){this.oldSearchName="",this.formData.teacherId&&(this.formData.teacherId="")},changeArea:function(t,e){var a=this;if(this.serviceCenterList=[],this.formData.serviceCenterId="",!t)return!1;var i={cityCode:this.formData.cityCode,areaId:this.formData.areaId};this.getServiceCenterListHandler(i).then((function(t){a.serviceCenterList=t,a.serviceCenterList.forEach((function(t){t.address||(t.address="")})),e&&(a.formData.serviceCenterId=e,a.changeService(e))})).catch((function(t){a.$Message.warning("获取服务中心失败:"+t.message)}))},changeService:function(t){var e=this;if(this.venueList=[],this.formData.venueId="",!t)return!1;var a={cityCode:this.formData.cityCode,serviceId:this.formData.serviceCenterId};this.getVenueListHandler(a).then((function(t){e.venueList=t})).catch((function(t){e.$Message.warning("获取教学点失败:"+t.message)}))},search:function(t){this.getTableData(t)},resetField:function(){this.formData=Object.assign({},b),this.cityWithoutAllCity&&(this.formData.cityCode=this.cityWithoutAllCity[0].id,this.cityYearChange(this.formData.cityCode)),this.intervalTime=[],this.$refs.form.resetFields()},changePage:function(t){this.currentPageNum=t,this.getTableData("form")},pageSizeChange:function(t){this.currentPageNum=1,this.currentPageSize=t,this.getTableData("form")},visitPageSizeChange:function(t){this.visitData.currentPageNum=1,this.visitData.currentPageSize=t,this.getDetailData()},changeVisitPage:function(t){this.visitData.currentPageNum=t,this.getDetailData()},getTableData:function(t){var e=this;this.$refs[t].validate((function(t){t&&(e.formData.pageSize=e.currentPageSize,e.formData.pageNo=e.currentPageNum,e.formData.teacherName=e.oldSearchName,e.tableLoading=!0,Object(l.l)(e.formData).then((function(t){0===t.records.length&&(e.tableData=[],e.$Message.warning("暂无数据")),e.pageTotal=t.totalCount,e.tableData=t.records,e.tableData.forEach((function(t,e){t.count=e+1,t.startDate||(t.startDate="--"),t.endDate||(t.endDate="--"),t.callTime||(t.callTime="--")})),e.tableLoading=!1})).catch((function(t){e.tableLoading=!1,e.$Message.warning({content:"获取数据失败:"+t.message,duration:5})})))}))},getDetailData:function(){var t=this;this.spinShow=!0,Object(l.k)({pageNo:this.visitData.currentPageNum,pageSize:this.visitData.currentPageSize,preAttendanceId:this.chooseData.preAttendanceId,cityCode:this.formData.cityCode}).then((function(e){0===e.record.records.length&&(t.curriculumData=[]),t.spinShow=!1,t.visitDetail=e.info,t.curriculumData=e.record.records,t.visitData.pageTotal=e.record.totalCount})).catch((function(e){t.spinShow=!1,t.$Message.error({content:"获取学员考勤回访信息失败：".concat(e.message),duration:5})}))},closeModel:function(){this.studentReplyModel=!1,this.chooseData={},this.visitData={remark:"",returnDate:Object(r.a)((new Date).getTime()+1e3,"yyyy-MM-dd"),currentPageNum:1,currentPageSize:5,pageTotal:0}},seeReply:function(t){this.studentReplyModel=!0,this.chooseData=t,this.uid=t.studentUid,this.getDetailData()},handleVisibleChange:function(t){t&&(this.visitData.visitTime=Object(r.a)((new Date).getTime()+1e3,"yyyy-MM-dd"))},edite:function(){var t=this;this.visitData.remark?(this.visitLoad=!0,Object(l.d)({preAttendanceId:this.chooseData.preAttendanceId,remark:this.visitData.remark,returnDate:this.visitData.visitTime,cityCode:this.formData.cityCode}).then((function(e){t.visitLoad=!1,t.$Message.success({content:"修改成功"}),t.visitData.remark="",t.getDetailData(),t.getTableData("form")})).catch((function(e){t.visitLoad=!1,t.$Message.error({content:"获取学员考勤回访信息失败：".concat(e.message),duration:5})}))):this.$Message.warning({content:"回访备注不能为空"})}}},w=(a("9b07"),Object(f.a)(I,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Layout",{staticClass:"gary",staticStyle:{width:"100%"},attrs:{id:"TalClassAttendance"}},[a("div",{staticClass:"container",staticStyle:{"margin-top":"15px"}},[a("Form",{ref:"form",staticClass:"ivu-common-shadow",attrs:{model:t.formData,rules:t.ruleForm,"label-position":"right","label-width":90,inline:""}},[a("div",{staticClass:"class_top"},[a("FormItem",{attrs:{prop:"cityCode",label:"城市"}},[a("Select",{staticStyle:{width:"120px"},attrs:{filterable:""},on:{"on-change":t.cityYearChange},model:{value:t.formData.cityCode,callback:function(e){t.$set(t.formData,"cityCode",e)},expression:"formData.cityCode"}},t._l(t.cityWithoutAllCity,(function(e,i){return a("Option",{key:i,attrs:{value:e.id}},[t._v(t._s(e.name))])})),1)],1),t._v(" "),a("FormItem",{attrs:{prop:"year",label:"年份"}},[a("Select",{staticStyle:{width:"120px"},on:{"on-change":t.cityYearChange},model:{value:t.formData.year,callback:function(e){t.$set(t.formData,"year",e)},expression:"formData.year"}},t._l(t.yearList,(function(e,i){return a("Option",{key:i,attrs:{value:e}},[t._v(t._s(e))])})),1)],1),t._v(" "),a("FormItem",{attrs:{prop:"termId",label:"学期"}},[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:""},on:{"on-change":t.termChange},model:{value:t.formData.termId,callback:function(e){t.$set(t.formData,"termId",e)},expression:"formData.termId"}},t._l(t.termList,(function(e,i){return a("Option",{key:i,attrs:{value:e.id}},[t._v(t._s(e.name))])})),1)],1),t._v(" "),a("FormItem",{attrs:{prop:"gradeTypeId",label:"学部"}},[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:""},on:{"on-change":t.gradeTypeChange},model:{value:t.formData.gradeTypeId,callback:function(e){t.$set(t.formData,"gradeTypeId",e)},expression:"formData.gradeTypeId"}},t._l(t.gradeTypeList,(function(e,i){return a("Option",{key:i,attrs:{value:e.id}},[t._v(t._s(e.name))])})),1)],1),t._v(" "),a("FormItem",{attrs:{label:"年级"}},[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:""},on:{"on-change":t.gradeChange},model:{value:t.formData.gradeId,callback:function(e){t.$set(t.formData,"gradeId",e)},expression:"formData.gradeId"}},t._l(t.gradeList,(function(e,i){return a("Option",{key:i,attrs:{value:e.id}},[t._v(t._s(e.name))])})),1)],1),t._v(" "),a("FormItem",{attrs:{label:"学科"}},[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:""},on:{"on-change":t.subjectChange},model:{value:t.formData.subjectId,callback:function(e){t.$set(t.formData,"subjectId",e)},expression:"formData.subjectId"}},t._l(t.subjectList,(function(e,i){return a("Option",{key:i,attrs:{value:e.id}},[t._v(t._s(e.name))])})),1)],1),t._v(" "),a("FormItem",{attrs:{label:"班次"}},[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:"",filterable:""},model:{value:t.formData.levelId,callback:function(e){t.$set(t.formData,"levelId",e)},expression:"formData.levelId"}},t._l(t.levelList,(function(e,i){return a("Option",{key:i,attrs:{value:e.id}},[t._v(t._s(e.name))])})),1)],1),t._v(" "),a("FormItem",{attrs:{label:"学员编号"}},[a("Input",{staticStyle:{width:"120px"},attrs:{clearable:"",placeholder:"请输入"},model:{value:t.formData.studentCard,callback:function(e){t.$set(t.formData,"studentCard","string"==typeof e?e.trim():e)},expression:"formData.studentCard"}})],1),t._v(" "),a("FormItem",{attrs:{label:"学员姓名"}},[a("Input",{staticStyle:{width:"120px"},attrs:{clearable:"",placeholder:"请输入"},model:{value:t.formData.studentName,callback:function(e){t.$set(t.formData,"studentName","string"==typeof e?e.trim():e)},expression:"formData.studentName"}})],1),t._v(" "),a("FormItem",{attrs:{label:"老师姓名"}},[a("Select",{staticStyle:{width:"120px"},attrs:{filterable:"",clearable:"",remote:"","remote-method":t.getTeacher,"label-in-value":"",loading:t.loading1},on:{"on-change":t.optionChange,"on-clear":t.clearTeacher},model:{value:t.formData.teacherId,callback:function(e){t.$set(t.formData,"teacherId",e)},expression:"formData.teacherId"}},t._l(t.teacherNameList,(function(e){return a("Option",{key:e.teaId,attrs:{value:e.teaId}},[t._v(t._s(e.sysName))])})),1)],1),t._v(" "),a("FormItem",{attrs:{label:"班级名称"}},[a("Input",{staticStyle:{width:"120px"},attrs:{clearable:"",placeholder:"请输入"},model:{value:t.formData.className,callback:function(e){t.$set(t.formData,"className","string"==typeof e?e.trim():e)},expression:"formData.className"}})],1),t._v(" "),a("FormItem",{attrs:{label:"课次"}},[a("InputNumber",{staticStyle:{width:"120px"},attrs:{max:100,min:0},model:{value:t.formData.classNum,callback:function(e){t.$set(t.formData,"classNum",e)},expression:"formData.classNum"}})],1),t._v(" "),a("FormItem",{attrs:{label:"是否回访"}},[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:""},model:{value:t.formData.isReturnVisit,callback:function(e){t.$set(t.formData,"isReturnVisit",e)},expression:"formData.isReturnVisit"}},t._l(t.replyList,(function(e,i){return a("Option",{key:i,attrs:{value:e.value}},[t._v(t._s(e.label))])})),1)],1),t._v(" "),a("FormItem",{attrs:{prop:"areaId",label:"区域"}},[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:"",filterable:""},on:{"on-change":t.changeArea},model:{value:t.formData.areaId,callback:function(e){t.$set(t.formData,"areaId",e)},expression:"formData.areaId"}},t._l(t.areaList,(function(e){return a("Option",{key:e.schoolId,attrs:{value:e.schoolId}},[t._v(t._s(e.name))])})),1)],1),t._v(" "),a("FormItem",{attrs:{prop:"serviceCenterId",label:"服务中心"}},[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:"",filterable:""},on:{"on-change":t.changeService},model:{value:t.formData.serviceCenterId,callback:function(e){t.$set(t.formData,"serviceCenterId",e)},expression:"formData.serviceCenterId"}},t._l(t.serviceCenterList,(function(e,i){return a("Option",{key:i,attrs:{value:e.schoolId}},[t._v(t._s(e.name))])})),1)],1),t._v(" "),a("FormItem",{attrs:{label:"教学点"}},[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:"",filterable:""},model:{value:t.formData.venueId,callback:function(e){t.$set(t.formData,"venueId",e)},expression:"formData.venueId"}},t._l(t.venueList,(function(e,i){return a("Option",{key:i,attrs:{value:e.schoolId}},[t._v(t._s(e.name))])})),1)],1),t._v(" "),a("FormItem",{attrs:{prop:"classDate",label:"上课日期"}},[a("DatePicker",{staticClass:"e-input",staticStyle:{width:"120px"},attrs:{editable:!1,type:"date",format:"yyyy-MM-dd"},on:{"on-change":t.changeClassDate},model:{value:t.formData.classDate,callback:function(e){t.$set(t.formData,"classDate",e)},expression:"formData.classDate"}})],1),t._v(" "),a("FormItem",{attrs:{label:"自动回访"}},[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:""},model:{value:t.formData.autoCallStatus,callback:function(e){t.$set(t.formData,"autoCallStatus",e)},expression:"formData.autoCallStatus"}},t._l(t.visitStatusList,(function(e,i){return a("Option",{key:i,attrs:{value:e.value}},[t._v(t._s(e.label))])})),1)],1),t._v(" "),a("FormItem",{attrs:{label:"上课开始时间"}},[a("TimePicker",{staticStyle:{width:"168px"},attrs:{format:"HH:mm:ss",type:"timerange",placement:"bottom-end"},on:{"on-change":t.changeDateTime},model:{value:t.intervalTime,callback:function(e){t.intervalTime=e},expression:"intervalTime"}})],1),t._v(" "),a("div",{staticStyle:{"text-align":"right"}},[a("FormItem",[a("Button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary"},on:{click:function(e){return t.search("form")}}},[t._v("查询")]),t._v(" "),a("Button",{staticStyle:{"margin-right":"10px"},on:{click:t.resetField}},[t._v("重置")])],1)],1)],1)]),t._v(" "),a("div",{staticStyle:{"margin-top":"9px"}},[a("Table",{ref:"selection",staticStyle:{width:"100%"},attrs:{columns:t.tableColumns,data:t.tableData,loading:t.tableLoading}})],1),t._v(" "),a("div",{class:{"page-fix":t.tableData.length<3},staticStyle:{margin:"10px"}},[a("div",{staticStyle:{"text-align":"right"}},[a("Page",{attrs:{total:t.pageTotal,"page-size":t.currentPageSize,current:t.currentPageNum,"show-elevator":"","show-sizer":"","show-total":""},on:{"on-page-size-change":t.pageSizeChange,"on-change":t.changePage}})],1)]),t._v(" "),a("Modal",{attrs:{"mask-closable":!1,width:"960",title:"考勤回访查看"},on:{"on-visible-change":t.handleVisibleChange},model:{value:t.studentReplyModel,callback:function(e){t.studentReplyModel=e},expression:"studentReplyModel"}},[a("div",{staticClass:"demo-spin-col"},[a("Divider",{attrs:{orientation:"left"}},[t._v("基本信息")]),t._v(" "),a("Row",{staticClass:"code-row-bg ivu-row-class",attrs:{type:"flex",justify:"center"}},[a("Col",{attrs:{span:"7"}},[a("span",[t._v("学员编号：")]),t._v(" "),a("span",{staticClass:"ivu-content-color"},[t._v("\n                  "+t._s(t.visitDetail.studentCard)+"\n            ")])]),t._v(" "),a("Col",{attrs:{span:"7"}},[a("span",[t._v("学员姓名：")]),a("span",{staticClass:"ivu-content-color"},[t._v(" "+t._s(t.visitDetail.studentRealName))])]),t._v(" "),a("Col",{attrs:{span:"7"}},[a("span",[t._v("班级名称：")]),t._v(" "),a("span",{staticClass:"ivu-content-color"},[a("Tooltip",{attrs:{content:t.visitDetail.className?t.visitDetail.className:"--"}},[t._v("\n                  "+t._s(t.visitDetail.className?t.visitDetail.className.length>16?t.visitDetail.className.substr(0,15)+"......":t.visitDetail.className:"--")+"\n              ")])],1)])],1),t._v(" "),a("Row",{staticClass:"code-row-bg ivu-row-class",attrs:{type:"flex",justify:"center"}},[a("Col",{attrs:{span:"7"}},[a("span",[t._v("服务中心：")]),a("span",{staticClass:"ivu-content-color"},[t._v(t._s(t.visitDetail.serviceCenterName))])]),t._v(" "),a("Col",{attrs:{span:"7"}},[a("span",[t._v("教学点：")]),a("span",{staticClass:"ivu-content-color"},[t._v(t._s(t.visitDetail.venueName))])]),t._v(" "),a("Col",{attrs:{span:"7"}},[a("span",[t._v("教师姓名：")]),a("span",{staticClass:"ivu-content-color"},[t._v(t._s(t.visitDetail.teacherName))])])],1),t._v(" "),a("Row",{staticClass:"code-row-bg ivu-row-class",attrs:{type:"flex",justify:"center"}},[a("Col",{attrs:{span:"21"}},[a("span",[t._v("上课时间：")]),t._v(" "),a("span",{staticClass:"ivu-content-color"},[a("Tooltip",{attrs:{content:t.visitDetail.classTimeName?t.visitDetail.classTimeName:"--"}},[t._v("\n                  "+t._s(t.visitDetail.classTimeName?t.visitDetail.classTimeName.length>56?t.visitDetail.classTimeName.substr(0,15)+"......":t.visitDetail.classTimeName:"--")+"\n              ")])],1)])],1),t._v(" "),a("Row",{staticClass:"code-row-bg ivu-row-class",attrs:{type:"flex",justify:"center"}},[a("Col",{attrs:{span:"7"}},[a("span",[t._v("是否调课：")]),a("span",{staticClass:"ivu-content-color"},[t._v(t._s(t.visitDetail.changeCourseStatus?t.changeCourseData[t.visitDetail.changeCourseStatus]:"--"))])]),t._v(" "),a("Col",{attrs:{span:"14"}},[a("span",[t._v("课次：")]),a("span",{staticClass:"ivu-content-color"},[t._v(t._s(t.visitDetail.curriculumNo))])])],1),t._v(" "),a("Row",{staticClass:"code-row-bg ivu-row-class",staticStyle:{background:"#E4F3FF"},attrs:{type:"flex",justify:"center"}},[a("Col",{attrs:{span:"21"}},[a("span",[t._v("联系方式：")]),a("span",{staticClass:"ivu-content-color"},[t._v("\n            第一联系人\n            "),a("tal-decode-text",{attrs:{"encode-text":t.visitDetail.motherTel?t.visitDetail.motherTel:"",type:"phone",uid:t.uid}}),t._v(" "),a("span",{staticStyle:{display:"inline-block","margin-left":"5px","margin-right":"5px"}}),t._v("\n             第二联系人\n            "),a("tal-decode-text",{attrs:{"encode-text":t.visitDetail.fatherTel?t.visitDetail.fatherTel:"",type:"phone",uid:t.uid}})],1)])],1),t._v(" "),a("Row",{staticClass:"code-row-bg ivu-row-class",attrs:{type:"flex",justify:"center"}},[a("Col",{attrs:{span:"21"}},[a("span",[t._v("考勤信息：")]),t._v(" "),a("span",{staticClass:"ivu-content-color"},[t._v("\n              电子考勤 ( "+t._s(t.visitDetail.checkInTime?t.visitDetail.checkInTime:"无")+" )     |  \n              ITS( "+t._s(0==t.visitDetail.itsIsAbsent?"出勤":"缺勤")+" "+t._s(t.visitDetail.itsCheckInTime?t.visitDetail.itsCheckInTime:"")+" )   \n            ")])])],1),t._v(" "),a("Divider",{attrs:{orientation:"left"}},[t._v("回访记录")]),t._v(" "),a("div",{staticClass:"visit-info"},[a("Form",{attrs:{"label-width":134,"label-position":"right"}},[a("FormItem",{attrs:{label:"回访日期：",required:""}},[a("DatePicker",{staticClass:"e-input",staticStyle:{width:"120px"},attrs:{clearable:!1,editable:!1,type:"date",format:"yyyy-MM-dd"},on:{"on-change":t.changeVisitDate},model:{value:t.visitData.returnDate,callback:function(e){t.$set(t.visitData,"returnDate",e)},expression:"visitData.returnDate"}})],1),t._v(" "),a("FormItem",{attrs:{label:"回访备注：",required:""}},[a("Input",{staticStyle:{width:"360px",height:"60px"},attrs:{maxlength:100,autosize:{minRows:3,maxRows:5},type:"textarea"},model:{value:t.visitData.remark,callback:function(e){t.$set(t.visitData,"remark",e)},expression:"visitData.remark"}}),t._v(" "),a("Button",{staticStyle:{"margin-top":"45px","margin-left":"15px"},attrs:{type:"info",loading:t.visitLoad},on:{click:t.edite}},[t._v("提交")])],1)],1)],1),t._v(" "),a("div",{staticStyle:{padding:"9px 60px 5px 60px"}},[a("p",{staticStyle:{"font-weight":"bold"}},[t._v("历史回访记录")]),t._v(" "),a("js-table",{staticStyle:{width:"100%","margin-top":"9px"},attrs:{config:t.curriculumCols,bgColor:t.bgColor,tableData:t.curriculumData}}),t._v(" "),a("div",{staticStyle:{margin:"10px"}},[a("div",{staticStyle:{"text-align":"right"}},[a("Page",{attrs:{total:t.visitData.pageTotal,"page-size":t.visitData.currentPageSize,current:t.visitData.currentPageNum,"show-elevator":"","show-sizer":"","show-total":"","page-size-opts":[5,10]},on:{"on-page-size-change":t.visitPageSizeChange,"on-change":t.changeVisitPage}})],1)])],1),t._v(" "),t.spinShow?a("Spin",{attrs:{fix:""}},[a("Icon",{staticClass:"demo-spin-icon-load",attrs:{type:"ios-loading",size:"18"}}),t._v(" "),a("div",[t._v("Loading")])],1):t._e()],1),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"info"},on:{click:t.closeModel}},[t._v("关闭")])],1)]),t._v(" "),a("tal-class-detail",{attrs:{show:t.classDetail.show,classId:t.classDetail.id},on:{close:function(e){t.classDetail.show=!1}}}),t._v(" "),a("tal-teacher-details",{ref:"teacherRef",attrs:{schoolCode:t.teacherDetail.cityCode,teacherId:t.teacherDetail.id,type:t.teacherDetail.type,creatorEmpNo:t.teacherDetail.empNo}})],1),t._v(" "),a("TalSchooltime",{ref:"talSchooltime"})],1)}),[],!1,null,"0bfcd77b",null));e.default=w.exports},fd68:function(t,e,a){"use strict";var i=a("ff6d");a.n(i).a},ff6d:function(t,e,a){}}]);
//# sourceMappingURL=attendanceManage.86d20c41.js.map