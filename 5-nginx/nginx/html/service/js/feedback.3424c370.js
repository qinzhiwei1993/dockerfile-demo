(window.webpackJsonp=window.webpackJsonp||[]).push([["feedback"],{"2d54":function(t,e,a){"use strict";a.r(e);a("28a5"),a("097d");var i=a("6297"),s=a("c82c"),l=a.n(s),n=(a("0808"),a("f751"),a("c5f6"),a("867e")),r={data:function(){return{formData:{status:"",productTime:null,codeTime:null,remark:""},ruleValidate:{status:[{required:!0,message:"处理结果不能为空",trigger:"blur"}],productTime:[{required:!0,message:"产品耗时不能为空",trigger:"blur",type:"number"}],codeTime:[{required:!0,message:"研发耗时不能为空",trigger:"blur",type:"number"}],remark:[{required:!0,message:"原因备注不能为空",trigger:"blur"},{message:"原因备注最多可输入200字",max:200,trigger:"blur",type:"string"}]}}},props:{feedbackId:String,handleStatus:[String,Number]},methods:{save:function(){var t=this;this.$refs.formValidate.validate((function(e){e?Object(i.b)(Object.assign({},t.formData,{cityCode:t.cityList[0].id,feedbackId:t.feedbackId})).then((function(e){t.$Message.success({content:"提交成功",duration:5}),t.$emit("success")})).catch((function(e){t.$Message.error({content:"提交失败："+e.message,duration:5})})):t.$Message.warning({content:"请填写完整后提交",duration:5})}))}},mounted:function(){var t=this;this.$nextTick((function(){t.formData.status=String(t.handleStatus)})),Object(n.d)().then((function(e){t.cityList=e})).catch((function(e){t.$Message.error({content:"获取城市失败："+e.message,duration:5})}))}},o=a("2877"),c={components:{HandleModal:Object(o.a)(r,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Form",{ref:"formValidate",attrs:{model:t.formData,rules:t.ruleValidate,"label-width":100}},[a("FormItem",{attrs:{label:"处理结果：",required:"",prop:"status"}},[a("RadioGroup",{model:{value:t.formData.status,callback:function(e){t.$set(t.formData,"status",e)},expression:"formData.status"}},[a("Radio",{attrs:{label:"1"}},[t._v("未处理")]),t._v(" "),a("Radio",{attrs:{label:"2"}},[t._v("处理中")]),t._v(" "),a("Radio",{attrs:{label:"3"}},[t._v("处理完成")])],1)],1),t._v(" "),a("FormItem",{attrs:{label:"产品耗时：",required:"",prop:"productTime"}},[a("InputNumber",{staticStyle:{width:"100px"},attrs:{min:0,max:1e3},model:{value:t.formData.productTime,callback:function(e){t.$set(t.formData,"productTime",e)},expression:"formData.productTime"}}),t._v(" 小时\n    ")],1),t._v(" "),a("FormItem",{attrs:{label:"研发耗时：",required:"",prop:"codeTime"}},[a("InputNumber",{staticStyle:{width:"100px"},attrs:{min:0,max:1e3},model:{value:t.formData.codeTime,callback:function(e){t.$set(t.formData,"codeTime",e)},expression:"formData.codeTime"}}),t._v(" 小时\n    ")],1),t._v(" "),a("FormItem",{attrs:{label:"原因备注：",required:"",prop:"remark"}},[a("Input",{attrs:{maxlength:200,type:"textarea",autosize:{minRows:3,maxRows:5},placeholder:"请输入原因备注"},model:{value:t.formData.remark,callback:function(e){t.$set(t.formData,"remark",e)},expression:"formData.remark"}})],1)],1),t._v(" "),a("div",{staticStyle:{"text-align":"center"}},[a("Button",{attrs:{type:"primary"},on:{click:t.save}},[t._v("提交")])],1)],1)}),[],!1,null,"a0a1f4a4",null).exports},data:function(){return{tableLoading:!1,formData:{startDateVal:"",startCreateDateDay:"",endDateVal:"",endCreateDateDay:"",type:"",status:"",totalCount:0,pageNo:1,pageSize:10},tableData:[],cols:[{title:"反馈日期",align:"center",key:"createDate",width:70},{title:"反馈人",align:"center",key:"empName"},{title:"员工编号",align:"center",key:"empNo"},{title:"部门",align:"center",key:"serviceCenterName"},{title:"角色",align:"center",key:"roleName"},{title:"问题类型",align:"center",slot:"type"},{title:"反馈内容",align:"left",slot:"content",width:370},{title:"图片",align:"center",slot:"imgUrl"},{title:"处理结果",align:"center",slot:"status"},{title:"处理人",align:"center",slot:"modifierName"},{title:"产品耗时",align:"center",slot:"productTime"},{title:"研发耗时",align:"center",slot:"codeTime"},{title:"操作",align:"center",slot:"operation"},{title:"处理记录",align:"center",slot:"logs"}],types:{optimize:"现有功能优化",bug:"系统BUG/问题",new:"新增功能建议"},statusList:{1:"未处理",2:"处理中",3:"处理完成"},imgUrls:[],viewPicModal:!1,feedbackId:"",handleStatus:"",handleModal:!1,logsModal:!1,logs:[]}},methods:{searchTableData:function(){this.formData.pageNo=1,this.getTableData()},getTableData:function(){var t=this;this.formData.startDateVal&&this.formData.endDateVal&&this.formData.startDateVal>this.formData.endDateVal?this.$Message.warning({content:"开始时间不能晚于结束时间",duration:3}):(this.tableLoading=!0,Object(i.c)(this.formData).then((function(e){t.formData.totalCount=e.totalCount,t.tableData=e.records})).catch((function(e){t.tableData=[],t.formData.totalCount=0,t.$Message.error({content:"获取反馈列表失败："+e.message})})).finally((function(){t.tableLoading=!1})))},changePage:function(t){this.formData.pageNo=t,this.getTableData()},pageSizeChange:function(t){this.formData.pageNo=1,this.formData.pageSize=t,this.getTableData()},DateMinus:function(t,e){var a=new Date(t),i=new Date(e).getTime()-a.getTime();return parseInt(i/864e5)},validateDate:function(t){this.formData.startCreateDateDay&&this.formData.endCreateDateDay&&this.DateMinus(this.formData.startCreateDateDay,this.formData.endCreateDateDay)>90&&(this.$Message.warning({content:"时间跨度不能大于90天，请重新选择",duration:5}),0===t?(this.formData.startDateVal="",this.formData.startCreateDateDay=""):1===t&&(this.formData.endDateVal="",this.formData.endCreateDateDay=""))},setStartTime:function(t){this.formData.startCreateDateDay=t},setEndTime:function(t){this.formData.endCreateDateDay=t},viewPics:function(t){var e=this;this.imgUrls=t.split(","),this.$nextTick((function(){e.viewer=new l.a(document.getElementById("galley"),{url:"data-original"}),e.viewPicModal=!0}))},viewPicModalClose:function(){this.viewPicModal=!1,this.viewer.destroy()},handle:function(t,e){this.feedbackId=t,this.handleStatus=0===e?"":e,this.handleModal=!0},handleSuccess:function(){this.handleModal=!1,this.getTableData()},showLogs:function(t){var e=this;Object(i.d)({feedbackId:t}).then((function(t){e.logs=t,e.logsModal=!0})).catch((function(t){e.logs=[],e.$Message.error({content:"获取处理记录失败："+t.message,duration:5})}))}},mounted:function(){}},u=(a("6968"),Object(o.a)(c,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Layout",{staticStyle:{padding:"10px"}},[a("Form",{staticClass:"ivu-common-shadow",staticStyle:{background:"#fff","padding-top":"24px"},attrs:{"label-position":"right","label-width":90,inline:""}},[a("FormItem",{attrs:{label:"反馈时间"}},[a("DatePicker",{staticClass:"e-input",attrs:{editable:!1,type:"date",format:"yyyy-MM-dd"},on:{"on-change":t.setStartTime},model:{value:t.formData.startDateVal,callback:function(e){t.$set(t.formData,"startDateVal",e)},expression:"formData.startDateVal"}}),t._v("   至  \n      "),a("DatePicker",{staticClass:"e-input",attrs:{editable:!1,type:"date",format:"yyyy-MM-dd"},on:{"on-change":t.setEndTime},model:{value:t.formData.endDateVal,callback:function(e){t.$set(t.formData,"endDateVal",e)},expression:"formData.endDateVal"}})],1),t._v(" "),a("FormItem",{attrs:{label:"问题类型"}},[a("Select",{staticClass:"e-input",attrs:{clearable:""},model:{value:t.formData.type,callback:function(e){t.$set(t.formData,"type",e)},expression:"formData.type"}},t._l(t.types,(function(e,i){return a("Option",{key:i,attrs:{value:i}},[t._v(t._s(e))])})),1)],1),t._v(" "),a("FormItem",{attrs:{label:"处理结果"}},[a("Select",{staticClass:"e-input",attrs:{clearable:""},model:{value:t.formData.status,callback:function(e){t.$set(t.formData,"status",e)},expression:"formData.status"}},t._l(t.statusList,(function(e,i){return a("Option",{key:i,attrs:{value:i}},[t._v(t._s(e))])})),1)],1),t._v(" "),a("FormItem",[a("Button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary",loading:t.tableLoading},on:{click:t.searchTableData}},[t._v("查询")])],1)],1),t._v(" "),a("div",[a("Table",{staticStyle:{width:"100%","margin-top":"10px",overflow:"auto"},attrs:{columns:t.cols,data:t.tableData,loading:t.tableLoading},scopedSlots:t._u([{key:"type",fn:function(e){var a=e.row;return[t._v("\n        "+t._s(t.types[a.type])+"\n      ")]}},{key:"content",fn:function(e){var i=e.row;return[i.content&&i.content.length>90?a("div",{staticClass:"ivu-table-cell"},[a("Tooltip",{attrs:{"max-width":"300",content:i.content,placement:"right",transfer:""}},[a("span",{staticStyle:{display:"-webkit-box","-webkit-box-orient":"vertical","-webkit-line-clamp":"3",overflow:"hidden","text-align":"left"}},[t._v(t._s(i.content))])])],1):a("div",{staticClass:"ivu-table-cell"},[t._v("\n          "+t._s(i.content)+"\n        ")])]}},{key:"imgUrl",fn:function(e){var i=e.row;return[i.imgUrl?a("a",{on:{click:function(e){return t.viewPics(i.imgUrl)}}},[t._v("查看图片")]):a("span",[t._v("--")])]}},{key:"status",fn:function(e){var a=e.row;return[t._v("\n        "+t._s(t.statusList[a.status])+"\n      ")]}},{key:"modifierName",fn:function(e){var a=e.row;return[t._v("\n        "+t._s(a.modifierName||"--")+"\n      ")]}},{key:"productTime",fn:function(e){var a=e.row;return[t._v("\n        "+t._s(null!==a.productTime?a.productTime+" 小时":"--")+"\n      ")]}},{key:"codeTime",fn:function(e){var a=e.row;return[t._v("\n        "+t._s(null!==a.codeTime?a.codeTime+" 小时":"--")+"\n      ")]}},{key:"operation",fn:function(e){var i=e.row;return[a("a",{on:{click:function(e){return t.handle(i.id,i.status)}}},[t._v("处理")])]}},{key:"logs",fn:function(e){var i=e.row;return[a("a",{on:{click:function(e){return t.showLogs(i.id)}}},[t._v("查看记录")])]}}])})],1),t._v(" "),a("div",{class:{"page-fix":t.tableData.length<3},staticStyle:{margin:"10px"}},[a("div",{staticStyle:{"text-align":"right"}},[a("Page",{attrs:{total:t.formData.totalCount,"page-size":t.formData.pageSize,current:t.formData.pageNo,"show-elevator":"","show-sizer":"","show-total":""},on:{"update:current":function(e){return t.$set(t.formData,"pageNo",e)},"on-page-size-change":t.pageSizeChange,"on-change":t.changePage}})],1)]),t._v(" "),a("Modal",{attrs:{title:"查看图片",closable:!1,width:"935px"},model:{value:t.viewPicModal,callback:function(e){t.viewPicModal=e},expression:"viewPicModal"}},[a("div",{attrs:{id:"galley"}},[a("ul",{staticClass:"pictures"},t._l(t.imgUrls,(function(t){return a("li",{key:t},[a("img",{attrs:{"data-original":t,src:t+"?x-oss-process=image/resize,m_fixed,h_300,w_300"}})])})),0)]),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{on:{click:t.viewPicModalClose}},[t._v("关闭")])],1)]),t._v(" "),a("Modal",{attrs:{title:"反馈处理","footer-hide":!0},model:{value:t.handleModal,callback:function(e){t.handleModal=e},expression:"handleModal"}},[t.handleModal?a("HandleModal",{attrs:{"feedback-id":t.feedbackId,"handle-status":t.handleStatus},on:{success:t.handleSuccess}}):t._e()],1),t._v(" "),a("Modal",{attrs:{title:"查看记录","footer-hide":!0,width:"900px"},on:{close:function(e){t.logsModal=!1}},model:{value:t.logsModal,callback:function(e){t.logsModal=e},expression:"logsModal"}},[a("div",{staticClass:"ivu-table ivu-table-default ivu-table-stripe ivu-table-wrapper"},[a("div",{staticClass:"ivu-table-body"},[a("table",{staticStyle:{width:"100%"},attrs:{cellspacing:"0",cellpadding:"0",border:"0"}},[a("thead",[a("tr",{staticClass:"ivu-table-row"},[a("th",{staticClass:"ivu-table-column-center",attrs:{width:"70px"}},[a("div",{staticClass:"ivu-table-cell"},[t._v("处理时间")])]),t._v(" "),a("th",{staticClass:"ivu-table-column-center"},[a("div",{staticClass:"ivu-table-cell"},[t._v("处理结果")])]),t._v(" "),a("th",{staticClass:"ivu-table-column-center"},[a("div",{staticClass:"ivu-table-cell"},[t._v("处理人")])]),t._v(" "),a("th",{staticClass:"ivu-table-column-center"},[a("div",{staticClass:"ivu-table-cell"},[t._v("产品耗时")])]),t._v(" "),a("th",{staticClass:"ivu-table-column-center"},[a("div",{staticClass:"ivu-table-cell"},[t._v("研发耗时")])]),t._v(" "),a("th",{staticClass:"ivu-table-column-center",attrs:{width:"370px"}},[a("div",{staticClass:"ivu-table-cell"},[t._v("备注")])])])]),t._v(" "),a("tbody",{staticClass:"ivu-table-tbody"},[t._l(t.logs,(function(e){return t.logs&&t.logs.length>0?a("tr",{key:e.id,staticClass:"ivu-table-row"},[a("td",{staticClass:"ivu-table-column-center"},[a("div",{staticClass:"ivu-table-cell"},[t._v(t._s(e.createDate))])]),t._v(" "),a("td",{staticClass:"ivu-table-column-center"},[a("div",{staticClass:"ivu-table-cell"},[t._v(t._s(t.statusList[e.status]))])]),t._v(" "),a("td",{staticClass:"ivu-table-column-center"},[a("div",{staticClass:"ivu-table-cell"},[t._v(t._s(e.empName))])]),t._v(" "),a("td",{staticClass:"ivu-table-column-center"},[a("div",{staticClass:"ivu-table-cell"},[t._v(t._s(null!==e.productTime?e.productTime+" 小时":""))])]),t._v(" "),a("td",{staticClass:"ivu-table-column-center"},[a("div",{staticClass:"ivu-table-cell"},[t._v(t._s(null!==e.codeTime?e.codeTime+" 小时":""))])]),t._v(" "),a("td",{staticClass:"ivu-table-column-center"},[e.remark.length>90?a("div",{staticClass:"ivu-table-cell"},[a("Tooltip",{attrs:{"max-width":"300",content:e.remark,placement:"right",transfer:""}},[a("span",{staticStyle:{display:"-webkit-box","-webkit-box-orient":"vertical","-webkit-line-clamp":"3",overflow:"hidden","text-align":"left"}},[t._v(t._s(e.remark))])])],1):a("div",{staticClass:"ivu-table-cell",staticStyle:{"text-align":"left"}},[t._v("\n                "+t._s(e.remark)+"\n              ")])])]):t._e()})),t._v(" "),t.logs&&t.logs.length?t._e():a("tr",[a("td",{staticClass:"ivu-table-column-center",attrs:{colspan:"6"}},[a("div",{staticClass:"ivu-table-cell"},[t._v("暂无处理记录")])])])],2)])])])])],1)}),[],!1,null,"ddbfd406",null));e.default=u.exports},"3f53":function(t,e,a){},6968:function(t,e,a){"use strict";var i=a("3f53");a.n(i).a}}]);
//# sourceMappingURL=feedback.3424c370.js.map