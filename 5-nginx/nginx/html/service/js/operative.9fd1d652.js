(window.webpackJsonp=window.webpackJsonp||[]).push([["operative"],{"01d5":function(e,t,a){"use strict";a.r(t);var r=a("867e"),n={name:"giftMgt",data:function(){return{}},components:{},mounted:function(){Object(r.w)({apiName:"giftManagePage"})}},i=(a("4157"),a("2877")),s=Object(i.a)(n,(function(){var e=this.$createElement,t=this._self._c||e;return t("Layout",{staticClass:"gary",attrs:{id:"TalGiftMgt"}},[t("TalGiftMgt")],1)}),[],!1,null,"c4e4fb80",null);t.default=s.exports},"0263":function(e,t,a){"use strict";var r=a("75fc"),n=(a("0d6d"),a("ac6a"),a("867e")),i=a("a78e"),s=a.n(i),o=a("2472");t.a={data:function(){return{allCityList:[],yearList:[],termList:[],subjectList:[],gradeTypeList:[],gradeList:[],levelList:[],areaList:[],serviceList:[],teacherDotList:[],classTypeList:[],teacherNameList:[],tutorNameList:[],loading1:!1,refundReason:[],secodeRefundReason:[],refundType:[],operationPlatform:[],changeClassType:[],changeCourseType:[],classFlag:[{value:0,label:"原班"},{value:1,label:"现班"}],formData:{type:0,typeName:"退费原因",cityCode:"",year:(new Date).getFullYear()+"",termId:"",gradeTypeId:"",gradeId:"",subjectId:"",levelId:"",areaId:"",serviceCenterId:"",venueId:"",teacherId:"",tutorId:"",startDate:"",startDateVal:"",endDate:"",endDateVal:"",secondReasonId:"",firstReasonId:"",refundType:"",operatePlatform:"",operateStartDate:"",operateStartDateVal:"",operateEndDate:"",operateEndDateVal:"",classFlag:"",totalCount:0,pageSize:10,pageNo:1},formDataSource:{type:0,typeName:"退费原因",cityCode:"",year:(new Date).getFullYear()+"",termId:"",gradeTypeId:"",gradeId:"",subjectId:"",levelId:"",areaId:"",serviceCenterId:"",venueId:"",teacherId:"",tutorId:"",startDate:"",startDateVal:"",endDate:"",endDateVal:"",secondReasonId:"",firstReasonId:"",refundType:"",operatePlatform:"",operateStartDate:"",operateStartDateVal:"",operateEndDate:"",operateEndDateVal:"",classFlag:"",totalCount:0,pageSize:10,pageNo:1},setDefaultServiceCenter:!1}},methods:{optDateChange:function(e,t,a){this.formData[t]=e[0],this.formData[a]=e[1]},getChangeCourseTypeHandler:function(){var e=this,t={cityCode:this.formData.cityCode};queryChangeCourseType(t).then((function(t){var a=[];t.forEach((function(e){a.push({value:e.chanageCourseTypeId,label:e.changeCourseTypeName,desc:e.description})})),e.changeCourseType=Object.freeze(a)})).catch((function(t){e.$Message.warning({content:"获取转班原因失败:"+t.message,duration:3})}))},getChangeClassTypeHandler:function(){var e=this,t={cityCode:this.formData.cityCode};getChangeClassType(t).then((function(t){var a=[];t.forEach((function(e){a.push({value:e.chanageClassTypeId,label:e.changeClassTypeName,desc:e.description})})),e.changeClassType=Object.freeze(a)})).catch((function(t){e.$Message.warning({content:"获取转班原因失败:"+t.message,duration:3})}))},operationPlatformHandler:function(){var e=this;this.formFields&&(this.formFields.has("refundType")?operationPlatform:changeClassCourseOperationPlatform)().then((function(t){e.operationPlatform=Object.freeze(t)})).catch((function(t){e.$Message.warning({content:"获取平台类型失败:"+t.message,duration:3})}))},getRefundTypeHandler:function(){var e=this;getRefundType().then((function(t){e.refundType=Object.freeze(t)})).catch((function(t){e.$Message.warning({content:"获取退费类型失败:"+t.message,duration:3})}))},changeFirstReason:function(e){if(this.secodeRefundReason=[],this.formData.secondReasonId="",!e)return!1;var t=this.refundReason.filter((function(t){return t.value===e}));t&&t[0]&&(t[0].children?this.secodeRefundReason=Object(r.a)(t[0].children):this.getRefundSecondLevelHandler(t[0]))},buildReason:function(e,t){var a=[];return e.forEach((function(e){var t={value:e.id,label:e.reason,desc:e.description};a.push(t)})),a},getRefundSecondLevelHandler:function(e){var t=this;getRefundSecondLevel({parentId:e.value,cityCode:this.formData.cityCode}).then((function(a){a&&a.length&&(e.children=t.buildReason(a),t.secodeRefundReason=Object(r.a)(e.children))})).catch((function(e){t.$Message.warning({content:"获取二级退费原因失败:"+e.message,duration:3})}))},getRefundFistLevelHandler:function(){var e=this;getRefundFistLevel({cityCode:this.formData.cityCode}).then((function(t){t&&t.length&&(e.refundReason=e.buildReason(t,!0))})).catch((function(t){e.$Message.warning({content:"获取一级退费原因失败:"+t.message,duration:3})}))},getCitys:function(){var e=this;Object(n.d)().then((function(t){e.allCityList=t,e.allCityList.length&&e.setDefaultServiceCenter&&(e.formData.cityCode=t[0].id,e.getBaseData(),e.cityYearChange(e.formData.cityCode))})).catch((function(t){e.$Message.warning({content:"获取所有城市失败:"+t.message,duration:5})}))},getYears:function(){var e=this;Object(n.q)().then((function(t){e.yearList=t})).catch((function(t){e.$Message.warning({content:"获取年份失败:"+t.message,duration:5})}))},getClassTypeList:function(){var e=this;Object(n.e)({}).then((function(t){e.classTypeList=t})).catch((function(t){e.$Message.warning({content:"获取授课类型失败:"+t.message,duration:5})}))},getBaseData:function(){var e=this,t={cityCode:this.formData.cityCode};Object(n.c)(t).then((function(t){e.areaList=t,e.setDefaultServiceCenter&&Object(o.e)({cityCode:e.formData.cityCode,empNo:JSON.parse(s.a.get("columbusUserInfo")).id}).then((function(t){e.areaList.filter((function(e){return e.schoolId===t.areaId})).length>0?(e.formData.areaId=t.areaId,e.changeArea(t.areaId,t.serviceCenterId)):(e.formData.areaId="",e.serviceCenterList=[],e.formData.serviceCenterId="")})).catch((function(t){e.$Message.error("获取当前所在服务中心失败:"+t.message)}))})).catch((function(t){e.$Message.error("获取区域失败:"+t.message)}))},cityYearChange:function(e){var t=this;if(console.log("city change",e),this.formData.termId="",this.formData.gradeTypeId="",this.formData.gradeId="",this.formData.levelId="",this.formData.classType=null,this.formData.teacherId="",this.formData.tutorId="",this.formData.subjectId="",this.formData.areaId="",this.formData.serviceCenterId="",this.formData.venueId="",this.formData.secondReasonId="",this.formData.firstReasonId="",this.formData.refundType="",this.formData.operatePlatform="",e){this.getBaseData();var a={cityCode:this.formData.cityCode,years:this.formData.year,queryType:"t"};Object(n.h)(a).then((function(e){t.termList=e})).catch((function(e){t.$Message.error("获取学期失败:"+e.message)})),this.formFields&&(this.formFields.has("refundType")&&(this.getRefundFistLevelHandler(),this.getRefundTypeHandler()),this.formFields.has("changeClassType")&&this.getChangeClassTypeHandler(),this.formFields.has("changeCourseType")&&this.getChangeCourseTypeHandler())}},changeYear:function(e){var t=this;if(this.gradeTypeList=[],this.formData.gradeTypeId="",this.termList=[],this.formData.termId="",this.formData.gradeId="",this.gradeList=[],this.formData.subjectId="",this.subjectList=[],this.formData.levelId="",this.levelList=[],e){var a={cityCode:this.formData.cityCode,years:this.formData.year,queryType:"t"};Object(n.h)(a).then((function(e){t.termList=e})).catch((function(e){t.$Message.error("获取学期失败:"+e.message)}))}},changeTerm:function(e){var t=this;if(this.formData.gradeTypeId="",this.formData.gradeId="",this.formData.subjectId="",this.formData.levelId="",this.gradeTypeList=[],this.gradeList=[],this.subjectList=[],this.levelList=[],!e)return!1;var a={cityCode:this.formData.cityCode,years:this.formData.year,termIds:this.formData.termId,queryType:"gt"};Object(n.h)(a).then((function(e){t.gradeTypeList=e})).catch((function(e){t.$Message.error("获取年部失败:"+e.message)}))},gradeTypeChange:function(e){var t=this;if(this.formData.gradeId="",this.formData.subjectId="",this.formData.levelId="",this.gradeList=[],this.subjectList=[],this.levelList=[],!e)return!1;var a={cityCode:this.formData.cityCode,years:this.formData.year,termIds:this.formData.termId,gtIds:this.formData.gradeTypeId,queryType:"g"};Object(n.h)(a).then((function(e){t.gradeList=e})).catch((function(e){t.$Message.error("获取年级失败:"+e.message)}))},changeClasses:function(e){var t=this;if(this.formData.subjectId="",this.subjectList=[],this.formData.levelId="",this.levelList=[],e){var a={cityCode:this.formData.cityCode,years:this.formData.year,termIds:this.formData.termId,gradeIds:this.formData.gradeId,queryType:"s"};Object(n.h)(a).then((function(e){t.subjectList=e})).catch((function(e){t.$Message.error("获取学科失败:"+e.message)}))}},changeSubject:function(e){var t=this;if(this.formData.levelId="",this.levelList=[],e){var a={cityCode:this.formData.cityCode,years:this.formData.year,termIds:this.formData.termId,gradeIds:this.formData.gradeId,subjectIds:this.formData.subjectId,queryType:"c"};Object(n.h)(a).then((function(e){t.levelList=e})).catch((function(e){t.$Message.error("获取班次失败:"+e.message)}))}},changeArea:function(e,t){var a=this;if(this.serviceList=[],this.formData.serviceCenterId="","undefined"===e||!this.formData.areaId)return!1;var r={cityCode:this.formData.cityCode,areaId:this.formData.areaId};Object(n.j)(r).then((function(e){a.serviceList=e,a.serviceList.forEach((function(e,t){e.address||(e.address="")})),t&&(a.formData.serviceCenterId=t)})).catch((function(e){a.$Message.warning("获取服务中心失败:"+e.message)}))},changeService:function(e){var t=this;if(this.teacherDotList=[],this.formData.venueId="","undefined"===e||!this.formData.serviceCenterId||!this.formData.areaId)return!1;var a={cityCode:this.formData.cityCode,serviceId:this.formData.serviceCenterId};Object(n.p)(a).then((function(e){t.teacherDotList=e})).catch((function(e){t.$Message.warning("获取教学点失败:"+e.message)}))},getTeacherName:function(e){var t=this;if(this.formData.cityCode){if((e=e.trim())&&e!==this.oldSearchName){this.loading1=!0,this.teacherNameList=[];var a={sysName:e,teacherType:0,cityCode:this.formData.cityCode,businessType:this.formData.classType,pageNo:1,pageSize:20};Object(n.l)(a).then((function(e){t.teacherNameList=e.records,t.loading1=!1})).catch((function(e){t.loading1=!1,t.$Message.error("获取主讲老师姓名失败:"+e.message)}))}}else this.$Message.error("未选择城市")},getTutorName:function(e){var t=this;if(this.formData.cityCode){if((e=e.trim())&&e!==this.oldSearchName){this.loading1=!0,this.tutorNameList=[];var a={sysName:e,teacherType:1,cityCode:this.formData.cityCode,businessType:this.formData.classType,pageNo:1,pageSize:20};Object(n.l)(a).then((function(e){t.tutorNameList=e.records,t.loading1=!1})).catch((function(e){t.loading1=!1,t.$Message.error("获取辅导老师姓名失败:"+e.message)}))}}else this.$Message.error("未选择城市")},optionChange:function(e){e&&e.label&&(this.oldSearchName=e.label)},getClassTypeName:function(e){return this.classTypeMap[e]},startDateChange:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"startDate",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"endDate";if(this.formData[a]&&new Date(e).getTime()>new Date(this.formData[a]).getTime())return this.$Message.warning({content:"结束时间不得小于开始时间",duration:5}),this.formData[t]="",void(this.formData[t+"Val"]="");this.formData[t]=e},endDateChange:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"startDate",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"endDate";if(this.formData[t]&&new Date(this.formData[t]).getTime()>new Date(e).getTime())return this.$Message.warning({content:"结束时间不得小于开始时间",duration:5}),this.formData[a]="",void(this.formData[a+"Val"]="");this.formData[a]=e}}}},"0385":function(e,t,a){"use strict";a.r(t);a("8e6e"),a("ac6a"),a("cadf"),a("456d");var r=a("bd86"),n=(a("7f7f"),a("6b54"),a("0d6d"),a("097d"),a("96cf"),a("3b8d")),i=(a("c5f6"),a("736c")),s=a("15b1");function o(e){return s.a.request({url:"/MASTER-BD/bd-web/baseData/combineList",method:"post",data:e})}var c,l,u,d,m,h,p,f=function(e){return s.a.request({url:"/MASTER-BD/bd-web/classlevel/list",method:"post",data:e})},g=function(e){return s.a.request({url:"/MASTER-BD/bd-web/classroom/list",method:"GET",params:e})},v=function(e){return s.a.request({url:"/MASTER-BD/bd-web/property/getOne",method:"GET",params:e})},y=a("867e"),b={data:function(){return{cityList:[],yearList:[],seasonList:[],gradeList:[],subjectList:[],districtList:[],serviceCenterList:[],advisorEmpNos:[],classLevelList:[],timeTypeList:[],timeList:[],sClassWayList:{},lClassWayList:{}}},methods:{getCityListHandler:(p=Object(n.a)(regeneratorRuntime.mark((function e(t){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(y.d)();case 3:a=e.sent,this.cityList=a,t&&t(a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),this.$Message.warning({content:"获取所有城市失败:"+e.t0.message,duration:5});case 11:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(e){return p.apply(this,arguments)}),getGradeList:(h=Object(n.a)(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={cityCode:this.formData.cityCode},e.next=4,Object(y.g)(t);case 4:a=e.sent,this.gradeList=Object.freeze(a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),this.$Message.warning({content:"获取年级失败:"+e.t0.message,duration:5});case 11:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(){return h.apply(this,arguments)}),getSubjectList:(m=Object(n.a)(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={cityCode:this.formData.cityCode},e.next=4,Object(y.k)(t);case 4:a=e.sent,this.subjectList=Object.freeze(a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),this.$Message.warning({content:"获取学科失败:"+e.t0.message,duration:5});case 11:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(){return m.apply(this,arguments)}),getTimeList:function(){var e=this;Object(y.m)().then((function(t){e.timeList=Object.freeze(t)})).catch((function(t){e.$Message.error({content:"获取上课时段失败: ".concat(t.message),duration:5})}))},getTimeTypeList:function(){var e=this;Object(y.n)().then((function(t){e.timeTypeList=Object.freeze(t)})).catch((function(t){e.$Message.error({content:"获取上课时间类型失败: ".concat(t.message),duration:5})}))},getServiceCenterList:(d=Object(n.a)(regeneratorRuntime.mark((function e(t,a){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r={cityCode:a,likeName:t},e.next=4,Object(y.j)(r);case 4:n=e.sent,this.serviceCenterList=Object.freeze(n)||[],e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),this.$Message.warning({content:"获取服务中心失败:"+e.t0.message,duration:5});case 11:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(e,t){return d.apply(this,arguments)}),getTeacherByNameFuzzyHandler:function(e){return Object(y.l)(e)},getVenueListHandler:function(e){return Object(y.p)(e)},getYears:(u=Object(n.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(y.q)();case 3:t=e.sent,this.yearList=Object.freeze(t),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),this.$Message.warning({content:"获取年份失败:"+e.t0.message,duration:5});case 10:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(){return u.apply(this,arguments)}),getBaseDataSeasonList:(l=Object(n.a)(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={enName:"season"},e.next=4,v(t);case 4:a=e.sent,this.seasonList=Object.freeze(JSON.parse(a.value)),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),this.$Message.error({content:"获取学期失败:"+e.t0.message,duration:5});case 11:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(){return l.apply(this,arguments)}),getCombineList:(c=Object(n.a)(regeneratorRuntime.mark((function e(){var t,a,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={schoolCode:this.formData.cityCode,levelDegreesReq:{},propertiesReq:{enNames:["classWay"]}},e.next=4,o(t);case 4:a=e.sent,this.classLevelList=a.levelDegrees,(r=a.properties)&&(this.sClassWayList=JSON.parse(r[0].value).splice(0,2),this.sClassWayList.forEach((function(e){e.id=e.id.toString()})),this.lClassWayList=JSON.parse(r[0].value).splice(0,3),this.lClassWayList.forEach((function(e){e.id=e.id.toString()}))),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),this.$Message.error({content:"获取combineList失败:"+e.t0.message,duration:5});case 13:case"end":return e.stop()}}),e,this,[[0,10]])}))),function(){return c.apply(this,arguments)})}},C=a("2f62");function D(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function w(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?D(Object(a),!0).forEach((function(t){Object(r.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):D(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var k,_,S,T,I,L,x,N={name:"createClass",mixins:[b],props:{type:{type:Number,default:1},title:{type:String,default:"新增班级"},oldFormData:{type:Object,default:function(){return{}}}},data:function(){return{modalLoading:!1,isExisted:!0,isClassLevelExisted:!0,isTeacherExisted:!0,gradeList:[],subjectList:[],areaList:[],serviceCenterList:[],venueList:[],classroomList:[],advisorEmpNos:[],classLevelList:[],levelDegreeList:[],teacherNameList:[],oldSearchName:"",loadingTeacherName:!1,yearList:[],seasonList:[],timeList:[],classTimeList:[],weekFromStartTime:"",classTimeListLoading:!1,areaLoading:!1,serviceCenterLoading:!1,teachingPointLoading:!1,classroomLoading:!1,showAddClassModal:!1,isLive:0,classType:1,periodIdMap:{1:1,2:4,3:2,4:3},periodNameMap:{"上午":"1","中午":"2","下午":"3","晚上":"4"},classTimeTypeIdMap:{"星期一":1,"星期二":2,"星期三":3,"星期四":4,"星期五":5,"星期六":6,"星期日":7},classTimeTypeNameMap:{"星期一":"周一","星期二":"周二","星期三":"周三","星期四":"周四","星期五":"周五","星期六":"周六","星期日":"周日"},capacityLabelNameMap:{1:"大班",2:"小班"},classWayNameMap:{0:"通用课程",1:"小组课",2:"新课堂通用课程",3:"新课堂小组课",4:"新课堂考试",5:"新课堂讲座"},ClassBeginOptions:{disabledDate:function(e){return e&&e.valueOf()<Date.now()-864e5}},pageCurrent:1,pageSize:50,classModelLevelList:[],classModelNameList:[],formData:{cityCode:"",cityName:"",productType:"2",productTypeName:"短期班",classModel:"",classModelName:"",classModelLevelId:"",classModelLevelName:"",empNo:"",empName:"",categoryType:"",categoryTypeName:"",gradeId:"",gradeName:"",subjectId:"",subjectName:"",classLevel:"",classLevelName:"",levelDegree:"",levelDegreeName:"",teacherEmpNo:"",teacherEmpName:"",teaId:"",curriculumCount:1,classNum:1,year:(new Date).getFullYear()+"",seasonId:"",seasonName:"",originalClassBeginTime:new Date,classBeginTime:"",classTimeTypeId:"",classTimeTypeName:"",period:"",periodId:"",courseTime:"",startTime:"",endTime:"",areaId:"",areaName:"",serviceCenterId:"",serviceCenterName:"",teachingPointCode:"",teachingPointName:"",classroomId:"",classroomName:"",maxPersons:1,capacityLabel:1,capacityLabelName:"大班",price:0,classWay:"",classWayName:"",deadLine:"",assembleEndTime:""},ruleValidate:{productType:[{required:!0,message:"请选择产品类型",trigger:"change",type:"string"}],classModelName:[{required:!0,message:"请选择班型名称",trigger:"change",type:"string"}],classModelLevelName:[{required:!0,message:"请选择班型难度",trigger:"change",type:"string"}],categoryType:[{required:!0,message:"请选择授课类型",trigger:"change",type:"number"}],gradeId:[{required:!0,message:"请选择年级",trigger:"change",type:"number"}],subjectId:[{required:!0,message:"请选择学科",trigger:"change"}],levelDegree:[{required:!0,message:"请选择班次级别",trigger:"change"}],classLevel:[{required:!0,message:"请选择版本",trigger:"change"}],teacherEmpNo:[{required:!0,message:"请选择主讲老师",trigger:"change"}],curriculumCount:[{required:!0,message:"请选择总课次",trigger:"change",type:"number"}],classNum:[{required:!0,message:"请选择班级个数",trigger:"change",type:"number"}],year:[{required:!0,message:"请选择年份",trigger:"change"}],seasonId:[{required:!0,message:"请选择学季",trigger:"change",type:"number"}],originalClassBeginTime:[{required:!0,message:"请选择开始日期",trigger:"change",type:"date"}],periodId:[{required:!0,message:"请选择上课时段",trigger:"change"}],courseTime:[{required:!0,message:"请选择上课时间",trigger:"change"}],areaId:[{required:!0,message:"请选择区域",trigger:"change"}],serviceCenterId:[{required:!0,message:"请选择服务中心",trigger:"change"}],teachingPointCode:[{required:!0,message:"请选择教学点",trigger:"change"}],classroomId:[{required:!0,message:"请选择教室/直播间",trigger:"change"}],maxPersons:[{required:!0,message:"请选择课程限额",trigger:"change",type:"number"}],capacityLabel:[{required:!0,message:"请选择容量类别",trigger:"change",type:"number"}],price:[{required:!0,message:"请选择课程金额",trigger:"change",type:"number"}],classWay:[{required:!0,message:"请选择上课模式",trigger:"change"}],deadLine:[{required:!0,message:"请选择攒班时效",trigger:"change",type:"date"}]}}},computed:w(w({},Object(C.e)({userInfo:function(e){return e.roleRelativeData.userInfo},roleId:function(e){return e.roleRelativeData.userInfo.crmRoleId}})),{},{userInfo:function(){return this.$store.state.roleRelativeData.userInfo}}),watch:{oldFormData:{handler:function(e,t){e.id&&this.getOldAssembleInfoById(e)},deep:!0},"formData.deadLine":{handler:function(){this.setCurrentAssembleEndTime()}},"formData.categoryType":{handler:function(){this.changeVenue(),this.remoteListTeacherName()}}},mounted:(T=Object(n.a)(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getCityListHandler((function(e){t.formData.cityCode=e[0].id}));case 2:this.initCityList();case 3:case"end":return e.stop()}}),e,this)}))),function(){return T.apply(this,arguments)}),methods:{addClassHandler:function(){var e=this.$options.data().formData;this.formData=e,this.formData.cityCode=this.cityList[0].id,this.setCurrentClassBeginTime(),this.$refs.formValidate.resetFields(),this.showAddClassModal=!0},closeModal:function(){this.showAddClassModal=!1},initCityList:(S=Object(n.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.initOtherFrmOptions();case 1:case"end":return e.stop()}}),e,this)}))),function(){return S.apply(this,arguments)}),initOtherFrmOptions:function(){this.getBaseDataSeasonList(),this.getYears(),this.getSubjectList(),this.getGradeList(),this.getTimeTypeList(),this.getTimeList(),this.getAreaList(),this.getCombineList(),this.queryClassModelList(),this.queryClassModelLevelList()},handleCategoryTypeChange:function(){var e=this;1===this.formData.categoryType?(this.ruleValidate.classNum.unshift({required:!0,message:"请选择班级个数",trigger:"change",type:"number"}),this.ruleValidate.classWay.unshift({required:!0,message:"请选择上课模式",trigger:"change"})):2===this.formData.categoryType?(this.ruleValidate.classNum.unshift({required:!0,message:"请选择班级个数",trigger:"change",type:"number"}),this.ruleValidate.classWay.shift()):4===this.formData.categoryType&&(this.ruleValidate.classNum.shift(),this.ruleValidate.classWay.shift()),this.formData.teacherEmpNo="",this.formData.classroomId="",this.teacherNameList=[],this.classroomList=[],clearTimeout(this.timer),this.timer=setTimeout((function(){e.classType=1,e.classroomLoading=!0,4===e.formData.categoryType?e.classType=1:1===e.formData.categoryType?e.classType=3:2===e.formData.categoryType?e.classType=2:e.classType=1;try{g({schoolCode:e.formData.cityCode,serviceid:e.formData.serviceCenterId,venueId:e.formData.teachingPointCode,classType:e.classType}).then((function(t){e.classroomList=t,e.classroomLoading=!1}))}catch(t){e.$Message.error({content:"获取所选教学点下教室失败: "+t.message,duration:5})}}),400)},handleCatChangeToReset:function(){this.formData.teacherEmpNo="",this.formData.classroomId="",this.teacherNameList=[],this.classroomList=[]},handleProductTypeChange:function(){"1"===this.formData.productType?this.formData.productTypeName="长期班":"2"===this.formData.productType&&(this.formData.productTypeName="短期班")},handleClassModelLevelNameChange:function(){console.log(this.formData.classModelLevelName)},handleClassModelNameChange:function(){console.log(this.formData.classModelName)},handleClassModelNameQueryChange:function(e){this.formData.classModelName=e,this.queryClassModelList()},handleClassModelLevelNameQueryChange:function(e){this.formData.classModelLevelName=e,this.queryClassModelLevelList()},handleClassModelNameClear:function(){this.formData.classModelName=""},handleClassModelLevelNameClear:function(){this.formData.classModelLevelName=""},changeCapacityLabel:function(){},periodChange:function(){if(this.formData.periodId){var e=this.periodIdMap[this.formData.periodId];this.getClassTimeList(e)}},getClassTimeList:function(e){var t,a=this;this.classTimeListLoading=!0,(t={schoolCode:this.formData.cityCode,periodType:e,status:0},s.a.request({url:"/MASTER-BD/bd-web/classTime/list",method:"post",data:t})).then((function(e){a.classTimeList=e})).catch((function(){a.$Message.error("调用上课时间接口失败")})).finally((function(){a.classTimeListLoading=!1}))},changeClassLevel:function(){var e=this;this.levelDegreeList=[],this.formData.classLevel="",f({schoolCode:this.formData.cityCode,status:0,degree:this.formData.levelDegree,current:1,disable:0,size:100,name:""}).then((function(t){e.levelDegreeList=t.records})).catch((function(t){e.$Message.error("获取班次级别下版本失败："+t.message)}))},remoteListTeacherName:function(e){var t=this;clearTimeout(this.lazyTimer),this.lazyTimer=setTimeout((function(){t.getTeacher(e)}),400)},queryClassModelLevelList:function(){var e,t=this;(e={schoolCode:this.formData.cityCode,likeName:this.formData.classModelLevelName,current:this.pageCurrent,size:this.pageSize},s.a.request({url:"/MASTER-BD/bd-web/classModelLevel/pageQuery",method:"post",data:e})).then((function(e){t.classModelLevelList=e.records||[]})).catch((function(){t.$Message.error("请求班型难度列表接口失败")})).finally((function(){t.tableLoading=!1}))},queryClassModelList:function(){var e,t=this;(e={schoolCode:this.formData.cityCode,likeName:this.formData.classModelName,current:this.pageCurrent,size:this.pageSize},s.a.request({url:"/MASTER-BD/bd-web/classModel/pageQuery",method:"post",data:e})).then((function(e){t.classModelNameList=e.records||[]})).catch((function(){t.$Message.error("请求班型名称列表接口失败")})).finally((function(){t.tableLoading=!1}))},getTeacher:function(e){var t=this;if(e){e=e.trim(),this.loadingTeacherName=!0,this.teacherNameList=[];var a={sysName:e,teacherType:0,cityCode:this.formData.cityCode,businessType:this.formData.categoryType,pageNo:1,pageSize:20};this.getTeacherByNameFuzzyHandler(a).then((function(e){e.records&&e.records.length&&(t.teacherNameList=e.records),t.loadingTeacherName=!1})).catch((function(e){t.loadingTeacherName=!1,t.$Message.error("获取主讲老师姓名失败:"+e.message)}))}},changeArea:function(){var e=this;this.serviceCenterList=[],this.formData.serviceCenterId="",this.serviceCenterLoading=!0;try{Object(y.j)({cityCode:this.formData.cityCode,areaId:this.formData.areaId}).then((function(t){e.serviceCenterList=t,e.serviceCenterLoading=!1}))}catch(e){this.$Message.error({content:"获取所选区域下服务中心失败: "+e.message,duration:5})}},changeService:function(e){var t=this;if(this.venueList=[],this.formData.teachingPointCode="",this.teachingPointLoading=!0,!e)return!1;var a={cityCode:this.formData.cityCode,serviceId:this.formData.serviceCenterId};this.getVenueListHandler(a).then((function(e){t.venueList=e,t.teachingPointLoading=!1})).catch((function(e){t.$Message.warning("获取所选服务中心下教学点失败:"+e.message)}))},changeVenue:function(){var e=this;clearTimeout(this.lazyTimer),this.lazyTimer=setTimeout((function(){e.changeVenueSearch()}),400)},changeVenueSearch:function(){var e=this;this.classType=1,this.classroomList=[],this.formData.classroomId="",this.classroomLoading=!0,4===this.formData.categoryType?(this.isLive=0,this.classType=1):1===this.formData.categoryType?(this.isLive=1,this.classType=3):(this.isLive=0,this.classType=2);try{g({schoolCode:this.formData.cityCode,serviceid:this.formData.serviceCenterId,venueId:this.formData.teachingPointCode,classType:this.classType}).then((function(t){e.classroomList=t,e.classroomLoading=!1}))}catch(e){this.$Message.error({content:"获取所选教学点下下教室失败: "+e.message,duration:5})}},getAreaList:(_=Object(n.a)(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.areaLoading=!0,t={cityCode:this.formData.cityCode},e.next=5,Object(y.c)(t);case 5:a=e.sent,this.areaLoading=!1,this.areaList=Object.freeze(a),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),this.$Message.error({content:"获取区域列表失败: ".concat(e.t0.message),duration:5});case 13:case"end":return e.stop()}}),e,this,[[0,10]])}))),function(){return _.apply(this,arguments)}),remoteListLinkName:function(e){var t=this;clearTimeout(this.lazyTimer),this.lazyTimer=setTimeout((function(){t.remoteList(e)}),400)},remoteList:function(e){var t=this;e&&""!==e&&f({schoolCode:this.formData.cityCode,status:0,degree:this.formData.levelDegree,current:1,disable:0,size:100,name:e||this.formData.classLevelName}).then((function(e){t.levelDegreeList=e.records})).catch((function(e){t.$Message.error("获取班次级别下版本失败："+e.message)}))},setCategoryTypeName:function(e){this.formData.categoryTypeName=e},setCurrentClassModelId:function(e){this.formData.classModel=e},setCurrentClassModelLevelId:function(e){this.formData.classModelLevelId=e},setCurrentGradeName:function(e){this.formData.gradeName=e},setCurrentSubjectName:function(e){this.formData.subjectName=e},setCurrentClassLevelName:function(e){this.formData.levelDegreeName=e},setCurrentLevelDegreeName:function(e){this.formData.classLevelName=e},setCurrentTeacherName:function(e,t){this.formData.teacherEmpName=e,this.formData.teaId=t},setCurrentSeasonName:function(e){this.formData.seasonName=e},setCurrentClassBeginTime:function(){if(""!==this.formData.originalClassBeginTime){this.formData.classBeginTime=this.formData.originalClassBeginTime;var e=this.formData.classBeginTime.getFullYear(),t=this.formData.classBeginTime.getMonth()+1,a=this.formData.classBeginTime.getDate();t<10&&(t="0"+t),a<10&&(a="0"+a),this.formData.classBeginTime=e.toString()+"-"+t.toString()+"-"+a.toString(),this.formData.classTimeTypeId=this.classTimeTypeIdMap[this.weekFromStartTime],this.formData.classTimeTypeName=this.classTimeTypeNameMap[this.weekFromStartTime];var r=this.formData.originalClassBeginTime;if(r)switch(r.toString().slice(0,3)){case"Mon":this.weekFromStartTime="星期一";break;case"Tue":this.weekFromStartTime="星期二";break;case"Wed":this.weekFromStartTime="星期三";break;case"Thu":this.weekFromStartTime="星期四";break;case"Fri":this.weekFromStartTime="星期五";break;case"Sat":this.weekFromStartTime="星期六";break;case"Sun":this.weekFromStartTime="星期日"}}},setCurrentPeriod:function(e){this.formData.period=e},setCurrentCourseTime:function(e,t){this.formData.startTime=e,this.formData.endTime=t},setCurrentAreaName:function(e){this.formData.areaName=e},setCurrentServiceCenterName:function(e){this.formData.serviceCenterName=e},setCurrentTeachingPointName:function(e){this.formData.teachingPointName=e},setCurrentClassroomName:function(e){this.formData.classroomName=e},setCurrentCapacityLabelName:function(){this.formData.capacityLabelName=this.capacityLabelNameMap[this.formData.capacityLabel]},setCurrentAssembleEndTime:function(){if(""!==this.formData.deadLine){var e=this.formData.deadLine.getFullYear(),t=this.formData.deadLine.getMonth()+1,a=this.formData.deadLine.getDate(),r=this.formData.deadLine.getHours(),n=this.formData.deadLine.getMinutes(),i=this.formData.deadLine.getSeconds();t<10&&(t="0"+t),a<10&&(a="0"+a),r<10&&(r="0"+r),n<10&&(n="0"+n),i<10&&(i="0"+i),this.formData.assembleEndTime=e.toString()+"-"+t.toString()+"-"+a.toString()+" "+r.toString()+":"+n.toString()+":"+i.toString()}},setCurrentClassWayName:function(e){this.formData.classWayName=e},confirm:function(){var e=this;this.$refs.formValidate.validate((function(t){t&&e.handlecreationConfirmed()}))},cancel:function(){var e=this;this.$Modal.confirm({title:"确认取消？",content:"<p>取消编辑将不会保存数据</p>",onOk:function(){e.closeModal()}})},handlecreationConfirmed:function(){var e=this;this.formData.type=this.type,this.formData.empNo=this.userInfo.empNo,this.formData.empName=this.userInfo.empName,this.setCurrentClassBeginTime(),this.modalLoading=!0,Object(i.d)(this.formData).then((function(t){1===e.formData.type?e.$Message.success({content:"新建班级成功",duration:5}):e.$Message.success({content:"修改班级成功",duration:5}),console.log("修改班级成功 ",e.formData),e.showAddClassModal=!1,e.$emit("updateTableData")})).catch((function(t){1===e.formData.type?e.$Message.error({content:"新建班级失败:"+t.message,duration:5}):e.$Message.error({content:"修改班级失败:"+t.message,duration:5})})),this.modalLoading=!1},getOldAssembleInfoById:(k=Object(n.a)(regeneratorRuntime.mark((function e(t){var a,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.modalLoading=!0;try{a={id:t.id,cityCode:t.cityCode},Object(i.p)(a).then((function(e){r.formData=w({},e),r.formData.seasonId=Number(e.seasonId),r.initCityList(),r.formData.originalClassBeginTime=new Date(e.classBeginTime),r.setCurrentClassBeginTime(),r.formData.deadLine=new Date(e.assembleEndTime),r.formData.periodId=r.periodNameMap[e.period],r.classTimeList=[{name:e.period+e.classTime}],r.formData.courseTime=e.period+e.classTime,r.serviceCenterLoading=!0;try{Object(y.j)({cityCode:r.formData.cityCode,areaId:r.formData.areaId}).then((function(e){r.serviceCenterList=e,r.serviceCenterLoading=!1}))}catch(e){r.$Message.error({content:"获取所选区域下服务中心失败: "+e.message,duration:5})}r.teachingPointLoading=!0;var t={cityCode:r.formData.cityCode,serviceId:r.formData.serviceCenterId};if(r.getVenueListHandler(t).then((function(e){r.venueList=e,r.teachingPointLoading=!1})).catch((function(e){r.$Message.warning("获取所选服务中心下教学点失败:"+e.message)})),clearTimeout(r.timer),r.timer=setTimeout((function(){r.classType=1,r.classroomLoading=!0,4===r.formData.categoryType?(r.isLive=0,r.classType=1):1===r.formData.categoryType?(r.isLive=1,r.classType=3):(r.isLive=0,r.classType=2);try{g({schoolCode:r.formData.cityCode,serviceid:r.formData.serviceCenterId,venueId:r.formData.teachingPointCode,classType:r.classType}).then((function(t){r.classroomList=t,r.isExisted=r.classroomList.some((function(t){return t.name===e.classroomName})),r.isExisted||(r.formData.classroomName="",r.formData.classroomId="",r.changeVenue()),r.classroomLoading=!1}))}catch(e){r.$Message.error({content:"获取所选教学点下下教室失败: "+e.message,duration:5})}}),400),e.classLevelName)try{f({schoolCode:r.formData.cityCode,status:0,degree:r.formData.levelDegree,current:1,disable:0,size:100,name:e.classLevelName||""}).then((function(t){r.levelDegreeList=t.records,r.isClassLevelExisted=r.levelDegreeList.some((function(t){return t.name===e.classLevelName})),r.isClassLevelExisted||(r.formData.classLevelName="",r.formData.classLevel="",r.remoteListLinkName(e.classLevelName))}))}catch(e){r.$Message.error("获取班次级别下版本失败："+e.message)}r.teacherNameList=[{empNo:e.teacherEmpNo,realName:e.teacherEmpName}]}))}catch(e){this.$Message.error({content:"获取之前攒班详情失败: ".concat(e.message),duration:5})}this.modalLoading=!1;case 3:case"end":return e.stop()}}),e,this)}))),function(e){return k.apply(this,arguments)}),clearSelect:function(){this.changeClassLevel()}}},O=(a("844d"),a("2877")),j=Object(O.a)(N,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Modal",{attrs:{width:"743",title:e.title,"mask-closable":!1,loading:e.modalLoading},on:{"on-cancel":e.closeModal},model:{value:e.showAddClassModal,callback:function(t){e.showAddClassModal=t},expression:"showAddClassModal"}},[a("div",{staticClass:"wrapper"},[a("Form",{ref:"formValidate",staticClass:"formWrapper",attrs:{"label-position":"right",rules:e.ruleValidate,model:e.formData,"label-width":80}},[a("h3",{staticClass:"basicInfo",staticStyle:{marginBottom:"8px"}},[e._v("产品信息")]),e._v(" "),a("Row",[a("Col",{attrs:{span:"12"}},[a("FormItem",{staticClass:"formItem",attrs:{label:"分校"}},[a("Select",{staticClass:"iptWidth",attrs:{filterable:""},on:{"on-change":e.initCityList},model:{value:e.formData.cityCode,callback:function(t){e.$set(e.formData,"cityCode",t)},expression:"formData.cityCode"}},e._l(e.cityList,(function(t,r){return a("Option",{key:r,attrs:{value:t.id}},[e._v(e._s(t.name))])})),1)],1)],1)],1),e._v(" "),a("Row",[a("Col",{attrs:{span:"12"}},[a("FormItem",{staticClass:"formItem",attrs:{label:"产品类型",prop:"productType"}},[a("Select",{staticStyle:{width:"216px"},attrs:{clearable:""},on:{"on-change":e.handleProductTypeChange},model:{value:e.formData.productType,callback:function(t){e.$set(e.formData,"productType",t)},expression:"formData.productType"}},[a("Option",{attrs:{value:"1"}},[e._v("长期班")]),e._v(" "),a("Option",{attrs:{value:"2"}},[e._v("短期班")])],1)],1)],1),e._v(" "),"1"===e.formData.productType?a("Col",{attrs:{span:"12"}},[a("FormItem",{staticClass:"formItem",attrs:{label:"班型名称",prop:"classModelName"}},[a("Select",{staticStyle:{width:"216px"},attrs:{clearable:"",filterable:"",placeholder:"请搜索选择"},on:{"on-query-change":e.handleClassModelNameQueryChange,"on-clear":e.handleClassModelNameClear,"on-change":e.handleClassModelNameChange},model:{value:e.formData.classModelName,callback:function(t){e.$set(e.formData,"classModelName",t)},expression:"formData.classModelName"}},e._l(e.classModelNameList,(function(t){return a("Option",{key:t.id,attrs:{value:t.name,label:t.name},nativeOn:{click:function(a){return e.setCurrentClassModelId(t.id)}}})})),1)],1)],1):e._e()],1),e._v(" "),a("Row",["1"===e.formData.productType?a("Col",{attrs:{span:"12"}},[a("FormItem",{staticClass:"formItem",attrs:{label:"班型难度",prop:"classModelLevelName"}},[a("Select",{staticStyle:{width:"216px"},attrs:{clearable:"",filterable:"",placeholder:"请搜索选择"},on:{"on-change":e.handleClassModelLevelNameChange,"on-query-change":e.handleClassModelLevelNameQueryChange,"on-clear":e.handleClassModelLevelNameClear},model:{value:e.formData.classModelLevelName,callback:function(t){e.$set(e.formData,"classModelLevelName",t)},expression:"formData.classModelLevelName"}},e._l(e.classModelLevelList,(function(t){return a("Option",{key:t.id,attrs:{value:t.name,label:t.name},nativeOn:{click:function(a){return e.setCurrentClassModelLevelId(t.id)}}})})),1)],1)],1):e._e()],1),e._v(" "),a("h3",{staticClass:"basicInfo",staticStyle:{marginBottom:"8px"}},[e._v("基本信息")]),e._v(" "),a("Row",[a("Col",{attrs:{span:"12"}},[a("FormItem",{staticClass:"formItem",attrs:{label:"授课类型",prop:"categoryType"}},[a("Select",{staticStyle:{width:"216px"},attrs:{clearable:""},on:{"on-change":e.handleCategoryTypeChange,"on-clear":e.handleCatChangeToReset},model:{value:e.formData.categoryType,callback:function(t){e.$set(e.formData,"categoryType",t)},expression:"formData.categoryType"}},[a("Option",{attrs:{value:1},nativeOn:{click:function(t){return e.setCategoryTypeName("在线")}}},[e._v("在线")]),e._v(" "),a("Option",{attrs:{value:2},nativeOn:{click:function(t){return e.setCategoryTypeName("双师")}}},[e._v("双师")]),e._v(" "),a("Option",{attrs:{value:4},nativeOn:{click:function(t){return e.setCategoryTypeName("面授")}}},[e._v("面授")])],1)],1)],1),e._v(" "),a("Col",{attrs:{span:"12"}},[a("FormItem",{staticClass:"formItem",attrs:{label:"年级",prop:"gradeId"}},[a("Select",{staticStyle:{width:"216px"},attrs:{clearable:""},model:{value:e.formData.gradeId,callback:function(t){e.$set(e.formData,"gradeId",t)},expression:"formData.gradeId"}},e._l(e.gradeList,(function(t,r){return a("Option",{key:r,attrs:{value:t.standardId},nativeOn:{click:function(a){return e.setCurrentGradeName(t.standardName)}}},[e._v(e._s(t.standardName))])})),1)],1)],1)],1),e._v(" "),a("Row",[a("Col",{attrs:{span:"12"}},[a("FormItem",{staticClass:"formItem",attrs:{label:"学科",prop:"subjectId"}},[a("Select",{staticStyle:{width:"216px"},attrs:{clearable:""},model:{value:e.formData.subjectId,callback:function(t){e.$set(e.formData,"subjectId",t)},expression:"formData.subjectId"}},e._l(e.subjectList,(function(t,r){return a("Option",{key:r,attrs:{value:t.schoolId},nativeOn:{click:function(a){return e.setCurrentSubjectName(t.customName)}}},[e._v(e._s(t.customName))])})),1)],1)],1),e._v(" "),a("Col",{attrs:{span:"12"}},[a("FormItem",{staticClass:"formItem",attrs:{label:"班次级别",prop:"levelDegree"}},[a("Select",{staticStyle:{width:"216px"},attrs:{clearable:""},on:{"on-change":e.changeClassLevel},model:{value:e.formData.levelDegree,callback:function(t){e.$set(e.formData,"levelDegree",t)},expression:"formData.levelDegree"}},e._l(e.classLevelList,(function(t,r){return a("Option",{key:r,attrs:{value:t.schoolId},nativeOn:{click:function(a){return e.setCurrentClassLevelName(t.name)}}},[e._v(e._s(t.name))])})),1)],1)],1)],1),e._v(" "),a("Row",[a("Col",{attrs:{span:"12"}},[a("FormItem",{staticClass:"formItem",attrs:{label:"版本",prop:"classLevel"}},[a("Select",{staticStyle:{width:"216px"},attrs:{clearable:"",filterable:"",disabled:!e.formData.levelDegree},on:{"on-query-change":e.remoteListLinkName,"on-clear":e.clearSelect},model:{value:e.formData.classLevel,callback:function(t){e.$set(e.formData,"classLevel",t)},expression:"formData.classLevel"}},e._l(e.levelDegreeList,(function(t,r){return a("Option",{key:r,attrs:{value:t.schoolId},nativeOn:{click:function(a){return e.setCurrentLevelDegreeName(t.name)}}},[e._v(e._s(t.name))])})),1)],1)],1),e._v(" "),a("Col",{attrs:{span:"12"}},[a("FormItem",{staticClass:"formItem",attrs:{label:"主讲老师",prop:"teacherEmpNo"}},[a("Select",{ref:"select",staticStyle:{width:"216px"},attrs:{clearable:"",filterable:"","label-in-value":"",placeholder:"请搜索选择",loading:e.loadingTeacherName},on:{"on-query-change":e.remoteListTeacherName},model:{value:e.formData.teacherEmpNo,callback:function(t){e.$set(e.formData,"teacherEmpNo",t)},expression:"formData.teacherEmpNo"}},e._l(e.teacherNameList,(function(t,r){return a("Option",{key:r,attrs:{value:t.empNo,label:t.realName},nativeOn:{click:function(a){return e.setCurrentTeacherName(t.realName,t.teaId)}}},[a("div",{attrs:{slot:""},slot:"default"},[e._v(e._s(t.realName+" ("+t.empNo+")"))])])})),1)],1)],1)],1),e._v(" "),a("FormItem",{staticClass:"formItem",attrs:{label:"总课次",prop:"curriculumCount"}},[a("InputNumber",{staticStyle:{width:"216px"},attrs:{clearable:"",placeholder:"请输入",min:1},model:{value:e.formData.curriculumCount,callback:function(t){e.$set(e.formData,"curriculumCount",t)},expression:"formData.curriculumCount"}})],1),e._v(" "),1===e.formData.categoryType||2===e.formData.categoryType?a("FormItem",{key:"_classNum",staticClass:"formItem",attrs:{label:"班级个数",prop:"classNum"}},[a("InputNumber",{staticStyle:{width:"216px"},attrs:{clearable:"",placeholder:"请输入",min:1,max:10},model:{value:e.formData.classNum,callback:function(t){e.$set(e.formData,"classNum",t)},expression:"formData.classNum"}})],1):e._e(),e._v(" "),a("h3",{staticClass:"timePlace",staticStyle:{marginBottom:"8px",marginTop:"32px"}},[e._v("时间地点")]),e._v(" "),a("Row",[a("Col",{attrs:{span:"12"}},[a("FormItem",{staticClass:"formItem",attrs:{label:"年份",prop:"year"}},[a("Select",{staticStyle:{width:"216px"},attrs:{clearable:""},model:{value:e.formData.year,callback:function(t){e.$set(e.formData,"year",t)},expression:"formData.year"}},e._l(e.yearList,(function(t,r){return a("Option",{key:r,attrs:{value:t}},[e._v(e._s(t))])})),1)],1)],1),e._v(" "),a("Col",{attrs:{span:"12"}},[a("FormItem",{staticClass:"formItem",attrs:{label:"学季",prop:"seasonId"}},[a("Select",{staticStyle:{width:"216px"},attrs:{clearable:""},model:{value:e.formData.seasonId,callback:function(t){e.$set(e.formData,"seasonId",t)},expression:"formData.seasonId"}},e._l(e.seasonList,(function(t){return a("Option",{key:t.id,attrs:{value:t.id},nativeOn:{click:function(a){return e.setCurrentSeasonName(t.name)}}},[e._v(e._s(t.name))])})),1)],1)],1)],1),e._v(" "),a("FormItem",{staticClass:"formItem",attrs:{label:"开始日期",prop:"originalClassBeginTime"}},[a("DatePicker",{staticStyle:{width:"216px"},attrs:{type:"date",placement:"top",placeholder:"开始日期",options:e.ClassBeginOptions},on:{"on-change":e.setCurrentClassBeginTime},model:{value:e.formData.originalClassBeginTime,callback:function(t){e.$set(e.formData,"originalClassBeginTime",t)},expression:"formData.originalClassBeginTime"}}),e._v(" "),a("Input",{staticStyle:{width:"216px",marginLeft:"24px"},attrs:{disabled:"",placeholder:"星期"},model:{value:e.weekFromStartTime,callback:function(t){e.weekFromStartTime=t},expression:"weekFromStartTime"}})],1),e._v(" "),a("FormItem",{staticClass:"formItem",staticStyle:{display:"inline-block"},attrs:{label:"上课时间",prop:"periodId"}},[a("Select",{staticStyle:{width:"216px"},attrs:{clearable:"",placeholder:"上课时段"},on:{"on-change":e.periodChange},model:{value:e.formData.periodId,callback:function(t){e.$set(e.formData,"periodId",t)},expression:"formData.periodId"}},e._l(e.timeList,(function(t,r){return a("Option",{key:r,attrs:{value:t.id},nativeOn:{click:function(a){return e.setCurrentPeriod(t.name)}}},[e._v(e._s(t.name)+"\n          ")])})),1),e._v(" "),a("FormItem",{staticClass:"formItem",staticStyle:{display:"inline-block",marginLeft:"24px"},attrs:{label:"",prop:"courseTime"}},[a("Select",{staticStyle:{width:"216px"},attrs:{clearable:"",filterable:"",placeholder:"上课时间",loading:e.classTimeListLoading,disabled:!e.formData.periodId},on:{"on-open-change":e.periodChange},model:{value:e.formData.courseTime,callback:function(t){e.$set(e.formData,"courseTime",t)},expression:"formData.courseTime"}},e._l(e.classTimeList,(function(t,r){return a("Option",{key:r,attrs:{value:t.name},nativeOn:{click:function(a){return e.setCurrentCourseTime(t.startTime,t.endTime)}}},[e._v(e._s(t.name))])})),1)],1)],1),e._v(" "),1===e.formData.categoryType?a("FormItem",{staticClass:"formItem",staticStyle:{display:"inline-block"},attrs:{label:"直播间",prop:"areaId"}},[a("Select",{staticStyle:{width:"216px"},attrs:{clearable:"",filterable:"",placeholder:"区域",loading:e.areaLoading},on:{"on-change":e.changeArea},model:{value:e.formData.areaId,callback:function(t){e.$set(e.formData,"areaId",t)},expression:"formData.areaId"}},e._l(e.areaList,(function(t,r){return a("Option",{key:r,attrs:{value:t.schoolId},nativeOn:{click:function(a){return e.setCurrentAreaName(t.name)}}},[e._v(e._s(t.name))])})),1),e._v(" "),1===e.formData.categoryType?a("FormItem",{staticClass:"formItem",staticStyle:{display:"inline-block",marginLeft:"24px"},attrs:{label:"",prop:"serviceCenterId"}},[a("Select",{staticStyle:{width:"216px"},attrs:{clearable:"",filterable:"",placeholder:"服务中心",disabled:!e.formData.areaId,loading:e.serviceCenterLoading},on:{"on-change":e.changeService},model:{value:e.formData.serviceCenterId,callback:function(t){e.$set(e.formData,"serviceCenterId",t)},expression:"formData.serviceCenterId"}},e._l(e.serviceCenterList,(function(t,r){return a("Option",{key:r,attrs:{value:t.schoolId},nativeOn:{click:function(a){return e.setCurrentServiceCenterName(t.name)}}},[e._v(e._s(t.name))])})),1)],1):e._e()],1):a("FormItem",{staticClass:"formItem",staticStyle:{display:"inline-block"},attrs:{label:"教室",prop:"areaId"}},[a("Select",{staticStyle:{width:"216px"},attrs:{clearable:"",filterable:"",placeholder:"区域"},on:{"on-change":e.changeArea},model:{value:e.formData.areaId,callback:function(t){e.$set(e.formData,"areaId",t)},expression:"formData.areaId"}},e._l(e.areaList,(function(t,r){return a("Option",{key:r,attrs:{value:t.schoolId},nativeOn:{click:function(a){return e.setCurrentAreaName(t.name)}}},[e._v(e._s(t.name))])})),1),e._v(" "),a("FormItem",{staticClass:"formItem",staticStyle:{display:"inline-block",marginLeft:"24px"},attrs:{label:"",prop:"serviceCenterId"}},[a("Select",{staticStyle:{width:"216px"},attrs:{clearable:"",filterable:"",placeholder:"服务中心",disabled:!e.formData.areaId,loading:e.serviceCenterLoading},on:{"on-change":e.changeService},model:{value:e.formData.serviceCenterId,callback:function(t){e.$set(e.formData,"serviceCenterId",t)},expression:"formData.serviceCenterId"}},e._l(e.serviceCenterList,(function(t,r){return a("Option",{key:r,attrs:{value:t.schoolId},nativeOn:{click:function(a){return e.setCurrentServiceCenterName(t.name)}}},[e._v(e._s(t.name))])})),1)],1)],1),e._v(" "),a("FormItem",{staticClass:"formItem",staticStyle:{display:"inline-block"},attrs:{label:"",prop:"teachingPointCode"}},[a("Select",{staticStyle:{width:"216px"},attrs:{clearable:"",filterable:"",placeholder:"教学点",disabled:!e.formData.serviceCenterId,loading:e.teachingPointLoading},on:{"on-change":e.changeVenue},model:{value:e.formData.teachingPointCode,callback:function(t){e.$set(e.formData,"teachingPointCode",t)},expression:"formData.teachingPointCode"}},e._l(e.venueList,(function(t,r){return a("Option",{key:r,attrs:{value:t.schoolId},nativeOn:{click:function(a){return e.setCurrentTeachingPointName(t.name)}}},[e._v(e._s(t.name))])})),1),e._v(" "),1===e.formData.categoryType?a("FormItem",{ref:"classroom",staticClass:"formItem",staticStyle:{display:"inline-block",marginLeft:"24px"},attrs:{label:"",prop:"classroomId"}},[a("Select",{staticStyle:{width:"216px"},attrs:{clearable:"",filterable:"",placeholder:"直播间",disabled:!e.formData.teachingPointCode,loading:e.classroomLoading},on:{"on-clear":e.changeVenue},model:{value:e.formData.classroomId,callback:function(t){e.$set(e.formData,"classroomId",t)},expression:"formData.classroomId"}},e._l(e.classroomList,(function(t,r){return a("Option",{key:r,attrs:{value:t.schoolId},nativeOn:{click:function(a){return e.setCurrentClassroomName(t.name)}}},[e._v(e._s(t.name))])})),1)],1):a("FormItem",{staticClass:"formItem",staticStyle:{display:"inline-block",marginLeft:"24px"},attrs:{label:"",prop:"classroomId"}},[a("Select",{staticStyle:{width:"216px"},attrs:{clearable:"",filterable:"",placeholder:"教室",disabled:!e.formData.teachingPointCode,loading:e.classroomLoading},on:{"on-clear":e.changeVenue},model:{value:e.formData.classroomId,callback:function(t){e.$set(e.formData,"classroomId",t)},expression:"formData.classroomId"}},e._l(e.classroomList,(function(t,r){return a("Option",{key:r,attrs:{value:t.schoolId},nativeOn:{click:function(a){return e.setCurrentClassroomName(t.name)}}},[e._v(e._s(t.name))])})),1)],1)],1),e._v(" "),a("h3",{staticClass:"courseInfo",staticStyle:{marginBottom:"8px",marginTop:"12px"}},[e._v("课程信息")]),e._v(" "),a("Row",[a("Col",{attrs:{span:"12"}},[a("FormItem",{staticClass:"formItem",attrs:{label:"课程限额",prop:"maxPersons"}},[a("InputNumber",{staticStyle:{width:"216px"},attrs:{max:100,min:1,placeholder:"请输入"},model:{value:e.formData.maxPersons,callback:function(t){e.$set(e.formData,"maxPersons",t)},expression:"formData.maxPersons"}})],1)],1),e._v(" "),a("Col",{attrs:{span:"12"}},[a("FormItem",{staticClass:"formItem",attrs:{label:"容量类别",prop:"capacityLabel"}},[a("Select",{staticStyle:{width:"216px"},attrs:{clearable:""},on:{"on-change":e.changeCapacityLabel},model:{value:e.formData.capacityLabel,callback:function(t){e.$set(e.formData,"capacityLabel",t)},expression:"formData.capacityLabel"}},[a("Option",{attrs:{value:1},nativeOn:{click:function(t){return e.setCurrentCapacityLabelName(t)}}},[e._v("大班")]),e._v(" "),a("Option",{attrs:{value:2},nativeOn:{click:function(t){return e.setCurrentCapacityLabelName(t)}}},[e._v("小班")])],1)],1)],1)],1),e._v(" "),a("FormItem",{staticClass:"formItem",attrs:{label:"课程金额",prop:"price"}},[a("InputNumber",{staticStyle:{width:"216px"},attrs:{min:0,max:1e5,placeholder:"请输入"},model:{value:e.formData.price,callback:function(t){e.$set(e.formData,"price",t)},expression:"formData.price"}})],1),e._v(" "),1===e.formData.categoryType?a("FormItem",{key:"_classWay",staticClass:"formItem",attrs:{label:"上课模式",prop:"classWay"}},[1===e.formData.capacityLabel?a("Select",{staticStyle:{width:"216px"},attrs:{clearable:""},model:{value:e.formData.classWay,callback:function(t){e.$set(e.formData,"classWay",t)},expression:"formData.classWay"}},e._l(e.lClassWayList,(function(t){return a("Option",{key:t.id,attrs:{value:t.id},nativeOn:{click:function(a){return e.setCurrentClassWayName(t.name)}}},[e._v(e._s(t.name))])})),1):e._e(),e._v(" "),2===e.formData.capacityLabel?a("Select",{staticStyle:{width:"216px"},attrs:{clearable:""},model:{value:e.formData.classWay,callback:function(t){e.$set(e.formData,"classWay",t)},expression:"formData.classWay"}},e._l(e.sClassWayList,(function(t){return a("Option",{key:t.id,attrs:{value:t.id},nativeOn:{click:function(a){return e.setCurrentClassWayName(t.name)}}},[e._v(e._s(t.name))])})),1):e._e()],1):e._e(),e._v(" "),a("h3",{staticClass:"cuanbanLimitation",staticStyle:{marginBottom:"8px"}},[e._v("\n        攒班时效\n        "),a("Tooltip",{attrs:{transfer:"",placement:"right"}},[a("Icon",{staticClass:"icon-help",attrs:{type:"ios-help-circle-outline"}}),e._v(" "),a("div",{attrs:{slot:"content"},slot:"content"},[a("p",[e._v("到达截止时间时，攒班活动自动下线")])])],1)],1),e._v(" "),a("FormItem",{staticClass:"formItem",attrs:{label:"截止时间",prop:"deadLine"}},[a("DatePicker",{staticStyle:{width:"216px"},attrs:{type:"datetime",placeholder:"请选择",placement:"top",options:e.ClassBeginOptions},on:{"on-change":e.setCurrentAssembleEndTime},model:{value:e.formData.deadLine,callback:function(t){e.$set(e.formData,"deadLine",t)},expression:"formData.deadLine"}})],1)],1)],1),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"default"},on:{click:e.cancel}},[e._v("取消")]),e._v(" "),a("Button",{attrs:{type:"primary"},on:{click:e.confirm}},[e._v("确认")])],1)])}),[],!1,null,"54d761fe",null).exports,M={props:{data:{type:Array,default:function(){return[]}}},data:function(){var e=this;return{columns:[{title:"产品类型",align:"center",minWidth:80,render:function(t,a){return t("span",e.data[a.index].productType[0].productType||"-")}},{title:"班型名称",align:"center",minWidth:140,render:function(t,a){return t("span",e.data[a.index].classModel[0].classModel||"-")}},{title:"班型难度",align:"center",minWidth:140,render:function(t,a){return t("span",e.data[a.index].classModelLevel[0].classModelLevel||"-")}},{title:"年份",align:"center",minWidth:80,render:function(t,a){return t("span",e.data[a.index].year[0].year||"-")}},{title:"学季",align:"center",minWidth:100,render:function(t,a){return t("span",e.data[a.index].seasons[0].seasonName||"-")}},{title:"年级",align:"center",minWidth:120,render:function(t,a){return t("span",e.data[a.index].grades[0].gradeName||"-")}},{title:"学科",align:"center",minWidth:120,render:function(t,a){return t("span",e.data[a.index].subjects[0].subjectName||"-")}},{title:"班次级别",align:"center",minWidth:80,render:function(t,a){return t("span",e.data[a.index].levelDegrees[0].levelDegreeName||"-")}},{title:"版本",align:"center",minWidth:120,render:function(t,a){return t("span",e.data[a.index].bookVersions[0].bookVersionName||"-")}},{title:"总课次",align:"center",minWidth:80,render:function(t,a){return t("span",e.data[a.index].courseNums[0].courseNum||"-")}},{title:"班级个数",align:"center",minWidth:80,render:function(t,a){return t("span",e.data[a.index].classNums[0].classNum||"-")}},{title:"授课类型",align:"center",minWidth:80,render:function(t,a){return t("span",e.data[a.index].categoryTypes[0].categoryTypeName||"-")}},{title:"容量类别",align:"center",minWidth:100,render:function(t,a){return t("span",e.data[a.index].capacityLabels[0].capacityLabelName||"-")}},{title:"上课模式",align:"center",minWidth:120,render:function(t,a){return t("span",e.data[a.index].classWays[0].classWayName||"-")}},{title:"课程限额",align:"center",minWidth:80,render:function(t,a){return t("span",e.data[a.index].maxPersons[0].maxPersons||"-")}},{title:"课程金额",align:"center",minWidth:100,render:function(t,a){return t("span",e.data[a.index].prices[0].price||"-")}},{title:"主讲",align:"center",minWidth:140,render:function(t,a){return t("span",e.data[a.index].teachers[0].teacherEmpName||"-")}},{title:"教室或直播间",align:"center",minWidth:140,render:function(t,a){return t("span",e.data[a.index].classRooms[0].classroomName||"-")}},{title:"开课日期",align:"center",minWidth:140,render:function(t,a){return t("span",new Date(e.data[a.index].classDates[0].classDate).toLocaleDateString()||"-")}},{title:"课程星期",align:"center",minWidth:100,render:function(t,a){return t("span",e.data[a.index].weekDays[0].weekDay||"-")}},{title:"上课时段",align:"center",minWidth:120,render:function(t,a){return t("span",e.data[a.index].periods[0].period||"-")}},{title:"上课时间",align:"center",minWidth:140,render:function(t,a){return t("span",e.data[a.index].startTimes[0].startTime||"-")}},{title:"攒班截止时间",align:"center",minWidth:140,render:function(t,a){return t("span",new Date(e.data[a.index].assembleEndTime[0].assembleEndTime).toLocaleDateString()+" "+new Date(e.data[a.index].assembleEndTime[0].assembleEndTime).toTimeString().substr(0,8)||"-")}}]}},mounted:function(){this.data&&this.data.length&&(console.log(this.data),console.log(this.data[0].year[0].year))}},$=(a("1e0c"),Object(O.a)(M,(function(){var e=this.$createElement;return(this._self._c||e)("Table",{staticClass:"error-target-table",attrs:{border:"",columns:this.columns,data:this.data}})}),[],!1,null,"f80e23ea",null).exports),R=a("325c"),P=a("a78e"),A=a.n(P),E={name:"batchImportWrapper",props:{cityCode:String},components:{ErrorTargetTable:$},data:function(){return{showBatchImportWrapperModal:!1,errorTargetData:[],fileList:[],uploading:!1,downloading:!1}},methods:{batchImportWrapperHandler:function(){this.showBatchImportWrapperModal=!0},closeUploadModal:function(){this.fileList=[],this.errorTargetData=[],this.$refs.upload.fileList=[],this.showBatchImportWrapperModal=!1},handleUploadTargetData:(L=Object(n.a)(regeneratorRuntime.mark((function e(){var t,a,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(t=this.fileList.filter((function(e){return 5===e.status}))||[]).length){e.next=3;break}return e.abrupt("return",this.$Message.warning({content:"请上传文件",duration:5}));case 3:if(!(t.length<this.fileList.length)){e.next=5;break}return e.abrupt("return",this.$Message.warning({content:"文件上传中，请稍后提交",duration:5}));case 5:return a={fileUrl:t[0].path,cityCode:this.cityCode},e.prev=6,this.uploading=!0,e.next=10,Object(i.z)(a);case 10:"2"===(r=e.sent).execResult?this.errorTargetData=r.messageData:(this.closeUploadModal(),this.$Message.success({content:"上传成功",duration:5}),this.showBatchImportWrapperModal=!1,this.$emit("updateTableData")),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(6),this.$Message.error({content:"批量设置失败: ".concat(e.t0.message),duration:5});case 17:this.uploading=!1;case 18:case"end":return e.stop()}}),e,this,[[6,14]])}))),function(){return L.apply(this,arguments)}),handleDownloadExcel:(I=Object(n.a)(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={empNo:JSON.parse(A.a.get("columbusUserInfo")).id},this.downloading=!0,e.next=5,Object(i.k)(t);case 5:a=e.sent,R.a.downloadBolbFile(a,"攒班-批量设置模板.xlsx","application/vnd.ms-excel;charset=utf-8"),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),this.$Message.error({content:"模版下载失败: ".concat(e.t0.message),duration:5});case 13:this.downloading=!1;case 14:case"end":return e.stop()}}),e,this,[[0,10]])}))),function(){return I.apply(this,arguments)})}},F=(a("945d"),Object(O.a)(E,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Modal",{staticClass:"batchImportModal",attrs:{title:"批量导入",width:"663","mask-closable":!1,closable:!1},model:{value:e.showBatchImportWrapperModal,callback:function(t){e.showBatchImportWrapperModal=t},expression:"showBatchImportWrapperModal"}},[a("div",{staticClass:"wrapper"},[a("div",{staticClass:"cuanbanSettings"},[a("Row",[a("Col",{attrs:{span:"5"}},[a("p",{staticStyle:{marginTop:"16px",marginLeft:"10px"}},[e._v("攒班配置")])]),e._v(" "),a("Col",{attrs:{span:"17"}},[a("Button",{staticStyle:{marginTop:"8px",marginBottom:"10px"},attrs:{type:"primary",loading:e.downloading},on:{click:e.handleDownloadExcel}},[e._v("下载模版")]),e._v(" "),a("p",{staticStyle:{marginTop:"3px"}},[e._v("1.模版表头不可更改和删除，上传过程请不要关闭弹窗")]),e._v(" "),a("p",{staticStyle:{marginTop:"3px"}},[e._v("2.上传过程中系统会对内容参数的合法性进行校验")]),e._v(" "),a("p",{staticStyle:{marginTop:"3px"}},[e._v("3.在线和双师课程，同一课程下最大支持10个班级")])],1)],1)],1),e._v(" "),a("div",{staticClass:"importSettings"},[a("Row",[a("Col",{attrs:{span:"5"}},[a("p",{staticStyle:{marginTop:"32px",marginLeft:"10px"}},[e._v("导入配置文件")])]),e._v(" "),a("Col",{attrs:{span:"17"}},[e.errorTargetData.length?a("div",{staticClass:"error-box",staticStyle:{marginTop:"25px"}},[a("TalOssUploadUi",{ref:"upload",attrs:{required:!0,btnName:"上传文件",platform:"fe-service-platform"},model:{value:e.fileList,callback:function(t){e.fileList=t},expression:"fileList"}}),e._v(" "),a("p",{staticClass:"flex",staticStyle:{"justify-content":"flex-start","align-items":"center",marginTop:"16px"}},[a("Icon",{staticStyle:{color:"red","font-size":"20px","font-weight":"bold","margin-right":"8px","margin-bottom":"8px"},attrs:{type:"md-close-circle"}}),e._v(" "),a("b",{staticStyle:{"margin-bottom":"6px"}},[e._v(" 校验失败（"+e._s(e.errorTargetData.length)+"）")])],1),e._v(" "),e._l(e.errorTargetData,(function(t,r){return a("div",{key:r,staticStyle:{marginTop:"16px"}},[t.log?a("div",{staticClass:"error-name"},[e._v(e._s(t.message)+"（"+e._s(t.log.length)+"）")]):e._e(),e._v(" "),t.log?a("ErrorTargetTable",{attrs:{data:t.log}}):e._e()],1)}))],2):a("div",{staticStyle:{marginTop:"25px"}},[a("TalOssUploadUi",{ref:"upload",attrs:{required:!0,btnName:"上传文件",platform:"fe-service-platform"},model:{value:e.fileList,callback:function(t){e.fileList=t},expression:"fileList"}})],1)])],1)],1)]),e._v(" "),a("div",{staticStyle:{"justify-content":"center"},attrs:{slot:"footer"},slot:"footer"},[e.errorTargetData.length?[a("Button",{on:{click:e.closeUploadModal}},[e._v("取消")]),e._v(" "),a("Button",{attrs:{type:"primary"},on:{click:function(t){e.errorTargetData=[]}}},[e._v("重新导入")])]:[a("Button",{attrs:{disabled:e.uploading},on:{click:e.closeUploadModal}},[e._v("取消")]),e._v(" "),a("Button",{attrs:{loading:e.uploading,disabled:!e.fileList.length,type:"primary"},on:{click:e.handleUploadTargetData}},[e._v("确认导入")])]],2)])}),[],!1,null,"3a217753",null).exports),q={name:"studentList",mixins:[a("0ef6").a],props:{id:{type:String,default:""},classId:{type:String,default:""},cityCode:String},data:function(){var e=this;return{showStudentListModal:!1,columns:[{width:"65px",type:"index",title:"序号",align:"center"},{width:"100px",title:"学员姓名",align:"center",key:"name",render:function(t,a){return t("a",{on:{click:function(){var t={card:a.row.stuLoginName,cityCode:e.cityCode};e.goCustomerDetail(t),e.showStudentListModal=!1}}},a.row.name||"无")}},{width:"170px",title:"学员编号",align:"center",key:"stuLoginName"},{width:"150px",title:"手机号",align:"center",key:"phone",render:function(e,t){var a=t.row;return console.log(" 手机号 %%% "+JSON.stringify(a)),e("tal-decode-text",{props:{encodeText:a.phone,type:"phone",uid:a.uid}})}},{width:"94px",title:"报名状态",align:"center",key:"registStatus",render:function(t,a){return t("span",e.registStatusMap[a.row.registStatus]||"--")}},{width:"94px",title:"缴费状态",align:"center",key:"pay_status",render:function(e,t){return e("span",t.row.payStatus?"已缴费":"未缴费")}},{width:"94px",title:"报名人",align:"center",key:"creator",render:function(e,t){return e("span",null===t.row.creator?"--":t.row.creator||"用户")}},{width:"94px",title:"报名渠道",align:"center",key:"regWay",render:function(t,a){return t("span",e.regWayMap[a.row.regWay]||"--")}},{width:"120px",title:"报名时间",align:"center",key:"regTime",render:function(e,t){return e("span",t.row.regTime||"--")}},{title:"缴费时间",align:"center",key:"payTime",render:function(e,t){return e("span",t.row.payTime||"--")}}],registStatusMap:{0:"未报名",1:"已报名",2:"报名失败"},regWayMap:{0:"前台报名",1:"网上报名",2:"电话报名",3:"App",4:"App",5:"CRM报名",6:"微信活动",7:"微信",8:"百度直达号"},formData:[]}},watch:{showStudentListModal:{handler:function(e){e&&this.cityCode&&this.getAssembleRecordList()}}},methods:{studentListHandler:function(){this.showStudentListModal=!0},getAssembleRecordList:(x=Object(n.a)(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={groupWorkId:this.id,classId:this.classId,cityCode:this.cityCode},e.next=4,Object(i.h)(t);case 4:a=e.sent,this.formData=a,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),this.$Message.error({content:"查询学员详情错误："+e.t0.message,duration:5});case 11:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(){return x.apply(this,arguments)})}},z=Object(O.a)(q,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Modal",{attrs:{width:"1131",title:"学员名单"},model:{value:e.showStudentListModal,callback:function(t){e.showStudentListModal=t},expression:"showStudentListModal"}},[a("div",{staticClass:"wrapper"},[a("Table",{attrs:{width:"1074",border:"",columns:e.columns,data:e.formData}}),e._v(" "),a("div",{staticClass:"page-box",staticStyle:{textAlign:"right",marginTop:"20px"}})],1),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"})])}),[],!1,null,"7cd7505f",null).exports,B=a("2472");function W(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function U(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?W(Object(a),!0).forEach((function(t){Object(r.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):W(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var V,G,H={name:"classSearch",mixins:[b],data:function(){return{cityList:[],hover:!1,hover2:!1,activeCard:1,stayOnlineTotal:0,assembleInTotal:0,assembleSuccessTotal:0,openClassSuccess:0,assembleFail:0,formData:{name:"",categoryType:"",productType:"",serviceCenterId:"",teachingPointCode:"",teacherEmpNo:"",classTimeTypeId:"",classTimeTypeName:"",period:"",cityCode:"",queryType:1},serviceCenterList:[],venueList:[],teacherNameList:[],loadingTeacherName:!1,timeTypeList:["周一","周二","周三","周四","周五","周六","周日"],classTimeTypeIdMap:{"周一":1,"周二":2,"周三":3,"周四":4,"周五":5,"周六":6,"周日":7},timeList:[]}},mounted:function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getCityListHandler((function(e){t.formData.cityCode=e[0].id}));case 2:this.initCityList();case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),methods:{initCityList:function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getCurrentserviceCenter();case 3:this.assembleSearch(),this.getTimeList(),this.formData.serviceCenterId&&this.getVenueListHandler({cityCode:this.formData.cityCode,serviceId:this.formData.serviceCenterId}).then((function(e){t.venueList=e})).catch((function(e){t.$Message.warning("获取教学点失败:"+e.message)})),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),this.$Message.error({content:"获取上课时段失败: "+e.t0.message,duration:5});case 11:case"end":return e.stop()}}),e,this,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),getAssembleTotal:function(){var e=this,t=U(U({},this.formData),{},{cityCode:this.formData.cityCode});Object(i.s)(t).then((function(t){t?(e.stayOnlineTotal=t.stayOnlineTotal,e.assembleInTotal=t.assembleInTotal,e.assembleSuccessTotal=t.assembleSuccessTotal,e.openClassSuccess=t.openClassSuccess,e.assembleFail=t.assembleFail):(e.stayOnlineTotal=0,e.assembleInTotal=0,e.assembleSuccessTotal=0,e.openClassSuccess=0,e.assembleFail=0)})).catch((function(t){e.$Message.error({content:"获取攒班类型数量失败: "+t.message,duration:5}),e.stayOnlineTotal=0,e.assembleInTotal=0,e.assembleSuccessTotal=0,e.openClassSuccess=0,e.assembleFail=0}))},getCurrentserviceCenter:(G=Object(n.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(B.e)({cityCode:this.formData.cityCode,empNo:JSON.parse(A.a.get("columbusUserInfo")).id});case 3:(t=e.sent).serviceCenterId&&t.serviceCenterName&&(this.serviceCenterList=[{schoolId:t.serviceCenterId,name:t.serviceCenterName}],this.formData.serviceCenterId=t.serviceCenterId),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),this.$Message.error({content:"获取当前顾问所在服务中心失败: "+e.t0.message,duration:5});case 10:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(){return G.apply(this,arguments)}),changeService:function(e){var t=this;if(this.venueList=[],this.formData.teachingPointCode="",!e)return!1;var a={cityCode:this.formData.cityCode,serviceId:this.formData.serviceCenterId};this.getVenueListHandler(a).then((function(e){t.venueList=e})).catch((function(e){t.$Message.warning("获取教学点失败:"+e.message)}))},remoteListTeacherName:function(e){var t=this;clearTimeout(this.lazyTimer),this.lazyTimer=setTimeout((function(){t.getTeacher(e)}),400)},getTeacher:function(e){var t=this;e=e.trim(),this.loadingTeacherName=!0,this.teacherNameList=[];var a={sysName:e,teacherType:0,cityCode:this.formData.cityCode,businessType:this.formData.categoryType,pageNo:1,pageSize:20};this.getTeacherByNameFuzzyHandler(a).then((function(e){e.records&&e.records.length&&(t.teacherNameList=e.records),t.loadingTeacherName=!1})).catch((function(e){t.loadingTeacherName=!1,t.$Message.error("获取主讲老师姓名失败:"+e.message)}))},assembleSearch:(V=Object(n.a)(regeneratorRuntime.mark((function e(){var t,a=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=a.length>0&&void 0!==a[0]&&a[0],this.formData.classTimeTypeId=this.classTimeTypeIdMap[this.formData.classTimeTypeName],this.getAssembleTotal(this.formData),this.$emit("queryParams",this.formData,new Date,t);case 4:case"end":return e.stop()}}),e,this)}))),function(){return V.apply(this,arguments)}),resetField:function(){this.formData.name="",this.formData.categoryType="",this.formData.teachingPointCode="",this.formData.teacherEmpNo="",this.formData.classTimeTypeId="",this.formData.classTimeTypeName="",this.formData.period="",this.formData.queryType=1,this.activeCard=1,this.assembleSearch(!0)},handleCardClick:function(e){this.activeCard=e,this.formData.queryType=e,this.$emit("queryParams",this.formData,new Date,!0)}}},Q=(a("bd2c"),Object(O.a)(H,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"wholeSearch"},[a("div",{staticClass:"formLayout"},[a("Form",{staticClass:"form-container",attrs:{model:e.formData,"label-width":100,inline:""}},[a("FormItem",{attrs:{label:"分校"}},[a("Select",{staticClass:"iptWidth",attrs:{filterable:""},on:{"on-change":e.initCityList},model:{value:e.formData.cityCode,callback:function(t){e.$set(e.formData,"cityCode",t)},expression:"formData.cityCode"}},e._l(e.cityList,(function(t,r){return a("Option",{key:r,attrs:{value:t.id}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),a("FormItem",{attrs:{label:"班级名称"}},[a("Input",{staticClass:"iptWidth",attrs:{placeholder:"学科/年级/班型/学季"},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1),e._v(" "),a("FormItem",{attrs:{label:"产品类型"}},[a("Select",{staticClass:"iptWidth",attrs:{clearable:""},model:{value:e.formData.productType,callback:function(t){e.$set(e.formData,"productType",t)},expression:"formData.productType"}},[a("Option",{attrs:{value:"1"}},[e._v("长期班")]),e._v(" "),a("Option",{attrs:{value:"2"}},[e._v("短期班")])],1)],1),e._v(" "),a("FormItem",{attrs:{label:"授课类型"}},[a("Select",{staticClass:"iptWidth",attrs:{clearable:""},model:{value:e.formData.categoryType,callback:function(t){e.$set(e.formData,"categoryType",t)},expression:"formData.categoryType"}},[a("Option",{attrs:{value:1}},[e._v("在线")]),e._v(" "),a("Option",{attrs:{value:2}},[e._v("双师")]),e._v(" "),a("Option",{attrs:{value:4}},[e._v("面授")])],1)],1),e._v(" "),a("FormItem",{attrs:{label:"服务中心"}},[a("Select",{staticClass:"iptWidth",attrs:{clearable:"",filterable:"","remote-method":function(t){return e.getServiceCenterList(t,e.formData.cityCode)}},on:{"on-change":e.changeService},model:{value:e.formData.serviceCenterId,callback:function(t){e.$set(e.formData,"serviceCenterId",t)},expression:"formData.serviceCenterId"}},e._l(e.serviceCenterList,(function(t,r){return a("Option",{key:r,attrs:{value:t.schoolId}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),a("FormItem",{attrs:{label:"教学点"}},[a("Select",{staticClass:"iptWidth",attrs:{clearable:"",filterable:"",disabled:!e.formData.serviceCenterId},model:{value:e.formData.teachingPointCode,callback:function(t){e.$set(e.formData,"teachingPointCode",t)},expression:"formData.teachingPointCode"}},e._l(e.venueList,(function(t,r){return a("Option",{key:r,attrs:{value:t.schoolId}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),a("FormItem",{attrs:{label:"主讲老师"}},[a("Select",{staticClass:"iptWidth",attrs:{filterable:"",clearable:"","label-in-value":"",placeholder:"请搜索选择",loading:e.loadingTeacherName,"remote-method":e.remoteListTeacherName},model:{value:e.formData.teacherEmpNo,callback:function(t){e.$set(e.formData,"teacherEmpNo",t)},expression:"formData.teacherEmpNo"}},e._l(e.teacherNameList,(function(t,r){return a("Option",{key:r,attrs:{value:t.empNo,label:t.realName}},[a("div",{attrs:{slot:""},slot:"default"},[e._v(e._s(t.realName+" ("+t.empNo+")"))])])})),1)],1),e._v(" "),a("FormItem",{attrs:{label:"上课星期"}},[a("Select",{staticClass:"iptWidth",attrs:{clearable:""},model:{value:e.formData.classTimeTypeName,callback:function(t){e.$set(e.formData,"classTimeTypeName",t)},expression:"formData.classTimeTypeName"}},e._l(e.timeTypeList,(function(t,r){return a("Option",{key:r,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),e._v(" "),a("FormItem",{attrs:{label:"上课时段"}},[a("Select",{staticClass:"iptWidth",attrs:{clearable:""},model:{value:e.formData.period,callback:function(t){e.$set(e.formData,"period",t)},expression:"formData.period"}},e._l(e.timeList,(function(t){return a("Option",{key:t.id,attrs:{value:t.name}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),a("FormItem",{staticClass:"btnArea"},[a("Button",{staticClass:"searchBtn",attrs:{type:"primary"},on:{click:e.assembleSearch}},[e._v("查询")]),e._v(" "),a("Button",{attrs:{type:"default"},on:{click:e.resetField}},[e._v("重置")])],1)],1)],1),e._v(" "),a("div",{staticClass:"cardWrapper"},[a("div",{ref:"card",staticClass:"task-type-card",class:{active:1===e.activeCard},on:{mouseenter:function(t){e.hover=!0},mouseleave:function(t){e.hover=!1},click:function(t){return e.handleCardClick(1)}}},[a("p",{staticClass:"typeName"},[e._v("\n        待上线\n        "),a("Tooltip",{attrs:{transfer:"",placement:"right"}},[a("Icon",{attrs:{type:"ios-information-circle-outline"}}),e._v(" "),a("div",{attrs:{slot:"content"},slot:"content"},[a("p",[e._v("课程上线后，用户可以进行攒班")])])],1)],1),e._v(" "),a("div",{staticClass:"typeNum"},[e._v(e._s(this.stayOnlineTotal))])]),e._v(" "),a("div",{ref:"card",staticClass:"task-type-card",class:{active:2===e.activeCard},on:{mouseenter:function(t){e.hover=!0},mouseleave:function(t){e.hover=!1},click:function(t){return e.handleCardClick(2)}}},[a("p",{staticClass:"typeName"},[e._v("\n        攒班中\n        "),a("Tooltip",{attrs:{transfer:"",placement:"right"}},[a("Icon",{attrs:{type:"ios-information-circle-outline"}}),e._v(" "),a("div",{attrs:{slot:"content"},slot:"content"},[a("p",[e._v("正在攒班的班级")])])],1)],1),e._v(" "),a("div",{staticClass:"typeNum"},[e._v(e._s(this.assembleInTotal))])]),e._v(" "),a("div",{ref:"card",staticClass:"task-type-card",class:{active:3===e.activeCard},on:{mouseenter:function(t){e.hover=!0},mouseleave:function(t){e.hover=!1},click:function(t){return e.handleCardClick(3)}}},[a("p",{staticClass:"typeName"},[e._v("\n        攒班成功\n        "),a("Tooltip",{attrs:{transfer:"",placement:"right"}},[a("Icon",{attrs:{type:"ios-information-circle-outline"}}),e._v(" "),a("div",{attrs:{slot:"content"},slot:"content"},[a("p",[e._v("攒班人数已满，需要学科正式开班")])])],1)],1),e._v(" "),a("div",{staticClass:"typeNum"},[e._v(e._s(this.assembleSuccessTotal))])]),e._v(" "),a("div",{ref:"card",staticClass:"task-type-card",class:{active:4===e.activeCard},on:{mouseenter:function(t){e.hover=!0},mouseleave:function(t){e.hover=!1},click:function(t){return e.handleCardClick(4)}}},[a("p",{staticClass:"typeName"},[e._v("\n        开班成功\n        "),a("Tooltip",{attrs:{transfer:"",placement:"right"}},[a("Icon",{attrs:{type:"ios-information-circle-outline"}}),e._v(" "),a("div",{attrs:{slot:"content"},slot:"content"},[a("p",[e._v("开班成功后，用户开始缴费")])])],1)],1),e._v(" "),a("div",{staticClass:"typeNum"},[e._v(e._s(this.openClassSuccess))])]),e._v(" "),a("div",{ref:"card",staticClass:"task-type-card",class:{active:5===e.activeCard},on:{mouseenter:function(t){e.hover=!0},mouseleave:function(t){e.hover=!1},click:function(t){return e.handleCardClick(5)}}},[a("p",{staticClass:"typeName"},[e._v("\n        攒班失败\n        "),a("Tooltip",{attrs:{transfer:"",placement:"right"}},[a("Icon",{attrs:{type:"ios-information-circle-outline"}}),e._v(" "),a("div",{attrs:{slot:"content"},slot:"content"},[a("p",[e._v("截止日期内，未攒班用户的班级")])])],1)],1),e._v(" "),a("div",{staticClass:"typeNum"},[e._v(e._s(this.assembleFail))])])])])}),[],!1,null,"b4d5bcd6",null).exports);function Y(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}var J={props:["choiceBtnText","rowData"],data:function(){var e=this;return{searchStuModal:!1,applyParams:{classId:"",studentId:"",cityCode:"",empNo:""},assembleStatusMap:{1:"待评估",2:"评估中",3:"开班成功",4:"开班失败",5:"攒班成功",6:"攒班失败",7:"取消"},applyShow:!1,relatedCols:[{title:"操作",align:"center",render:function(t,a){return t("a",{on:{click:function(){Object(i.e)({assembleClassDemandId:a.row.id,assembleId:e.rowData.id}).then((function(){e.$Message.success("关联成功"),e.relatedModal=!1,e.applyShow=!0})).catch((function(t){e.$Message.error({content:"关联失败："+t.message,duration:5})}))}}},"关联攒班记录")}},{title:"攒班状态",key:"status",align:"center",render:function(t,a){return t("span",e.assembleStatusMap[a.row.status])}},{title:"学员姓名",key:"name",align:"center"},{title:"接待顾问",key:"receptionAdvisorEmpName",align:"center"},{title:"年级",key:"gradeName",align:"center"},{title:"创建人",key:"creatorName",align:"center",render:function(e,t){return e("span",t.row.creatorName||"用户")}},{title:"创建时间",key:"createDate",align:"center"},{title:"推荐学员",key:"recommendName",align:"center"},{title:"攒班年份",key:"year",align:"center"},{title:"意向学科",key:"subjectName",align:"center"},{title:"意向学期",key:"termName",align:"center"},{title:"班次级别",key:"classLevelName",align:"center"},{title:"意向服务中心",key:"serviceCenterName",align:"center"},{title:"意向上课时间",key:"classtimeTimeClassifys",align:"center"},{title:"意向上课时段",key:"classtimeTimePeriods",align:"center"},{title:"意向度",key:"intention",align:"center"}],relatedData:[],relatedModal:!1}},created:function(){},mounted:function(){},watch:function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Y(Object(a),!0).forEach((function(t){Object(r.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Y(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},Object(C.e)("roleRelativeData",["userInfo"])),methods:{setStuInfoForApplyHandle:function(e){this.searchStuModal=!1,this.applyParams.studentId=e.studentId,this.applyParams.cityCode=e.cityCode,this.applyParams.classId=this.rowData.classId,this.applyParams.empNo=JSON.parse(A.a.get("columbusUserInfo")).id,"报名"===this.choiceBtnText?this.showRelatedAssembleClass(e.uid):this.queryAddStu(e)},showRelatedAssembleClass:function(e){this.applyShow=!0},queryAddStu:function(e){var t=this,a=e.uid,r=e.card,n=e.realName,s=this.rowData,o={groupWorkId:s.groupWorkId,uid:a,studentCard:r,studentName:n,recommendServiceCenterId:s.authDeptId,recommendServiceCenterName:s.authDeptName,cityCode:s.cityCode};Object(i.f)(o).then((function(e){t.$Message.success({content:"添加学员成功",duration:5}),t.$emit("onSuccess",!0)})).catch((function(e){t.$Message.error({content:"添加学员失败："+e.message,duration:5})}))},open:function(){this.searchStuModal=!0},applySuccess:function(){this.$emit("onSuccess",!0)}}},X=Object(O.a)(J,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("Modal",{attrs:{title:"查找报名学员",width:"800","footer-hide":!0},model:{value:e.searchStuModal,callback:function(t){e.searchStuModal=t},expression:"searchStuModal"}},[e.searchStuModal?a("TalStuSearch",{ref:"stuSearchForApply",attrs:{attendanceSearch:!1,showDetail:!1,showCrmInfo:!1,"choice-btn-text":e.choiceBtnText},on:{stuInfo:e.setStuInfoForApplyHandle}}):e._e()],1),e._v(" "),a("TalApplyModal",{attrs:{show:e.applyShow,classId:e.applyParams.classId,stuId:e.applyParams.studentId,stuCityCode:e.applyParams.cityCode,creatorEmpNo:e.applyParams.empNo},on:{success:e.applySuccess,close:function(t){e.applyShow=!1}}}),e._v(" "),a("Modal",{attrs:{title:"关联攒班记录",width:"80%","footer-hide":!0},model:{value:e.relatedModal,callback:function(t){e.relatedModal=t},expression:"relatedModal"}},[a("Table",{attrs:{border:"",columns:e.relatedCols,data:e.relatedData}})],1)],1)}),[],!1,null,"da93e94e",null).exports,K=a("c276"),Z=a("fa7d");function ee(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function te(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ee(Object(a),!0).forEach((function(t){Object(r.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ee(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var ae=Object(K.n)(),re={props:["tableColumnsKey","tableData","_this","cityCode"],components:{SearchApplyStu:X,StudentList:z},data:function(){var e=this;return{selectItemNum:0,categoryMap:{1:"在线",2:"双师",4:"面授"},openClassModal:!1,isRegistTime:!1,openClassRow:{},cuanbanSuccess:[{type:"expand",width:50,zIndex:"99999"},{title:"班级名称",key:"name",width:200,render:function(t,a){var r=a.row,n="";return"1"===r.productType?n=(r.subjectName||"")+(r.gradeName||"")+(r.seasonName||"")+(r.classModelLevelName||""):"2"===r.productType&&(n=(r.subjectName||"")+(r.gradeName||"")+(r.classLevelName||"")),t("a",{style:{color:"#276BFC",cursor:"pointer",zIndex:"99999"},on:{click:function(){e.openClassDetail(r.classId)}}},n)}},{title:"攒班进度",key:"assemblePlan",render:function(t,a){var r=a.row;return t("a",{style:{color:"#276BFC",cursor:"pointer"},on:{click:function(){e.stuId=r.groupWorkId,e.classId=r.classId,e.$refs.childStudentList.studentListHandler()}}},r.assemblePlan?r.assemblePlan:"--")}},{title:"产品类型",key:"productTypeName",width:100},{title:"授课类型",key:"categoryType",render:function(t,a){var r=a.row;return t("span",e.categoryMap[r.categoryType])}},{title:"主讲老师",key:"teacherEmpName"},{title:"上课时间",key:"name",render:function(e,t){var a=t.row;return e("span",{},a.classTimeTypeName+a.period+a.classTime)}},{title:"服务中心",key:"serviceCenterName"},{title:"教学点",key:"teachingPointName"},{title:"课程次数",key:"curriculumCount"},{title:"课程金额",key:"price"},{title:"攒班截止时间",key:"assembleEndTime"},{title:"创建人",key:"creatorName"},{title:"创建时间",key:"createDate"},{title:"操作",key:"operate",width:80,solt:"operate",render:function(t,a){var r=a.row;return t("a",{style:{lineHeight:"22px",display:"inline-block",margin:"0 8px",color:"#0f62fe",textDecoration:"none"},on:{click:function(){e.queryTime(r.classId),e.openClassRow=r}}},"开班")}}],kaibanSuccess:[{type:"expand",width:50},{title:"班级名称",key:"name",width:200,render:function(t,a){var r=a.row,n="";return"1"===r.productType?n=(r.subjectName||"")+(r.gradeName||"")+(r.seasonName||"")+(r.classModelLevelName||""):"2"===r.productType&&(n=(r.subjectName||"")+(r.gradeName||"")+(r.classLevelName||"")),t("a",{style:{color:"#276BFC",cursor:"pointer"},on:{click:function(){e.openClassDetail(r.classId)}}},n)}},{title:"攒班进度",key:"assemblePlan",render:function(t,a){var r=a.row;return t("a",{style:{color:"#276BFC",cursor:"pointer"},on:{click:function(){e.stuId=r.groupWorkId,e.classId=r.classId,e.$refs.childStudentList.studentListHandler()}}},r.assemblePlan?r.assemblePlan:"--")}},{title:"缴费进度",key:"payPlan",render:function(t,a){var r=a.row;return t("a",{style:{color:"#276BFC",cursor:"pointer"},on:{click:function(){e.stuId=r.groupWorkId,e.classId=r.classId,e.$refs.childStudentList.studentListHandler()}}},r.payPlan?r.payPlan:"--")}},{title:"产品类型",key:"productTypeName",width:100},{title:"授课类型",key:"categoryType",render:function(t,a){var r=a.row;return t("span",e.categoryMap[r.categoryType])}},{title:"主讲老师",key:"teacherEmpName"},{title:"上课时间",key:"name",render:function(e,t){var a=t.row;return e("span",{},a.classTimeTypeName+a.period+a.classTime)}},{title:"服务中心",key:"serviceCenterName"},{title:"教学点",key:"teachingPointName"},{title:"课程次数",key:"curriculumCount"},{title:"课程金额",key:"price"},{title:"攒班截止时间",key:"assembleEndTime"},{title:"创建人",key:"creatorName"},{title:"创建时间",key:"createDate"},{title:"操作",key:"operate",width:80,render:function(t,a){var r=a.row;return t("a",{style:{lineHeight:"22px",display:"inline-block",color:"#0f62fe",textDecoration:"none"},on:{click:function(){e.choiceBtnText="报名",e.rowData=r,e.rowData=te(te({},r),{},{cityCode:e.cityCode,authDeptId:e.userInfo.authDeptId,authDeptName:e.userInfo.authDeptName}),e.$refs.SearchApplyStuRef.open()}}},"报名")}}],cuanbanFail:[{type:"expand",width:50},{title:"班级名称",key:"name",width:200,render:function(t,a){var r=a.row,n="";return"1"===r.productType?n=(r.subjectName||"")+(r.gradeName||"")+(r.seasonName||"")+(r.classModelLevelName||""):"2"===r.productType&&(n=(r.subjectName||"")+(r.gradeName||"")+(r.classLevelName||"")),t("a",{style:{color:"#276BFC",cursor:"pointer"},on:{click:function(){e.openClassDetail(r.classId)}}},n)}},{title:"攒班进度",key:"assemblePlan",render:function(t,a){var r=a.row;return t("a",{style:{color:"#276BFC",cursor:"pointer"},on:{click:function(){e.stuId=r.groupWorkId,e.classId=r.classId,e.$refs.childStudentList.studentListHandler()}}},r.assemblePlan?r.assemblePlan:"--")}},{title:"产品类型",key:"productTypeName",width:100},{title:"授课类型",key:"categoryType",render:function(t,a){var r=a.row;return t("span",e.categoryMap[r.categoryType])}},{title:"主讲老师",key:"teacherEmpName"},{title:"上课时间",key:"className",render:function(e,t){var a=t.row;return e("span",{},a.classTimeTypeName+a.period+a.classTime)}},{title:"服务中心",key:"serviceCenterName"},{title:"教学点",key:"teachingPointName"},{title:"课程次数",key:"curriculumCount"},{title:"课程金额",key:"price"},{title:"攒班截止时间",key:"assembleEndTime"},{title:"创建人",key:"creatorName"},{title:"创建时间",key:"createDate"}],classDetail:{show:!1,id:""},choiceBtnText:"",rowData:{},classUrlMap:{beta:"//one-beta.speiyou.cn/home?platform=course&self=1&openType=self",dev:"//one-beta.speiyou.cn/home?platform=course&self=1&openType=self",prod:"//one.speiyou.cn/home/?platform=course&self=1&openType=self"},classId:"",stuId:"",groupWorkId:"",currentClassId:""}},computed:te(te({},Object(C.e)("roleRelativeData",["userInfo"])),{},{getVar:function(){return function(e){return this[e]}}}),created:function(){},mounted:function(){},methods:{copy:function(){Object(Z.b)(this.currentClassId)},queryTime:function(e){var t=this,a=this.userInfo.empNo,r={cityCode:this.cityCode,empNo:a,classId:e};Object(i.r)(r).then((function(a){a&&a.isRegist?(t.openClassModal=!0,t.isRegistTime=!0,t.currentClassId=e):(t.isRegistTime=!1,t.openClassModal=!0,t.currentClassId=e)})).catch((function(e){t.$Message.error({content:"查询网报时间失败:"+e.message,duration:5})}))},openClassDetail:function(e){this.classDetail.show=!0,this.classDetail.id=e},openCourse:function(){window.open(this.classUrlMap[ae])},openClass:function(e){var t=this,a={groupWorkId:e,empNo:this.userInfo.empNo,cityCode:this.cityCode};Object(i.j)(a).then((function(e){t.$Message.success({content:"开班成功",duration:5}),t.$emit("onSuccess",!0),t.openClassModal=!1})).catch((function(e){t.$Message.error({content:"开班失败:"+e.message,duration:5})}))},getSuccessInfo:function(){status&&this.$emit("onSuccess",!0)},comfirmOpenClass:function(){this.openClass(this.openClassRow.groupWorkId)},goCourse:function(){this.openCourse()},close:function(){this.openClassModal=!1}}},ne=(a("236a"),Object(O.a)(re,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"content_table1"},[a("Table",{staticClass:"expendTable",attrs:{border:"",columns:e.getVar(e.tableColumnsKey),data:e.tableData,"show-header":!1}}),e._v(" "),a("tal-class-detail",{attrs:{show:e.classDetail.show,classId:e.classDetail.id},on:{close:function(t){e.classDetail.show=!1}}}),e._v(" "),a("SearchApplyStu",{ref:"SearchApplyStuRef",attrs:{choiceBtnText:this.choiceBtnText,rowData:e.rowData},on:{onSuccess:e.getSuccessInfo}}),e._v(" "),a("StudentList",{ref:"childStudentList",attrs:{id:e.stuId,classId:e.classId,cityCode:e.cityCode}}),e._v(" "),a("Modal",{attrs:{width:"400","mask-closable":!1},model:{value:e.openClassModal,callback:function(t){e.openClassModal=t},expression:"openClassModal"}},[a("p",{attrs:{slot:"header"},slot:"header"},[a("span",[e._v("请前往班课平台完善以下信息")])]),e._v(" "),a("div",{staticClass:"copy_text",staticStyle:{"margin-bottom":"10px"}},[a("span",{staticStyle:{"line-height":"24px",color:"rgba(0,0,0,0.8)"}},[e._v(e._s("班级ID : "+e.currentClassId))]),e._v(" "),a("a",{on:{click:e.copy}},[e._v("复制")])]),e._v(" "),a("div",[a("h3",{staticClass:"title_info",staticStyle:{"line-height":"24px",color:"rgba(0,0,0,0.8)","font-weight":"500"}},[e._v("1、完善班级信息")]),e._v(" "),a("div",{staticClass:"desc_info",staticStyle:{"line-height":"24px",color:"rgba(0,0,0,0.8)"}},[e._v("在「班课平台-班级管理」检查并完善班级信息")])]),e._v(" "),e.isRegistTime?e._e():a("div",[a("h3",{staticClass:"title_info",staticStyle:{"line-height":"24px",color:"rgba(0,0,0,0.8)","font-weight":"500"}},[e._v("2、完善班级网报时间")]),e._v(" "),a("div",{staticClass:"desc_info",staticStyle:{"line-height":"24px",color:"rgba(0,0,0,0.8)"}},[e._v("在「报名规则管理-网报时间管理」补充班级网报时间")])]),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[e.isRegistTime?e._e():a("Button",{attrs:{type:"default"},on:{click:e.close}},[e._v("取消")]),e._v(" "),e.isRegistTime?a("Button",{attrs:{type:"default"},on:{click:e.comfirmOpenClass}},[e._v("确认开班")]):e._e(),e._v(" "),a("Button",{attrs:{type:"primary"},on:{click:e.goCourse}},[e._v("前往班课平台")])],1)])],1)}),[],!1,null,"83228d62",null).exports);function ie(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function se(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ie(Object(a),!0).forEach((function(t){Object(r.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ie(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var oe=Object(K.n)(),ce={props:["queryParams"],components:{SearchApplyStu:X,CreateClass:j,StudentList:z},data:function(){var e=this;return{selectItemNum:0,statusMap:{1:"waitOnline",2:"cuanban",3:"cuanbanSuccess",4:"kaibanSuccess",5:"cuanbanFail"},pageSize:[10,20],choiceBtnText:"",rowData:{},tableLoading:!1,currentClassId:"",waitOnline:[{type:"selection",width:60,align:"center",fixed:"left"},{title:"班级名称",key:"name",width:200,fixed:"left",render:function(e,t){return"1"===t.row.productType?e("span",{style:{color:"#3384FF"}},("【"+t.row.subjectName+"】"||!1)+(t.row.gradeName||"")+(t.row.seasonName||"")+(t.row.classModelLevelName||"")):"2"===t.row.productType?e("span",{style:{color:"#3384FF"}},("【"+t.row.subjectName+"】"||!1)+(t.row.gradeName||"")+(t.row.classLevelName||"")):void 0}},{title:"上线状态",key:"name",width:160,slot:"onlineStatus"},{title:"产品类型",key:"productTypeName",width:100},{title:"授课类型",width:100,key:"categoryType",render:function(t,a){var r=a.row;return t("span",e.categoryMap[r.categoryType])}},{title:"主讲老师",width:100,key:"teacherEmpName"},{title:"上课时间",width:160,key:"time",render:function(e,t){var a=t.row;return e("span",{},a.classTimeTypeName+a.period+a.classTime)}},{title:"服务中心",width:150,key:"serviceCenterName"},{title:"教学点",width:150,key:"teachingPointName"},{title:"课程次数",width:100,key:"curriculumCount"},{title:"课程金额",key:"price",width:150},{title:"攒班截止时间",key:"assembleEndTime",width:170},{title:"创建人",key:"creatorName",width:100},{title:"创建时间",key:"createDate",width:150},{title:"操作",key:"operate",width:120,fixed:"right",render:function(t,a){var r=a.row,n="1"===String(r.isShowEdit),i="0"===String(r.status);return t("div",[n?t("a",{style:{lineHeight:"22px",display:"inline-block",marginRight:"16px",color:"#0f62fe",textDecoration:"none"},on:{click:function(){e.$emit("updateCuanbanDemand",{id:String(r.id),cityCode:r.cityCode})}}},"编辑"):t("span",{style:{color:"#979797",marginRight:"16px"}},"编辑"),i?t("a",{style:{lineHeight:"22px",display:"inline-block",color:"#0f62fe",textDecoration:"none"},on:{click:function(){e.$Modal.confirm({title:"确定班级上线？",content:'<p style="font-size:16px;line-height:24px;">上线后，班级会展示在小程序上，且课程信息不可修改，请核对并确认</p>',onOk:function(){e.online([r.id])},okText:"确认上线"})}}},"1"===String(r.status)?"上线中":"上线"):t("span",{style:{color:"#979797"}},"1"===String(r.status)?"上线中":"上线")])}}],cuanban:[{title:"班级名称",key:"name",width:200,fixed:"left",render:function(t,a){var r=a.row,n="";return"1"===r.productType?n=("【"+r.subjectName+"】"||!1)+(r.gradeName||"")+(r.seasonName||"")+(r.classModelLevelName||""):"2"===r.productType&&(n=("【"+r.subjectName+"】"||!1)+(r.gradeName||"")+(r.classLevelName||"")),t("a",{style:{color:"#276BFC",cursor:"pointer"},on:{click:function(){e.openClassDetail(r.classId)}}},n)}},{title:"攒班进度",key:"assemblePlan",width:100,render:function(t,a){var r=a.row;return r.assembleList&&r.assembleList.length>0?t("span",{style:{color:"#393939"}},r.assemblePlan?r.assemblePlan:"--"):t("a",{style:{color:"#276BFC",cursor:"pointer"},on:{click:function(){e.stuId=r.groupWorkId,e.classId=r.classId,e.$refs.childStudentList.studentListHandler()}}},r.assemblePlan?r.assemblePlan:"--")}},{title:"产品类型",key:"productTypeName",width:100},{title:"授课类型",key:"categoryType",width:100,render:function(t,a){var r=a.row;return t("span",e.categoryMap[r.categoryType])}},{title:"主讲老师",key:"teacherEmpName",width:100},{title:"上课时间",width:160,key:"name",render:function(e,t){var a=t.row;return e("span",{},a.classTimeTypeName+a.period+a.classTime)}},{title:"服务中心",width:150,key:"serviceCenterName"},{title:"教学点",width:150,key:"teachingPointName"},{title:"课程次数",width:100,key:"curriculumCount"},{title:"课程金额",key:"price",width:150},{title:"攒班截止时间",key:"assembleEndTime",width:170},{title:"创建人",key:"creatorName",width:100},{title:"创建时间",key:"createDate",width:150},{title:"操作",key:"operate",width:100,fixed:"right",render:function(t,a){var r=a.row;return"1"===String(r.isShowAddStu)?t("a",{style:{fontSize:"12px",lineHeight:"22px",display:"inline-block",margin:"0 8px",color:"#0f62fe",textDecoration:"none"},on:{click:function(){e.choiceBtnText="选择",e.rowData=r,e.rowData=se(se({},r),{},{cityCode:e.queryParams.cityCode,authDeptId:e.userInfo.authDeptId,authDeptName:e.userInfo.authDeptName}),e.$refs.SearchApplyStuRef.open()}}},"添加学员"):t("span",{style:{color:"#979797",fontSize:"12px",margin:"0 8px"}},"添加学员")}}],cuanbanSuccess:[{type:"expand",width:50,render:function(t,a){var r=a.row;if(r.assembleList&&r.assembleList&&r.assembleList.length>0)return t(ne,{props:{tableColumnsKey:"cuanbanSuccess",tableData:r.assembleList,cityCode:e.queryParams.cityCode},on:{onSuccess:function(t){e.tableLoading=!0,e.repateQuery()}}})}},{title:"班级名称",key:"name",width:200,render:function(t,a){var r=a.row,n="";return"1"===r.productType?n=("【"+r.subjectName+"】"||!1)+(r.gradeName||"")+(r.seasonName||"")+(r.classModelLevelName||""):"2"===r.productType&&(n=("【"+r.subjectName+"】"||!1)+(r.gradeName||"")+(r.classLevelName||"")),r.assembleList&&r.assembleList&&r.assembleList.length>0?t("span",n):t("a",{style:{color:"#276BFC",cursor:"pointer"},on:{click:function(){e.openClassDetail(r.classId)}}},n)}},{title:"攒班进度",key:"assemblePlan",render:function(t,a){var r=a.row;return r.assembleList&&r.assembleList.length>0?t("span",{style:{color:"#393939"}},r.assemblePlan?r.assemblePlan:"--"):t("a",{style:{color:"#276BFC",cursor:"pointer"},on:{click:function(){e.stuId=r.groupWorkId,e.classId=r.classId,e.$refs.childStudentList.studentListHandler()}}},r.assemblePlan?r.assemblePlan:"--")}},{title:"产品类型",key:"productTypeName",width:100},{title:"授课类型",key:"categoryType",render:function(t,a){var r=a.row;return t("span",e.categoryMap[r.categoryType])}},{title:"主讲老师",key:"teacherEmpName"},{title:"上课时间",key:"name",render:function(e,t){var a=t.row;return e("span",{},a.classTimeTypeName+a.period+a.classTime)}},{title:"服务中心",key:"serviceCenterName"},{title:"教学点",key:"teachingPointName"},{title:"课程次数",key:"curriculumCount"},{title:"课程金额",key:"price"},{title:"攒班截止时间",key:"assembleEndTime"},{title:"创建人",key:"creatorName"},{title:"创建时间",key:"createDate"},{title:"操作",key:"operate",width:80,solt:"operate",render:function(t,a){var r=a.row;if(!r.assembleList||0===r.assembleList.length)return"1"===String(r.isShowOpenClass)?t("a",{style:{lineHeight:"22px",display:"inline-block",margin:"0 8px",color:"#0f62fe",textDecoration:"none"},on:{click:function(){e.queryTime(r.classId),e.openClassRow=r}}},"开班"):t("span",{style:{color:"#979797",lineHeight:"22px"}},"开班")}}],kaibanSuccess:[{type:"expand",width:50,render:function(t,a){var r=a.row;if(r.assembleList&&r.assembleList&&r.assembleList.length>0)return t(ne,{props:{tableColumnsKey:"kaibanSuccess",tableData:r.assembleList},on:{onSuccess:function(t){e.repateQuery()}}})}},{title:"班级名称",key:"name",width:200,render:function(t,a){var r=a.row,n="";return"1"===r.productType?n=("【"+r.subjectName+"】"||!1)+(r.gradeName||"")+(r.seasonName||"")+(r.classModelLevelName||""):"2"===r.productType&&(n=("【"+r.subjectName+"】"||!1)+(r.gradeName||"")+(r.classLevelName||"")),r.assembleList&&r.assembleList&&r.assembleList.length>0?t("span",n):t("a",{style:{color:"#276BFC",cursor:"pointer"},on:{click:function(){e.openClassDetail(r.classId)}}},n)}},{title:"攒班进度",key:"assemblePlan",render:function(t,a){var r=a.row;return r.assembleList&&r.assembleList.length>0?t("span",{style:{color:"#393939"}},r.assemblePlan?r.assemblePlan:"--"):t("a",{style:{color:"#276BFC",cursor:"pointer"},on:{click:function(){e.stuId=r.groupWorkId,e.classId=r.classId,e.$refs.childStudentList.studentListHandler()}}},r.assemblePlan?r.assemblePlan:"--")}},{title:"缴费进度",key:"payPlan",render:function(t,a){var r=a.row;return r.assembleList&&r.assembleList.length>0?t("span",{style:{color:"#393939"}},r.assemblePlan?r.assemblePlan:"--"):t("a",{style:{color:"#276BFC",cursor:"pointer"},on:{click:function(){e.stuId=r.groupWorkId,e.classId=r.classId,e.$refs.childStudentList.studentListHandler()}}},r.payPlan?r.payPlan:"--")}},{title:"产品类型",key:"productTypeName",width:100},{title:"授课类型",key:"categoryType",render:function(t,a){var r=a.row;return t("span",e.categoryMap[r.categoryType])}},{title:"主讲老师",key:"teacherEmpName"},{title:"上课时间",key:"name",render:function(e,t){var a=t.row;return e("span",{},a.classTimeTypeName+a.period+a.classTime)}},{title:"服务中心",key:"serviceCenterName"},{title:"教学点",key:"teachingPointName"},{title:"课程次数",key:"curriculumCount"},{title:"课程金额",key:"price"},{title:"攒班截止时间",key:"assembleEndTime"},{title:"创建人",key:"creatorName"},{title:"创建时间",key:"createDate"},{title:"操作",key:"operate",width:80,render:function(t,a){var r=a.row;if(!r.assembleList||0===r.assembleList.length)return t("a",{style:{lineHeight:"22px",display:"inline-block",color:"#0f62fe",textDecoration:"none"},on:{click:function(){e.choiceBtnText="报名",e.rowData=r,e.rowData=se(se({},r),{},{cityCode:e.queryParams.cityCode,authDeptId:e.userInfo.authDeptId,authDeptName:e.userInfo.authDeptName}),e.$refs.SearchApplyStuRef.open(e.rowData)}}},"报名")}}],cuanbanFail:[{type:"expand",width:50,render:function(e,t){var a=t.row;if(a.assembleList&&a.assembleList&&a.assembleList.length>0)return e(ne,{props:{tableColumnsKey:"cuanbanFail",tableData:a.assembleList}})}},{title:"班级名称",key:"name",width:200,render:function(t,a){var r=a.row,n="";return"1"===r.productType?n=("【"+r.subjectName+"】"||!1)+(r.gradeName||"")+(r.seasonName||"")+(r.classModelLevelName||""):"2"===r.productType&&(n=("【"+r.subjectName+"】"||!1)+(r.gradeName||"")+(r.classLevelName||"")),r.assembleList&&r.assembleList&&r.assembleList.length>0?t("span",n):t("a",{style:{color:"#276BFC",cursor:"pointer"},on:{click:function(){e.openClassDetail(r.classId)}}},n)}},{title:"攒班进度",key:"assemblePlan",render:function(t,a){var r=a.row;return r.assembleList&&r.assembleList.length>0?t("span",{style:{color:"#393939"}},r.assemblePlan?r.assemblePlan:"--"):t("a",{style:{color:"#276BFC",cursor:"pointer"},on:{click:function(){e.stuId=r.groupWorkId,e.classId=r.classId,e.$refs.childStudentList.studentListHandler()}}},r.assemblePlan?r.assemblePlan:"--")}},{title:"产品类型",key:"productTypeName",width:100},{title:"授课类型",key:"categoryType",render:function(t,a){var r=a.row;return t("span",e.categoryMap[r.categoryType])}},{title:"主讲老师",key:"teacherEmpName"},{title:"上课时间",key:"className",render:function(e,t){var a=t.row;return e("span",{},a.classTimeTypeName+a.period+a.classTime)}},{title:"服务中心",key:"serviceCenterName"},{title:"教学点",key:"teachingPointName"},{title:"课程次数",key:"curriculumCount"},{title:"课程金额",key:"price"},{title:"攒班截止时间",key:"assembleEndTime"},{title:"创建人",key:"creatorName"},{title:"创建时间",key:"createDate"}],classDetail:{show:!1,id:""},tableData:{},selectItemId:[],classUrlMap:{beta:"//one-beta.speiyou.cn/home?platform=course&self=1&openType=self",dev:"//one-beta.speiyou.cn/home?platform=course&self=1&openType=self",prod:"//one.speiyou.cn/home/?platform=course&self=1&openType=self"},selectItem:[],categoryMap:{1:"在线",2:"双师",4:"面授"},classId:"",stuId:"",groupWorkId:"",openClassModal:!1,isRegistTime:!1,openClassRow:{},selectAllItemNum:0,selectAllItem:[],selectAllItemId:[],newQueryParams:{pageNo:1,pageSize:10},currentpage:1}},watch:{"queryParams._status":{handler:function(e,t){e!==t&&this.queryParams.cityCode&&(this.newQueryParams=se(se({},this.newQueryParams),this.queryParams),this.queryParams._clear&&(this.newQueryParams=se(se({},this.newQueryParams),{},{pageNo:1,pageSize:10})),this.queryTableData(this.newQueryParams))}}},computed:se(se({},Object(C.e)("roleRelativeData",["userInfo"])),{},{getColumns:function(){return function(e){return this[this.statusMap[e]]}}}),created:function(){},methods:{copy:function(){Object(Z.b)(this.currentClassId)},queryTableData:function(e){var t=this;this.tableLoading=!0,this.selectItemId=[],this.selectItem=[],this.selectItemNum=0,this.selectAllItemId=[],this.selectAllItem=[],this.selectAllItemNum=0,Object(i.q)(e).then((function(e){if(e){var a=e&&e.records;a=a.map((function(e){return e._expanded=!1,e})),t.tableData=se(se({},e),{},{records:a}),t.tableLoading=!1}else t.tableData={}})).catch((function(e){t.tableData={},t.$Message.error({content:"查询攒班详情失败: "+e.message,duration:5})}))},isOnline:function(e){return("all"===e?this.selectAllItem:this.selectItem).every((function(e){return 0===e.status}))},openAllOnlineModal:function(e){var t=this;"all"!==e&&0===this.selectItemId.length||("all"===e&&this.setSelectItem(),"all"!==e&&0===this.selectItemNum||"all"===e&&0===this.selectAllItemNum?this.$Message.warning("当前无可以上线课程"):this.isOnline(e)?this.$Modal.confirm({title:"共".concat("all"===e?this.selectAllItemNum:this.selectItemNum,"项，确定班级上线？"),content:'<p style="font-size:16px;line-height:24px;">上线后，班级会展示在小程序上，且课程信息不可修改，请核对并确认</p>',onOk:function(){t.online("all"===e?t.selectAllItemId:t.selectItemId,"all"===e?5e3:3e3)},okText:"确认上线"}):this.$Message.warning("当前选中的课程包含已经开班的课程，无法再次开班"))},handleSelect:function(e,t){var a=e.length>0?e.length:0;this.selectItemNum=a,this.selectItemId=e&&e.map((function(e){return e.id})),this.selectItem=e},openClassDetail:function(e){this.classDetail.show=!0,this.classDetail.id=e,this.classDetail.cityId=e},setClassName:function(e,t){return 0!==this.status&&e.assembleList&&e.assembleList.length>0?"":"expend"},changePage:function(e){this.newQueryParams.pageNo=e,this.queryTableData(this.newQueryParams)},changePageSize:function(e){this.newQueryParams.pageSize=e,this.queryTableData(this.newQueryParams)},setSelectItem:function(){this.selectAllItemNum=this.tableData&&this.tableData.records&&this.tableData.records.length,this.selectAllItem=this.tableData&&this.tableData.records,this.selectAllItemId=this.tableData&&this.tableData.records.map((function(e){return e.id}))},handelAddClass:function(){this.$refs.createClassRef.addClassHandler()},online:function(e,t){var a=this,r={empNo:this.userInfo.empNo,cityCode:this.queryParams.cityCode,activityIds:e};Object(i.a)(r).then((function(e){a.$Message.success({content:"上线中...",duration:5}),a.tableLoading=!0,a.repateQuery(t)})).catch((function(e){a.$Message.error({content:"上线失败:"+e.message,duration:5}),a.tableLoading=!1}))},openClass:function(e){var t=this,a={groupWorkId:e,empNo:this.userInfo.empNo,cityCode:this.queryParams.cityCode};Object(i.j)(a).then((function(e){t.$Message.success({content:"开班成功",duration:5}),t.openClassModal=!1,t.repateQuery()})).catch((function(e){t.$Message.error({content:"开班失败:"+e.message,duration:5}),t.openClassModal=!0}))},queryTime:function(e){var t=this,a=this.userInfo.empNo,r={cityCode:this.queryParams.cityCode,empNo:a,classId:e};Object(i.r)(r).then((function(a){a&&a.isRegist?(t.openClassModal=!0,t.isRegistTime=!0,t.currentClassId=e):(t.isRegistTime=!1,t.openClassModal=!0,t.currentClassId=e)})).catch((function(e){t.$Message.error({content:"查询网报时间失败:"+e.message,duration:5})}))},allOnline:function(){var e=this,t=this.userInfo,a=(t.cityCode,{empNo:t.empNo,cityCode:this.queryParams.cityCode});Object(i.b)(a).then((function(t){e.$Message.success({content:"上线中...",duration:5}),e.repateQuery(5e3)})).catch((function(t){e.$Message.error({content:"上线失败:"+t.message,duration:5})}))},openCourse:function(){window.open(this.classUrlMap[oe])},repateQuery:function(e){var t=null;if(e){var a=this,r=se({},this.newQueryParams);t=setTimeout((function(){a.queryTableData(r),a.$parent.$refs.classSearchComponent.getAssembleTotal()}),e)}else clearTimeout(t),this.queryTableData(this.newQueryParams),this.$parent.$refs.classSearchComponent.getAssembleTotal()},getSuccessInfo:function(e){e&&this.repateQuery(3e3)},onSuccess:function(){this.repateQuery()},comfirmOpenClass:function(){this.openClass(this.openClassRow.groupWorkId)},goCourse:function(){this.openCourse()},close:function(){this.openClassModal=!1}}};a("b278");function le(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function ue(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?le(Object(a),!0).forEach((function(t){Object(r.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):le(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var de={name:"cuanbanConfig",components:{CreateClass:j,BatchImportWrapper:F,ErrorTargetTable:$,StudentList:z,ClassSearch:Q,CuanbanTable:Object(O.a)(ce,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("Row",[r("div",{staticClass:"content_table"},[e.tableData&&e.tableData.records&&e.tableData.records.length>0?r("div",[r("div",{directives:[{name:"show",rawName:"v-show",value:"waitOnline"==e.statusMap[e.queryParams.queryType],expression:"statusMap[queryParams.queryType]=='waitOnline'"}],class:"waitOnline"==e.statusMap[e.queryParams.queryType]?"table_tips wait_status":"table_tips"},[r("div",{staticClass:"left_tips",on:{click:function(t){return e.openAllOnlineModal("noAll")}}},[r("span",[e._v("已选中"),r("strong",[e._v(e._s(e.selectItemNum))]),e._v("项")]),e._v(" "),r("span",{class:e.selectItemNum>0?"selectStyle nomalStyle":"noSelectStyle nomalStyle"},[r("span",[e._v("选中上线")])])]),e._v(" "),r("div",{staticClass:"right_tips",on:{click:function(t){return e.openAllOnlineModal("all")}}},[r("span",{staticClass:"selectStyle nomalStyle"},[r("span",[e._v("上线全部")])])])]),e._v(" "),r("Table",{ref:"selection",class:"waitOnline"==e.statusMap[e.queryParams.queryType]?"wait_status":"other_status",attrs:{border:"",loading:e.tableLoading,"row-class-name":e.setClassName,columns:e.getColumns(e.queryParams.queryType),data:e.tableData.records},on:{"on-selection-change":e.handleSelect},scopedSlots:e._u([{key:"onlineStatus",fn:function(t){var a=t.row;return"waitOnline"==e.statusMap[e.queryParams.queryType]?[a.classFailMessage||a.courseFailMessage?r("div",[r("Tag",{directives:[{name:"show",rawName:"v-show",value:a.classFailMessage||a.courseFailMessage,expression:"row.classFailMessage || row.courseFailMessage"}],attrs:{color:"red"}},[e._v("上线失败")]),e._v(" "),r("Tooltip",{attrs:{"max-width":"200",transfer:"",content:a.classFailMessage||a.courseFailMessage,placement:"top"}},[r("Tag",{directives:[{name:"show",rawName:"v-show",value:a.classFailMessage||a.courseFailMessage,expression:"row.classFailMessage || row.courseFailMessage"}],attrs:{color:"red"}},[e._v("原因")])],1)],1):r("div",[r("Tag",{directives:[{name:"show",rawName:"v-show",value:"0"==a.status,expression:"row.status=='0'"}],attrs:{color:"default"}},[e._v("待上线")]),e._v(" "),r("Tag",{directives:[{name:"show",rawName:"v-show",value:"1"==a.status,expression:"row.status=='1'"}],attrs:{color:"orange"}},[e._v("上线中")])],1)]:void 0}}],null,!0)}),e._v(" "),r("br"),e._v(" "),r("Row",{attrs:{type:"flex",justify:"end"}},[r("Page",{attrs:{total:e.tableData.totalCount,"page-size":e.tableData.pageSize,current:e.tableData.pageNo,"show-total":"","show-elevator":"","show-sizer":"","page-size-opts":e.pageSize},on:{"update:current":function(t){return e.$set(e.tableData,"pageNo",t)},"on-change":e.changePage,"on-page-size-change":e.changePageSize}})],1),e._v(" "),r("tal-class-detail",{attrs:{show:e.classDetail.show,"class-id":e.classDetail.id},on:{close:function(t){e.classDetail.show=!1}}})],1):r("div",{staticClass:"nodata_style"},[r("img",{attrs:{src:a("f717"),width:"200",height:"200",alt:""}}),e._v(" "),r("div",[r("Button",{staticClass:"btn",staticStyle:{"margin-right":"10px"},attrs:{type:"primary",icon:"md-add"},on:{click:e.handelAddClass}},[e._v("新增班级")])],1)])]),e._v(" "),r("SearchApplyStu",{ref:"SearchApplyStuRef",attrs:{choiceBtnText:this.choiceBtnText,rowData:e.rowData},on:{onSuccess:e.getSuccessInfo}}),e._v(" "),r("CreateClass",{ref:"createClassRef",on:{updateTableData:e.onSuccess}}),e._v(" "),r("StudentList",{ref:"childStudentList",attrs:{id:e.stuId,classId:e.classId,"city-code":e.queryParams.cityCode}}),e._v(" "),r("Modal",{attrs:{width:"400","mask-closable":!1},model:{value:e.openClassModal,callback:function(t){e.openClassModal=t},expression:"openClassModal"}},[r("p",{attrs:{slot:"header"},slot:"header"},[r("span",[e._v("请前往班课平台完善以下信息")])]),e._v(" "),r("div",{staticClass:"copy_text",staticStyle:{"margin-bottom":"10px"}},[r("span",{staticStyle:{"line-height":"24px",color:"rgba(0,0,0,0.8)"}},[e._v(e._s("班级ID : "+e.currentClassId))]),e._v(" "),r("a",{on:{click:e.copy}},[e._v("复制")])]),e._v(" "),r("div",[r("h3",{staticClass:"title_info",staticStyle:{"line-height":"24px",color:"rgba(0,0,0,0.8)","font-weight":"500"}},[e._v("1、完善班级信息")]),e._v(" "),r("div",{staticClass:"desc_info",staticStyle:{"line-height":"24px",color:"rgba(0,0,0,0.8)"}},[e._v("在「班课平台-班级管理」检查并完善班级信息")])]),e._v(" "),e.isRegistTime?e._e():r("div",[r("h3",{staticClass:"title_info",staticStyle:{"line-height":"24px",color:"rgba(0,0,0,0.8)","font-weight":"500"}},[e._v("2、完善班级网报时间")]),e._v(" "),r("div",{staticClass:"desc_info",staticStyle:{"line-height":"24px",color:"rgba(0,0,0,0.8)"}},[e._v("在「报名规则管理-网报时间管理」补充班级网报时间")])]),e._v(" "),r("div",{attrs:{slot:"footer"},slot:"footer"},[e.isRegistTime?e._e():r("Button",{attrs:{type:"default"},on:{click:e.close}},[e._v("取消")]),e._v(" "),e.isRegistTime?r("Button",{attrs:{type:"default"},on:{click:e.comfirmOpenClass}},[e._v("确认开班")]):e._e(),e._v(" "),r("Button",{attrs:{type:"primary"},on:{click:e.goCourse}},[e._v("前往班课平台")])],1)])],1)}),[],!1,null,"5cd3ea22",null).exports},data:function(){return{oldCuanbanDemand:{},createClassType:1,createClassTypeName:"",queryParams:{}}},created:function(){},mounted:function(){},methods:{openAddClassHandler:function(){this.$refs.childCreateClass.addClassHandler()},openStudentListHandler:function(){this.$refs.childStudentList.studentListHandler()},openBatchImportHandler:function(){this.$refs.childBatchImportWrapper.batchImportWrapperHandler()},createCuanbanClass:function(){this.openAddClassHandler(),this.createClassType=1,this.createClassTypeName="新增班级"},updateCuanbanDemand:function(e){console.log(e,"----"),this.oldCuanbanDemand=e,this.openAddClassHandler(),this.createClassType=2,this.createClassTypeName="修改班级"},updateTableData:function(){this.$refs.classSearchComponent.getAssembleTotal(),this.$refs.cuanbanTableRef.queryTableData(this.$refs.classSearchComponent.formData)},getQueryParams:function(e,t,a){this.queryParams=ue(ue({},e),{},{_status:t,_clear:a})}}},me=(a("e4de"),Object(O.a)(de,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"layout"},[a("div",{staticClass:"header"},[a("h1",{staticClass:"title"},[e._v("攒班配置")]),e._v(" "),a("Button",{staticClass:"btn",attrs:{type:"default"},on:{click:e.openBatchImportHandler}},[a("Icon",{attrs:{type:"md-download"}}),e._v("\n      批量导入\n    ")],1),e._v(" "),a("Button",{staticClass:"btn",staticStyle:{"margin-right":"10px"},attrs:{type:"primary"},on:{click:e.createCuanbanClass}},[a("Icon",{attrs:{type:"md-add"}}),e._v("\n      新增班级\n    ")],1)],1),e._v(" "),a("div",{staticClass:"layout-card"},[a("ClassSearch",{ref:"classSearchComponent",on:{queryParams:e.getQueryParams}})],1),e._v(" "),a("div",{staticClass:"cuanban-table"},[a("CuanbanTable",{ref:"cuanbanTableRef",attrs:{queryParams:e.queryParams},on:{updateCuanbanDemand:e.updateCuanbanDemand}})],1),e._v(" "),a("CreateClass",{ref:"childCreateClass",attrs:{oldFormData:e.oldCuanbanDemand,type:e.createClassType,title:e.createClassTypeName},on:{updateTableData:e.updateTableData}}),e._v(" "),a("StudentList",{ref:"childStudentList",attrs:{"city-code":e.queryParams.cityCode}}),e._v(" "),a("BatchImportWrapper",{ref:"childBatchImportWrapper",attrs:{cityCode:e.queryParams.cityCode},on:{updateTableData:e.updateTableData}})],1)}),[],!1,null,"e26ad036",null));t.default=me.exports},"06b4":function(e,t,a){},"0811":function(e,t,a){"use strict";var r=a("9f56");a.n(r).a},"08c0":function(e,t,a){},"0a03":function(e,t,a){"use strict";var r={name:"TalIframe",props:{contentSrc:{type:String}},data:function(){return{}},created:function(){},mounted:function(){}},n=(a("965b"),a("2877")),i=Object(n.a)(r,(function(){var e=this.$createElement,t=this._self._c||e;return t("Layout",{attrs:{id:"iframe"}},[this.contentSrc?t("iframe",{ref:"ifr",attrs:{src:this.contentSrc,frameborder:"0",width:"100%"}}):t("div")])}),[],!1,null,"738ccff8",null);t.a=i.exports},"0bc1":function(e,t,a){"use strict";var r=a("ba07");a.n(r).a},1169:function(e,t,a){var r=a("2d95");e.exports=Array.isArray||function(e){return"Array"==r(e)}},"11c5":function(e,t,a){},"13ac":function(e,t,a){},1576:function(e,t,a){"use strict";a("ac6a"),a("cadf"),a("5df3"),a("96cf");var r,n=a("3b8d"),i=a("49e5");t.a={data:function(){return{cuanbanStatusMap:{1:"待评估",2:"评估中",3:"开班成功",4:"开班失败",5:"攒班成功",6:"攒班失败",7:"取消"},registStatusMap:{0:"未报名",1:"已报名",2:"报名失败"},payStatusMap:{0:"未缴费",1:"已缴费"},classStatusMap:{0:"--",1:"否",2:"是"},intentionList:["高","中","低"],cuanbanStatusList:[{label:"待评估",value:1},{label:"评估中",value:2},{label:"开班成功",value:3},{label:"开班失败",value:4},{label:"攒班成功",value:5},{label:"攒班失败",value:6},{label:"取消",value:7}],registStatusList:[{label:"未报名",value:0},{label:"已报名",value:1},{label:"报名失败",value:2}],payStatusList:[{label:"未缴费",value:0},{label:"已缴费",value:1}],approvalStatusList:[{label:"未审批",value:0},{label:"已审批",value:1}],openClassStatusList:[{label:"开班成功",value:1},{label:"开班失败",value:2}]}},methods:{handleSelectChange:function(e,t){this.formData[t]=e?e.label:""},setStudentLevel:function(e){var t=this;return new Promise(function(){var a=Object(n.a)(regeneratorRuntime.mark((function a(r){var n,s,o,c;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:for(n=[],s=0;s<e.length;s++)o=e[s],c={gradeId:o.gradeId,subjectId:o.subjectId,uid:o.uid,levelDegree:o.classLevel,cityCode:o.cityCode},n.push(Object(i.a)(c));Promise.all(n).then((function(t){e.forEach((function(e,a){e.diagnosisScore=t[a]?1:2})),r(e)})).catch((function(e){r([]),t.$Message.error({content:"获取学员成绩失败: ".concat(e.message),duration:5})}));case 3:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}())},abilityStudentLevel:(r=Object(n.a)(regeneratorRuntime.mark((function e(t){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(i.a)(t);case 3:return a=e.sent,e.abrupt("return",a);case 7:e.prev=7,e.t0=e.catch(0),this.$Message.error({content:"获取学员成绩失败: ".concat(e.t0.message),duration:5});case 10:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(e){return r.apply(this,arguments)})}}},"1cb2":function(e,t,a){"use strict";a.r(t);a("8e6e"),a("cadf"),a("456d"),a("7f7f"),a("ac6a"),a("96cf");var r=a("3b8d"),n=a("bd86"),i=a("1535"),s=a("127a"),o={props:{content:{type:String}},data:function(){return{decoded:!1,decodedStr:""}},methods:{decode:function(){var e=this;if(!this.decodedStr){var t=window.atob(this.content);this.$nextTick((function(){e.decodedStr=t}))}this.decoded=!0}}},c=(a("291b"),a("2877")),l=Object(c.a)(o,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("span",[a("span",{staticClass:"content"},[e._v(e._s(e.decoded?e.decodedStr:"*************"))]),e._v(" "),a("Icon",{directives:[{name:"show",rawName:"v-show",value:!e.decoded,expression:"!decoded"}],staticClass:"icon",attrs:{type:"ios-eye"},on:{click:e.decode}}),e._v(" "),a("Icon",{directives:[{name:"show",rawName:"v-show",value:e.decoded,expression:"decoded"}],staticClass:"icon",attrs:{type:"ios-eye-off"},on:{click:function(t){e.decoded=!1}}})],1)}),[],!1,null,"0e8f81ca",null).exports,u=a("c24f"),d=a("2f62");function m(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function h(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?m(Object(a),!0).forEach((function(t){Object(n.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):m(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var p,f,g,v,y={name:"QRCode",components:{TalTab:i.a,TalTabItem:s.a,Base64Encode:l},computed:h(h({},Object(d.e)({cityCode:function(e){return e.roleRelativeData.userInfo.cityCode}})),{},{activeActivity:function(){return this.activityLabelList[this.activeActivityIndex]||{}}}),data:function(){return{activityLabelList:[],posterDownloading:!1,qrCodeDownloading:!1,activeActivityIndex:-1,minappInfo:{},hasPosterArea:!0}},watch:{cityCode:function(){this.cityCode&&0===this.activityLabelList.length&&(this.queryStoreActivityLabelList(),this._getChannelUserInfo())},activeActivityIndex:(v=Object(r.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.activityLabelList[this.activeActivityIndex].loaded||"loginMinapp"===this.activityLabelList[this.activeActivityIndex].id||(this.activityLabelList[this.activeActivityIndex].loaded=!0,this.setCodeUrl("posterUrl"),this.setCodeUrl("qrCodeUrl"));case 1:case"end":return e.stop()}}),e,this)}))),function(){return v.apply(this,arguments)})},mounted:function(){this.cityCode&&(this.queryStoreActivityLabelList(),this._getChannelUserInfo()),this.setBuriedPoint("init")},methods:{_getChannelUserInfo:(g=Object(r.a)(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={cityCode:this.cityCode},e.next=4,Object(u.c)(t);case 4:a=e.sent,this.minappInfo=h({},a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),this.$Message({content:"获取推广顾问账号失败: "+e.t0.message,duration:5});case 11:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(){return g.apply(this,arguments)}),onImageLoadError:function(e){this.activityLabelList[this.activeActivityIndex][e]="failed",console.log("海报图加载失败")},setBuriedPoint:function(e){var t;switch(e){case"init":t="202-4926";break;case"shop-tab":t="202-4928";break;case"shop-poster":t="202-4929";break;case"shop-qrcode":t="202-4930";break;case"diagnosis-tab":t="202-4931";break;case"diagnosis-poster":t="202-4932";break;case"diagnosis-qrcode":t="202-4933";break;case"audition-tab":t="202-4934";break;case"audition-poster":t="202-4935";break;case"audition-qrcode":t="202-4936";break;case"assembleClass-tab":t="202-4937";break;case"assembleClass-poster":t="202-4938";break;case"assembleClass-qrcode":t="202-4939";break;case"recommend-tab":t="202-4940";break;case"recommend-poster":t="202-4941";break;case"recommend-qrcode":t="202-4942";break;case"consultant-tab":t="202-4943";break;case"consultant-poster":t="202-4944";break;case"consultant-qrcode":t="202-4945";break;case"classList-tab":t="202-4946";break;case"classList-qrcode":t="202-4947"}t&&XesAnalytics.track(t,{adviser:this.$store.state.roleRelativeData.userInfo.crmRoleId,adviser_departmentID:this.$store.state.roleRelativeData.userInfo.crmDeptId,adviser_empNo:this.$store.state.roleRelativeData.roleInfo.userWorkCode,adviser_citycode:this.$store.state.roleRelativeData.userInfo.cityCode})},setCodeUrl:function(e){var t=this;this.activityLabelList[this.activeActivityIndex][e]="";var a="qrCodeUrl"===e?1:2,r=this.activeActivityIndex;return this.queryDimensionCode(this.activeActivity.id,a).then((function(a){setTimeout((function(){if(!a)return t.activityLabelList[r][e]="failed";t.activityLabelList[r][e]=a}),200)}))},queryDimensionCode:function(e,t){var a=this;return Object(u.e)({trigPageTag:e,codeType:t,cityCode:this.cityCode}).then((function(e){var t=new Blob([e.data],{type:"image/jpeg;charset=UTF-8"});return URL.createObjectURL(t)})).catch((function(r){console.log("接口失败",e,t),a.$Message.error({content:"获取二维码失败: ".concat(r.message),duration:5})}))},queryStoreActivityLabelList:(f=Object(r.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(u.p)({cityCode:this.cityCode});case 3:(t=e.sent).forEach((function(e){e.posterUrl="",e.qrCodeUrl="",e.loaded=!1})),this.activityLabelList=t||[],this.activityLabelList.unshift({id:"loginMinapp",name:"小程序拉流账号",loaded:!1}),this.activityLabelList.length&&(this.activeActivityIndex=0),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),this.$Message.error({content:"获取活动二维码列表失败: ".concat(e.t0.message),duration:5});case 13:case"end":return e.stop()}}),e,this,[[0,10]])}))),function(){return f.apply(this,arguments)}),handleChangeActivity:function(e,t){this.activeActivityIndex=e,"课程列表页"===t.name||"签到页"===t.name?this.hasPosterArea=!1:this.hasPosterArea=!0,this.setBuriedPoint(t.id+"-tab")},downloadImg:(p=Object(r.a)(regeneratorRuntime.mark((function e(t,a){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r="poster"===a?"posterDownloading":"qrCodeDownloading";try{this[r]=!0,(n=document.createElement("a")).href=t,n.download="".concat(this.activeActivity.name,"poster"===a?"海报图":"二维码"),document.body.appendChild(n),n.click(),document.body.removeChild(n),this.setBuriedPoint(this.activeActivity.id+"-"+a)}catch(e){this.$Message.error({content:"图片下载失败: ".concat(e.message),duration:5})}this[r]=!1;case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return p.apply(this,arguments)})}},b=(a("fed9"),Object(c.a)(y,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Layout",{staticClass:"layout"},[a("header",{staticClass:"header"},[a("h2",[e._v("专属二维码")]),e._v(" "),a("p",{staticClass:"header_p"},[e._v("以下二维码中带有您的个人信息，将二维码转发至微信，学员通过二维码进行注册，您将获得绩效奖")])]),e._v(" "),a("div",{staticClass:"content"},[a("div",{staticClass:"content_border"},[a("TalTab",{staticStyle:{width:"207px"}},[e.activityLabelList.length?e._l(e.activityLabelList,(function(t,r){return a("TalTabItem",{key:r,attrs:{"border-bottom":!1,active:t.name===e.activeActivity.name},on:{"on-click":function(a){return e.handleChangeActivity(r,t)}}},[a("span",{staticClass:"f-14"},[e._v(e._s(t.name))])])})):a("span",{staticStyle:{color:"gray","text-align":"center","margin-top":"100px"}},[e._v("暂无数据")])],2),e._v(" "),e.activityLabelList.length&&"loginMinapp"!==e.activeActivity.id?a("div",{staticClass:"display"},[e.hasPosterArea?a("div",{staticClass:"poster"},[e.activeActivity.posterUrl?a("img",{staticClass:"poster_img",attrs:{src:e.activeActivity.posterUrl,alt:"海报图加载失败"},on:{error:function(t){return e.onImageLoadError("posterUrl")}}}):a("div",{staticClass:"spin-container"},[a("Spin",{attrs:{fix:"",size:"large"}})],1),e._v(" "),"failed"===e.activeActivity.posterUrl?a("Button",{staticClass:"download_button",attrs:{type:"primary"},on:{click:function(t){return e.setCodeUrl("posterUrl")}}},[e._v("重新加载")]):e._e(),e._v(" "),e.activeActivity.posterUrl&&"failed"!==e.activeActivity.posterUrl?a("Button",{staticClass:"download_button",attrs:{type:"primary",loading:e.posterDownloading},on:{click:function(t){return e.downloadImg(e.activeActivity.posterUrl,"poster")}}},[e._v("下载")]):e._e()],1):e._e(),e._v(" "),a("div",{staticClass:"qrCode"},[e.activeActivity.qrCodeUrl?a("img",{staticClass:"poster_img",attrs:{src:e.activeActivity.qrCodeUrl,alt:"二维码加载失败"},on:{error:function(t){return e.onImageLoadError("qrCodeUrl")}}}):a("div",{staticClass:"spin-container"},[a("Spin",{attrs:{fix:"",size:"large"}})],1),e._v(" "),"failed"===e.activeActivity.qrCodeUrl?a("Button",{staticClass:"download_button",attrs:{type:"primary"},on:{click:function(t){return e.setCodeUrl("qrCodeUrl")}}},[e._v("重新加载")]):e._e(),e._v(" "),e.activeActivity.qrCodeUrl&&"failed"!==e.activeActivity.qrCodeUrl?a("Button",{staticClass:"download_button",attrs:{type:"primary",loading:e.qrCodeDownloading},on:{click:function(t){return e.downloadImg(e.activeActivity.qrCodeUrl,"qrcode")}}},[e._v("下载")]):e._e()],1)]):e._e(),e._v(" "),"loginMinapp"===e.activeActivity.id?a("div",{staticClass:"display f12",staticStyle:{"flex-direction":"column"}},[a("h5",[e._v("小程序账号: "+e._s(e.minappInfo.studentCard))]),e._v(" "),a("h5",{staticClass:"mgt-16"},[e._v("小程序密码: "),a("Base64Encode",{attrs:{content:e.minappInfo.initPassword}})],1),e._v(" "),a("p",{staticClass:"mgt-16",staticStyle:{color:"gray"}},[e._v("*学而思培优App上能进行密码修改，以修改后的密码为准")]),e._v(" "),a("div",{staticClass:"instructions-container mgt-28"},[a("p",[e._v("使用说明：")]),e._v(" "),a("p",[e._v("1.使用账号密码登录小程序，并分享页面，小程序链接中带有您的个人信息。")]),e._v(" "),a("p",[e._v("2.用户进入链接后完成注册，您将获得绩效。注册用户转化长期班也能计入绩效。")]),e._v(" "),a("p",[e._v("3.可分享的页面为：到店有礼活动页面、预约诊断页面、预约试听页面、我的专属顾问页面、课程列表页面。")])])]):e._e()],1)])])}),[],!1,null,"5a35403f",null));t.default=b.exports},"1e0c":function(e,t,a){"use strict";var r=a("e87d");a.n(r).a},"236a":function(e,t,a){"use strict";var r=a("08c0");a.n(r).a},"287d":function(e,t,a){"use strict";var r=a("b8bc");a.n(r).a},"291b":function(e,t,a){"use strict";var r=a("54cb");a.n(r).a},"2b6f":function(e,t,a){"use strict";var r=a("d737");a.n(r).a},3130:function(e,t,a){"use strict";a.r(t);a("097d"),a("f751"),a("7f7f"),a("0d6d");var r=a("0263"),n=a("46a8"),i=a("6ab3"),s=a("7665"),o=a("49e5"),c=a("3c8d"),l=a("c24f"),u=a("0ef6"),d={name:"scatteredDiagnosisMgt",mixins:[r.a,u.a],components:{FllowDiagnosisRecord:n.a,AddSubscribeDiagnosis:i.default},data:function(){var e=this;return{tableLoading:!1,tableData:[],stuDetail:{show:!1,scoreRecordShow:!1},fllowUp:{showModal:!1,id:!1},showAddSubscribeModal:!1,conditions:{stuIntention:[],isNewStudent:[],isRegist:[],isPay:[]},setDefaultServiceCenter:!0,treatAdvisorEmpNos:[],formData:{year:"",diagnosisStartTime:"",diagnosisEndTime:"",treatAdvisorEmpNo:"",stuIntention:"",isNewStudent:"",isRegist:"",isPay:"",isDiagnosisAttend:"",stuRealName:"",phone:"",stuCode:"",diagnosisTime:"",createTime:"",createStartTime:"",createEndTime:"",channelId:""},btnLoading:!1,diagnosisChannels:[],columns:Object.freeze([{title:"操作",align:"center",render:function(t,a){return t("div",[t("a",{on:{click:function(){var t={cityCode:e.formData.cityCode,uid:a.row.pyUid,studentUid:a.row.pyUid};Object(o.b)(t).then((function(t){e.stuDetail.uid=a.row.pyUid,e.stuDetail.card=a.row.stuCode,e.stuDetail.realName=a.row.stuRealName,e.stuDetail.cityCode=e.formData.cityCode,e.stuDetail.areaCode=e.formData.cityCode,e.stuDetail.gradeName=t.gradeName,e.fllowUp.id=a.row.id,e.fllowUp.showModal=!0})).catch((function(t){e.$Message.error({content:"获取学员信息失败"+t.message,duration:5})}))}}},"跟进"),t("p"),a.row.diagnosisTime?t("span",{style:{color:"gray"}},"成绩录入"):t("a",{on:{click:function(){var t={cityCode:e.formData.cityCode,uid:a.row.pyUid,studentUid:a.row.pyUid};Object(o.b)(t).then((function(t){e.stuDetail.uid=a.row.pyUid,e.stuDetail.card=a.row.stuCode,e.stuDetail.realName=a.row.stuRealName,e.stuDetail.cityCode=e.formData.cityCode,e.stuDetail.studentId=t.studentId,e.stuDetail.scoreRecordShow=!0,e.stuDetail.diagnosisRecordId=a.row.id})).catch((function(t){e.$Message.error({content:"获取学员信息失败"+t.message,duration:5})}))}}},"成绩录入")])}},{title:"学员姓名",key:"stuRealName",align:"center",render:function(t,a){return t("a",{on:{click:function(){var t={card:a.row.stuCode,cityCode:e.formData.cityCode};e.goCustomerDetail(t)}}},a.row.stuRealName||"无")}},{title:"联系电话",key:"phone",align:"center",width:120,render:function(e,t){return e(c.TalDecodeText,{props:{uid:t.row.pyUid,encodeText:t.row.phone,type:"phone"}})}},{title:"绑定顾问",key:"belongAdvisorName",align:"center",render:function(e,t){return e("span",t.row.belongAdvisorName||"无")}},{title:"预约顾问",key:"planEmpName",align:"center",render:function(e,t){return e("span",t.row.planEmpName||"无")}},{title:"微信状态",key:"isWechatAdded",align:"center",render:function(e,t){return e("span",1===t.row.isWechatAdded?"已添加":"未添加")}},{title:"用户意向",key:"stuIntention",align:"center",render:function(e,t){return e("span",t.row.stuIntention||"无")}},{title:"渠道标签",key:"channelName",align:"center",render:function(e,t){return e("span",t.row.channelName||"无")}},{title:"预约意向学科",key:"intentionSubjectName",align:"center",render:function(e,t){return e("span",t.row.intentionSubjectName||"无")},renderHeader:function(e,t){return e("div",{style:{display:"flex","flex-direction":"row","align-items":"center"}},[e("span","预约意向学科"),e("Tooltip",{props:{placement:"bottom",maxWidth:"500",content:"预约诊断时首次填写的意向学科"}},[e("Icon",{style:{verticalAlign:"middle"},props:{size:14,type:"md-help-circle"}},"")])])}},{title:"创建时间",key:"createDate",align:"center",render:function(e,t){return e("span",t.row.createDate||"无")}},{title:"预约诊断时间",key:"diagnosisPlanTime",align:"center",width:100,render:function(e,t){return e("span",t.row.diagnosisPlanTime||"无")}},{title:"是否参诊",key:"isDiagnosisAttend",align:"center",render:function(e,t){return e("span",1===t.row.isDiagnosisAttend?"是":"否")}},{title:"参诊时间",key:"diagnosisTime",align:"center",render:function(e,t){return e("span",t.row.diagnosisTime||"--")}},{title:"接待顾问",key:"empName",align:"center",render:function(e,t){return e("span",t.row.empName||"--")}},{title:"参诊年份",key:"year",align:"center",render:function(e,t){return e("span",t.row.year||"--")}},{title:"参诊学期",key:"termName",align:"center",render:function(e,t){return e("span",t.row.termName||"--")}},{title:"参诊年级",key:"gradeName",align:"center",render:function(e,t){return e("span",t.row.gradeName||"--")}},{title:"参诊学科",key:"subjectName",align:"center",render:function(e,t){return e("span",t.row.subjectName||"--")}},{title:"参诊成绩",key:"levelDegreeName",align:"center",render:function(e,t){return e("span",t.row.levelDegreeName||"--")}},{title:"诊断报告",key:"reportUrl",align:"center",render:function(e,t){return t.row.reportUrl?e("a",{attrs:{href:t.row.reportUrl,target:"_blank"}},"查看"):e("span","--")}},{title:"是否报名",key:"isRegist",align:"center",render:function(e,t){return e("span",1===t.row.isRegist?"是":t.row.diagnosisTime?"否":"--")},renderHeader:function(e,t){return e("div",{style:{display:"flex","flex-direction":"row","align-items":"center"}},[e("span","是否报名"),e("Tooltip",{props:{placement:"bottom-end",maxWidth:"500",content:"判断该用户本次诊断后，是否报名同学科长期班，不区分学期"}},[e("Icon",{style:{verticalAlign:"middle"},props:{size:14,type:"md-help-circle"}},"")])])}},{title:"是否缴费",key:"isPay",align:"center",render:function(e,t){return e("span",1===t.row.isPay?"是":t.row.diagnosisTime?"否":"--")},renderHeader:function(e,t){return e("div",{style:{display:"flex","flex-direction":"row","align-items":"center",positon:"relative"}},[e("span","是否缴费"),e("Tooltip",{props:{placement:"bottom",maxWidth:"500",content:"判断该用户本次诊断后，是否缴费同学科长期班，不区分学期"}},[e("Icon",{style:{verticalAlign:"middle"},props:{size:14,type:"md-help-circle"}},"")])])}},{title:"跟进次数",key:"followCount",align:"center",render:function(e,t){return e("span",t.row.followCount||"--")}}])}},mounted:function(){this.searchFromNotice(this.$route),this.initView()},activated:function(){this.formData.cityCode&&this.tableData.length&&this.getTableData()},methods:{queryDiagnosisChannels:function(){var e=this;Object(s.f)({}).then((function(t){e.diagnosisChannels=Object.freeze(t)})).catch((function(t){e.$Message.error({content:t.message,duration:5})}))},exportDataClick:function(){var e=this,t=this.allCityList.filter((function(t){return t.id===e.formData.cityCode}))[0].name,a=Object.assign({},this.formData,{areaCode:this.formData.cityCode,diagnosisStartTime:this.formData.diagnosisStartTime?this.formData.diagnosisStartTime+" 00:00:00":"",diagnosisEndTime:this.formData.diagnosisEndTime?this.formData.diagnosisEndTime+" 23:59:59":"",createStartTime:this.formData.createStartTime?this.formData.createStartTime+" 00:00:00":"",createEndTime:this.formData.createEndTime?this.formData.createEndTime+" 23:59:59":"",cityName:t,crmRoleId:this.$store.state.roleRelativeData.userInfo.crmRoleId});if(!a.createStartTime||!a.createEndTime)return this.$Message.warning({content:"请选择创建时间，最多支持选择三个月",duration:3});this.btnLoading=!0,Object(s.c)(a).then((function(t){var a=t.id;e.$Message.info({content:"正在导出excel，请勿关闭当前标签页",duration:5}),function e(t,a){Object(l.b)({id:t}).then((function(r){r.filePath?setTimeout((function(){window.open(r.filePath),a.btnLoading=!1}),500):setTimeout((function(){e(t,a)}),2e3)})).catch((function(e){a.btnLoading=!1,a.$Message.error({content:e.message,duration:5})}))}(a,e)})).catch((function(t){e.btnLoading=!1,e.$Message.error({content:t.message,duration:5})}))},refreshSearch:function(){var e=this;this.stuDetail.scoreRecordShow=!1,this.fllowUp.showModal=!1,this.showAddSubscribeModal=!1,setTimeout((function(){e.getTableData()}),1500)},searchFromNotice:function(e){var t=e.query;t.cityCode&&t.studentCard&&(this.formData.stuCode=t.studentCard,this.formData.cityCode=t.cityCode,this.setDefaultServiceCenter=!1,this.cityYearChange(this.formData.cityCode),this.getTableData())},getTreatAdvisorEmpNos:function(e){var t=this,a={userName:e};Object(s.e)(a).then((function(e){t.treatAdvisorEmpNos=Object.freeze(e)})).catch((function(e){t.$Message.error({content:e.message,duration:5})}))},getCondition:function(){var e=this;Object(s.b)({}).then((function(t){e.conditions=Object.freeze(t)})).catch((function(t){e.$Message.error({content:t.message,duration:5})}))},initView:function(){this.getCitys(),this.getYears(),this.getCondition(),this.queryDiagnosisChannels()},onSubscribe:function(){this.$router.push({name:"addSubscribeDiagnosis"})},onSearch:function(){if(!this.formData.cityCode)return this.$Message.warning({content:"请选择城市",duration:5});this.formData.pageNo=1,this.formData.pageSize=10,this.getTableData()},changePage:function(e){this.formData.pageNo=e,this.getTableData()},pageSizeChange:function(e){this.formData.pageNo=1,this.formData.pageSize=e,this.getTableData()},getTableData:function(){var e=this,t=Object.assign({},this.formData,{areaCode:this.formData.cityCode,diagnosisStartTime:this.formData.diagnosisStartTime?this.formData.diagnosisStartTime+" 00:00:00":"",diagnosisEndTime:this.formData.diagnosisEndTime?this.formData.diagnosisEndTime+" 23:59:59":"",createStartTime:this.formData.createStartTime?this.formData.createStartTime+" 00:00:00":"",createEndTime:this.formData.createEndTime?this.formData.createEndTime+" 23:59:59":""});this.tableLoading=!0,Object(s.g)(t).then((function(t){e.formData.totalCount=t.totalCount,e.tableData=Object.freeze(t.records)||[]})).catch((function(t){e.formData.totalCount=0,e.$Message.error({content:t.message,duration:5})})).finally((function(){e.tableLoading=!1}))},diagnosisImport:function(){var e=this;this.$Modal.confirm({title:"提示",content:"<p>1、关联诊断报告，系统会按照“预约意向科目”匹配。</p><p>2、为避免转化数据遗漏，请在录入线下报告之前在散诊管理页面完成同学科的散诊预约。</p>",onOk:function(){e.$router.push("/operative/diagnosisImport")}})}}},m=(a("363d"),a("2877")),h=Object(m.a)(d,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{width:"100%",padding:"10px"}},[a("Form",{ref:"form",staticClass:"mrg-b filter-search",staticStyle:{padding:"10px 0",background:"#fff"},attrs:{model:e.formData,"label-position":"right","label-width":15,inline:""}},[a("div",{staticClass:"class_top clearfix"},[a("FormItem",{attrs:{label:" ",required:""}},[a("Select",{staticStyle:{width:"120px"},attrs:{filterable:"",placeholder:"城市"},on:{"on-change":e.cityYearChange},model:{value:e.formData.cityCode,callback:function(t){e.$set(e.formData,"cityCode",t)},expression:"formData.cityCode"}},e._l(e.allCityList,(function(t,r){return a("Option",{key:r,attrs:{value:t.id}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),a("FormItem",[a("Select",{staticStyle:{width:"150px"},attrs:{clearable:"",filterable:"",placeholder:"区域"},on:{"on-change":function(t){return e.changeArea()}},model:{value:e.formData.areaId,callback:function(t){e.$set(e.formData,"areaId",t)},expression:"formData.areaId"}},e._l(e.areaList,(function(t,r){return a("Option",{key:r,attrs:{value:t.schoolId}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),a("FormItem",[a("Select",{staticStyle:{width:"150px"},attrs:{clearable:"",filterable:"",placeholder:"服务中心"},on:{"on-change":e.changeService},model:{value:e.formData.serviceCenterId,callback:function(t){e.$set(e.formData,"serviceCenterId",t)},expression:"formData.serviceCenterId"}},e._l(e.serviceList,(function(t,r){return a("Option",{key:r,attrs:{value:t.schoolId}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),a("FormItem",[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:"",placeholder:"参诊年份"},model:{value:e.formData.year,callback:function(t){e.$set(e.formData,"year",t)},expression:"formData.year"}},e._l(e.yearList,(function(t,r){return a("Option",{key:r,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),e._v(" "),a("FormItem",[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:"",placeholder:"参诊学期"},on:{"on-change":e.changeTerm},model:{value:e.formData.termId,callback:function(t){e.$set(e.formData,"termId",t)},expression:"formData.termId"}},e._l(e.termList,(function(t,r){return a("Option",{key:r,attrs:{value:t.id}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),a("FormItem",[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:"",placeholder:"参诊年部"},on:{"on-change":e.gradeTypeChange},model:{value:e.formData.gradeTypeId,callback:function(t){e.$set(e.formData,"gradeTypeId",t)},expression:"formData.gradeTypeId"}},e._l(e.gradeTypeList,(function(t,r){return a("Option",{key:r,attrs:{value:t.id}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),a("FormItem",[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:"",placeholder:"参诊年级"},on:{"on-change":e.changeClasses},model:{value:e.formData.gradeId,callback:function(t){e.$set(e.formData,"gradeId",t)},expression:"formData.gradeId"}},e._l(e.gradeList,(function(t,r){return a("Option",{key:r,attrs:{value:t.id}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),a("FormItem",[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:"",placeholder:"参诊学科"},on:{"on-change":e.changeSubject},model:{value:e.formData.subjectId,callback:function(t){e.$set(e.formData,"subjectId",t)},expression:"formData.subjectId"}},e._l(e.subjectList,(function(t,r){return a("Option",{key:r,attrs:{value:t.id}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),a("FormItem",[a("Select",{staticStyle:{width:"150px"},attrs:{filterable:"",clearable:"",remote:"","remote-method":e.getTreatAdvisorEmpNos,"label-in-value":"",loading:e.loading1,placeholder:"预约顾问"},model:{value:e.formData.planEmpNo,callback:function(t){e.$set(e.formData,"planEmpNo",t)},expression:"formData.planEmpNo"}},e._l(e.treatAdvisorEmpNos,(function(t){return a("Option",{key:t.userWorkCode,attrs:{value:t.userWorkCode}},[e._v(e._s(t.userName)+" - "+e._s(t.userWorkCode))])})),1)],1),e._v(" "),a("FormItem",[a("Select",{staticStyle:{width:"150px"},attrs:{filterable:"",clearable:"",remote:"","remote-method":e.getTreatAdvisorEmpNos,"label-in-value":"",loading:e.loading1,placeholder:"接待顾问"},model:{value:e.formData.treatAdvisorEmpNo,callback:function(t){e.$set(e.formData,"treatAdvisorEmpNo",t)},expression:"formData.treatAdvisorEmpNo"}},e._l(e.treatAdvisorEmpNos,(function(t){return a("Option",{key:t.userWorkCode,attrs:{value:t.userWorkCode}},[e._v(e._s(t.userName)+" - "+e._s(t.userWorkCode))])})),1)],1),e._v(" "),a("FormItem",[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:"",placeholder:"用户意向"},on:{"on-change":e.changeSubject},model:{value:e.formData.stuIntention,callback:function(t){e.$set(e.formData,"stuIntention",t)},expression:"formData.stuIntention"}},e._l(e.conditions.stuIntention,(function(t,r){return a("Option",{key:r,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),e._v(" "),a("FormItem",[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:"",placeholder:"是否报名"},on:{"on-change":e.changeSubject},model:{value:e.formData.isRegist,callback:function(t){e.$set(e.formData,"isRegist",t)},expression:"formData.isRegist"}},e._l(e.conditions.isRegist,(function(t,r){return a("Option",{key:r,attrs:{value:t.id}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),a("FormItem",[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:"",placeholder:"是否缴费"},on:{"on-change":e.changeSubject},model:{value:e.formData.isPay,callback:function(t){e.$set(e.formData,"isPay",t)},expression:"formData.isPay"}},e._l(e.conditions.isPay,(function(t,r){return a("Option",{key:r,attrs:{value:t.id}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),a("FormItem",[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:"",placeholder:"是否参诊"},on:{"on-change":e.changeSubject},model:{value:e.formData.isDiagnosisAttend,callback:function(t){e.$set(e.formData,"isDiagnosisAttend",t)},expression:"formData.isDiagnosisAttend"}},e._l(e.conditions.isDiagnosisAttend,(function(t,r){return a("Option",{key:r,attrs:{value:t.id}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),a("FormItem",[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:"",placeholder:"渠道标签"},model:{value:e.formData.channelId,callback:function(t){e.$set(e.formData,"channelId",t)},expression:"formData.channelId"}},e._l(e.diagnosisChannels,(function(t,r){return a("Option",{key:r,attrs:{value:t.id}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),a("FormItem",[a("DatePicker",{staticStyle:{width:"200px"},attrs:{placeholder:"创建时间",type:"daterange",editable:!1},on:{"on-change":function(t){return e.optDateChange(t,"createStartTime","createEndTime")}},model:{value:e.formData.createTime,callback:function(t){e.$set(e.formData,"createTime",t)},expression:"formData.createTime"}})],1),e._v(" "),a("FormItem",[a("DatePicker",{staticStyle:{width:"200px"},attrs:{placeholder:"诊断时间",type:"daterange",editable:!1},on:{"on-change":function(t){return e.optDateChange(t,"diagnosisStartTime","diagnosisEndTime")}},model:{value:e.formData.diagnosisTime,callback:function(t){e.$set(e.formData,"diagnosisTime",t)},expression:"formData.diagnosisTime"}})],1),e._v(" "),a("div"),e._v(" "),a("FormItem",[a("Input",{attrs:{placeholder:"学员姓名",clearable:""},model:{value:e.formData.stuRealName,callback:function(t){e.$set(e.formData,"stuRealName",t)},expression:"formData.stuRealName"}})],1),e._v(" "),a("FormItem",[a("Input",{attrs:{number:"",placeholder:"学员手机号",clearable:""},model:{value:e.formData.phone,callback:function(t){e.$set(e.formData,"phone",t)},expression:"formData.phone"}})],1),e._v(" "),a("FormItem",[a("Input",{attrs:{placeholder:"学员编号",number:"",clearable:""},model:{value:e.formData.stuCode,callback:function(t){e.$set(e.formData,"stuCode",t)},expression:"formData.stuCode"}})],1),e._v(" "),a("div",{staticStyle:{"text-align":"right","margin-bottom":"10px","margin-top":"-30px"}},[a("Button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary"},on:{click:e.onSearch}},[e._v("查询")]),e._v(" "),a("Button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary"},on:{click:function(t){e.showAddSubscribeModal=!0}}},[e._v("新增诊断信息")]),e._v(" "),a("Button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary",loading:e.btnLoading},on:{click:e.exportDataClick}},[e._v("导出数据")]),e._v(" "),a("Button",{attrs:{type:"primary"},on:{click:e.diagnosisImport}},[e._v("录入线下报告")])],1)],1)]),e._v(" "),a("Table",{ref:"selection",staticStyle:{"margin-top":"20px"},attrs:{border:"",loading:e.tableLoading,columns:e.columns,data:e.tableData}}),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!e.tableLoading,expression:"!tableLoading"}],class:{"page-fix":e.tableData.length<3},staticStyle:{margin:"10px"}},[a("div",{staticClass:"page-box",staticStyle:{"text-align":"right"}},[a("Page",{attrs:{total:e.formData.totalCount,"page-size":e.formData.pageSize,current:e.formData.pageNo,"show-elevator":"","show-sizer":"","show-total":""},on:{"update:current":function(t){return e.$set(e.formData,"pageNo",t)},"on-page-size-change":e.pageSizeChange,"on-change":e.changePage}})],1)]),e._v(" "),a("Modal",{attrs:{"mask-closable":!1,title:"成绩录入","footer-hide":!0,width:"960px"},model:{value:e.stuDetail.scoreRecordShow,callback:function(t){e.$set(e.stuDetail,"scoreRecordShow",t)},expression:"stuDetail.scoreRecordShow"}},[e.stuDetail.scoreRecordShow?a("TalScoreRecord",{attrs:{stuId:e.stuDetail.studentId,cityCode:e.stuDetail.cityCode,stuCard:e.stuDetail.card,stuUid:e.stuDetail.uid,stuName:e.stuDetail.realName,isDiagnosis:1,diagnosisRecordId:e.stuDetail.diagnosisRecordId},on:{success:function(t){return e.refreshSearch()}}}):e._e()],1),e._v(" "),a("Modal",{attrs:{"mask-closable":!1,title:"散诊跟进","footer-hide":!0,width:"760px"},model:{value:e.fllowUp.showModal,callback:function(t){e.$set(e.fllowUp,"showModal",t)},expression:"fllowUp.showModal"}},[e.fllowUp.showModal?a("FllowDiagnosisRecord",{attrs:{diagnosisRecordId:e.fllowUp.id,studentDetail:e.stuDetail},on:{success:e.refreshSearch,close:function(t){e.fllowUp.showModal=!1}}}):e._e()],1),e._v(" "),a("Modal",{attrs:{"mask-closable":!1,title:"新增预约诊断","footer-hide":!0,width:"1050px"},model:{value:e.showAddSubscribeModal,callback:function(t){e.showAddSubscribeModal=t},expression:"showAddSubscribeModal"}},[e.showAddSubscribeModal?a("AddSubscribeDiagnosis",{on:{success:e.refreshSearch,close:function(t){e.showAddSubscribeModal=!1}}}):e._e()],1)],1)}),[],!1,null,"4eab6304",null);t.default=h.exports},"318f":function(e,t,a){"use strict";a.r(t);a("ac6a");var r=a("fa7d"),n=a("a36e"),i=a("5c96"),s={props:{row:Object}},o=a("2877"),c=Object(o.a)(s,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e._l(e.row.tag,(function(t){return a("Tag",{key:t,staticStyle:{"margin-right":"10px"},attrs:{type:"border",color:"primary"}},[e._v(e._s(t))])})),e._v(e._s(e.row.content)+"\n")],2)}),[],!1,null,null,null).exports,l=a("2472"),u=a("66df");var d=a("867e"),m={name:"serviceCenterEvaluation",mixins:[n.a],components:{expandRow:c},data:function(){var e=this;return{formData:{cityCode:"",areaId:"",serviceCenterId:"",star:"",hasContent:"",startTime:"",startDateVal:"",endTime:"",endDateVal:""},formData2:{cityCode:"",areaId:"",serviceCenterId:"",star:"",hasContent:"",startTime:"",startDateVal:"",endTime:"",endDateVal:""},tableLoading:!1,currentPageNum:1,currentPageSize:10,totalCount:0,allCityList:[],areaList:[],serviceCenterList:"",baseInfo:{},scoreList:[1,2,3,4,5],tableData:[],cols:[{type:"expand",width:50,render:function(e,t){return e(c,{props:{row:t.row}})}},{title:"教学点",key:"venueName",align:"center"},{title:"学员姓名",align:"center",render:function(t,a){return t("a",{on:{click:function(){e.routerTo(a.row)}}},a.row.studentRealName)}},{title:"学员编号",key:"studentCard",align:"center"},{title:"注册时间",key:"createDate",align:"center"},{title:"是否匿名",key:"anonymous",align:"center",render:function(e,t){return e("span","1"===t.row.anonymous?"是":"否")}},{title:"评分",key:"star",align:"center",render:function(e,t){return e(i.Rate,{props:{disabled:!0,value:t.row.star}})}},{title:"操作",align:"center",render:function(t,a){return t("a",{on:{click:function(){e.$set(e.tableData[a.index],"_expanded",!e.tableData[a.index]._expanded)}}},e.tableData[a.index]._expanded?"收起详情":"展开详情")}}]}},methods:{search:function(){this.currentPageNum=1,this.getTableData()},getTableData:function(){var e,t=this;this.formData.cityCode?this.formData.areaId?this.formData.serviceCenterId?(this.formData.pageSize=this.currentPageSize,this.formData.pageNo=this.currentPageNum,this.tableLoading=!0,(e=this.formData,u.a.request({url:"serviceCenter/getEvaluateList",method:"post",data:e})).then((function(e){0===e.records.length?(t.tableData=[],t.$Message.warning("暂无数据")):(t.totalCount=e.totalCount,t.tableData=e.records.map((function(e,t){return e._index=t,e}))),t.tableLoading=!1})).catch((function(e){t.tableData=[],t.totalCount=0,t.currentPageSize=10,t.currentPageNum=1,t.tableLoading=!1,t.$Message.warning({content:"获取数据失败:"+e.message,duration:5})}))):this.$Message.warning("请选择服务中心"):this.$Message.warning("请选择区域"):this.$Message.warning("请选择所在城市")},changePage:function(e){this.currentPageNum=e,this.getTableData()},pageSizeChange:function(e){this.currentPageNum=1,this.currentPageSize=e,this.getTableData()},cityChange:function(e){var t=this;this.formData.areaId="",this.formData.serviceCenterId="",this.areaList=[],this.serviceCenterList=[],this.baseInfo={},e&&this.getAreaListHandler({cityCode:e}).then((function(e){t.areaList=e,Object(l.e)({cityCode:t.formData.cityCode,empNo:t.$store.state.user.userInfo.id}).then((function(e){t.formData.areaId=e.areaId,t.formData2.areaId=e.areaId,t.changeArea(e.areaId,e.serviceCenterId)})).catch((function(e){t.$Message.error("获取当前所在服务中心失败:"+e.message)}))})).catch((function(e){t.$Message.error("获取区域失败:"+e.message)}))},changeArea:function(e,t){var a=this;if(this.serviceCenterList=[],this.formData.serviceCenterId="",this.baseInfo={},!e)return!1;var r={cityCode:this.formData.cityCode,areaId:this.formData.areaId};this.getServiceCenterListHandler(r).then((function(e){a.serviceCenterList=e,a.serviceCenterList.forEach((function(e){e.address||(e.address="")})),t&&(a.formData.serviceCenterId=t,a.formData2.serviceCenterId=t,a.getBaseInfo())})).catch((function(e){a.$Message.error("获取服务中心失败:"+e.message)}))},getBaseInfo:function(){var e,t=this;(e={cityCode:this.formData.cityCode,serviceCenterId:this.formData.serviceCenterId},u.a.request({url:"serviceCenter/getAggregateInfo",method:"get",params:e})).then((function(e){t.baseInfo=e})).catch((function(e){t.$Message.error("获取服务中心综合信息失败:"+e.message)}))},changeSC:function(e){e&&this.getBaseInfo()},startDateChange:function(e){if(this.formData.endTime&&new Date(e).getTime()>new Date(this.formData.endTime).getTime())return this.$Message.warning({content:"结束时间不得小于开始时间",duration:5}),this.formData.startTime="",void(this.formData.startDateVal="");this.formData.startTime=e},endDateChange:function(e){if(this.formData.startTime&&new Date(this.formData.startTime).getTime()>new Date(e).getTime())return this.$Message.warning({content:"结束时间不得小于开始时间",duration:5}),this.formData.endTime="",void(this.formData.endDateVal="");this.formData.endTime=e},reset:function(){Object(r.e)(this.formData,this.formData2)},routerTo:function(e){this.$router.push({name:"applyWorkbenchForMulti",query:{cityCode:this.formData.cityCode,card:e.studentCard,tab:"classRecord"},params:{id:e.studentCard}})},tableExpand:function(e,t){this.$set(this.tableData[e._index],"_expanded",t)}},watch:{allCityList:function(e){this.formData.cityCode=e[0].id,this.formData2.cityCode=e[0].id,this.cityChange(this.formData.cityCode)}},mounted:function(){this.getCityListHandler(),Object(d.w)({apiName:"serviceComment"})}},h=(a("d0a8"),Object(o.a)(m,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{width:"100%",padding:"15px"}},[a("Form",{ref:"form",attrs:{model:e.formData,"label-position":"right","label-width":100,inline:""}},[a("FormItem",{attrs:{label:"城市：",required:""}},[a("Select",{staticStyle:{width:"120px"},attrs:{filterable:""},on:{"on-change":e.cityChange},model:{value:e.formData.cityCode,callback:function(t){e.$set(e.formData,"cityCode",t)},expression:"formData.cityCode"}},e._l(e.allCityList,(function(t,r){return a("Option",{key:r,attrs:{value:t.id}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),a("FormItem",{attrs:{label:"区域：",required:""}},[a("Select",{staticStyle:{width:"120px"},attrs:{filterable:""},on:{"on-change":e.changeArea},model:{value:e.formData.areaId,callback:function(t){e.$set(e.formData,"areaId",t)},expression:"formData.areaId"}},e._l(e.areaList,(function(t){return a("Option",{key:t.schoolId,attrs:{value:t.schoolId}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),a("FormItem",{attrs:{label:"服务中心：",required:""}},[a("Select",{staticStyle:{width:"120px"},attrs:{filterable:""},on:{"on-change":e.changeSC},model:{value:e.formData.serviceCenterId,callback:function(t){e.$set(e.formData,"serviceCenterId",t)},expression:"formData.serviceCenterId"}},e._l(e.serviceCenterList,(function(t,r){return a("Option",{key:r,attrs:{value:t.schoolId}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),a("FormItem",[a("span",{staticClass:"blod-font",attrs:{slot:"label"},slot:"label"},[e._v("综合评分：")]),e._v(" "),a("el-rate",{staticClass:"service-rate",attrs:{disabled:""},model:{value:e.baseInfo.star,callback:function(t){e.$set(e.baseInfo,"star",t)},expression:"baseInfo.star"}})],1),e._v(" "),a("FormItem",[a("span",{staticClass:"blod-font",attrs:{slot:"label"},slot:"label"},[e._v("评价数：")]),e._v(" "),a("span",{staticClass:"blod-font"},[e._v("\n        "+e._s(e.baseInfo.size||"--")+"\n      ")])]),e._v(" "),a("FormItem",[a("span",{staticClass:"blod-font",attrs:{slot:"label"},slot:"label"},[e._v("匿名率：")]),e._v(" "),a("span",{staticClass:"blod-font"},[e._v("\n        "+e._s(e.baseInfo.anonymityRate?(100*e.baseInfo.anonymityRate).toFixed(0)+"%":"--")+"\n      ")])])],1),e._v(" "),a("div",{staticClass:"tag-wrapper"},e._l(e.baseInfo.tag,(function(t){return a("div",{key:t.id,staticClass:"tag"},[e._v(e._s(t.desc+" "+t.count))])})),0),e._v(" "),a("Form",{ref:"form",staticStyle:{"padding-top":"18px"},attrs:{model:e.formData,"label-position":"right","label-width":100,inline:""}},[a("FormItem",{attrs:{label:"评分："}},[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:""},model:{value:e.formData.star,callback:function(t){e.$set(e.formData,"star",t)},expression:"formData.star"}},e._l(e.scoreList,(function(t,r){return a("Option",{key:r,attrs:{value:t}},[e._v(e._s(t+"星"))])})),1)],1),e._v(" "),a("FormItem",{attrs:{label:"有无文字："}},[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:""},model:{value:e.formData.hasContent,callback:function(t){e.$set(e.formData,"hasContent",t)},expression:"formData.hasContent"}},[a("Option",{attrs:{value:1}},[e._v("有文字")]),e._v(" "),a("Option",{attrs:{value:0}},[e._v("无文字")])],1)],1),e._v(" "),a("FormItem",{attrs:{label:"创建时间："}},[a("DatePicker",{staticStyle:{width:"120px"},attrs:{editable:!1,type:"date"},on:{"on-change":e.startDateChange},model:{value:e.formData.startDateVal,callback:function(t){e.$set(e.formData,"startDateVal",t)},expression:"formData.startDateVal"}}),e._v("\n        至  \n      "),a("DatePicker",{staticStyle:{width:"120px"},attrs:{editable:!1,type:"date"},on:{"on-change":e.endDateChange},model:{value:e.formData.endDateVal,callback:function(t){e.$set(e.formData,"endDateVal",t)},expression:"formData.endDateVal"}})],1),e._v(" "),a("FormItem",[a("Button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary",loading:e.tableLoading},on:{click:e.search}},[e._v("查询")]),e._v(" "),a("Button",{on:{click:e.reset}},[e._v("重置")])],1)],1),e._v(" "),a("Table",{attrs:{columns:e.cols,data:e.tableData,loading:e.tableLoading},on:{"on-expand":e.tableExpand}}),e._v(" "),a("div",{class:{"page-fix":e.tableData.length<3},staticStyle:{margin:"10px"}},[a("div",{staticStyle:{float:"right"}},[a("Page",{attrs:{total:e.totalCount,"page-size":e.currentPageSize,current:e.currentPageNum,"show-elevator":"","show-sizer":"","show-total":""},on:{"on-page-size-change":e.pageSizeChange,"on-change":e.changePage}})],1)])],1)}),[],!1,null,"83e012d4",null));t.default=h.exports},"331d":function(e,t,a){"use strict";var r=a("abb5");a.n(r).a},3377:function(e,t,a){},"363d":function(e,t,a){"use strict";var r=a("06b4");a.n(r).a},"37c8":function(e,t,a){t.f=a("2b4c")},"3a21":function(e,t,a){},"3a72":function(e,t,a){var r=a("7726"),n=a("8378"),i=a("2d00"),s=a("37c8"),o=a("86cc").f;e.exports=function(e){var t=n.Symbol||(n.Symbol=i?{}:r.Symbol||{});"_"==e.charAt(0)||e in t||o(t,e,{value:s.f(e)})}},"3e56":function(e,t,a){"use strict";var r=a("ef6a");a.n(r).a},"404b":function(e,t,a){},4157:function(e,t,a){"use strict";var r=a("c99b");a.n(r).a},"41f1":function(e,t,a){"use strict";a.r(t);a("8e6e"),a("456d"),a("f751"),a("c5f6");var r=a("bd86"),n=(a("cadf"),a("5df3"),a("4f7f"),a("ac6a"),a("7f7f"),a("d225")),i=a("b0b4"),s=a("bc3a"),o=a.n(s),c=a("f825"),l=a.n(c),u=a("c276"),d=Object(u.f)(),m=function(){function e(t){Object(n.a)(this,e),this.baseURL=t.baseURL,this.withCredentials=t.withCredentials,this.timeout=t.timeout,this.queue={}}return Object(i.a)(e,[{key:"getInsideConfig",value:function(){return{baseURL:this.baseURL,withCredentials:this.withCredentials,timeout:this.timeout,headers:{"X-Ca-platform":d,platform:"splat"}}}},{key:"destroy",value:function(e){delete this.queue[e],Object.keys(this.queue).length}},{key:"interceptors",value:function(e,t){var a=this;e.interceptors.request.use((function(e){return Object.keys(a.queue).length,a.queue[t]=!0,e.params=e.params||{},e.params.rn=Math.random(),e.params.cityCode?e.headers.cityCode=e.params.cityCode:e.data&&e.data.cityCode&&(e.headers.cityCode=e.data.cityCode),e.params.empNo?e.headers.empNo=e.params.empNo:e.data&&e.data.empNo&&(e.headers.empNo=e.data.empNo),e}),(function(e){return Promise.reject(e)})),e.interceptors.response.use((function(e){var r=e.data.code;return"ACCESS_DENIED"===r?Promise.reject({message:"您无此功能权限"}):"ENCODE_ERROR_INTERNAL"===r||"HTTP_HEADER_REQUIRED"===r||"HTTP_HEADER_VALUE_ERROR"===r||"HTTP_COOKIE_REQUIRED"===r||"HTTP_COOKIE_VALUE_ERROR"===r||"HTTP_HEADER_FORBIDDEN"===r||"HTTP_REQUEST_PATH_FORBIDDEN"===r||"HTTP_REQUEST_ERROR"===r||"TOO_MANY_REQUESTS"===r||"CID_NOT_REGIST"===r||"CID_HAS_NOT_SECURET"===r||"SIGNATURE_NOT_MATCH"===r||"LOAD_PRINCIPAL_ERROR"===r||"LOAD_AUTHORITY_COLLECTION_ERROR"===r||"LOAD_RATELIMITER_ERROR"===r?(window.parent.postMessage("".concat(r,"_sys_").concat(d),"*"),e.data):(a.destroy(t),e.data.rlt?e.data?e.data:Promise.reject({message:"系统错误"}):(l.a.Message.error({content:e.data.message,duration:3}),Promise.reject(e.data||{message:"系统错误"})))}),(function(e){return a.destroy(t),Promise.reject({message:e.response.data.message||"前端请求错误"})}))}},{key:"request",value:function(e){var t=o.a.create();return e=Object.assign(this.getInsideConfig(),e),this.interceptors(t,e.url),t(e)}}]),e}(),h=Object(u.n)(),p="";switch(h){case"dev":p="/";break;case"external":p="http://beta-gateway-one.speiyou.cn/";break;case"beta":p="http://gateway.one.speiyou.net/";break;case"prod":p="https://gateway-one.speiyou.cn/"}sessionStorage.setItem("currentEnv",h);var f=new m({baseURL:p,withCredentials:!0,timeout:3e4}),g=function(e){return f.request({url:"/SPLAT/register/queryUidsCountByConditions",method:"post",data:e})},v=function(e){return f.request({url:"/SPLAT/baseData/getCityList",method:"get",params:e})},y=function(e){return f.request({url:"/MASTER-BD/bd-web/school/list",method:"get",params:e})},b=function(e){return f.request({url:"/MASTER-BD/bd-web/gradeType/standardList",method:"get",params:e})},C=function(e){return f.request({url:"/MASTER-BD/bd-web/district/list",method:"get",params:e})},D={name:"index",data:function(){return{cityId:"",cityList:[],districtId:this.propDistrictId,districtList:[],level:"",levelList:[],school:"",schoolNum:0,selectList:[],current:1,size:10,total:0,columns:[{type:"selection",width:60,align:"center"},{title:"学校",key:"name",align:"left"},{title:"区/县",key:"districtName",align:"center"},{title:"年部",key:"levelName",align:"center"},{title:" ",key:"provinceName",align:"center"}],schoolList:[],schoolCode:this.propSchoolCode}},props:["deptId","propDistrictId","propSchoolCode"],methods:{handleEvents:function(e){e&&(this.districtId=this.propDistrictId,this.schoolCode=this.propSchoolCode,this.handleCityList(),this.handleSchoolBackList())},handleManageOk:function(){var e=this;if(0!==this.selectList.length){var t=[];this.selectList.forEach((function(e){t.push(e.id)}));var a,r={deptId:this.deptId,schoolIds:t};(a=r,f.request({url:"/SPLAT/baseData/bindSchool",method:"post",data:a})).then((function(t){!0===t.rlt&&(e.schoolList=[],e.$emit("handleEimtSchoolList"),e.$store.commit("service/HANDLE_SCHOOLMANAGE",!1))})).catch((function(t){e.$Message.warning({content:"绑定学校失败:"+t.message,duration:5})})),this.schoolList=[]}else this.$Message.warning("请先选择学校")},handleManageCancle:function(){this.schoolList=[],this.$store.commit("service/HANDLE_SCHOOLMANAGE",!1)},handleSchoolBackList:function(){var e=this;y({schoolCode:this.schoolCode,deptId:this.deptId}).then((function(t){!0===t.rlt&&t.data&&(e.selectList=t.data)})).catch((function(t){e.$Message.warning({content:"获取学校数据失败:"+t.message,duration:5})}))},handleCityList:function(){var e=this;v().then((function(t){!0===t.rlt&&t.data&&(e.cityId=t.data.find((function(t){return t.id===e.schoolCode})).cityId,e.cityList=t.data,e.handleGetDistrict(e.cityId,!0),e.handleGetCityList(e.schoolCode))})).catch((function(t){e.$Message.warning({content:"获取分校失败:"+t.message,duration:5})}))},handleGetDistrict:function(e,t){var a,r=this;if(t)a=e;else{var n=this.cityList.find((function(t){return t.id===e}));a=n&&n.cityId,this.cityId=a,this.handleGetCityList(e)}C({cityId:a}).then((function(e){!0===e.rlt&&e.data&&(r.districtList=e.data)})).catch((function(e){r.$Message.warning({content:"获取地区失败:"+e.message,duration:5})}))},handleDistrict:function(e){this.districtId=e},handleGetCityList:function(e){var t=this;b({schoolCode:e,status:0}).then((function(e){!0===e.rlt&&e.data&&(t.level=e.data[0].id,t.levelList=e.data)})).catch((function(e){t.$Message.warning({content:"获取年部失败:"+e.message,duration:5})}))},handleSearch:function(e,t){var a=this;e||(this.current=1,this.size=10,this.total=0);var r,n={schoolCode:this.schoolCode,cityId:this.cityId,districtId:this.districtId,level:this.level,likeName:this.school,status:0,current:e||this.current,size:t||this.size};(r=n,f.request({url:"/MASTER-BD/bd-web/school/pageQuery",method:"get",params:r})).then((function(e){!0===e.rlt&&e.data&&(a.schoolList=e.data&&e.data.records,a.schoolList.forEach((function(e){e.districtName=e.district.name,e.levelName=a.levelList.find((function(t){return t.id===e.level})).name})),a.total=e.data.total,a.selectList.length>0&&a.selectList.forEach((function(e){a.schoolList.forEach((function(t){t.id===e.id&&(t._checked=!0)}))})))})).catch((function(e){a.$Message.warning({content:"分页查询学校失败:"+e.message,duration:5})}))},handleSelect:function(e,t){this.schoolList.find((function(e){return e.id===t.id}))._checked=!0,this.selectList.push(t)},handleCancel:function(e,t){this.schoolList.find((function(e){return e.id===t.id}))._checked=!1,this.selectList=this.selectList.filter((function(e){return e.id!==t.id}))},handleSelectAll:function(e){this.selectList.forEach((function(t){e.forEach((function(e){t.id===e.id&&(e.hasChoose=!0)}))})),this.selectList=this.selectList.concat(e.filter((function(e){return!0!==e.hasChoose}))),this.schoolList.forEach((function(e){e._checked=!0}))},handleCancleAll:function(e){var t=this;this.schoolList=this.schoolList.slice(),this.schoolList.forEach((function(e){e._checked=!1})),this.selectList.forEach((function(e){t.schoolList.forEach((function(t){e.id===t.id&&(e.leave=!0)}))})),this.selectList=this.selectList.filter((function(e){return!e.leave}))},handleClear:function(e,t){this.schoolList=this.schoolList.slice();var a=this.schoolList.find((function(t){return t.id===e.id}));a&&(a._checked=!1),this.selectList=this.selectList.filter((function(t){return t.id!==e.id}))},clearAll:function(){this.selectList=[],this.schoolList=this.schoolList.slice(),this.schoolList.forEach((function(e){e._checked=!1}))},handleSizeChange:function(e){this.size=e,this.handleSearch(this.current,e)}},computed:{schoolState:{get:function(){return this.$store.state.service.schoolState},set:function(e){this.$store.state.service.schoolState=e}}}},w=(a("0811"),a("2877")),k=Object(w.a)(D,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Modal",{attrs:{"ok-text":"确定","cancel-text":"取消",title:"学校管理","mask-closable":!1,closable:!0,"footer-hide":!0,width:"80%"},on:{"on-visible-change":e.handleEvents},model:{value:e.schoolState,callback:function(t){e.schoolState=t},expression:"schoolState"}},[a("div",{staticClass:"school-manage"},[a("div",{staticClass:"school-manage-left"},[a("div",{staticClass:"manege-left-row select-box"},[a("Select",{staticClass:"select-active",staticStyle:{width:"130px","margin-right":"10px"},attrs:{disabled:!0,placeholder:"请选择城市"},on:{"on-change":e.handleGetDistrict},model:{value:e.schoolCode,callback:function(t){e.schoolCode=t},expression:"schoolCode"}},e._l(e.cityList,(function(t){return a("Option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.name))])})),1),e._v(" "),a("Select",{staticStyle:{width:"130px","margin-right":"10px"},attrs:{placeholder:"请选择地区"},on:{"on-change":e.handleDistrict},model:{value:e.districtId,callback:function(t){e.districtId=t},expression:"districtId"}},e._l(e.districtList,(function(t){return a("Option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.name))])})),1),e._v(" "),a("Select",{staticStyle:{width:"130px"},attrs:{placeholder:"年部"},model:{value:e.level,callback:function(t){e.level=t},expression:"level"}},e._l(e.levelList,(function(t){return a("Option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.name))])})),1),e._v(" "),a("div",{staticClass:"select-icon"},[e._v("*")])],1),e._v(" "),a("div",{staticClass:"manege-left-row"},[a("Input",{staticStyle:{width:"200px","margin-right":"20px"},attrs:{placeholder:"请选择学校"},on:{"on-enter":function(t){return e.handleSearch()}},model:{value:e.school,callback:function(t){e.school=t},expression:"school"}}),e._v(" "),a("Button",{attrs:{type:"primary"},on:{click:function(t){return e.handleSearch()}}},[e._v("搜索")])],1),e._v(" "),a("div",{staticClass:"schoolList-box"},[a("Table",{ref:"selection",attrs:{"no-data-text":"请根据“城市、区/县、年部”筛选或按“关键词”查找学校”",columns:e.columns,height:"400",data:e.schoolList},on:{"on-select":e.handleSelect,"on-select-cancel":e.handleCancel,"on-select-all-cancel":e.handleCancleAll,"on-select-all":e.handleSelectAll}}),e._v(" "),a("div",{staticClass:"schoolList-total"},[e._v("共筛选出 "),a("span",{staticStyle:{color:"#2d8cf0"}},[e._v(e._s(e.total))]),e._v(" 条记录")]),e._v(" "),a("div",{staticStyle:{"margin-top":"20px","text-align":"center"}},[a("Page",{attrs:{total:e.total,"show-sizer":"","page-size-opts":[10,20,40]},on:{"on-page-size-change":e.handleSizeChange,"on-change":e.handleSearch}})],1)],1)]),e._v(" "),a("div",{staticClass:"school-manage-right"},[a("div",{staticStyle:{padding:"10px"}},[a("p",{staticStyle:{"font-size":"14px"}},[e._v("已选 "),a("span",{staticStyle:{color:"#2d8cf0"}},[e._v(e._s(e.selectList.length))]),e._v(" 个学校\n          "),a("Poptip",{staticStyle:{"margin-left":"120px"},attrs:{confirm:"",transfer:"",title:"您确定要清除已选学校吗？"},on:{"on-ok":e.clearAll}},[a("span",{staticStyle:{color:"deepskyblue",cursor:"pointer"}},[e._v("清除全部")])])],1)]),e._v(" "),a("div",{staticClass:"mess"},e._l(e.selectList,(function(t,r){return a("div",{key:r,staticClass:"target-list-item"},[a("span",{staticClass:"ivu-tag-text"},[e._v(e._s(t.name))]),e._v(" "),a("Icon",{staticStyle:{color:"#979797","margin-left":"2px"},attrs:{type:"md-close"},on:{click:function(a){return e.handleClear(t,r)}}})],1)})),0)])]),e._v(" "),a("div",{staticStyle:{"text-align":"center"}},[a("Button",{staticStyle:{"margin-right":"20px"},on:{click:e.handleManageCancle}},[e._v("取消")]),e._v(" "),a("Button",{attrs:{type:"primary"},on:{click:e.handleManageOk}},[e._v("确定")])],1)])}),[],!1,null,"44507cc2",null).exports,_=a("7618");function S(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function T(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?S(Object(a),!0).forEach((function(t){Object(r.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):S(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var I={name:"serverCenter",props:["propSchoolCode","propDistrictId","propServerId"],data:function(){return{cityId:"",serviceAreaName:"",serviceCenter:"",serviceCenterName:"",cityList:[],districtList:[],serviceCenterList:[],schoolCode:this.propSchoolCode,districtId:this.propDistrictId,serverId:"",bindServerId:this.propServerId,canLoad:!0}},computed:{serviceState:{get:function(){return this.$store.state.service.serviceState},set:function(e){this.$store.state.service.serviceState=e}}},methods:{handleEvents:function(e){e?(this.schoolCode=this.propSchoolCode,this.districtId=this.propDistrictId,this.bindServerId=this.propServerId,this.canLoad=!0,this.getCityList()):this.canLoad=!1},handleChoose:function(){var e,t=this;(e={id:this.bindServerId},f.request({url:"/SPLAT/baseData/bindEmpServiceCenter",method:"post",data:e})).then((function(e){!0===e.rlt&&(t.$emit("handleBindSchoolCode",t.schoolCode),t.serviceSite="".concat(t.serviceAreaName,"-").concat(t.serviceCenterName),t.$emit("handleChoose",t.serviceSite),t.$emit("handleEimtSchoolList",t.bindServerId),t.$emit("handleDistrict",t.districtId),t.$emit("handleServer",t.serverId),t.$store.commit("service/HANDLE_SERVICECENTER",!1))})).catch((function(e){t.$Message.warning({content:"绑定服务中心失败:"+e.message,duration:5})}))},handleCancle:function(){this.schoolCode="",this.districtId="",this.bindServerId="",this.canLoad=!1},getCityList:function(){var e=this;this.canLoad&&v().then((function(t){!0===t.rlt&&t.data&&(e.cityList=t.data,e.schoolCode?e.cityId=t.data.find((function(t){return t.id===e.schoolCode})).cityId:(e.cityId=t.data[0].cityId,e.schoolCode=t.data[0].id),e.handleGetDistrict(e.cityId,!0))})).catch((function(t){e.$Message.warning({content:"获取城市失败:"+t.message,duration:5})}))},handleGetDistrict:function(e,t){var a=this;if(this.canLoad){var r;if(t)r=e;else{var n=this.cityList.find((function(t){return t.id===e}));r=n&&n.cityId,this.cityId=r}C({cityId:r}).then((function(e){if(!0===e.rlt&&e.data){if(e.data.length>0){a.districtList=e.data;var t=e.data.find((function(e){return e.id===a.districtId}));a.serviceAreaName=t&&t.name,t||(a.districtId=e.data[0].id,a.serviceAreaName=e.data[0].name),a.getServiceCenter({schoolCode:a.schoolCode,districtId:a.districtId})}else a.serviceAreaName="",a.serviceCenterName="",a.serviceCenterList=[];a.districtList=e.data}})).catch((function(e){a.$Message.warning({content:"获取地区失败:"+e.message,duration:5})}))}},getServiceCenter:function(e){var t=this;if(this.canLoad){var a,r;if("object"===Object(_.a)(e))a=e;else{var n=this.districtList.find((function(t){return t.id===e}));this.serviceAreaName=n.name,this.serverId=n.schoolId,a={schoolCode:this.schoolCode,districtId:e}}(r=T(T({},a),{},{disable:0}),f.request({url:"/MASTER-BD/bd-web/serviceCenter/list",method:"get",params:r})).then((function(e){if(!0===e.rlt&&e.data){if(e.data.length>0){var a=e.data.find((function(e){return e.id===t.bindServerId}));a?(t.serverId=a.schoolId,t.serviceCenterName=a.name):(t.bindServerId=e.data[0].id,t.serverId=e.data[0].schoolId,t.serviceCenterName=e.data[0]&&e.data[0].name)}else t.serverId="",t.bindServerId="",t.serviceCenterName="";t.serviceCenterList=e.data}})).catch((function(e){t.$Message.warning({content:"获取服务中心失败:"+e.message,duration:5})}))}},handleServiceCenter:function(e){if(this.canLoad){var t=this.serviceCenterList.find((function(t){return t.id===e}));this.serverId=t&&t.schoolId,this.bindServerId=e,this.serviceCenterName=t&&t.name}}}},L=(a("9b61"),Object(w.a)(I,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Modal",{staticClass:"server-wrapper",attrs:{"ok-text":"确定","cancel-text":"取消",title:"选择服务中心","mask-closable":!1,closable:!0,width:"700"},on:{"on-ok":e.handleChoose,"on-cancel":e.handleCancle,"on-visible-change":e.handleEvents},model:{value:e.serviceState,callback:function(t){e.serviceState=t},expression:"serviceState"}},[a("div",{staticClass:"select-box",staticStyle:{height:"100px"}},[a("Select",{staticClass:"select-active",staticStyle:{width:"130px","margin-right":"10px"},attrs:{placeholder:"请选择城市"},on:{"on-change":e.handleGetDistrict},model:{value:e.schoolCode,callback:function(t){e.schoolCode=t},expression:"schoolCode"}},e._l(e.cityList,(function(t){return a("Option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.name))])})),1),e._v(" "),a("Select",{staticStyle:{width:"130px","margin-right":"10px"},attrs:{placeholder:"请选择地区"},on:{"on-change":e.getServiceCenter},model:{value:e.districtId,callback:function(t){e.districtId=t},expression:"districtId"}},e._l(e.districtList,(function(t){return a("Option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.name))])})),1),e._v(" "),a("Select",{staticStyle:{width:"130px"},attrs:{placeholder:"请选择服务中心"},on:{"on-change":e.handleServiceCenter},model:{value:e.bindServerId,callback:function(t){e.bindServerId=t},expression:"bindServerId"}},e._l(e.serviceCenterList,(function(t){return a("Option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.name))])})),1),e._v(" "),a("div",{staticClass:"select-icon"},[e._v("*")])],1)])}),[],!1,null,"6bd9ffc5",null).exports),x={name:"index",props:{classList:Array},data:function(){return{columnsList:[{title:"班级名称",key:"name",width:"200",align:"center"},{title:"授课类型",key:"classType",align:"center",render:function(e,t){var a="";switch(t.row.classType){case 1:a="在线";break;case 2:a="双师";break;case 4:a="面授"}return e("span",{},a)}},{title:"年份",key:"year",align:"center"},{title:"学期",key:"termName",align:"center"},{title:"年级",key:"gradeName",align:"center"},{title:"学科",key:"subjectNames",align:"center"},{title:"开课日期",key:"startDate",align:"center",render:function(e,t){return e("span",{},t.row.startDate.slice(0,11))}},{title:"结束日期",key:"endDate",align:"center",render:function(e,t){return e("span",{},t.row.endDate.slice(0,11))}},{title:"总金额",key:"price",align:"center"},{title:"教师",key:"teacherNames",align:"center"},{title:"教室",key:"classroomName",align:"center"}]}}},N=Object(w.a)(x,(function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"classList-container"},[t("Table",{ref:"selection",attrs:{"no-data-text":"暂无数据",columns:this.columnsList,height:"325",data:this.classList}})],1)}),[],!1,null,null,null).exports;a("6762"),a("2fdb");function O(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function j(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?O(Object(a),!0).forEach((function(t){Object(r.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):O(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var M={name:"index",props:["schoolData"],data:function(){return{schoolList:[]}},methods:{handleEvents:function(e){var t,a=this;e&&(t=this.schoolData.params,f.request({url:"/SPLAT/schoolGrade/querySchoolGradeNums",method:"post",data:t})).then((function(e){if(!0===e.rlt){var t=e.data.schoolGradeNumDtoList;t.forEach((function(e){e.showMark=!1,e.gradeNumber=e.gradeNumber?e.gradeNumber:""})),a.schoolList=t}})).catch((function(e){a.$Message.error(e.message)}))},handleSubmitSchoolNum:function(){var e=this,t=!0;(this.schoolList.forEach((function(e){e.gradeNumber>=1||(e.showMark=!0,t=!1)})),t)&&function(e){return f.request({url:"/SPLAT/schoolGrade/saveSchoolGradeNums",method:"post",data:e})}(j(j({},this.schoolData.params),{},{gradeTypeName:this.schoolData.levelName,schoolName:this.schoolData.name,schoolGradeNumDtoList:this.schoolList})).then((function(t){!0===t.rlt&&(e.$Message.success("保存成功"),e.$store.state.service.schoolEditState=!1,e.schoolData.checkAllGroupIds.length>0&&e.schoolData.checkAllGroupIds.includes(e.schoolData.params.schoolId)&&e.$emit("resetStaticies"))})).catch((function(t){e.$Message.error(t.message)}))},handleCancle:function(){this.$store.state.service.schoolEditState=!1},handleRule:function(e){e.showMark&&e.gradeNumber>=0&&(e.showMark=!1)}},computed:{schoolEditState:{get:function(){return this.$store.state.service.schoolEditState},set:function(e){this.$store.state.service.schoolEditState=e}},total:function(){return this.schoolList.map((function(e){return e.gradeNumber})).reduce((function(e,t){return Number(e)+Number(t)}),0)}}};a("cc55");function $(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function R(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?$(Object(a),!0).forEach((function(t){Object(r.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):$(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var P={name:"Index",components:{schoolManage:k,classList:N,serverCenter:L,schoolEdit:Object(w.a)(M,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Modal",{staticClass:"server-wrapper",attrs:{title:"编辑学校人数","mask-closable":!1,closable:!0,width:"420","footer-hide":!0},on:{"on-visible-change":e.handleEvents},model:{value:e.schoolEditState,callback:function(t){e.schoolEditState=t},expression:"schoolEditState"}},[a("div",{staticClass:"school-edit-container"},[a("div",{staticStyle:{"margin-bottom":"20px"}},[a("span",{staticStyle:{"margin-right":"80px"}},[e._v("学校："+e._s(e.schoolData.name))]),e._v(" "),a("span",[e._v("年部："+e._s(e.schoolData.levelName))])]),e._v(" "),a("Form",{ref:"schoolEdit",attrs:{"label-position":"left"}},[e._l(e.schoolList,(function(t,r){return a("Row",{key:r,staticClass:"row grade-item",attrs:{type:"flex"}},[a("Col",{staticStyle:{width:"280px"}},[a("FormItem",{class:{"item-error":t.showMark},attrs:{"label-width":100,label:t.gradeName}},[a("Input",{attrs:{type:"number",width:"180",placeholder:"请输入"},on:{"on-change":function(a){return e.handleRule(t)}},model:{value:t.gradeNumber,callback:function(a){e.$set(t,"gradeNumber",a)},expression:"item.gradeNumber"}}),e._v(" "),a("span",{staticClass:"error-text"},[e._v("请正确填写数量")]),e._v(" "),a("div",{staticClass:"select-icon"},[e._v("*")])],1)],1)],1)})),e._v(" "),a("Row",{staticClass:"row grade-item",attrs:{type:"flex"}},[a("Col",{staticStyle:{width:"280px","margin-bottom":"20px"}},[a("FormItem",{attrs:{"label-width":100,label:"学校总人数"}},[a("Input",{attrs:{type:"text",disabled:"",width:"180"},model:{value:e.total,callback:function(t){e.total=t},expression:"total"}})],1)],1)],1)],2),e._v(" "),a("Row",{staticStyle:{"text-align":"right","padding-right":"30px"}},[a("Button",{staticStyle:{"margin-right":"20px"},attrs:{type:"primary"},on:{click:e.handleSubmitSchoolNum}},[e._v("提交")]),e._v(" "),a("Button",{on:{click:e.handleCancle}},[e._v("取消")])],1)],1)])}),[],!1,null,null,null).exports},data:function(){var e=this;return{serviceSite:"",serviceSiteMark:!1,schoolState:!1,deptId:"",year:2019,term:"2",gradeId:"$",subjectId:"$",classType:"$",service:"",yearList:[],termList:[],subjectList:[],classTypes:[],gradeIdAll:"",subjectIdAll:"",gradeList:[],columnsList:[{title:"学员编号",key:"card",align:"center"},{title:"姓名",key:"realname",align:"center"},{title:"性别",key:"address",align:"center",render:function(e,t){return e("span",{},1===t.row.sex?"男":"女")}},{title:"年级",key:"grName",align:"center"},{title:"在读学校",key:"readingSchoolName",width:200,align:"center"},{title:"在读班级",key:"readNumber",align:"center",render:function(t,a){return t("div",{style:{color:a.row.readNumber>0?"#4DA2FF":"",cursor:"pointer"},on:{click:function(){a.row.readNumber&&e.showClass(a.row.readList)}}},a.row.readNumber>0?a.row.readNumber:"--")}},{title:"在线班级",key:"onlineNumber",align:"center",render:function(t,a){return t("div",{style:{color:a.row.onlineNumber>0?"#4DA2FF":"",cursor:"pointer"},on:{click:function(){a.row.onlineNumber&&e.showClass(a.row.onlineList)}}},a.row.onlineNumber>0?a.row.onlineNumber:"--")}},{title:"面授班级",key:"offlineNumber",align:"center",render:function(t,a){return t("div",{style:{color:a.row.offlineNumber>0?"#4DA2FF":"",cursor:"pointer"},on:{click:function(){a.row.offlineNumber&&e.showClass(a.row.offlineList)}}},a.row.offlineNumber>0?a.row.offlineNumber:"--")}},{title:"双师班级",key:"doubleNumber",align:"center",render:function(t,a){return t("div",{style:{color:a.row.doubleNumber>0?"#4DA2FF":"",cursor:"pointer"},on:{click:function(){a.row.doubleNumber&&e.showClass(a.row.doubleList)}}},a.row.doubleNumber>0?a.row.doubleNumber:"--")}}],detailList:[],classList:[],showClassState:!1,indeterminate:!1,checkAll:!1,checkAllGroup:[],checkAllGroupIds:[],checkAllGroupList:[],selectList:[],level:"",levelList:[],checkboxLen:0,checkLen:0,statisticsMark:!1,registerNum:"-1",onlineReaderNum:"-1",faceNum:"-1",teachNum:"-1",onlineNum:"-1",serverCenterNum:"-1",statisticsTxt:"",current:1,size:10,uids:[],handleFunction:"",pageTotal:0,registerMark:!1,onlineReaderNumMark:!1,faceNumMark:!1,teachNumMark:!1,onlineNumMark:!1,serverCenterNumMark:!1,schoolCode:"",districtId:"",serverId:"",bindServerId:"",schoolData:{},totalNumber:"-1",coverRate:"-1"}},mounted:function(){this.getEmpServiceCenter(),this.handleGetGrade();var e=(new Date).getFullYear();this.year=e},watch:{registerNum:function(){this.registerNum>=0&&this.totalNumber>0?((this.registerNum/this.totalNumber).toFixed(2)>1&&this.$Message.warning({content:"覆盖率=选定年份年级下，注册学员数/学校的人数，请检查学校人数信息是否正确。",duration:5}),this.coverRate=this.registerNum/this.totalNumber>0?(this.registerNum/this.totalNumber*100).toFixed(2):100*(this.registerNum/this.totalNumber).toFixed(2)):this.coverRate="-1"},totalNumber:function(){this.registerNum>=0&&this.totalNumber>0?((this.registerNum/this.totalNumber).toFixed(2)>1&&this.$Message.warning({content:"覆盖率=选定年份年级下，注册学员数/学校的人数，请检查学校人数信息是否正确。",duration:5}),this.coverRate=this.registerNum/this.totalNumber>0?(this.registerNum/this.totalNumber*100).toFixed(2):100*(this.registerNum/this.totalNumber).toFixed(2)):this.coverRate="-1"}},computed:{inversionRate:function(){return this.onlineReaderNum>=0&&this.registerNum>0?this.onlineReaderNum/this.registerNum>0?(this.onlineReaderNum/this.registerNum*100).toFixed(2):100*(this.onlineReaderNum/this.registerNum).toFixed(2):"-1"},coverRateMark:function(){return this.registerNum>=0&&this.totalNumber>0},inversionRateMark:function(){return this.onlineReaderNum>=0&&this.registerNum>0},matchNum:function(){return this.faceNum>=0&&this.teachNum>=0&&this.onlineNum>=0&&this.onlineReaderNum>0?((this.faceNum+this.teachNum+this.onlineNum)/this.onlineReaderNum).toFixed(2):"-1"},matchNumMark:function(){return this.faceNum>=0&&this.teachNum>=0&&this.onlineNum>=0&&this.onlineReaderNum>0}},methods:{getEmpServiceCenter:function(){var e,t=this;f.request({url:"/SPLAT/baseData/getEmpServiceCenter",method:"get",params:e}).then((function(e){!0===e.rlt&&e.data&&(t.serviceSiteMark=!0,t.deptId=e.data&&e.data.id,t.schoolCode=e.data&&e.data.cityCode,t.districtId=e.data&&e.data.districtId,t.serverId=e.data&&e.data.schoolId,t.bindServerId=e.data&&e.data.id,t.serviceSite="".concat(e.data&&e.data.districtName,"-").concat(e.data&&e.data.name),t.handleSchoolBackList())}))},handleGetYear:function(){var e=this;return new Promise((function(t,a){var r;f.request({url:"/MASTER-BD/bd-web/year/list",method:"get",params:r}).then((function(a){!0===a.rlt&&a.data&&(e.yearList=a.data,t())}))}))},handleGetTerm:function(){var e=this;return new Promise((function(t,a){var r;(r={schoolCode:e.schoolCode,termType:1,status:0},f.request({url:"/MASTER-BD/bd-web/term/list",method:"get",params:r})).then((function(a){!0===a.rlt&&a.data&&(e.termList=a.data,t())}))}))},handleGetGrade:function(e){var t=this;b({schoolCode:e,status:0}).then((function(e){!0===e.rlt&&e.data&&(t.levelList=e.data)}))},handleGetClassTypes:function(){var e,t=this;f.request({url:"/course/v1/baseDate/queryClassType",method:"get",params:e}).then((function(e){if(!0===e.rlt&&e.data){var a=e.data;a.unshift({id:"$",name:"全部"}),t.classTypes=a}})).catch((function(e){t.$Message.warning({content:"获取授课类型失败:"+e.message,duration:5})}))},handleGetGradeList:function(){var e=this;return new Promise((function(t,a){var r;(r={cityCode:e.schoolCode,empNo:e.$store.state.user.userInfo.id,gradeTypeId:e.level},f.request({url:"/SPLAT/baseData/queryGradeByGradeType",method:"get",params:r})).then((function(a){if(!0===a.rlt&&a.data){var r=a.data,n=[];r.forEach((function(e){n.push(e.standardId)})),e.gradeIdAll=n,r.unshift({standardId:"$",name:"全部"}),e.gradeList=r,t()}}))}))},handleGetSubjectList:function(){var e=this;return new Promise((function(t,a){var r;(r={schoolCode:e.schoolCode,status:0,gradeTypeId:e.level},f.request({url:"/MASTER-BD/bd-web/subject/list",method:"get",params:r})).then((function(a){if(!0===a.rlt&&a.data){var r=a.data,n=[];r.forEach((function(e){n.push(e.standardId)})),e.subjectIdAll=n,r.unshift({standardId:"$",name:"全部"}),e.subjectList=r,t()}}))}))},handleSchoolListNum:function(){var e=this;return new Promise((function(t,a){(function(e){return f.request({url:"/SPLAT/schoolGrade/querySchoolGradeNumsBySchoolList",method:"post",data:e})})({empNo:e.$store.state.user.userInfo.id,cityCode:e.schoolCode,gradeTypeId:e.level,schoolIdList:e.checkAllGroupIds}).then((function(a){!0===a.rlt&&a.data&&(e.totalNumber=a.data.map((function(e){return e.totalNumber})).reduce((function(e,t){return e+t}),0),e.handleGetReadingCount(),t())}))}))},handleSchoolBackList:function(e){var t=this;e&&(this.deptId=e,this.bindServerId=e),this.selectList=[],y({schoolCode:this.schoolCode,deptId:this.deptId}).then((function(e){if(!0===e.rlt&&e.data){var a=[],r=[];e.data.forEach((function(e){a.push(e.level)})),(a=new Set(a)).forEach((function(a){var n={},i=[];e.data.forEach((function(e){e.level===a&&i.push(e)})),n.list=i,n.level=a,n.name=t.levelList.find((function(e){return e.id===a})).name,r.push(n)})),t.resetStaticies(),t.resetCheckBox(),t.selectList=r}})).catch((function(e){t.$Message.warning({content:"获取学校列表失败:"+e.message,duration:5})}))},resetCheckBox:function(){this.checkboxLen=0,this.checkAllGroupIds=[],this.checkAllGroupList=[],this.checkAll=!1,this.checkAllGroup=[],this.checkLen=0},handleScan:function(){var e=this;this.statisticsMark=!0,this.year=2019,this.term="2",this.gradeId="$",this.classType="$",this.handleLoading(),this.resetStaticies();var t=this.handleGetYear(),a=this.handleGetTerm(),r=this.handleGetGradeList(),n=this.handleGetSubjectList();this.handleSchoolListNum(),this.handleGetClassTypes(),Promise.all([t,a,r,n]).then((function(t){e.handleStatisticsAll(),e.handleGetReadingCount()}))},resetStaticies:function(){this.registerNum=-1,this.onlineReaderNum=-1,this.faceNum=-1,this.teachNum=-1,this.onlineNum=-1,this.serverCenterNum=-1,this.detailList=[],this.pageTotal=0,this.current=1,this.size=10},handleLoading:function(){this.registerMark=!0,this.onlineReaderNumMark=!0,this.faceNumMark=!0,this.teachNumMark=!0,this.onlineNumMark=!0,this.serverCenterNumMark=!0},handleSearch:function(){this.resetStaticies(),this.handleStatisticsAll(),this.handleLoading(),this.handleSchoolListNum()},handleChoose:function(e){this.serviceSite=e,this.serviceSiteMark=!0},handleDistrict:function(e){this.districtId=e},handleServer:function(e){this.serverId=e},handleBindSchoolCode:function(e){this.schoolCode=e},handleSchoolNum:function(e,t){var a=R(R({},e),{},{levelName:t}),r={empNo:this.$store.state.user.userInfo.id,cityCode:this.schoolCode,gradeTypeId:this.level,schoolId:e.schoolId};a.params=r,a.checkAllGroupIds=this.checkAllGroupIds,this.schoolData=a,this.$store.state.service.schoolEditState=!0},handleService:function(){this.$store.commit("service/HANDLE_SERVICECENTER",!0)},handleSchoolManage:function(){this.serviceSiteMark?this.$store.commit("service/HANDLE_SCHOOLMANAGE",!0):this.$Message.info("请先绑定服务中心")},showClass:function(e){this.showClassState=!0,this.handleGetfindClassByIds(e)},handleStatisticsAll:function(){this.handleStatisticsByConditions(1),this.handleStatisticsByConditions(2),this.handleStatisticsByConditions(4),this.handleGetCount(),this.handleGetCount(this.serverId)},handleStatisticsByConditions:function(e){var t,a=this,r=this.handleGradeId(),n=this.handleClassType(),i={cityCode:this.schoolCode,orgCode:this.schoolCode,year:this.year,termId:this.term,gradeIds:this.gradeIdAll,schoolIds:this.checkAllGroupIds,schoolGradeIds:r,classType:String(e),classTypes:n};"$"!==this.subjectId&&(i.subjectId=String(this.subjectId)),(t=i,f.request({url:"/SPLAT/register/queryStatisticsByConditions?".concat(Math.random()),method:"post",data:t})).then((function(t){!0===t.rlt&&(1===e?(a.onlineNum=t.data,a.onlineNumMark=!1):2===e?(a.teachNum=t.data,a.teachNumMark=!1):(a.faceNum=t.data,a.faceNumMark=!1))})).catch((function(e){a.$Message.warning({content:"获取人次数据失败:"+e.message,duration:5})}))},handleGetCount:function(e){var t,a=this,r=this.handleClassType(),n=this.handleGradeId(),i={cityCode:this.schoolCode,orgCode:this.schoolCode,year:this.year,termId:this.term,gradeIds:this.gradeIdAll,schoolIds:this.checkAllGroupIds,classTypes:r,schoolGradeIds:n,serviceCenterId:e||""};"$"!==this.subjectId&&(i.subjectId=String(this.subjectId)),(t=i,f.request({url:"/SPLAT/register/queryCountByConditions?".concat(Math.random()),method:"post",data:t})).then((function(t){!0===t.rlt&&(e?(a.serverCenterNum=t.data,a.serverCenterNumMark=!1):(a.onlineReaderNum=t.data,a.onlineReaderNumMark=!1))})).catch((function(e){a.$Message.warning({content:"获取在读数据失败:"+e.message,duration:5})}))},handleGetReadingCount:function(){var e,t=this,a={year:this.year,schoolIds:this.checkAllGroupIds,gradeType:this.level,loginCity:this.schoolCode,cityCode:this.schoolCode};"$"!==this.gradeId&&(a.gradeId=Number(this.gradeId)),(e=a,f.request({url:"/SPLAT/student/queryReadingCount",method:"post",data:e})).then((function(e){!0===e.rlt&&(t.registerMark=!1,t.registerNum=e.data)})).catch((function(e){t.$Message.warning({content:"获取注册学员数据失败:"+e.message,duration:5})}))},handleRegister:function(e){var t=this;if(0!==this.registerNum){e&&(this.initPagePayloads(),this.pageTotal=this.registerNum,this.statisticsTxt="注册学员",this.handleFunction=this.handleRegister),console.log(this.size,"注册学员");var a={year:this.year,cityCode:this.schoolCode,schoolIds:this.checkAllGroupIds,gradeType:this.level,loginCity:this.schoolCode,current:this.current,size:this.size};"$"!==this.gradeId&&(a.gradeId=Number(this.gradeId));var r,n=[];(r=a,f.request({url:"/SPLAT/student/queryReading",method:"post",data:r})).then((function(e){!0===e.rlt&&(t.detailList=e.data,e.data.forEach((function(e){return n.push(e.uid)})),t.uids=n,t.handleGetUidsCountByConditions(t.detailList))})).catch((function(e){t.$Message.warning({content:"获取详情失败:"+e.message,duration:5})}))}},handleonlineReader:function(e){var t=this;if(0!==this.onlineReaderNum){e&&(this.initPagePayloads(),this.handleFunction=this.handleonlineReader),this.pageTotal=this.onlineReaderNum,this.statisticsTxt="在读学员";var a=this.handleClassType(),r=this.handleGradeId(),n={cityCode:this.schoolCode,orgCode:this.schoolCode,year:this.year,termId:this.term,classTypes:a,gradeIds:this.gradeIdAll,schoolIds:this.checkAllGroupIds,schoolGradeIds:r,pageNo:this.current,pageSize:this.size};"$"!==this.subjectId&&(n.subjectId=String(this.subjectId)),g(n).then((function(e){!0===e.rlt&&(t.uids=e.data,t.handleGetUidsCountByConditions())})).catch((function(e){t.$Message.warning({content:"获取详情失败:"+e.message,duration:5})}))}},handleGetUidsCountByConditions:function(e){var t,a=this,r=this.handleGradeId(),n={cityCode:this.schoolCode,orgCode:this.schoolCode,year:this.year,termId:this.term,gradeIds:this.gradeIdAll,schoolIds:this.checkAllGroupIds,schoolGradeIds:r,uids:this.uids,serviceCenterId:this.serverId};"$"!==this.subjectId&&(n.subjectId=String(this.subjectId)),(t=n,f.request({url:"/SPLAT/register/queryClassCountByUids",method:"post",data:t})).then((function(t){!0===t.rlt&&(e?a.detailList=e.map((function(e,a){var r={};return t.data.forEach((function(t){Number(e.uid)===Number(t.uid)&&(r=Object.assign({},e,t))})),r})):(a.detailList=t.data,a.handleGetListBasicUsers()))})).catch((function(e){a.$Message.warning({content:"获取统计人数失败:"+e.message,duration:5})}))},handleGetListBasicUsers:function(){var e,t=this,a={cityCode:this.schoolCode,uids:this.uids,loginCity:this.schoolCode,year:this.year};(e=a,f.request({url:"/SPLAT/student/listBasicUsers",method:"post",data:e})).then((function(e){!0===e.rlt&&e.data&&(t.detailList=t.detailList.map((function(t,a){var r={};return e.data.forEach((function(e){Number(t.uid)===Number(e.uid)&&(r=Object.assign({},t,e))})),r})))})).catch((function(e){t.$Message.warning({content:"获取学员基本信息失败:"+e.message,duration:5})}))},handleServerCenter:function(e){var t=this;if(0!==this.serverCenterNum){e&&(this.statisticsTxt="服务中心在读学员",this.pageTotal=this.serverCenterNum,this.initPagePayloads(),this.handleFunction=this.handleServerCenter);var a=this.handleClassType(),r=this.handleGradeId(),n={cityCode:this.schoolCode,orgCode:this.schoolCode,year:this.year,termId:this.term,classTypes:a,gradeIds:this.gradeIdAll,schoolIds:this.checkAllGroupIds,schoolGradeIds:r,pageNo:this.current,pageSize:this.size,serviceCenterId:this.serverId};"$"!==this.subjectId&&(n.subjectId=String(this.subjectId)),g(n).then((function(e){!0===e.rlt&&(t.uids=e.data,t.handleGetUidsCountByConditions())})).catch((function(e){t.$Message.warning({content:"获取服务中心详情失败:"+e.message,duration:5})}))}},handleGetfindClassByIds:function(e){var t,a=this,r={cityCode:this.schoolCode,ids:e};(t=r,f.request({url:"/SPLAT/clazz/findClassByIds",method:"post",data:t})).then((function(e){(!0===e.rlt||e.data)&&(a.classList=e.data)})).catch((function(e){a.$Message.warning({content:"获取班级详情失败:"+e.message,duration:5})}))},initPagePayloads:function(){this.current=1},handleSizeChange:function(e){this.size=e,console.log(this.size),this.handleFunction&&this.handleFunction()},handleCurrentSearch:function(e){this.current=e,this.handleFunction&&this.handleFunction()},handleCheckAll:function(e){if(this.checkAll=!this.checkAll,this.checkAll){var t=e.list,a=[],r=[];t.forEach((function(e){a.push(e.name),r.push(e.schoolId)})),this.checkAllGroup=a,this.checkAllGroupIds=r,this.checkLen=a.length}else this.checkAllGroup=[],this.checkAllGroupIds=[],this.checkLen=0;this.resetStaticies()},checkGroupChange:function(e){e.length===this.checkboxLen?this.checkAll=!0:this.checkAll=!1,this.checkLen=e.length;var t=[];this.checkAllGroupList.forEach((function(a){e.forEach((function(e){e===a.name&&t.push(a.schoolId)}))})),this.checkAllGroupIds=t,this.resetStaticies()},handleOpenChange:function(e){var t=e[0];if(t){var a=this.selectList.find((function(e){return e.level===t})).list;this.checkboxLen=a.length,this.checkAllGroupList=a}else this.checkboxLen=0,this.checkAllGroupIds=[],this.checkAllGroupList=[];this.statisticsMark=!1,this.checkAll=!1,this.checkAllGroup=[],this.checkLen=0,this.level=t,this.resetStaticies()},handleClassType:function(){var e=this.classType;return e="$"===e?["1","2","4"]:[this.classType]},handleGradeId:function(){return"$"===this.gradeId?this.gradeIdAll:[this.gradeId]},handleCoverRateNotice:function(){0!==this.checkLen&&this.$Message.warning({content:"请编辑学校人数",duration:5})}}},A=(a("331d"),Object(w.a)(P,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"campus-container"},[a("div",{staticClass:"campus-operation"},[a("div",{staticClass:"service-choose service-toggle"},[e.serviceSiteMark?a("div",{staticClass:"service-center"},[e._v(e._s(e.serviceSite))]):a("div",{staticClass:"service-change service-center",on:{click:e.handleService}},[e._v("选择服务中心")]),e._v(" "),a("div",{staticClass:"service-change service-cut",on:{click:e.handleService}},[e._v("切换")]),e._v(" "),a("div",{staticStyle:{clear:"both"}})]),e._v(" "),a("div",{staticClass:"service-choose",staticStyle:{"border-bottom":"1px solid #eee"}},[a("div",{staticClass:"service-center"},[e._v("学校列表")]),e._v(" "),a("div",{staticClass:"service-change service-cut",on:{click:e.handleSchoolManage}},[e._v("学校管理")]),e._v(" "),a("div",{staticStyle:{clear:"both"}})]),e._v(" "),a("div",{staticClass:"service-schools"},[0===e.selectList.length?a("div",{staticClass:"school-empty"},[e._v("请通过“ "),a("span",{staticStyle:{color:"#2d8cf0",cursor:"pointer"},on:{click:e.handleSchoolManage}},[e._v("学校管理")]),e._v(" ”添加学校")]):a("div",{staticClass:"school-list"},[a("Menu",{attrs:{theme:"light",accordion:""},on:{"on-open-change":e.handleOpenChange}},e._l(e.selectList,(function(t,r){return a("Submenu",{key:r,attrs:{name:t.level}},[a("template",{slot:"title"},[e._v("\n              "+e._s(t.name)+"\n            ")]),e._v(" "),a("div",{staticClass:"checkbox-list"},[a("Checkbox",{attrs:{indeterminate:e.indeterminate,value:e.checkAll},nativeOn:{click:function(a){return a.preventDefault(),e.handleCheckAll(t)}}},[e._v("\n                全选\n              ")]),e._v(" "),a("CheckboxGroup",{on:{"on-change":e.checkGroupChange},model:{value:e.checkAllGroup,callback:function(t){e.checkAllGroup=t},expression:"checkAllGroup"}},e._l(t.list,(function(r){return a("div",{key:r.name},[a("Checkbox",{attrs:{label:r.name}}),e._v(" "),a("Icon",{staticStyle:{cursor:"pointer"},attrs:{type:"ios-create-outline",size:"20"},on:{click:function(a){return e.handleSchoolNum(r,t.name)}}})],1)})),0)],1)],2)})),1)],1)]),e._v(" "),a("div",{staticClass:"service-manage"},[a("div",{staticStyle:{float:"left"}},[e._v("已经选择 "),a("span",{staticStyle:{color:"#2d8cf0"}},[e._v(e._s(e.checkLen))]),e._v(" 个学校")]),e._v(" "),a("div",{staticStyle:{float:"right"}},[a("Button",{attrs:{type:"primary",disabled:0===e.checkLen},on:{click:e.handleScan}},[e._v("查看")])],1),e._v(" "),a("div",{staticStyle:{clear:"both"}})])]),e._v(" "),a("div",{staticClass:"campus-wrapper"},[a("div",{staticClass:"campus-cencus"},[a("div",{staticClass:"campus-title"},[e._v("统计汇总")]),e._v(" "),a("div",{staticClass:"campus-box"},[a("Form",[a("Row",{staticClass:"row",attrs:{type:"flex"}},[a("Col",{staticClass:"campus-select",staticStyle:{width:"200px"}},[a("FormItem",{attrs:{"label-width":50,label:"年份"}},[a("Select",{attrs:{placeholder:"年份"},model:{value:e.year,callback:function(t){e.year=t},expression:"year"}},e._l(e.yearList,(function(t){return a("Option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),e._v(" "),a("div",{staticClass:"select-icon"},[e._v("*")])],1),e._v(" "),a("Col",{staticClass:"campus-select",staticStyle:{width:"200px"}},[a("FormItem",{attrs:{"label-width":50,label:"年级"}},[a("Select",{attrs:{placeholder:"年级"},model:{value:e.gradeId,callback:function(t){e.gradeId=t},expression:"gradeId"}},e._l(e.gradeList,(function(t){return a("Option",{key:t.standardId,attrs:{value:t.standardId}},[e._v(e._s(t.name))])})),1)],1)],1),e._v(" "),a("div",{staticClass:"info-txt info-register"},[a("span",[e._v("注册学员")]),e._v(" "),a("Poptip",{staticStyle:{"margin-bottom":"5px"},attrs:{trigger:"hover","word-wrap":"",content:"统计规则：1.账号已完善学校信息；2.学员当前年份在读学校为所选学校。"}},[a("Icon",{staticStyle:{cursor:"pointer","margin-right":"10px"},attrs:{type:"ios-information-circle-outline",size:"20"}})],1),e._v(" "),e.registerNum>=0?a("div",{staticClass:"info-num info-color info-cursor",staticStyle:{"font-size":"24px",height:"32px","line-height":"28px"},on:{click:function(t){return e.handleRegister(!0)}}},[e._v(e._s(e.registerNum))]):a("div",{staticClass:"info-num info-line"},[e.registerMark?a("Spin"):a("div",[a("span",{staticStyle:{"margin-right":"10px","margin-bottom":"3px",height:"4px",width:"24px",background:"#4DA2FF",display:"inline-block"}}),e._v(" "),a("span",{staticStyle:{"margin-bottom":"3px",height:"4px",width:"24px",background:"#4DA2FF",display:"inline-block"}})])],1)],1),e._v(" "),a("div",{staticClass:"list-item"},[a("div",{staticClass:"info-item-txt",staticStyle:{"font-size":"16px"}},[e._v("\n                覆盖率\n                "),a("Poptip",{staticStyle:{margin:"0 0 3px 3px"},attrs:{trigger:"hover","word-wrap":"",content:"统计规则：覆盖率=选定年份年级下，注册学员数/学校的人数。"}},[a("Icon",{staticStyle:{cursor:"pointer"},attrs:{type:"ios-information-circle-outline",size:"16"}})],1),e._v(" "),e.coverRate>=0?a("div",{staticClass:"info-item-num",style:{color:e.coverRate>100?"red":""}},[e._v(e._s(e.coverRate)+"%")]):a("div",{staticClass:"info-item-num"},[e.coverRateMark?a("Spin"):a("div",{staticStyle:{cursor:"pointer"},on:{click:e.handleCoverRateNotice}},[a("span",{staticStyle:{"margin-right":"3px","margin-bottom":"8px",height:"4px",width:"10px",background:"#666",display:"inline-block"}}),e._v(" "),a("span",{staticStyle:{"margin-bottom":"8px",height:"4px",width:"10px",background:"#666",display:"inline-block"}})])],1)],1)])],1),e._v(" "),a("Divider",{staticStyle:{margin:"15px 0"}}),e._v(" "),a("Row",{staticClass:"row",attrs:{type:"flex"}},[a("Col",{staticClass:"campus-select",staticStyle:{width:"200px"}},[a("FormItem",{attrs:{"label-width":50,label:"学期"}},[a("Select",{attrs:{placeholder:"学期"},model:{value:e.term,callback:function(t){e.term=t},expression:"term"}},e._l(e.termList,(function(t){return a("Option",{key:t.schoolId,attrs:{value:t.schoolId}},[e._v(e._s(t.name))])})),1)],1)],1),e._v(" "),a("Col",{staticClass:"campus-select",staticStyle:{width:"200px"}},[a("FormItem",{attrs:{"label-width":50,label:"学科"}},[a("Select",{attrs:{placeholder:"学科"},model:{value:e.subjectId,callback:function(t){e.subjectId=t},expression:"subjectId"}},e._l(e.subjectList,(function(t){return a("Option",{key:t.name,attrs:{value:t.standardId}},[e._v(e._s(t.name))])})),1)],1)],1),e._v(" "),a("div",{staticClass:"info-txt info-register"},[a("span",[e._v("在读学员")]),e._v(" "),a("Poptip",{staticStyle:{"margin-bottom":"5px"},attrs:{trigger:"hover","word-wrap":"",content:"统计规则：1.选定年份、年级、学期、学科下，有报长期班且未退费的学员。（学员为所选学校在读学员）"}},[a("Icon",{staticStyle:{cursor:"pointer","margin-right":"10px"},attrs:{type:"ios-information-circle-outline",size:"20"}})],1),e._v(" "),e.onlineReaderNum>=0?a("div",{staticClass:"info-num info-color info-cursor",staticStyle:{"font-size":"24px",height:"32px","line-height":"28px"},on:{click:function(t){return e.handleonlineReader(!0)}}},[e._v(e._s(e.onlineReaderNum))]):a("div",{staticClass:"info-num info-line"},[e.onlineReaderNumMark?a("Spin"):a("div",[a("span",{staticStyle:{"margin-right":"10px","margin-bottom":"3px",height:"4px",width:"24px",background:"#4DA2FF",display:"inline-block"}}),e._v(" "),a("span",{staticStyle:{"margin-bottom":"3px",height:"4px",width:"24px",background:"#4DA2FF",display:"inline-block"}})])],1)],1),e._v(" "),a("div",{staticClass:"list-item"},[a("div",{staticClass:"info-item-txt",staticStyle:{"font-size":"16px"}},[e._v("\n                转化率\n                "),a("Poptip",{staticStyle:{margin:"0 0 3px 3px"},attrs:{trigger:"hover","word-wrap":"",content:"统计规则：选定年份、年级、学期、学科下，在读学员/注册学员。"}},[a("Icon",{staticStyle:{cursor:"pointer"},attrs:{type:"ios-information-circle-outline",size:"20"}})],1),e._v(" "),e.inversionRate>=0?a("div",{staticClass:"info-item-num"},[e._v(e._s(e.inversionRate)+"%")]):a("div",{staticClass:"info-item-num"},[e.inversionRateMark?a("Spin"):a("div",[a("span",{staticStyle:{"margin-right":"3px","margin-bottom":"8px",height:"4px",width:"10px",background:"#666",display:"inline-block"}}),e._v(" "),a("span",{staticStyle:{"margin-bottom":"8px",height:"4px",width:"10px",background:"#666",display:"inline-block"}})])],1)],1)])],1),e._v(" "),a("div",{staticStyle:{height:"15px"}})],1),e._v(" "),a("div",{staticClass:"info-list"},[a("div",{staticClass:"list-item"},[a("div",{staticClass:"info-item-txt",staticStyle:{"font-size":"16px"}},[e._v("\n              匹配度\n              "),a("Poptip",{attrs:{trigger:"hover","word-wrap":"",content:"统计规则：选定年份、年级、学期、学科下，报面授+双师+在线人次/在读学员人数。"}},[a("Icon",{staticStyle:{cursor:"pointer"},attrs:{type:"ios-information-circle-outline",size:"20"}})],1),e._v(" "),e.matchNum>=0?a("div",{staticClass:"info-item-num info-cursor"},[e._v(e._s(e.matchNum))]):a("div",{staticClass:"info-item-num"},[e.matchNumMark?a("Spin"):a("div",[a("span",{staticClass:"common-line",staticStyle:{background:"rgb(102, 102, 102)"}}),e._v(" "),a("span",{staticClass:"common-line",staticStyle:{background:"rgb(102, 102, 102)"}})])],1)],1)]),e._v(" "),a("div",{staticClass:"list-item"},[a("div",{staticClass:"info-item-txt"},[e._v("\n              面授人次\n              "),a("Poptip",{attrs:{trigger:"hover","word-wrap":"",content:"在读学员中，报名面授班级的报班总量。"}},[a("Icon",{staticStyle:{cursor:"pointer"},attrs:{type:"ios-information-circle-outline",size:"16"}})],1),e._v(" "),e.faceNum>=0?a("div",{staticClass:"info-item-num"},[e._v(e._s(e.faceNum))]):a("div",{staticClass:"info-item-num"},[e.faceNumMark?a("Spin"):a("div",[a("span",{staticClass:"common-line"}),e._v(" "),a("span",{staticClass:"common-line"})])],1)],1)]),e._v(" "),a("div",{staticClass:"list-item"},[a("div",{staticClass:"info-item-txt"},[e._v("\n              双师人次\n              "),a("Poptip",{attrs:{trigger:"hover","word-wrap":"",content:"在读学员中，报名双师班级的报班总量。"}},[a("Icon",{staticStyle:{cursor:"pointer"},attrs:{type:"ios-information-circle-outline",size:"16"}})],1),e._v(" "),e.teachNum>=0?a("div",{staticClass:"info-item-num"},[e._v(e._s(e.teachNum))]):a("div",{staticClass:"info-item-num"},[e.teachNumMark?a("Spin"):a("div",[a("span",{staticClass:"common-line"}),e._v(" "),a("span",{staticClass:"common-line"})])],1)],1)]),e._v(" "),a("div",{staticClass:"list-item"},[a("div",{staticClass:"info-item-txt"},[e._v("\n              在线人次\n              "),a("Poptip",{attrs:{trigger:"hover","word-wrap":"",content:"在读学员中，报名在线班级的报班总量。"}},[a("Icon",{staticStyle:{cursor:"pointer"},attrs:{type:"ios-information-circle-outline",size:"16"}})],1),e._v(" "),e.onlineNum>=0?a("div",{staticClass:"info-item-num"},[e._v(e._s(e.onlineNum))]):a("div",{staticClass:"info-item-num"},[e.onlineNumMark?a("Spin"):a("div",[a("span",{staticClass:"common-line"}),e._v(" "),a("span",{staticClass:"common-line"})])],1)],1)]),e._v(" "),a("div",{staticClass:"info-ing"},[a("div",{staticClass:"info-item-txt",staticStyle:{"font-size":"16px"}},[e._v("\n              服务中心在读学员\n              "),a("Poptip",{attrs:{trigger:"hover","word-wrap":"",content:"选定年份、年级、学期、学科下，在本服务中心下辖教学点上课的学员数量。"}},[a("Icon",{staticStyle:{cursor:"pointer"},attrs:{type:"ios-information-circle-outline",size:"20"}})],1),e._v(" "),e.serverCenterNum>=0?a("div",{staticClass:"info-color info-item-num info-cursor",on:{click:function(t){return e.handleServerCenter(!0)}}},[a("div",[e._v(e._s(e.serverCenterNum))])]):a("div",{staticClass:"info-item-num"},[e.serverCenterNumMark?a("Spin"):a("div",[a("span",{staticClass:"common-line",staticStyle:{background:"#4DA2FF"}}),e._v(" "),a("span",{staticClass:"common-line",staticStyle:{background:"#4DA2FF"}})])],1)],1)]),e._v(" "),a("Button",{staticStyle:{"margin-bottom":"5px",float:"left"},attrs:{type:"primary",disabled:!e.statisticsMark||0===e.checkLen},on:{click:e.handleSearch}},[e._v("刷新数据")]),e._v(" "),a("div",{staticStyle:{clear:"both"}})],1)],1)]),e._v(" "),a("div",{staticClass:"campus-list"},[a("div",{staticClass:"campus-title"},[e._v("学员列表"+e._s(e.statisticsTxt?"-":"")+e._s(e.statisticsTxt))]),e._v(" "),a("div",{staticClass:"table-box"},[a("Table",{attrs:{border:"",columns:e.columnsList,data:e.detailList,"no-data-text":"请点击“注册学员”、“在读学员”或“服务中心在读学员”下的数字查看对应选项下的学员列表"}}),e._v(" "),a("div",{staticClass:"page-box"},[a("Page",{attrs:{total:e.pageTotal,"show-sizer":"","page-size-opts":[10,20,40]},on:{"on-page-size-change":e.handleSizeChange,"on-change":e.handleCurrentSearch}})],1)],1)])]),e._v(" "),a("serverCenter",{attrs:{"prop-school-code":e.schoolCode,"prop-district-id":e.districtId,"prop-server-id":e.bindServerId},on:{handleChoose:e.handleChoose,handleEimtSchoolList:e.handleSchoolBackList,handleDistrict:e.handleDistrict,handleServer:e.handleServer,handleBindSchoolCode:e.handleBindSchoolCode}}),e._v(" "),a("schoolManage",{attrs:{"dept-id":e.deptId,"prop-school-code":e.schoolCode,"prop-district-id":e.districtId},on:{handleEimtSchoolList:e.handleSchoolBackList}}),e._v(" "),a("Modal",{attrs:{"ok-text":"确定","cancel-text":"取消",title:"班级列表","mask-closable":!1,closable:!0,width:"80%"},model:{value:e.showClassState,callback:function(t){e.showClassState=t},expression:"showClassState"}},[a("classList",{attrs:{"class-list":e.classList}})],1),e._v(" "),a("schoolEdit",{attrs:{schoolData:e.schoolData},on:{resetStaticies:e.resetStaticies}})],1)}),[],!1,null,null,null));t.default=A.exports},4203:function(e,t,a){},4274:function(e,t,a){"use strict";var r=a("9b89");a.n(r).a},"42bb":function(e,t,a){"use strict";var r=a("d793");a.n(r).a},"54cb":function(e,t,a){},"58f2":function(e,t,a){},"6ab3":function(e,t,a){"use strict";a.r(t);var r=a("6ec6"),n=a("2991"),i={name:"addSubscribeDiagnosis",mixins:[r.a],data:function(){return{studentDetail:{},scoreRecordShow:!1}},components:{SubscribeDiagnosis:n.a},methods:{setStuInfo:function(e){var t=this;this.scoreRecordShow=!1,this.studentDetail=e,setTimeout((function(){t.scoreRecordShow=!0}),50)}}},s=(a("4274"),a("2877")),o=Object(s.a)(i,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{width:"100%",padding:"15px"}},[a("div",{staticClass:"stu-search"},[a("TalStuSearch",{ref:"stuSearch",attrs:{"stu-card":e.queryData.card,"stu-city-code":e.queryData.cityCode,showCrmInfo:!1},on:{stuInfo:e.setStuInfo}})],1),e._v(" "),e.scoreRecordShow?a("div",{staticStyle:{"margin-top":"10px",padding:"10px",background:"#fff"}},[e.scoreRecordShow?a("SubscribeDiagnosis",{attrs:{operateType:1,studentDetail:e.studentDetail},on:{success:function(t){return e.$emit("success")},close:function(t){return e.$emit("close")}}}):e._e()],1):a("div",{staticStyle:{"margin-top":"10px",padding:"20px",background:"#fff","font-size":"13px"}},[e._v("\n    请选择学员\n  ")])])}),[],!1,null,"86a9bdec",null);t.default=o.exports},"6e31":function(e,t,a){"use strict";a.r(t);a("386d"),a("f751"),a("96cf");var r,n,i=a("3b8d"),s=a("2801"),o=a("7014"),c=a("75fc"),l=(a("0d6d"),a("ac6a"),a("cadf"),a("5df3"),a("4f7f"),a("7f7f"),a("0ef6")),u=a("3c8d"),d=a("736c"),m=a("1576"),h={name:"DemandPool",mixins:[l.a,m.a],props:{parentFormData:{type:Object,default:function(){return{}}}},data:function(){var e=this;return{showOpenClassAssessApproval:!1,formData:{enable:!1,checkbox:["year","termId","gradeId","subjectId","classLevel"]},options:[{label:"同年份",value:"year",disabled:!0},{label:"同意向学期",value:"termId",disabled:!0},{label:"同年级",value:"gradeId",disabled:!0},{label:"同意向学科",value:"subjectId",disabled:!0},{label:"同班次级别",value:"classLevel",disabled:!0},{label:"同意向服务中心",value:"serviceCenterId"},{label:"同意向上课时间",value:"classtimeTimeClassify"},{label:"同意向上课时段",value:"classtimeTimePeriods"},{label:"同授课类型",value:"classType"}],columns:[{type:"selection",width:60,align:"center"},{title:"操作",key:"name",align:"center",render:function(t,a){var r=1===a.row.type||1!==a.row.isStart,n=1===a.row.type||1===a.row.isEnd;return t("div",[t("a",{on:{click:function(){e.$emit("checkCuanbanDemand",{id:a.row.id,cityCode:a.row.cityCode,uid:a.row.uid})}}},"查看"),t("br"),r?t("span",{style:{color:"gray"}},"修改"):t("a",{on:{click:function(){e.$emit("updateCuanbanDemand",{id:a.row.id,cityCode:a.row.cityCode,uid:a.row.uid})}}},"修改"),t("br"),n?t("span",{style:{color:"gray"}},"取消"):t("a",{on:{click:function(){e.cancelCuanban.remark="",e.cancelCuanban.id=a.row.id,e.cancelCuanban.showModal=!0}}},"取消")])}},{title:"攒班状态",key:"status",align:"center",render:function(t,a){return t("span",e.cuanbanStatusMap[a.row.status])}},{title:"学员姓名",key:"name",align:"center",render:function(t,a){return t("a",{on:{click:function(){var t={card:a.row.studentCard,cityCode:a.row.cityCode};e.goCustomerDetail(t)}}},a.row.name||"无")}},{title:"联系电话",key:"phone",align:"center",width:120,render:function(e,t){return e(u.TalDecodeText,{props:{uid:t.row.uid,encodeText:t.row.phone,type:"phone"}})}},{title:"接待顾问",key:"receptionAdvisorEmpName",align:"center"},{title:"创建人",key:"creatorName",align:"center",render:function(e,t){return e("span",t.row.creatorName||"用户")}},{title:"创建时间",key:"createDate",align:"center"},{title:"推荐学员",key:"recommendName",align:"center",render:function(t,a){return a.row.recommendCard?t("a",{on:{click:function(){var t={card:a.row.recommendCard,cityCode:a.row.cityCode};e.goCustomerDetail(t)}}},a.row.recommendName||"--"):t("span",a.row.recommendName||"--")}},{title:"攒班年份",key:"year",align:"center"},{title:"意向学期",key:"termName",align:"center"},{title:"年级",key:"gradeName",align:"center"},{title:"意向学科",key:"subjectName",align:"center"},{title:"班次级别",key:"classLevelName",align:"center"},{title:"授课类型",key:"classTypeName",align:"center"},{title:"意向服务中心",key:"serviceCenterName",align:"center"},{title:"意向上课时间",key:"classtimeTimeClassifys",align:"center"},{title:"意向上课时段",key:"classtimeTimePeriods",align:"center"},{title:"意向度",key:"intention",align:"center"},{title:"入学测试成绩",key:"diagnosisScore",align:"center",render:function(e,t){return e("span",1===t.row.diagnosisScore?"符合":"不符合")}},{title:"攒班班级ID",key:"assembleClassId",align:"center"},{title:"攒班班级报名状态",key:"registStatus",align:"center",render:function(t,a){return t("span",e.registStatusMap[a.row.registStatus])}},{title:"攒班班级缴费状态",key:"payStatus",align:"center",render:function(t,a){return t("span",e.payStatusMap[a.row.payStatus])}},{title:"开班失败原因",key:"failureReason",align:"center"}],tableLoading:!1,tableData:[],rowChecked:[],searchData:{totalCount:0,pageSize:10,pageNo:1,isAggregation:0,aggregationField:""},cancelCuanban:{id:"",showModal:!1,remark:"",confirmLoading:!1},classTypeList:[]}},watch:{formData:{deep:!0,handler:function(e){var t="";e.enable&&(t=e.checkbox.join(",")),this.searchData={isAggregation:e.enable?1:0,aggregationField:t},this.search()}}},methods:{confirmCancelCuanban:(n=Object(i.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.cancelCuanban.remark){e.next=3;break}return e.abrupt("return",this.$Message.error({content:"请输入取消攒班原因"}));case 3:return t={assembleClassDemandId:this.cancelCuanban.id,remark:this.cancelCuanban.remark,cityCode:this.parentFormData.cityCode},this.cancelCuanban.confirmLoading=!0,e.next=7,Object(d.i)(t);case 7:this.$Message.success({content:"取消攒班成功"}),this.search(),this.cancelCuanban.showModal=!1,e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),console.log("error",e.t0),this.$Message.error({content:"取消攒班失败:"+e.t0.message,duration:5});case 16:this.cancelCuanban.confirmLoading=!1;case 17:case"end":return e.stop()}}),e,this,[[0,12]])}))),function(){return n.apply(this,arguments)}),confirm:function(){var e=new Set;this.rowChecked.forEach((function(t){return e.add(t.studentCard)})),e.size===this.rowChecked.length?this.notSameTermCheck(this.rowChecked)||this.$emit("submitOpenClassAssessApproval",this.rowChecked):this.$Message.warning({content:"不可重复选择同一个学员",duration:5})},notSameTermCheck:function(e){if(e.length>1){var t=e[0],a=e[e.length-1];if(console.log(t,a),t._sameTag!==a._sameTag)return this.$Message.warning({content:"请选择年份、学期、年期、学科、班次级别相同学员！",duration:5}),!0}},search:(r=Object(i.a)(regeneratorRuntime.mark((function e(){var t,a,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,1!==(t=Object.assign({},this.parentFormData,this.searchData,{startCreateDate:this.parentFormData.startCreateDate?this.parentFormData.startCreateDate+" 00:00:00":"",endCreateDate:this.parentFormData.endCreateDate?this.parentFormData.endCreateDate+" 23:59:59":""})).classType&&t.classType||delete t.serviceCenterId,this.tableLoading=!0,e.next=6,Object(d.u)(t);case 6:return(a=e.sent).records.forEach(function(){var e=Object(i.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:1===t.type||1!==t.isStart?t._disabled=!0:t._disabled=!1,t._sameTag="".concat(t.year,"-").concat(t.termId,"-").concat(t.gradeId,"-").concat(t.subjectId,"-").concat(t.classLevel);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=10,this.setStudentLevel(a.records);case 10:r=e.sent,this.tableData=Object.freeze(r),this.searchData.totalCount=a.totalCount,e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),this.$Message.error({content:"查询需求池失败: ".concat(e.t0.message),duration:5});case 18:this.tableLoading=!1;case 19:case"end":return e.stop()}}),e,this,[[0,15]])}))),function(){return r.apply(this,arguments)}),onSelectionChange:function(e){30===this.rowChecked.length&&this.$Message.warning({content:"最多勾选30个学员",duration:5}),this.notSameTermCheck(e),this.rowChecked=Object(c.a)(e)},changePage:function(e){this.searchData.pageNo=e,this.search()},pageSizeChange:function(e){this.searchData.pageNo=1,this.searchData.pageSize=e,this.search()}}},p=(a("a1d0"),a("2877")),f=Object(p.a)(h,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"flex",staticStyle:{"margin-bottom":"10px"}},[a("i-switch",{attrs:{size:"large"},model:{value:e.formData.enable,callback:function(t){e.$set(e.formData,"enable",t)},expression:"formData.enable"}},[a("span",{attrs:{slot:"open"},slot:"open"},[e._v("开")]),e._v(" "),a("span",{attrs:{slot:"close"},slot:"close"},[e._v("关")])]),e._v(" "),a("span",{staticStyle:{margin:"0 10px","font-size":"16px","font-weight":"bold"}},[e._v("快速聚类")]),e._v(" "),e.formData.enable?[a("CheckboxGroup",{model:{value:e.formData.checkbox,callback:function(t){e.$set(e.formData,"checkbox",t)},expression:"formData.checkbox"}},e._l(e.options,(function(t,r){return a("Checkbox",{key:r,attrs:{label:t.value,disabled:t.disabled}},[e._v(e._s(t.label))])})),1)]:e._e()],2),e._v(" "),a("Table",{ref:"selection",attrs:{border:"",columns:e.columns,data:e.tableData,loading:e.tableLoading},on:{"on-selection-change":e.onSelectionChange}}),e._v(" "),a("div",{staticClass:"flex-page",staticStyle:{margin:"10px"}},[a("Button",{attrs:{disabled:0===e.rowChecked.length},on:{click:e.confirm}},[e._v("提交开班评估")]),e._v(" "),a("Page",{attrs:{total:e.searchData.totalCount,"page-size":e.searchData.pageSize,current:e.searchData.pageNo,"show-elevator":"","show-sizer":"",transfer:"","show-total":""},on:{"update:current":function(t){return e.$set(e.searchData,"pageNo",t)},"on-page-size-change":e.pageSizeChange,"on-change":e.changePage}})],1),e._v(" "),a("Modal",{attrs:{"mask-closable":!1,title:"取消攒班","footer-hide":!0,width:"450px"},model:{value:e.cancelCuanban.showModal,callback:function(t){e.$set(e.cancelCuanban,"showModal",t)},expression:"cancelCuanban.showModal"}},[a("Form",[a("FormItem",{attrs:{required:"",label:"取消原因"}},[a("Input",{staticStyle:{width:"420px"},attrs:{type:"textarea",autosize:{minRows:3,maxRows:10},placeholder:"请输入原因"},model:{value:e.cancelCuanban.remark,callback:function(t){e.$set(e.cancelCuanban,"remark",t)},expression:"cancelCuanban.remark"}})],1)],1),e._v(" "),a("Row",{attrs:{type:"flex",justify:"center",gutter:20}},[a("Col",[a("Button",{attrs:{type:"primary",loading:e.cancelCuanban.confirmLoading},on:{click:e.confirmCancelCuanban}},[e._v("提交")])],1),e._v(" "),a("Col",[a("Button",{attrs:{loading:e.cancelCuanban.confirmLoading},on:{click:function(t){e.cancelCuanban.showModal=!1}}},[e._v("取消")])],1)],1)],1)],1)}),[],!1,null,"706ee80a",null).exports,g=(a("c5f6"),a("867e")),v=a("66df");var y,b,C,D,w,k,_,S,T,I,L,x,N,O,j,M,$={data:function(){return{cityList:[],yearList:[],termList:[],gradeList:[],subjectList:[],serviceCenterList:[],advisorEmpNos:[],classLevelList:[],timeTypeList:[],timeList:[]}},methods:{getTimeList:function(){var e=this;Object(g.m)().then((function(t){e.timeList=Object.freeze(t)})).catch((function(t){e.$Message.error({content:"获取班次级别失败: ".concat(t.message),duration:5})}))},getTimeTypeList:function(){var e=this;Object(g.n)().then((function(t){e.timeTypeList=Object.freeze(t)})).catch((function(t){e.$Message.error({content:"获取班次级别失败: ".concat(t.message),duration:5})}))},queryLevelDegreeList:function(){var e=this,t={schoolCode:this.formData.cityCode,status:0};Object(g.a)(t).then((function(t){e.classLevelList=Object.freeze(t)})).catch((function(t){e.$Message.error({content:"获取班次级别失败: ".concat(t.message),duration:5})}))},getCityList:function(){var e=this;return Object(g.d)().then((function(t){e.cityList=t,e.cityList.length&&(e.formData.cityCode=t[0].id)})).catch((function(t){e.$Message.warning({content:"获取所有城市失败:"+t.message,duration:5})}))},getAdvisorEmpNos:function(e,t){var a=this;t?function(e){return v.a.request({url:"/specialRefund/getEmployeeList",method:"get",params:e})}({cityCode:t,name:isNaN(Number(e))?e:"",empNo:isNaN(Number(e))?"":e}).then((function(e){a.advisorEmpNos=Object.freeze(e)})).catch((function(e){a.$Message.error({content:e.message,duration:5})})):this.$Message.info({content:"请选择城市"})},getServiceCenterList:(w=Object(i.a)(regeneratorRuntime.mark((function e(t,a){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,a){e.next=4;break}return this.$Message.info({content:"请选择城市"}),e.abrupt("return");case 4:return r={cityCode:a,likeName:t},e.next=7,Object(g.j)(r);case 7:n=e.sent,this.serviceCenterList=Object.freeze(n)||[],e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),this.$Message.warning({content:"获取服务中心失败:"+e.t0.message,duration:5});case 14:case"end":return e.stop()}}),e,this,[[0,11]])}))),function(e,t){return w.apply(this,arguments)}),getSubjectList:(D=Object(i.a)(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={cityCode:this.formData.cityCode},e.next=4,Object(g.k)(t);case 4:a=e.sent,this.subjectList=Object.freeze(a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),this.$Message.warning({content:"获取学科失败:"+e.t0.message,duration:5});case 11:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(){return D.apply(this,arguments)}),getGradeList:(C=Object(i.a)(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={cityCode:this.formData.cityCode},e.next=4,Object(g.g)(t);case 4:a=e.sent,this.gradeList=Object.freeze(a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),this.$Message.warning({content:"获取年级失败:"+e.t0.message,duration:5});case 11:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(){return C.apply(this,arguments)}),getYears:(b=Object(i.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(g.q)();case 3:t=e.sent,this.yearList=Object.freeze(t),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),this.$Message.warning({content:"获取年份失败:"+e.t0.message,duration:5});case 10:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(){return b.apply(this,arguments)}),getBaseDataTermList:(y=Object(i.a)(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={cityCode:this.formData.cityCode},e.next=4,Object(g.v)(t);case 4:a=e.sent,this.termList=Object.freeze(a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),this.$Message.error({content:"获取学期失败:"+e.t0.message,duration:5});case 11:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(){return y.apply(this,arguments)})}},R={name:"OpenClassAssess",mixins:[$,m.a],props:{parentFormData:{type:Object,default:function(){return{}}}},data:function(){var e=this;return{formData:{receptionEmpNo:"",status:""},columns:[{title:"操作",key:"name",align:"center",render:function(t,a){var r=1===a.row.type||0!==a.row.status;return t("div",[t("a",{on:{click:function(){e.$emit("check",a.row.id)}}},"查看"),t("br"),r?t("span",{style:{color:"gray"}},"审批"):t("a",{on:{click:function(){e.$emit("approval",a.row.id)}}},"审批")])}},{title:"操作人",key:"creatorName",align:"center"},{title:"操作时间",key:"createDate",align:"center"},{title:"年份",key:"year",align:"center"},{title:"年级",key:"gradeName",align:"center"},{title:"意向学科",key:"subjectName",align:"center"},{title:"意向学期",key:"termName",align:"center"},{title:"班次级别",key:"classLevelName",align:"center"},{title:"授课类型",key:"classTypeName",align:"center"},{title:"意向服务中心",key:"serviceCenterName",align:"center"},{title:"意向上课时间",key:"classtimeTimeClassify",align:"center"},{title:"意向上课时段",key:"classtimeTimePeriod",align:"center"},{title:"审批状态",key:"status",align:"center",render:function(e,t){return e("span",0===t.row.status?"未审批":"已审批")}},{title:"开班状态",key:"status",align:"center",render:function(e,t){return e("span",1===t.row.status?"开班成功":2===t.row.status?"开班失败":"--")}},{title:"开班班级ID",key:"assembleClassId",align:"center"},{title:"审批人",key:"receptionEmpName",align:"center"}],tableLoading:!1,tableData:[],searchData:{totalCount:0,pageSize:10,pageNo:1}}},watch:{formData:{deep:!0,handler:function(){this.search()}}},methods:{search:function(){var e=Object(i.a)(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,1!==(t=Object.assign({},this.searchData,this.formData,{cityCode:this.parentFormData.cityCode,year:this.parentFormData.year,termId:this.parentFormData.termId,subjectId:this.parentFormData.subjectId,gradeId:this.parentFormData.gradeId,classLevel:this.parentFormData.classLevel,serviceCenterId:this.parentFormData.serviceCenterId,classtimeTimePeriod:this.parentFormData.classtimeTimePeriod,classtimeTimeClassify:this.parentFormData.classtimeTimeClassify,classType:this.parentFormData.classType})).classType&&t.classType||delete t.serviceCenterId,this.tableLoading=!0,e.next=6,Object(d.m)(t);case 6:a=e.sent,this.tableData=Object.freeze(a.records),this.searchData.totalCount=a.totalCount,e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),this.$Message.error({content:"获取评估列表失败: ".concat(e.t0.message),duration:5});case 14:this.tableLoading=!1;case 15:case"end":return e.stop()}}),e,this,[[0,11]])})));return function(){return e.apply(this,arguments)}}(),changePage:function(e){this.searchData.pageNo=e,this.search()},pageSizeChange:function(e){this.searchData.pageNo=1,this.searchData.pageSize=e,this.search()}}},P=(a("42bb"),Object(p.a)(R,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("Form",{attrs:{inline:"","label-width":80}},[a("FormItem",{attrs:{label:"审批状态"}},[a("Select",{staticStyle:{width:"150px"},attrs:{clearable:""},model:{value:e.formData.status,callback:function(t){e.$set(e.formData,"status",t)},expression:"formData.status"}},e._l(e.approvalStatusList,(function(t){return a("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])})),1)],1),e._v(" "),a("FormItem",{attrs:{label:"审批人"}},[a("Select",{staticStyle:{width:"150px"},attrs:{filterable:"",clearable:"",remote:"","remote-method":function(t){return e.getAdvisorEmpNos(t,e.parentFormData.cityCode)},"label-in-value":""},model:{value:e.formData.receptionEmpNo,callback:function(t){e.$set(e.formData,"receptionEmpNo",t)},expression:"formData.receptionEmpNo"}},e._l(e.advisorEmpNos,(function(t){return a("Option",{key:t.empNo,attrs:{value:t.empNo}},[e._v(e._s(t.name)+"-"+e._s(t.empNo))])})),1)],1)],1),e._v(" "),a("Table",{ref:"selection",attrs:{border:"",columns:e.columns,data:e.tableData,loading:e.tableLoading}}),e._v(" "),a("div",{staticClass:"flex-page",staticStyle:{margin:"10px"}},[a("Page",{attrs:{total:e.searchData.totalCount,"page-size":e.searchData.pageSize,current:e.searchData.pageNo,"show-elevator":"","show-sizer":"","show-total":"",transfer:""},on:{"update:current":function(t){return e.$set(e.searchData,"pageNo",t)},"on-page-size-change":e.pageSizeChange,"on-change":e.changePage}})],1)],1)}),[],!1,null,"c18be04e",null).exports),A=(a("097d"),a("a78e")),E=a.n(A),F={name:"StuDetailExpand",mixins:[l.a],props:{stuList:Array,loading:Boolean},data:function(){var e=this;return{detailCols:[{title:"序号",type:"index",align:"center"},{title:"学员姓名",key:"name",align:"center",render:function(t,a){return a.row.stuLoginName?t("a",{on:{click:function(){var t={card:a.row.stuLoginName,cityCode:a.row.areaCode};e.goCustomerDetail(t)}}},a.row.name||"--"):t("span",a.row.name||"--")}},{title:"学员编号",key:"stuLoginName",align:"center"},{title:"是否攒班",key:"isAssemble",align:"center",render:function(e,t){return e("span",t.row.isAssemble?"是":"否")}},{title:"报名状态",key:"registStatus",align:"center",render:function(t,a){return t("span",e.registStatusMap[a.row.registStatus]||"--")}},{title:"缴费状态",key:"payStatus",align:"center",render:function(e,t){return e("span",t.row.payStatus?"已缴费":"未缴费")}},{title:"报名人",key:"creator",align:"center",render:function(e,t){return e("span",null===t.row.creator?"--":t.row.creator||"用户")}},{title:"报名渠道",key:"regWay",align:"center",render:function(t,a){return t("span",e.regWayMap[a.row.regWay]||"--")}},{title:"报名时间",key:"regTime",align:"center",render:function(e,t){return e("span",t.row.regTime||"--")}},{title:"缴费时间",key:"payTime",align:"center",render:function(e,t){return e("span",t.row.payTime||"--")}},{title:"操作",key:"address",align:"center",render:function(t,a){return a.row.registStatus?"":t("a",{on:{click:function(){e.$emit("apply",a.row)}}},"报名")}}],registStatusMap:{0:"未报名",1:"已报名",2:"报名失败"},regWayMap:{0:"前台报名",1:"网上报名",2:"电话报名",3:"App",4:"App",5:"CRM报名",6:"微信活动",7:"微信",8:"百度直达号"}}}},q=Object(p.a)(F,(function(){var e=this.$createElement;return(this._self._c||e)("Table",{attrs:{border:"",loading:this.loading,columns:this.detailCols,data:this.stuList}})}),[],!1,null,null,null).exports,z={name:"CuanbanList",props:{parentFormData:{type:Object,default:function(){return{}}}},data:function(){var e=this;return{loading:!1,searchStuModal:!1,formData:{status:"",totalCount:0,pageSize:10,pageNo:1},applyShow:!1,applyParams:{classId:"",studentId:"",cityCode:"",empNo:""},assessStatusMap:[{value:1,label:"是"},{value:0,label:"否"}],columns:[{type:"expand",width:50,render:function(t,a){return t(q,{props:{stuList:a.row.stuList,loading:a.row.stuListLoading},on:{apply:function(t){e.detailRow=a.row,e.applyParams.classId=t.classId,e.applyParams.studentId=t.studentId,e.applyParams.cityCode=t.areaCode,e.applyShow=!0}}})}},{title:"操作",key:"name",align:"center",render:function(t,a){return t("div",[t("a",{on:{click:function(){e.detailRow=a.row,e.applyParams.classId=a.row.clazzDetail.classId,e.assembleId=a.row.id,e.searchStuModal=!0}}},"报名"),t("br"),t("a",{on:{click:function(){var t=e.tableData[a.index];e.$set(t,"_expanded",!t._expanded),t._expanded&&e.queryStudents(t)}}},e.tableData[a.index]._expanded?"收起学员详情":"查看学员详情")])}},{title:"班级名称",key:"className",align:"center",render:function(t,a){return a.row.clazzDetail.className?t("a",{on:{click:function(){e.$emit("showClassDetail",a.row.clazzDetail.classId)}}},a.row.clazzDetail.className):t("span","--")}},{title:"授课类型",key:"categoryTypeName",align:"center",render:function(e,t){return e("span",t.row.clazzDetail.categoryTypeName)}},{title:"学期",key:"termName",align:"center",render:function(e,t){return e("span",t.row.clazzDetail.termName)}},{title:"学科",key:"subjectName",align:"center",render:function(e,t){return e("span",t.row.clazzDetail.subjectName)}},{title:"主讲教师",key:"teacherNames",align:"center",render:function(t,a){return t("div",a.row.clazzDetail.teachers.map((function(r){return t("a",{on:{click:function(){e.$emit("showTeacherDetail",a.row.cityCode,r.teacherId,r.teacherAccountType)}}},r.teacherName)})))}},{title:"开课日期",key:"startDate",align:"center",render:function(e,t){return e("span",t.row.clazzDetail.startDate)}},{title:"结课日期",key:"endDate",align:"center",render:function(e,t){return e("span",t.row.clazzDetail.endDate)}},{title:"上课时间",key:"classTimeDisplay",align:"center",render:function(e,t){return e("span",t.row.clazzDetail.classTimeDisplay)}},{title:"服务中心",key:"serviceCenterName",align:"center",render:function(e,t){return e("span",t.row.clazzDetail.classroomServiceCenterName)}},{title:"教室",key:"classroomName",align:"center",render:function(e,t){return e("span",t.row.clazzDetail.classroomName)}},{title:"上课进度",align:"center",render:function(e,t){return e("span",t.row.clazzDetail.passedCount+"/"+t.row.clazzDetail.classCount)}},{title:"班级限额",key:"maxPersons",align:"center",render:function(e,t){return e("span",t.row.clazzDetail.maxPersons)}},{title:"已报人数",key:"registPersons",align:"center",render:function(e,t){return e("span",t.row.clazzDetail.registPersons)}},{title:"剩余名额",align:"center",render:function(e,t){return e("span",t.row.clazzDetail.maxPersons-t.row.clazzDetail.registPersons)}},{title:"是否关班",align:"center",render:function(e,t){return e("span","1"===String(t.row.clazzDetail.isClose)?"是":"否")}}],tableLoading:!1,tableData:[],detailRow:null,relatedModal:!1,assembleStatusMap:{1:"待评估",2:"评估中",3:"开班成功",4:"开班失败",5:"攒班成功",6:"攒班失败",7:"取消"},relatedCols:[{title:"操作",align:"center",render:function(t,a){return t("a",{on:{click:function(){Object(d.e)({assembleClassDemandId:a.row.id,assembleId:e.assembleId}).then((function(){e.$Message.success("关联成功"),e.relatedModal=!1,e.applyShow=!0})).catch((function(t){e.$Message.error({content:"关联失败："+t.message,duration:5})}))}}},"关联攒班记录")}},{title:"攒班状态",key:"status",align:"center",render:function(t,a){return t("span",e.assembleStatusMap[a.row.status])}},{title:"学员姓名",key:"name",align:"center"},{title:"接待顾问",key:"receptionAdvisorEmpName",align:"center"},{title:"年级",key:"gradeName",align:"center"},{title:"创建人",key:"creatorName",align:"center",render:function(e,t){return e("span",t.row.creatorName||"用户")}},{title:"创建时间",key:"createDate",align:"center"},{title:"推荐学员",key:"recommendName",align:"center"},{title:"攒班年份",key:"year",align:"center"},{title:"意向学科",key:"subjectName",align:"center"},{title:"意向学期",key:"termName",align:"center"},{title:"班次级别",key:"classLevelName",align:"center"},{title:"意向服务中心",key:"serviceCenterName",align:"center"},{title:"意向上课时间",key:"classtimeTimeClassifys",align:"center"},{title:"意向上课时段",key:"classtimeTimePeriods",align:"center"},{title:"意向度",key:"intention",align:"center"}],relatedData:[]}},methods:{setStuInfoForApplyHandle:function(e){this.searchStuModal=!1,this.applyParams.studentId=e.studentId,this.applyParams.cityCode=e.cityCode,this.showRelatedAssembleClass(e.uid)},showRelatedAssembleClass:function(e){var t=this;Object(d.x)({uid:e,assembleId:this.assembleId}).then((function(e){e&&e.length?(t.relatedData=e,t.relatedModal=!0):t.applyShow=!0})).catch((function(e){t.$Message.error({content:"攒班记录条件查询单个学员需求列表错误："+e.message,duration:5})}))},getTableData:(_=Object(i.a)(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.loading=!0,1!==(t=Object.assign({},this.parentFormData,this.formData,{startCreateDate:"",endCreateDate:""})).classType&&t.classType||delete t.serviceCenterId,e.prev=3,e.next=6,Object(d.w)(t);case 6:a=e.sent,this.tableData=a.records.map((function(e){return e.stuList=[],e})),this.formData.totalCount=a.totalCount,e.next=14;break;case 11:e.prev=11,e.t0=e.catch(3),this.$Message.error({content:"查询学员详情错误："+e.t0.message,duration:5});case 14:return e.prev=14,this.loading=!1,e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[3,11,14,17]])}))),function(){return _.apply(this,arguments)}),changePage:function(e){this.formData.pageNo=e,this.getTableData()},pageSizeChange:function(e){this.formData.pageNo=1,this.formData.pageSize=e,this.getTableData()},search:function(){this.formData.pageNo=1,this.getTableData()},applySuccess:(k=Object(i.a)(regeneratorRuntime.mark((function e(){var t,a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{t=this.tableData.find((function(e){return e.id===a.detailRow.id})),this.queryStudents(t),this.$set(t,"_expanded",!0)}catch(e){this.$Message.error({content:"刷新列表错误："+e.message||!1,duration:5})}case 1:case"end":return e.stop()}}),e,this)}))),function(){return k.apply(this,arguments)}),onExpand:function(e,t){var a=this.tableData.find((function(t){return t.id===e.id}));this.$set(a,"_expanded",t),t&&this.queryStudents(a)},queryStudents:function(e){var t=this;e.stuListLoading=!0,Object(d.g)({id:e.id,classId:e.clazzDetail.classId,cityCode:e.cityCode}).then((function(t){e.stuList=t})).catch((function(e){t.$Message.error({content:"查询学员详情错误："+e.message,duration:5})})).finally((function(){e.stuListLoading=!1}))}},mounted:function(){this.applyParams.empNo=JSON.parse(E.a.get("columbusUserInfo")).id}},B=(a("8db1"),Object(p.a)(z,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("Form",{attrs:{inline:"","label-width":80}},[a("FormItem",{attrs:{label:"是否关班"}},[a("Select",{staticStyle:{width:"150px"},attrs:{clearable:""},on:{"on-change":e.search},model:{value:e.formData.status,callback:function(t){e.$set(e.formData,"status",t)},expression:"formData.status"}},e._l(e.assessStatusMap,(function(t){return a("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])})),1)],1)],1),e._v(" "),a("Table",{ref:"selection",attrs:{border:"",loading:e.loading,columns:e.columns,data:e.tableData},on:{"on-expand":e.onExpand}}),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!e.tableLoading,expression:"!tableLoading"}],staticClass:"flex-page",staticStyle:{margin:"10px"}},[a("Page",{attrs:{total:e.formData.totalCount,"page-size":e.formData.pageSize,current:e.formData.pageNo,"show-elevator":"","show-sizer":"","show-total":"",transfer:""},on:{"update:current":function(t){return e.$set(e.formData,"pageNo",t)},"on-page-size-change":e.pageSizeChange,"on-change":e.changePage}})],1),e._v(" "),a("Modal",{attrs:{title:"查找报名学员",width:"800","footer-hide":!0},model:{value:e.searchStuModal,callback:function(t){e.searchStuModal=t},expression:"searchStuModal"}},[e.searchStuModal?a("TalStuSearch",{ref:"stuSearchForApply",attrs:{attendanceSearch:!1,showDetail:!1,showCrmInfo:!1,"choice-btn-text":"报名"},on:{stuInfo:e.setStuInfoForApplyHandle}}):e._e()],1),e._v(" "),a("Modal",{attrs:{title:"关联攒班记录",width:"80%","footer-hide":!0},model:{value:e.relatedModal,callback:function(t){e.relatedModal=t},expression:"relatedModal"}},[a("Table",{attrs:{border:"",columns:e.relatedCols,data:e.relatedData}})],1),e._v(" "),a("TalApplyModal",{attrs:{show:e.applyShow,classId:e.applyParams.classId,stuId:e.applyParams.studentId,stuCityCode:e.applyParams.cityCode,creatorEmpNo:e.applyParams.empNo},on:{success:e.applySuccess,close:function(t){e.applyShow=!1}}})],1)}),[],!1,null,"5543d342",null).exports),W=(a("28a5"),a("6ec6")),U=a("49e5"),V={name:"createCuanban",mixins:[W.a,$,m.a],props:{type:{type:Number,default:1},oldFormData:{type:Object,default:function(){return{}}},classTypeList:{type:Array,default:function(){return[]}},classTypeRuleMap:{type:Object,default:function(){return{}}}},watch:{"formData.classLevel":(x=Object(i.a)(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.formData.classLevel&&this.formData.gradeId&&this.formData.subjectId)){e.next=8;break}return t={levelDegree:this.formData.classLevel,subjectId:this.formData.subjectId,gradeId:this.formData.gradeId,uid:this.formData.uid,cityCode:this.formData.cityCode},this.diagnosisScore.spining=1,e.next=5,this.abilityStudentLevel(t);case 5:a=e.sent,this.diagnosisScore.value=a,this.diagnosisScore.spining=2;case 8:case"end":return e.stop()}}),e,this)}))),function(){return x.apply(this,arguments)})},data:function(){return{formData:{cityCode:"",year:(new Date).getFullYear()+"",termId:"",termName:"",gradeId:"",gradeName:"",subjectId:"",subjectName:"",classLevel:"",classLevelName:"",serviceCenterId:"",serviceCenterName:"",classtimeTimeClassifys:"",classtimeTimePeriods:"",intention:"",name:"",uid:"",studentCard:"",remark:"",recommendName:"",recommendCard:"",classType:1},ruleValidate:{year:[{required:!0,message:"请选择年份",trigger:"change"}],termId:[{required:!0,message:"请选择学期",trigger:"change"}],gradeId:[{required:!0,type:"number",message:"请选择年级",trigger:"change"}],subjectId:[{required:!0,message:"请选择意向学科",trigger:"change"}],classLevel:[{required:!0,message:"请选择班次级别",trigger:"change"}],serviceCenterId:[{required:!0,message:"请选择意向服务中心",trigger:"change"}],classtimeTimeClassifys:[{required:!0,type:"array",message:"请选择意向服务中心",trigger:"change"}],classtimeTimePeriods:[{required:!0,type:"array",message:"请选择意向服务中心",trigger:"change"}],classType:[{required:!0,type:"number",message:"请选择授课类型",trigger:"change"}]},confirmLoading:!1,updateRecords:[],diagnosisScore:{spining:0,value:null}}},mounted:function(){2!==this.type&&3!==this.type||(Object.assign(this.formData,this.oldFormData),this.getAssembleClassDemandInfoById()),this.formData.cityCode&&this.initFormOptions()},methods:{abilityStudentLevel:(L=Object(i.a)(regeneratorRuntime.mark((function e(t){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(U.a)(t);case 3:return a=e.sent,e.abrupt("return",a);case 7:e.prev=7,e.t0=e.catch(0),this.$Message.error({content:"获取学员成绩失败: ".concat(e.t0.message),duration:5});case 10:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(e){return L.apply(this,arguments)}),getAssembleClassDemandInfoById:(I=Object(i.a)(regeneratorRuntime.mark((function e(){var t,a,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={assembleClassDemandId:this.oldFormData.id,cityCode:this.oldFormData.cityCode},e.next=4,Object(d.o)(t);case 4:a=e.sent,r=Object.freeze(a.logList),delete a.logList,this.formData=Object.assign({},a,{classtimeTimePeriods:a.classtimeTimePeriods.split(","),classtimeTimeClassifys:a.classtimeTimeClassifys.split(",")}),this.serviceCenterList=[{schoolId:a.serviceCenterId,name:a.serviceCenterName}],this.updateRecords=r,e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),this.$Message.error({content:"攒班需求详情获取失败: ".concat(e.t0.message),duration:5});case 15:case"end":return e.stop()}}),e,this,[[0,12]])}))),function(){return I.apply(this,arguments)}),initFormOptions:function(){this.getBaseDataTermList(),this.getYears(),this.getSubjectList(),this.getGradeList(),this.getTimeList(),this.getTimeTypeList(),this.queryLevelDegreeList()},confirm:function(){var e=this;this.$refs.formValidate.validate((function(t){t&&(1===e.type?e.addAssembleClassDemand():e.editAssembleClassDemand())}))},addAssembleClassDemand:(T=Object(i.a)(regeneratorRuntime.mark((function e(){var t,a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.confirmLoading=!0,1!==(t=Object.assign({},this.formData,{classtimeTimePeriods:this.formData.classtimeTimePeriods.join(","),classtimeTimeClassifys:this.formData.classtimeTimeClassifys.join(",")})).classType&&t.classType||delete t.serviceCenterId,e.next=6,Object(d.c)(t);case 6:setTimeout((function(){a.$Message.success({content:"新增攒班需求成功"}),a.confirmLoading=!1,a.$emit("close"),a.$emit("success")}),2e3),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),this.confirmLoading=!1,this.$Message.error({content:"新增攒班需求失败: ".concat(e.t0.message),duration:5});case 13:case"end":return e.stop()}}),e,this,[[0,9]])}))),function(){return T.apply(this,arguments)}),editAssembleClassDemand:(S=Object(i.a)(regeneratorRuntime.mark((function e(){var t,a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.confirmLoading=!0,1!==(t=Object.assign({},this.formData,{classtimeTimePeriods:this.formData.classtimeTimePeriods.join(","),classtimeTimeClassifys:this.formData.classtimeTimeClassifys.join(",")})).classType&&t.classType||delete t.serviceCenterId,e.next=6,Object(d.l)(t);case 6:setTimeout((function(){a.$Message.success({content:"修改攒班需求成功"}),a.confirmLoading=!1,a.$emit("close"),a.$emit("success")}),2e3),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),this.confirmLoading=!1,this.$Message.error({content:"新增攒班需求失败: ".concat(e.t0.message),duration:5});case 13:case"end":return e.stop()}}),e,this,[[0,9]])}))),function(){return S.apply(this,arguments)}),setStuInfo:function(e){this.formData.cityCode=e.cityCode,this.formData.uid=e.uid,this.formData.name=e.realName,this.formData.studentCard=e.card,this.formData.gradeId=e.gradeId,this.formData.gradeName=e.gradeName,this.initFormOptions()}}},G=(a("b515"),Object(p.a)(V,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{width:"100%",padding:"15px"}},[1===e.type?a("div",{staticClass:"stu-search",staticStyle:{"margin-bottom":"30px"}},[a("TalStuSearch",{ref:"stuSearch",attrs:{"stu-card":e.queryData.card,"stu-city-code":e.queryData.cityCode,showCrmInfo:!1},on:{stuInfo:e.setStuInfo}})],1):e._e(),e._v(" "),e.formData.uid?e._e():a("p",[e._v("请选择学员")]),e._v(" "),!e.formData.uid||1!==e.type&&2!=e.type?e._e():[a("Form",{ref:"formValidate",staticStyle:{"margin-bottom":"20px"},attrs:{inline:"","label-width":130,model:e.formData,rules:e.ruleValidate}},[a("FormItem",{attrs:{label:"年份",prop:"year"}},[a("Select",{staticStyle:{width:"150px"},attrs:{clearable:""},model:{value:e.formData.year,callback:function(t){e.$set(e.formData,"year",t)},expression:"formData.year"}},e._l(e.yearList.slice(1,-1),(function(t,r){return a("Option",{key:r,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),e._v(" "),a("FormItem",{attrs:{label:"意向学期",prop:"termId"}},[a("Select",{staticStyle:{width:"150px"},attrs:{clearable:"","label-in-value":""},on:{"on-change":function(t){return e.handleSelectChange(t,"termName")}},model:{value:e.formData.termId,callback:function(t){e.$set(e.formData,"termId",t)},expression:"formData.termId"}},e._l(e.termList.slice(0,4),(function(t,r){return a("Option",{key:r,attrs:{value:t.standardId}},[e._v(e._s(t.standardName))])})),1)],1),e._v(" "),a("FormItem",{attrs:{label:"年级",prop:"gradeId"}},[a("Select",{staticStyle:{width:"150px"},attrs:{clearable:"","label-in-value":""},on:{"on-change":function(t){return e.handleSelectChange(t,"gradeName")}},model:{value:e.formData.gradeId,callback:function(t){e.$set(e.formData,"gradeId",t)},expression:"formData.gradeId"}},e._l(e.gradeList,(function(t,r){return a("Option",{key:r,attrs:{value:t.standardId}},[e._v(e._s(t.standardName))])})),1)],1),e._v(" "),a("FormItem",{attrs:{label:"意向学科",prop:"subjectId"}},[a("Select",{staticStyle:{width:"150px"},attrs:{clearable:"","label-in-value":""},on:{"on-change":function(t){return e.handleSelectChange(t,"subjectName")}},model:{value:e.formData.subjectId,callback:function(t){e.$set(e.formData,"subjectId",t)},expression:"formData.subjectId"}},e._l(e.subjectList,(function(t,r){return a("Option",{key:r,attrs:{value:t.schoolId}},[e._v(e._s(t.customName))])})),1)],1),e._v(" "),a("FormItem",{attrs:{label:"班次级别",prop:"classLevel"}},[a("Select",{staticStyle:{width:"150px"},attrs:{clearable:"","label-in-value":""},on:{"on-change":function(t){return e.handleSelectChange(t,"classLevelName")}},model:{value:e.formData.classLevel,callback:function(t){e.$set(e.formData,"classLevel",t)},expression:"formData.classLevel"}},e._l(e.classLevelList,(function(t,r){return a("Option",{key:r,attrs:{value:t.schoolId}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),a("FormItem",[a("p",{staticStyle:{"margin-left":"-100px",position:"relative",height:"30px"}},[1===e.diagnosisScore.spining?a("Spin",{attrs:{size:"large",fix:""}}):e._e(),e._v(" "),2!==e.diagnosisScore.spining||e.diagnosisScore.value?e._e():a("span",[e._v("入学测试成绩不符合，请及时联系学员进行诊断")])],1)]),e._v(" "),a("FormItem",{attrs:{label:"授课类型",prop:"classType"}},[a("Select",{staticStyle:{width:"150px"},model:{value:e.formData.classType,callback:function(t){e.$set(e.formData,"classType",t)},expression:"formData.classType"}},e._l(e.classTypeList,(function(t){return a("Option",{key:t.id,attrs:{value:t.id,disabled:!e.$haveAuthority("roleRelativeData",e.classTypeRuleMap[t.id])}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),2===e.formData.classType||4===e.formData.classType?[a("FormItem",{attrs:{label:"意向服务中心",prop:"serviceCenterId"}},[a("Select",{staticStyle:{width:"150px"},attrs:{clearable:"",filterable:"","remote-method":function(t){return e.getServiceCenterList(t,e.formData.cityCode)},"label-in-value":""},on:{"on-change":function(t){return e.handleSelectChange(t,"serviceCenterName")}},model:{value:e.formData.serviceCenterId,callback:function(t){e.$set(e.formData,"serviceCenterId",t)},expression:"formData.serviceCenterId"}},e._l(e.serviceCenterList,(function(t,r){return a("Option",{key:r,attrs:{value:t.schoolId}},[e._v(e._s(t.name))])})),1)],1)]:e._e(),e._v(" "),a("FormItem",{attrs:{label:"意向上课时间",prop:"classtimeTimeClassifys"}},[a("Select",{staticStyle:{width:"150px"},attrs:{clearable:"",multiple:""},model:{value:e.formData.classtimeTimeClassifys,callback:function(t){e.$set(e.formData,"classtimeTimeClassifys",t)},expression:"formData.classtimeTimeClassifys"}},e._l(e.timeTypeList,(function(t,r){return a("Option",{key:r,attrs:{value:t.name}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),a("FormItem",{attrs:{label:"意向上课时段",prop:"classtimeTimePeriods"}},[a("Select",{staticStyle:{width:"150px"},attrs:{clearable:"",multiple:""},model:{value:e.formData.classtimeTimePeriods,callback:function(t){e.$set(e.formData,"classtimeTimePeriods",t)},expression:"formData.classtimeTimePeriods"}},e._l(e.timeList,(function(t,r){return a("Option",{key:r,attrs:{value:t.name}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),a("FormItem",{attrs:{label:"意向度",prop:"intention"}},[a("Select",{staticStyle:{width:"150px"},attrs:{clearable:""},model:{value:e.formData.intention,callback:function(t){e.$set(e.formData,"intention",t)},expression:"formData.intention"}},e._l(e.intentionList,(function(t,r){return a("Option",{key:r,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),e._v(" "),a("FormItem",{attrs:{label:"推荐学员",prop:"recommendName"}},[a("Input",{attrs:{placeholder:"请输入",maxlength:10,clearable:""},model:{value:e.formData.recommendName,callback:function(t){e.$set(e.formData,"recommendName",t)},expression:"formData.recommendName"}})],1),e._v(" "),a("FormItem",{attrs:{label:"推荐学员编号",prop:"recommendCard"}},[a("Input",{attrs:{placeholder:"请输入",clearable:"",maxlength:20},model:{value:e.formData.recommendCard,callback:function(t){e.$set(e.formData,"recommendCard",t)},expression:"formData.recommendCard"}})],1),e._v(" "),a("br"),e._v(" "),a("FormItem",{attrs:{label:"备注",prop:"remark"}},[a("Input",{staticStyle:{width:"740px"},attrs:{type:"textarea",autosize:{minRows:3,maxRows:10},placeholder:"请输入备注",maxlength:100},model:{value:e.formData.remark,callback:function(t){e.$set(e.formData,"remark",t)},expression:"formData.remark"}})],1)],2),e._v(" "),a("Row",{attrs:{type:"flex",justify:"center",gutter:20}},[a("Col",[a("Button",{attrs:{type:"primary",loading:e.confirmLoading},on:{click:e.confirm}},[e._v("提交")])],1),e._v(" "),a("Col",[a("Button",{attrs:{loading:e.confirmLoading},on:{click:function(t){return e.$emit("close")}}},[e._v("取消")])],1)],1)],e._v(" "),2===e.type||3===e.type?[a("h3",{staticStyle:{"margin-bottom":"20px"}},[e._v("修改记录")]),e._v(" "),a("div",{staticClass:"record"},e._l(e.updateRecords,(function(t,r){return a("Row",{key:r},[a("Col",{attrs:{span:"24"}},[e._v("操作类型: "+e._s(t.logTypeName))]),e._v(" "),a("Col",{attrs:{span:"6"}},[e._v("年份: "+e._s(t.year))]),e._v(" "),a("Col",{attrs:{span:"6"}},[e._v("意向学期: "+e._s(t.termName))]),e._v(" "),a("Col",{attrs:{span:"6"}},[e._v("年级: "+e._s(t.gradeName))]),e._v(" "),a("Col",{attrs:{span:"6"}},[e._v("意向学科: "+e._s(t.subjectName))]),e._v(" "),a("Col",{attrs:{span:"6"}},[e._v("班次级别: "+e._s(t.classLevelName))]),e._v(" "),a("Col",{attrs:{span:"6"}},[e._v("授课类型: "+e._s(t.classTypeName))]),e._v(" "),a("Col",{attrs:{span:"6"}},[e._v("意向服务中心: "+e._s(t.serviceCenterName))]),e._v(" "),a("Col",{attrs:{span:"6"}},[e._v("意向上课时间: "+e._s(t.classtimeTimeClassifys))]),e._v(" "),a("Col",{attrs:{span:"6"}},[e._v("意向上课时段: "+e._s(t.classtimeTimePeriods))]),e._v(" "),a("Col",{attrs:{span:"6"}},[e._v("意向度: "+e._s(t.intention))]),e._v(" "),a("Col",{attrs:{span:"6"}},[e._v("推荐学员: "+e._s(t.recommendName))]),e._v(" "),a("Col",{attrs:{span:"6"}},[e._v("推荐学员编号: "+e._s(t.recommendCard))]),e._v(" "),a("Col",{attrs:{span:"24"}},[e._v("备注: "+e._s(t.remark))]),e._v(" "),a("Col",{attrs:{span:"6"}},[e._v("操作人: "+e._s(t.creatorName))]),e._v(" "),a("Col",{attrs:{span:"6"}},[e._v("操作时间: "+e._s(t.createDate))]),e._v(" "),a("Col",{attrs:{span:"24"}},[a("Divider",{staticStyle:{margin:"10px 0","background-color":"#333"}})],1)],1)})),1)]:e._e()],2)}),[],!1,null,"16f5f416",null).exports),H=(a("55dd"),a("456d"),a("d225")),Q=a("b0b4"),Y=function(){function e(t,a){Object(H.a)(this,e),this.data=t,this.name=a}return Object(Q.a)(e,[{key:"getKeys",value:function(e,t){var a=this;return e.reduce((function(e,r){var n=a.getObject(r,t);return a.isHasObject(e,n)||e.push(n),e}),[])}},{key:"getObject",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.name,a={},r=0,n=t.length;r<n;r++)a[t[r]]=e[t[r]];return a}},{key:"isHasObject",value:function(e,t){var a=this;return 0!==e.length&&e.find((function(e){return a.isObjectValueEqual(e,t)}))}},{key:"isObjectValueEqual",value:function(e,t){var a=Object.keys(e),r=Object.keys(t);if(a.length!==r.length)return!1;for(var n=0;n<a.length;n++){var i=a[n];if(e[i]!==t[i])return!1}return!0}},{key:"hasObjectData",value:function(e,t){return e.filter((function(e){return Object.keys(t).reduce((function(a,r){return!!a&&t[r]===e[r]}),!0)}))}},{key:"group",value:function(){var e=this;return this.getKeys(this.data,this.name).map((function(t){return{key:t,value:e.hasObjectData(e.data,t)}}))}}]),e}(),J={name:"OpenClassAeeseeApproval",mixins:[$,m.a],props:{parentFormData:{type:Object,default:function(){return{}}},studentDemandList:{type:Array,default:function(){return[]}},type:{type:Number,default:1},accessId:{type:String,default:""},classTypeList:{type:Array,default:function(){return[]}},classTypeRuleMap:{type:Object,default:function(){return{}}}},data:function(){var e=this;return{formData:{cityCode:"",year:(new Date).getFullYear()+"",termId:"",termName:"",gradeId:"",gradeName:"",subjectId:"",subjectName:"",classLevel:"",classLevelName:"",serviceCenterId:"",serviceCenterName:"",classtimeTimeClassify:"",classtimeTimePeriod:"",receptionEmpNo:"",receptionEmpName:"",classId:"",status:null,remark:"",failReason:"",classType:null},ruleValidate:{year:[{required:!0,message:"请选择年份",trigger:"change"}],termId:[{required:!0,message:"请选择学期",trigger:"change"}],gradeId:[{required:!0,type:"number",message:"请选择年级",trigger:"change"}],subjectId:[{required:!0,message:"请选择意向学科",trigger:"change"}],classLevel:[{required:!0,message:"请选择班次级别",trigger:"change"}],serviceCenterId:[{required:!0,message:"请选择意向服务中心",trigger:"change"}],classtimeTimeClassify:[{required:!0,message:"请选择意向上课时间",trigger:"change"}],classtimeTimePeriod:[{required:!0,message:"请选择意向上课时段",trigger:"change"}],receptionEmpNo:[{required:!0,message:"请选择审批人",trigger:"change"}],status:[{required:!0,type:"number",message:"请选择开班状态",trigger:"change"}],classId:[{required:!0,message:"请输入开班班级ID",trigger:"change"}],failReason:[{required:!0,message:"请输入失败原因",trigger:"change"},{maxlength:200,message:"最多输入200字符",trigger:"change"}]},columns:[{title:"学员姓名",key:"name",align:"center"},{title:"联系电话",key:"phone",align:"center",width:120,render:function(e,t){return e(u.TalDecodeText,{props:{uid:t.row.uid,encodeText:t.row.phone,type:"phone"}})}},{title:"学员编号",key:"studentCard",align:"center"},{title:"创建时间",key:"createDate",align:"center"},{title:"意向学期",key:"termName",align:"center"},{title:"意向学科",key:"subjectName",align:"center"},{title:"年级",key:"gradeName",align:"center"},{title:"班次级别",key:"classLevelName",align:"center"},{title:"授课类型",key:"classTypeName",align:"center"},{title:"意向服务中心",key:"serviceCenterName",align:"center"},{title:"意向上课时间",key:"classtimeTimeClassify",align:"center"},{title:"意向上课时段",key:"classtimeTimePeriod",align:"center"},{title:"意向度",key:"intention",align:"center"},{title:"入学测试成绩",key:"diagnosisScore",align:"center",render:function(e,t){return e("span",1===t.row.diagnosisScore?"符合":"不符合")}},{title:"攒班状态",key:"status",align:"center",render:function(t,a){return t("span",e.cuanbanStatusMap[a.row.status])}}],tableData:[],tableLoading:!1,studentDemandListSorted:[],confirmLoading:!1,assessLogs:[]}},mounted:function(){Object.assign(this.formData,{cityCode:this.parentFormData.cityCode}),this.initFormOptions(),1===this.type&&this.groupStudentDemandList(),2!==this.type&&3!==this.type||this.queryDetailById()},methods:{handleStatusChange:function(e){var t=this;console.log("val",e),this.$nextTick((function(){t.$refs.formValidate2.resetFields(),t.formData.status=e}))},queryDetailById:(N=Object(i.a)(regeneratorRuntime.mark((function e(){var t,a,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={accessId:this.accessId,cityCode:this.formData.cityCode},this.tableLoading=!0,e.next=5,Object(d.v)(t);case 5:return a=e.sent,Object.assign(this.formData,a,{assembleClassDemandIds:null,assessLogs:null}),3===this.type&&(this.formData.status=1,this.formData.remark=""),this.serviceCenterList=[{schoolId:a.serviceCenterId,name:a.serviceCenterName}],e.next=11,this.setStudentLevel(a.assembleClassDemandIds||[]);case 11:r=e.sent,this.studentDemandListSorted=r,this.assessLogs=Object.freeze(a.assessLogs),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),this.$Message.error({content:"获取评估详情失败: ".concat(e.t0.message),duration:5});case 19:this.tableLoading=!1;case 20:case"end":return e.stop()}}),e,this,[[0,16]])}))),function(){return N.apply(this,arguments)}),groupStudentDemandList:function(){var e=this,t=new Y(this.studentDemandList,["year","termId","gradeId","subjectId","classLevel","serviceCenterId","classtimeTimeClassify","classtimeTimePeriod"]).group().sort((function(e,t){return t.value.length-e.value.length})),a=t[0].value[0];this.studentDemandListSorted=[],t.forEach((function(t){var a;(a=e.studentDemandListSorted).push.apply(a,Object(c.a)(t.value))})),Object.assign(this.formData,{year:a.year,termId:a.termId,termName:a.termName,subjectId:a.subjectId,subjectName:a.subjectName,gradeId:a.gradeId,gradeName:a.gradeName,classLevel:a.classLevel,classLevelName:a.classLevelName,serviceCenterId:a.serviceCenterId,serviceCenterName:a.serviceCenterName,classtimeTimePeriod:a.classtimeTimePeriod.split(",")[0],classtimeTimeClassify:a.classtimeTimeClassify.split(",")[0],remark:"",assembleClassDemandIds:this.studentDemandListSorted.map((function(e){return e.id})),intentionNumber:this.studentDemandListSorted.length,classType:a.classType}),this.serviceCenterList=[{schoolId:this.formData.serviceCenterId,name:this.formData.serviceCenterName}]},apply:function(){var e=this;this.$refs.formValidate.validate((function(t){t&&e.$refs.formValidate2.validate((function(t){if(t){e.confirmLoading=!0;var a=Object.assign({},e.formData,{receptionEmpName:e.formData.receptionEmpName.split("-")[0]});console.log(a),Object(d.y)(a).then((function(){setTimeout((function(){e.$Message.success({content:"提交成功"}),e.$emit("close"),e.$emit("success"),e.confirmLoading=!1}),1e3)})).catch((function(t){e.confirmLoading=!1,e.$Message.error({content:"提交失败: ".concat(t.message),duration:5})}))}}))}))},approval:function(){var e=this;this.$refs.formValidate.validate((function(t){t&&e.$refs.formValidate2.validate((function(t){if(t){var a="";a=2===e.formData.status?e.formData.failReason:e.formData.remark,e.confirmLoading=!0;var r={accessId:e.formData.id,status:e.formData.status,remark:a,classId:e.formData.classId,cityCode:e.formData.cityCode};console.log(r),Object(d.t)(r).then((function(){setTimeout((function(){e.$Message.success({content:"审批成功"}),e.$emit("close"),e.$emit("success"),e.confirmLoading=!1}),1e3)})).catch((function(t){e.confirmLoading=!1,e.$Message.error({content:"审批失败: ".concat(t.message),duration:5})}))}}))}))},confirm:function(){1===this.type?this.apply():3===this.type&&this.approval()},initFormOptions:function(){this.getBaseDataTermList(),this.getYears(),this.getSubjectList(),this.getGradeList(),this.getTimeList(),this.getTimeTypeList(),this.queryLevelDegreeList()}}},X=(a("a176"),Object(p.a)(J,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("h3",{staticStyle:{"margin-bottom":"20px"}},[e._v("意向攒班需求")]),e._v(" "),a("Form",{ref:"formValidate",attrs:{inline:"","label-width":90,model:e.formData,rules:e.ruleValidate}},[a("FormItem",{attrs:{label:"年份",prop:"year"}},[a("Select",{staticStyle:{width:"150px"},attrs:{clearable:"",disabled:1!==e.type},model:{value:e.formData.year,callback:function(t){e.$set(e.formData,"year",t)},expression:"formData.year"}},e._l(e.yearList,(function(t,r){return a("Option",{key:r,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),e._v(" "),a("FormItem",{attrs:{label:"意向学期",prop:"termId"}},[a("Select",{staticStyle:{width:"150px"},attrs:{clearable:"","label-in-value":"",disabled:1!==e.type},on:{"on-change":function(t){return e.handleSelectChange(t,"termName")}},model:{value:e.formData.termId,callback:function(t){e.$set(e.formData,"termId",t)},expression:"formData.termId"}},e._l(e.termList.slice(0,4),(function(t,r){return a("Option",{key:r,attrs:{value:t.standardId}},[e._v(e._s(t.standardName))])})),1)],1),e._v(" "),a("FormItem",{attrs:{label:"年级",prop:"gradeId"}},[a("Select",{staticStyle:{width:"150px"},attrs:{clearable:"","label-in-value":"",disabled:1!==e.type},on:{"on-change":function(t){return e.handleSelectChange(t,"gradeName")}},model:{value:e.formData.gradeId,callback:function(t){e.$set(e.formData,"gradeId",t)},expression:"formData.gradeId"}},e._l(e.gradeList,(function(t,r){return a("Option",{key:r,attrs:{value:t.standardId}},[e._v(e._s(t.standardName))])})),1)],1),e._v(" "),a("FormItem",{attrs:{label:"意向学科",prop:"subjectId"}},[a("Select",{staticStyle:{width:"150px"},attrs:{clearable:"","label-in-value":"",disabled:1!==e.type},on:{"on-change":function(t){return e.handleSelectChange(t,"subjectName")}},model:{value:e.formData.subjectId,callback:function(t){e.$set(e.formData,"subjectId",t)},expression:"formData.subjectId"}},e._l(e.subjectList,(function(t,r){return a("Option",{key:r,attrs:{value:t.schoolId}},[e._v(e._s(t.customName))])})),1)],1),e._v(" "),a("FormItem",{attrs:{label:"班次级别",prop:"classLevel"}},[a("Select",{staticStyle:{width:"150px"},attrs:{clearable:"","label-in-value":"",disabled:1!==e.type},on:{"on-change":function(t){return e.handleSelectChange(t,"classLevelName")}},model:{value:e.formData.classLevel,callback:function(t){e.$set(e.formData,"classLevel",t)},expression:"formData.classLevel"}},e._l(e.classLevelList,(function(t,r){return a("Option",{key:r,attrs:{value:t.schoolId}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),a("FormItem",{attrs:{label:"授课类型",prop:"classType"}},[a("Select",{staticStyle:{width:"150px"},attrs:{disabled:1!==e.type},model:{value:e.formData.classType,callback:function(t){e.$set(e.formData,"classType",t)},expression:"formData.classType"}},e._l(e.classTypeList,(function(t){return a("Option",{key:t.id,attrs:{value:t.id,disabled:!e.$haveAuthority("roleRelativeData",e.classTypeRuleMap[t.id])}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),2===e.formData.classType||4===e.formData.classType?[a("FormItem",{attrs:{label:"意向服务中心",prop:"serviceCenterId"}},[a("Select",{staticStyle:{width:"150px"},attrs:{clearable:"",filterable:"","remote-method":function(t){return e.getServiceCenterList(t,e.formData.cityCode)},"label-in-value":"",disabled:1!==e.type},on:{"on-change":function(t){return e.handleSelectChange(t,"serviceCenterName")}},model:{value:e.formData.serviceCenterId,callback:function(t){e.$set(e.formData,"serviceCenterId",t)},expression:"formData.serviceCenterId"}},e._l(e.serviceCenterList,(function(t,r){return a("Option",{key:r,attrs:{value:t.schoolId}},[e._v(e._s(t.name))])})),1)],1)]:e._e(),e._v(" "),a("FormItem",{attrs:{label:"意向上课时间",prop:"classtimeTimeClassify"}},[a("Select",{staticStyle:{width:"150px"},attrs:{clearable:"",disabled:1!==e.type},model:{value:e.formData.classtimeTimeClassify,callback:function(t){e.$set(e.formData,"classtimeTimeClassify",t)},expression:"formData.classtimeTimeClassify"}},e._l(e.timeTypeList,(function(t,r){return a("Option",{key:r,attrs:{value:t.name}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),a("FormItem",{attrs:{label:"意向上课时段",prop:"classtimeTimePeriod"}},[a("Select",{staticStyle:{width:"150px"},attrs:{clearable:"",disabled:1!==e.type},model:{value:e.formData.classtimeTimePeriod,callback:function(t){e.$set(e.formData,"classtimeTimePeriod",t)},expression:"formData.classtimeTimePeriod"}},e._l(e.timeList,(function(t,r){return a("Option",{key:r,attrs:{value:t.name}},[e._v(e._s(t.name))])})),1)],1)],2),e._v(" "),e._m(0),e._v(" "),a("h4",{staticStyle:{"margin-top":"20px","margin-bottom":"10px"}},[e._v("意向人数: "),a("span",{staticStyle:{color:"red"}},[e._v(e._s(e.studentDemandListSorted.length))])]),e._v(" "),a("Table",{attrs:{border:"",columns:e.columns,data:e.studentDemandListSorted,loading:e.tableLoading}}),e._v(" "),1!==e.type?a("div",{staticStyle:{margin:"20px 0","padding-left":"40px"}},e._l(e.assessLogs,(function(t,r){return a("div",{key:r,staticStyle:{"margin-bottom":"10px"}},["add"===t.logType?[a("h3",{staticStyle:{"margin-left":"-20px","margin-bottom":"10px"}},[e._v("发起记录")]),e._v(" "),a("Row",[a("Col",{attrs:{span:"4"}},[e._v("发起人: "+e._s(t.creatorName||"--"))]),e._v(" "),a("Col",{attrs:{span:"4"}},[e._v("发起人工号: "+e._s(t.creator||"--"))]),e._v(" "),a("Col",{staticStyle:{"margin-bottom":"10px"},attrs:{span:"16"}},[e._v("申请时间: "+e._s(t.createDate))]),e._v(" "),a("Col",{attrs:{span:"24"}},[e._v("备注: "+e._s(t.remark||"--"))])],1)]:[a("h3",{staticStyle:{margin:"20px 0 10px -20px"}},[e._v("审批记录")]),e._v(" "),a("Row",[a("Col",{attrs:{span:"4"}},[e._v("审批人: "+e._s(t.creatorName||"--"))]),e._v(" "),a("Col",{attrs:{span:"4"}},[e._v("审批人工号: "+e._s(t.creator||"--"))]),e._v(" "),a("Col",{staticStyle:{"margin-bottom":"10px"},attrs:{span:"16"}},[e._v("审批时间: "+e._s(t.createDate))]),e._v(" "),a("Col",{staticStyle:{"margin-bottom":"10px"},attrs:{span:"4"}},[e._v("开班状态: "+e._s("success"===t.logType?"开班成功":"fail"===t.logType?"开班失败":"--"))]),e._v(" "),a("Col",{attrs:{span:"16"}},[e._v("开班班级ID: "+e._s(t.assembleClassId||"--"))]),e._v(" "),a("Col",{attrs:{span:"24"}},[e._v(e._s("success"===t.logType?"备注":"失败原因")+": "+e._s(t.approvalRemark||"--"))])],1)]],2)})),0):e._e(),e._v(" "),a("Form",{ref:"formValidate2",staticStyle:{margin:"20px 0"},attrs:{inline:"","label-width":90,model:e.formData,rules:e.ruleValidate}},[1===e.type?a("FormItem",{attrs:{label:"审批人",prop:"receptionEmpNo"}},[a("Select",{staticStyle:{width:"150px"},attrs:{filterable:"",clearable:"",remote:"","remote-method":function(t){return e.getAdvisorEmpNos(t,e.formData.cityCode)},"label-in-value":""},on:{"on-change":function(t){return e.handleSelectChange(t,"receptionEmpName")}},model:{value:e.formData.receptionEmpNo,callback:function(t){e.$set(e.formData,"receptionEmpNo",t)},expression:"formData.receptionEmpNo"}},e._l(e.advisorEmpNos,(function(t){return a("Option",{key:t.empNo,attrs:{value:t.empNo}},[e._v(e._s(t.name)+"-"+e._s(t.empNo))])})),1)],1):e._e(),e._v(" "),3===e.type?[a("FormItem",{attrs:{label:"开班状态",prop:"status"}},[a("Select",{staticStyle:{width:"150px"},on:{"on-change":e.handleStatusChange},model:{value:e.formData.status,callback:function(t){e.$set(e.formData,"status",t)},expression:"formData.status"}},e._l(e.openClassStatusList,(function(t,r){return a("Option",{key:r,attrs:{value:t.value}},[e._v(e._s(t.label))])})),1)],1),e._v(" "),1===e.formData.status?a("FormItem",{attrs:{label:"开班班级ID",prop:"classId"}},[a("Input",{attrs:{clearable:""},model:{value:e.formData.classId,callback:function(t){e.$set(e.formData,"classId",t)},expression:"formData.classId"}})],1):e._e()]:e._e(),e._v(" "),1!==e.type&&3!==e.type||1!==e.formData.status?e._e():a("FormItem",{staticClass:"disabled-required",attrs:{label:"备注",prop:"remark"}},[a("Input",{staticStyle:{width:"740px"},attrs:{type:"textarea",autosize:{minRows:3,maxRows:10},placeholder:"请输入",maxlength:200},model:{value:e.formData.remark,callback:function(t){e.$set(e.formData,"remark",t)},expression:"formData.remark"}})],1),e._v(" "),1!==e.type&&3!==e.type||2!==e.formData.status?e._e():a("FormItem",{attrs:{label:"失败原因",prop:"failReason"}},[a("Input",{staticStyle:{width:"740px"},attrs:{type:"textarea",autosize:{minRows:3,maxRows:10},placeholder:"请输入",maxlength:200},model:{value:e.formData.failReason,callback:function(t){e.$set(e.formData,"failReason",t)},expression:"formData.failReason"}})],1)],2),e._v(" "),1===e.type||3===e.type?a("Row",{attrs:{type:"flex",justify:"center",gutter:20}},[a("Col",[a("Button",{attrs:{type:"primary",loading:e.confirmLoading},on:{click:e.confirm}},[e._v(e._s(1===e.type?"提交申请":3===e.type?"审批":""))])],1),e._v(" "),a("Col",[a("Button",{attrs:{loading:e.confirmLoading},on:{click:function(t){return e.$emit("close")}}},[e._v("取消")])],1)],1):e._e()],1)}),[function(){var e=this.$createElement,t=this._self._c||e;return t("h3",[this._v("\n    意向攒班需求名单\n    "),t("span",{staticStyle:{color:"red"}},[this._v("特别提醒：请参照开班年级限额勾选攒班学员数量，避免攒班成功用户不能报入目标班次！")])])}],!1,null,"4573bb20",null).exports),K=a("2472"),Z={name:"cuanbanMgt",mixins:[$,s.a,o.a,m.a],components:{DemandPool:f,OpenClassAssessList:P,CuanbanList:B,CreateCuanban:G,OpenClassAssessApproval:X},data:function(){return{showCreateCuanbanModal:!1,setDefaultServiceCenter:!0,formData:{cityCode:"",year:(new Date).getFullYear()+"",serviceCenterId:"",termId:"",gradeId:"",subjectId:"",classLevel:"",status:"",classtimeTimeClassify:"",classtimeTimePeriods:"",intention:"",payStatus:"",registStatus:"",creator:"",receptionAdvisorEmpNo:"",name:"",phone:"",studentCard:"",time:"",startCreateDate:"",endCreateDate:"",classType:1},activeTab:"demandPool",createCuanbanType:1,createCuanbanTypeName:"",oldCuanbanDemand:{},openClassAssessApproval:{showModal:!1,studentDemandList:[],accessId:"",type:1},qrCode:{showModal:!1,activityCodeUrl:""},classTypeList:[],classTypeRuleMap:{1:"operative/cuanbanMgt/zaixian",2:"operative/cuanbanMgt/shuangshi",4:"operative/cuanbanMgt/mianshou"}}},mounted:function(){this.initCityList()},methods:{optDateChange:function(e,t,a){this.formData[t]=e[0],this.formData[a]=e[1]},showQrcode:(M=Object(i.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(d.n)({cityCode:this.formData.cityCode});case 3:t=e.sent,Object.assign(this.qrCode,t),this.qrCode.showModal=!0,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),this.$Message.error({content:"获取分校攒班二维码失败: ".concat(e.t0.message),duration:5});case 11:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(){return M.apply(this,arguments)}),handleApprovalAssess:function(e){this.openClassAssessApproval.accessId=e,this.openClassAssessApproval.type=3,this.openClassAssessApproval.showModal=!0},handleCheckAssess:function(e){this.openClassAssessApproval.accessId=e,this.openClassAssessApproval.type=2,this.openClassAssessApproval.showModal=!0},handleSubmitOpenClassAssessApproval:function(e){this.openClassAssessApproval.type=1,this.openClassAssessApproval.studentDemandList=e,this.openClassAssessApproval.showModal=!0},handleCreateCuanbanSuccess:function(){"demandPool"===this.activeTab&&this.search()},checkCuanbanDemand:function(e){this.oldCuanbanDemand=e,this.createCuanbanType=3,this.createCuanbanTypeName="查看攒班需求",this.showCreateCuanbanModal=!0},updateCuanbanDemand:function(e){this.oldCuanbanDemand=e,this.createCuanbanType=2,this.createCuanbanTypeName="修改攒班需求",this.showCreateCuanbanModal=!0},search:function(){this.$refs[this.activeTab].search()},getCurrentserviceCenter:(j=Object(i.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(K.e)({cityCode:this.formData.cityCode,empNo:JSON.parse(E.a.get("columbusUserInfo")).id});case 3:(t=e.sent).serviceCenterId&&t.serviceCenterName&&(this.serviceCenterList=[{schoolId:t.serviceCenterId,name:t.serviceCenterName}],this.formData.serviceCenterId=t.serviceCenterId),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),this.$Message.error({content:"获取当前顾问所在服务中心失败: "+e.t0.message,duration:5});case 10:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(){return j.apply(this,arguments)}),onCityChange:function(e){this.formData.cityCode=e,this.initOtherFrmOptions()},initCityList:(O=Object(i.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getCityList();case 2:this.getCurrentserviceCenter(),this.initOtherFrmOptions();case 4:case"end":return e.stop()}}),e,this)}))),function(){return O.apply(this,arguments)}),initOtherFrmOptions:function(){this.getBaseDataTermList(),this.getYears(),this.getSubjectList(),this.getGradeList(),this.queryLevelDegreeList(),this.getTimeTypeList(),this.getTimeList(),this.getClassTypeList()},getClassTypeList:function(){var e=this;Object(g.e)({}).then((function(t){e.classTypeList=t})).catch((function(t){e.$Message.warning({content:"获取授课类型失败:"+t.message,duration:5})}))}}},ee=(a("287d"),Object(p.a)(Z,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticStyle:{width:"100%",padding:"10px"}},[r("Form",{ref:"form",staticClass:"mrg-b filter-search",staticStyle:{padding:"10px 0",background:"#fff"},attrs:{model:e.formData,"label-position":"right","label-width":15,inline:""}},[r("div",{staticClass:"class_top clearfix"},[r("FormItem",{attrs:{required:"",label:" "}},[r("Select",{staticStyle:{width:"120px"},attrs:{placeholder:"城市",filterable:""},on:{"on-change":e.onCityChange},model:{value:e.formData.cityCode,callback:function(t){e.$set(e.formData,"cityCode",t)},expression:"formData.cityCode"}},e._l(e.cityList,(function(t,a){return r("Option",{key:a,attrs:{value:t.id}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),r("FormItem",{attrs:{label:" ",required:""}},[r("Select",{staticStyle:{width:"120px"},attrs:{placeholder:"授课类型"},model:{value:e.formData.classType,callback:function(t){e.$set(e.formData,"classType",t)},expression:"formData.classType"}},e._l(e.classTypeList,(function(t){return r("Option",{key:t.id,attrs:{value:t.id,disabled:!e.$haveAuthority("roleRelativeData",e.classTypeRuleMap[t.id])}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),2===e.formData.classType||4===e.formData.classType?[r("FormItem",[r("Select",{ref:"serviceCenterRef",staticStyle:{width:"150px"},attrs:{placeholder:"意向服务中心",clearable:"",filterable:"","remote-method":function(t){return e.getServiceCenterList(t,e.formData.cityCode)}},model:{value:e.formData.serviceCenterId,callback:function(t){e.$set(e.formData,"serviceCenterId",t)},expression:"formData.serviceCenterId"}},e._l(e.serviceCenterList,(function(t,a){return r("Option",{key:a,attrs:{value:t.schoolId}},[e._v(e._s(t.name))])})),1)],1)]:e._e(),e._v(" "),r("FormItem",[r("Select",{staticStyle:{width:"120px"},attrs:{placeholder:"攒班年份",clearable:""},model:{value:e.formData.year,callback:function(t){e.$set(e.formData,"year",t)},expression:"formData.year"}},e._l(e.yearList,(function(t,a){return r("Option",{key:a,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),e._v(" "),r("FormItem",[r("Select",{staticStyle:{width:"120px"},attrs:{placeholder:"意向学期",clearable:""},model:{value:e.formData.termId,callback:function(t){e.$set(e.formData,"termId",t)},expression:"formData.termId"}},e._l(e.termList.slice(0,4),(function(t,a){return r("Option",{key:a,attrs:{value:t.standardId}},[e._v(e._s(t.standardName))])})),1)],1),e._v(" "),r("FormItem",[r("Select",{staticStyle:{width:"120px"},attrs:{clearable:"",placeholder:"年级"},model:{value:e.formData.gradeId,callback:function(t){e.$set(e.formData,"gradeId",t)},expression:"formData.gradeId"}},e._l(e.gradeList,(function(t,a){return r("Option",{key:a,attrs:{value:t.standardId}},[e._v(e._s(t.standardName))])})),1)],1),e._v(" "),r("FormItem",[r("Select",{staticStyle:{width:"120px"},attrs:{clearable:"",placeholder:"意向学科"},model:{value:e.formData.subjectId,callback:function(t){e.$set(e.formData,"subjectId",t)},expression:"formData.subjectId"}},e._l(e.subjectList,(function(t,a){return r("Option",{key:a,attrs:{value:t.schoolId}},[e._v(e._s(t.customName))])})),1)],1),e._v(" "),r("FormItem",[r("Select",{staticStyle:{width:"120px"},attrs:{clearable:"",placeholder:"班次级别"},model:{value:e.formData.classLevel,callback:function(t){e.$set(e.formData,"classLevel",t)},expression:"formData.classLevel"}},e._l(e.classLevelList,(function(t,a){return r("Option",{key:a,attrs:{value:t.schoolId}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),"demandPool"===e.activeTab?[r("FormItem",[r("Select",{staticStyle:{width:"120px"},attrs:{clearable:"",placeholder:"攒班状态"},model:{value:e.formData.status,callback:function(t){e.$set(e.formData,"status",t)},expression:"formData.status"}},e._l(e.cuanbanStatusList,(function(t,a){return r("Option",{key:a,attrs:{value:t.value}},[e._v(e._s(t.label))])})),1)],1),e._v(" "),r("FormItem",[r("Select",{staticStyle:{width:"120px"},attrs:{clearable:"",placeholder:"意向上课时间"},model:{value:e.formData.classtimeTimeClassify,callback:function(t){e.$set(e.formData,"classtimeTimeClassify",t)},expression:"formData.classtimeTimeClassify"}},e._l(e.timeTypeList,(function(t,a){return r("Option",{key:a,attrs:{value:t.name}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),r("FormItem",[r("Select",{staticStyle:{width:"120px"},attrs:{clearable:"",placeholder:"意向上课时段"},model:{value:e.formData.classtimeTimePeriod,callback:function(t){e.$set(e.formData,"classtimeTimePeriod",t)},expression:"formData.classtimeTimePeriod"}},e._l(e.timeList,(function(t,a){return r("Option",{key:a,attrs:{value:t.name}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),r("FormItem",[r("Select",{staticStyle:{width:"120px"},attrs:{clearable:"",placeholder:"意向度"},model:{value:e.formData.intention,callback:function(t){e.$set(e.formData,"intention",t)},expression:"formData.intention"}},e._l(e.intentionList,(function(t,a){return r("Option",{key:a,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),e._v(" "),r("FormItem",[r("Select",{staticStyle:{width:"140px"},attrs:{clearable:"",placeholder:"攒班班级报名状态"},model:{value:e.formData.registStatus,callback:function(t){e.$set(e.formData,"registStatus",t)},expression:"formData.registStatus"}},e._l(e.registStatusList,(function(t,a){return r("Option",{key:a,attrs:{value:t.value}},[e._v(e._s(t.label))])})),1)],1),e._v(" "),r("FormItem",[r("Select",{staticStyle:{width:"140px"},attrs:{clearable:"",placeholder:"攒班班级缴费状态"},model:{value:e.formData.payStatus,callback:function(t){e.$set(e.formData,"payStatus",t)},expression:"formData.payStatus"}},e._l(e.payStatusList,(function(t,a){return r("Option",{key:a,attrs:{value:t.value}},[e._v(e._s(t.label))])})),1)],1),e._v(" "),r("FormItem",[r("Select",{staticStyle:{width:"150px"},attrs:{filterable:"",clearable:"",remote:"","remote-method":function(t){return e.getAdvisorEmpNos(t,e.formData.cityCode)},"label-in-value":"",placeholder:"创建人"},model:{value:e.formData.creator,callback:function(t){e.$set(e.formData,"creator",t)},expression:"formData.creator"}},e._l(e.advisorEmpNos,(function(t){return r("Option",{key:t.empNo,attrs:{value:t.empNo}},[e._v(e._s(t.remark))])})),1)],1),e._v(" "),r("FormItem",[r("DatePicker",{staticStyle:{width:"200px"},attrs:{placeholder:"创建时间",type:"daterange",editable:!1},on:{"on-change":function(t){return e.optDateChange(t,"startCreateDate","endCreateDate")}},model:{value:e.formData.time,callback:function(t){e.$set(e.formData,"time",t)},expression:"formData.time"}})],1),e._v(" "),r("FormItem",[r("Select",{staticStyle:{width:"150px"},attrs:{filterable:"",clearable:"",remote:"","remote-method":function(t){return e.getAdvisorEmpNos(t,e.formData.cityCode)},"label-in-value":"",placeholder:"接待顾问"},model:{value:e.formData.receptionAdvisorEmpNo,callback:function(t){e.$set(e.formData,"receptionAdvisorEmpNo",t)},expression:"formData.receptionAdvisorEmpNo"}},e._l(e.advisorEmpNos,(function(t){return r("Option",{key:t.empNo,attrs:{value:t.empNo}},[e._v(e._s(t.name)+"-"+e._s(t.empNo))])})),1)],1),e._v(" "),r("FormItem",[r("Input",{attrs:{placeholder:"学员姓名",clearable:""},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1),e._v(" "),r("FormItem",[r("Input",{attrs:{number:"",placeholder:"学员手机号",clearable:""},model:{value:e.formData.phone,callback:function(t){e.$set(e.formData,"phone",t)},expression:"formData.phone"}})],1),e._v(" "),r("FormItem",[r("Input",{attrs:{placeholder:"学员编号",clearable:""},model:{value:e.formData.studentCard,callback:function(t){e.$set(e.formData,"studentCard",t)},expression:"formData.studentCard"}})],1)]:e._e(),e._v(" "),r("div",{staticStyle:{"text-align":"right","margin-bottom":"10px"}},[r("Button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary"},on:{click:e.search}},[e._v("查询")]),e._v(" "),r("Button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary"},on:{click:e.showQrcode}},[e._v("分校攒班二维码")]),e._v(" "),r("Button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary"},on:{click:function(t){e.createCuanbanType=1,e.createCuanbanTypeName="新增攒班需求",e.showCreateCuanbanModal=!0}}},[e._v("新增")])],1)],2)]),e._v(" "),r("div",{staticStyle:{background:"#fff","margin-top":"20px",padding:"10px"}},[r("Tabs",{attrs:{type:"card",animated:!1},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[r("TabPane",{attrs:{label:"攒班需求池",name:"demandPool"}},[r("DemandPool",{ref:"demandPool",attrs:{parentFormData:e.formData},on:{updateCuanbanDemand:e.updateCuanbanDemand,checkCuanbanDemand:e.checkCuanbanDemand,submitOpenClassAssessApproval:e.handleSubmitOpenClassAssessApproval}})],1),e._v(" "),r("TabPane",{attrs:{label:"开班评估列表",name:"openClassAssessList"}},[r("OpenClassAssessList",{ref:"openClassAssessList",attrs:{parentFormData:e.formData},on:{check:e.handleCheckAssess,approval:e.handleApprovalAssess}})],1),e._v(" "),r("TabPane",{attrs:{label:"攒班班级列表",name:"cuanbanList"}},[r("CuanbanList",{ref:"cuanbanList",attrs:{parentFormData:e.formData},on:{showClassDetail:e.showClassDetail,showTeacherDetail:e.showTeacherDetail}})],1)],1)],1),e._v(" "),r("Modal",{attrs:{"mask-closable":!1,title:e.createCuanbanTypeName,"footer-hide":!0,width:"1050px"},model:{value:e.showCreateCuanbanModal,callback:function(t){e.showCreateCuanbanModal=t},expression:"showCreateCuanbanModal"}},[e.showCreateCuanbanModal?r("CreateCuanban",{attrs:{type:e.createCuanbanType,oldFormData:e.oldCuanbanDemand,classTypeList:e.classTypeList,classTypeRuleMap:e.classTypeRuleMap},on:{close:function(t){e.showCreateCuanbanModal=!1},success:e.handleCreateCuanbanSuccess}}):e._e()],1),e._v(" "),r("TalClassDetail",{attrs:{"class-id":e.classDetail.id,show:e.classDetail.show},on:{close:function(t){e.classDetail.show=!1}}}),e._v(" "),r("TalTeacherDetails",{ref:"teacherRef",attrs:{schoolCode:e.teacherDetail.cityCode,teacherId:e.teacherDetail.id,type:e.teacherDetail.type}}),e._v(" "),r("Modal",{attrs:{"mask-closable":!1,title:"开班评估审批","footer-hide":!0,width:"1050px"},model:{value:e.openClassAssessApproval.showModal,callback:function(t){e.$set(e.openClassAssessApproval,"showModal",t)},expression:"openClassAssessApproval.showModal"}},[e.openClassAssessApproval.showModal?r("OpenClassAssessApproval",{attrs:{type:e.openClassAssessApproval.type,parentFormData:e.formData,accessId:e.openClassAssessApproval.accessId,studentDemandList:e.openClassAssessApproval.studentDemandList,classTypeRuleMap:e.classTypeRuleMap,classTypeList:e.classTypeList},on:{close:function(t){e.openClassAssessApproval.showModal=!1},success:e.search}}):e._e()],1),e._v(" "),r("Modal",{attrs:{"mask-closable":!1,title:"分校攒班二维码","footer-hide":!0,width:"350px"},model:{value:e.qrCode.showModal,callback:function(t){e.$set(e.qrCode,"showModal",t)},expression:"qrCode.showModal"}},[r("div",{staticClass:"qr-wrap"},[r("img",{staticClass:"qr-bg",attrs:{src:a("a7fd"),alt:""}}),e._v(" "),r("img",{staticClass:"qr-img",attrs:{src:e.qrCode.activityCodeUrl,alt:""}})])])],1)}),[],!1,null,"2f9ad572",null));t.default=ee.exports},"6ec6":function(e,t,a){"use strict";a("96cf");var r,n=a("3b8d"),i=a("2472");t.a={data:function(){return{queryData:{card:"",cityCode:""},classInfo:{type:Object,default:function(){return{}}}}},mounted:function(){this.initStu()},methods:{initStu:(r=Object(n.a)(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!this.$route.query){e.next=9;break}if(this.$route.query.card&&"undefined"!==this.$route.query.card&&(this.queryData.card=String(this.$route.query.card)),this.$route.query.cityCode&&"undefined"!==this.$route.query.cityCode&&(this.queryData.cityCode=String(this.$route.query.cityCode)),!this.$route.query.classId){e.next=8;break}return e.next=7,Object(i.d)({classId:this.$route.query.classId});case 7:this.classInfo=e.sent;case 8:this.queryData.card&&this.queryData.cityCode&&this.$nextTick((function(){t.$refs.stuSearch.searchStuByUid({card:t.queryData.card,realName:"",phone:"",cityCode:t.queryData.cityCode,current:1})}));case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),this.$Message.error("初始化错误："+e.t0||!1);case 14:case"end":return e.stop()}}),e,this,[[0,11]])}))),function(){return r.apply(this,arguments)})}}},7022:function(e,t,a){},"736c":function(e,t,a){"use strict";a.d(t,"u",(function(){return n})),a.d(t,"c",(function(){return i})),a.d(t,"l",(function(){return s})),a.d(t,"o",(function(){return o})),a.d(t,"i",(function(){return c})),a.d(t,"y",(function(){return l})),a.d(t,"w",(function(){return u})),a.d(t,"g",(function(){return d})),a.d(t,"m",(function(){return m})),a.d(t,"v",(function(){return h})),a.d(t,"t",(function(){return p})),a.d(t,"n",(function(){return f})),a.d(t,"x",(function(){return g})),a.d(t,"e",(function(){return v})),a.d(t,"s",(function(){return y})),a.d(t,"p",(function(){return b})),a.d(t,"q",(function(){return C})),a.d(t,"d",(function(){return D})),a.d(t,"k",(function(){return w})),a.d(t,"z",(function(){return k})),a.d(t,"f",(function(){return _})),a.d(t,"a",(function(){return S})),a.d(t,"b",(function(){return T})),a.d(t,"j",(function(){return I})),a.d(t,"h",(function(){return L})),a.d(t,"r",(function(){return x}));var r=a("66df"),n=function(e){return r.a.request({url:"/assembleClass/queryAssembleClassDemandPage",data:e,method:"POST"})},i=function(e){return r.a.request({url:"/assembleClass/addAssembleClassDemand",data:e,method:"post"})},s=function(e){return r.a.request({url:"/assembleClass/editAssembleClassDemand",data:e,method:"post"})},o=function(e){return r.a.request({url:"/assembleClass/getAssembleClassDemandInfoById",params:e,method:"get"})},c=function(e){return r.a.request({url:"/assembleClass/cancelAssembleClassDemand",params:e,method:"get"})},l=function(e){return r.a.request({url:"/assembleClassAssess/submit",data:e,method:"post"})},u=function(e){return r.a.request({url:"/assembleClassAssess/queryPage",data:e,method:"POST"})},d=function(e){return r.a.request({url:"/assembleClassAssess/assembleRecordList",params:e,method:"get"})},m=function(e){return r.a.request({url:"/assembleClassAssess/findList",data:e,method:"post"})},h=function(e){return r.a.request({url:"/assembleClassAssess/queryDetailById",params:e,method:"get"})},p=function(e){return r.a.request({url:"/assembleClassAssess/operate",params:e,method:"get"})},f=function(e){return r.a.request({url:"/assembleClass/getAssembleClassActivity",params:e,method:"get"})},g=function(e){return r.a.request({url:"/assembleClass/queryStudentDemandListByAssembleId",params:e,method:"get"})},v=function(e){return r.a.request({url:"/assembleClassAssess/addSingleDemandRelate",params:e,method:"get"})},y=function(e){return r.a.request({url:"/groupAssembleClass/getTotalList",data:e,method:"post"})},b=function(e){return r.a.request({url:"/groupAssembleClass/getById",params:e,method:"get"})},C=function(e){return r.a.request({url:"/groupAssembleClass/getPage",data:e,method:"post"})},D=function(e){return r.a.request({url:"/groupAssembleClass/updateOrInsert",data:e,method:"post"})},w=function(e){return r.a.request({url:"/excel/downloadExcel",params:e,method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded"},responseType:"blob"})},k=function(e){return r.a.request({url:"/excel/upLoadFile",params:e,method:"get"})},_=function(e){return r.a.request({url:"/groupAssembleClass/addStu",data:e,method:"post"})},S=function(e){return r.a.request({url:"/groupAssembleClass/activityOnline",data:e,method:"post"})},T=function(e){return r.a.request({url:"/groupAssembleClass/activityOnlineAll",data:e,method:"post"})},I=function(e){return r.a.request({url:"/groupAssembleClass/confirmOpenClass",params:e,method:"get"})},L=function(e){return r.a.request({url:"/groupAssembleClass/getUserList",data:e,method:"post"})},x=function(e){return r.a.request({url:"/groupAssembleClass/getRegistTimeByClass",params:e,method:"get"})}},"7bbc":function(e,t,a){var r=a("6821"),n=a("9093").f,i={}.toString,s="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return s&&"[object Window]"==i.call(e)?function(e){try{return n(e)}catch(e){return s.slice()}}(e):n(r(e))}},"7d74":function(e,t,a){"use strict";a.r(t);a("8e6e"),a("cadf"),a("456d");var r=a("75fc"),n=(a("28a5"),a("55dd"),a("ac6a"),a("96cf"),a("3b8d")),i=a("bd86"),s=(a("0d6d"),a("c5f6"),{props:{min:{type:Number,default:0},max:{type:Number,default:999999999},initCount:{type:Number,default:0},edit:{type:Boolean,default:!1},isEditSelf:{type:Boolean,default:!0}},watch:{edit:function(){this.isEdit=this.edit},initCount:function(){this.count=this.initCount}},computed:{isError:function(){return this.count>this.max||this.count<this.min}},data:function(){return{count:100,isEdit:!1}},mounted:function(){this.count=this.initCount},methods:{save:function(){return this.count<this.min?(this.reset(),this.$Message.warning({content:"最小值为".concat(this.min)})):this.count>this.max?(this.reset(),this.$Message.warning({content:"最大值为".concat(this.max)})):(this.$emit("save",this.count),void(this.isEdit=!1))},close:function(){this.reset()},reset:function(){this.count=this.initCount,this.isEdit=!1}}}),o=(a("db66"),a("2877")),c=Object(o.a)(s,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"count-edit"},[a("div",[e.isEdit?a("InputNumber",{class:{error:e.isError},staticStyle:{width:"65px"},attrs:{size:"small",max:e.max,min:e.min},on:{"on-change":function(t){return e.$emit("input",e.count)}},model:{value:e.count,callback:function(t){e.count=t},expression:"count"}}):a("span",{staticStyle:{width:"50px"}},[e._v(e._s(e.count||"-"))])],1),e._v(" "),e.isEditSelf?[a("div",{staticClass:"btns"},[e.isEdit?[a("Icon",{staticClass:"btn checkmark",staticStyle:{"margin-right":"2px"},attrs:{type:"ios-checkmark-circle"},on:{click:e.save}}),e._v(" "),a("Icon",{staticClass:"btn close",attrs:{type:"ios-close-circle"},on:{click:e.close}})]:a("Icon",{staticClass:"btn",attrs:{type:"ios-create-outline"},on:{click:function(t){e.isEdit=!0}}})],2)]:e._e()],2)}),[],!1,null,"613eccdf",null).exports,l=a("6167"),u=a("5523"),d=a("2f62"),m={props:{edit:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}}},h=(a("9289"),Object(o.a)(m,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"edit-button"},[e.edit?[a("Button",{staticStyle:{"margin-right":"8px"},attrs:{type:"default",size:"small",loading:e.loading},on:{click:function(t){return e.$emit("cancel")}}},[e._v("取消")]),e._v(" "),a("Button",{attrs:{type:"primary",size:"small",loading:e.loading},on:{click:function(t){return e.$emit("save")}}},[e._v("保存")])]:a("a",{attrs:{href:"javscript: void(0)"},on:{click:function(t){return e.$emit("edit")}}},[e._v("编辑")])],2)}),[],!1,null,"cc36bc50",null).exports),p=a("e61f");function f(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function g(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?f(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):f(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var v,y,b,C={props:{type:{type:Number,default:1}},components:{CountEdit:c,EditButton:h},computed:g({},Object(d.e)({userInfo:function(e){return e.roleRelativeData.userInfo},roleId:function(e){return e.roleRelativeData.userInfo.crmRoleId},cityCode:function(e){return e.roleRelativeData.userInfo.cityCode}})),watch:{cityCode:function(){this.initData()}},data:function(){var e=this;return{columns:[],columns1:[{title:"城市",key:"cityName",align:"center",fixed:"left",minWidth:80},{title:"区域",key:"areaName",align:"center",fixed:"left",minWidth:120},{title:"服务中心",key:"serviceCenterName",align:"center",fixed:"left",minWidth:140},{title:"服务中心编码",key:"serviceCenterCode",align:"center",fixed:"left",minWidth:120},{title:"2021年4月",key:"date",align:"center",children:[{title:"招新目标(人次)",key:"newRecruitsNum",align:"right",minWidth:100,render:function(e,t){return e(c,{props:{max:9999,min:0,initCount:t.row.trecruitmentTargetList[0].newRecruitsNum,edit:t.row.trecruitmentTargetList[0].isEdit,isEditSelf:!1},on:{input:function(e){t.row.trecruitmentTargetList[0].newRecruitsNum=e}}})}},{title:"转化产品目标(人数)",key:"convertProductNum",align:"right",minWidth:120,render:function(e,t){return e(c,{props:{max:9999,min:0,initCount:t.row.trecruitmentTargetList[0].convertProductNum,edit:t.row.trecruitmentTargetList[0].isEdit,isEditSelf:!1},on:{input:function(e){t.row.trecruitmentTargetList[0].convertProductNum=e}}})}},{title:"加微信目标(人头)",key:"addWechatNum",align:"right",minWidth:110,render:function(e,t){return e(c,{props:{max:9999,min:0,initCount:t.row.trecruitmentTargetList[0].addWechatNum,edit:t.row.trecruitmentTargetList[0].isEdit,isEditSelf:!1},on:{input:function(e){t.row.trecruitmentTargetList[0].addWechatNum=e}}})}},{title:"缴费目标(人次)",key:"paymentTargetNum",align:"right",minWidth:100,render:function(e,t){return e(c,{props:{max:9999,min:0,initCount:t.row.trecruitmentTargetList[0].paymentTargetNum,edit:t.row.trecruitmentTargetList[0].isEdit,isEditSelf:!1},on:{input:function(e){t.row.trecruitmentTargetList[0].paymentTargetNum=e}}})}},{title:"操作",key:"addWechatNum",align:"right",width:120,render:function(t,a){return t(h,{props:{edit:a.row.trecruitmentTargetList[0].isEdit,loading:a.row.trecruitmentTargetList[0].isLoading},on:{edit:function(){e.edit(a.row.trecruitmentTargetList[0])},cancel:function(){e.cancel(a.row.trecruitmentTargetList[0])},save:(r=Object(n.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.saveData(a.row.trecruitmentTargetList[0]);case 1:case"end":return t.stop()}}),t)}))),function(){return r.apply(this,arguments)})}});var r}}]},{title:"2021年4月",key:"date",align:"center",children:[{title:"招新目标(人次)",key:"newRecruitsNum",align:"right",minWidth:100,render:function(e,t){return e(c,{props:{max:9999,min:0,initCount:t.row.trecruitmentTargetList[1].newRecruitsNum,edit:t.row.trecruitmentTargetList[1].isEdit,isEditSelf:!1},on:{input:function(e){t.row.trecruitmentTargetList[1].newRecruitsNum=e}}})}},{title:"转化产品目标(人数)",key:"convertProductNum",align:"right",minWidth:120,render:function(e,t){return e(c,{props:{max:9999,min:0,initCount:t.row.trecruitmentTargetList[1].convertProductNum,edit:t.row.trecruitmentTargetList[1].isEdit,isEditSelf:!1},on:{input:function(e){t.row.trecruitmentTargetList[1].convertProductNum=e}}})}},{title:"加微信目标(人头)",key:"addWechatNum",align:"right",minWidth:110,render:function(e,t){return e(c,{props:{max:9999,min:0,initCount:t.row.trecruitmentTargetList[1].addWechatNum,edit:t.row.trecruitmentTargetList[1].isEdit,isEditSelf:!1},on:{input:function(e){t.row.trecruitmentTargetList[1].addWechatNum=e}}})}},{title:"缴费目标(人次)",key:"paymentTargetNum",align:"right",minWidth:100,render:function(e,t){return e(c,{props:{max:9999,min:0,initCount:t.row.trecruitmentTargetList[1].paymentTargetNum,edit:t.row.trecruitmentTargetList[1].isEdit,isEditSelf:!1},on:{input:function(e){t.row.trecruitmentTargetList[1].paymentTargetNum=e}}})}},{title:"操作",key:"addWechatNum",align:"right",width:120,render:function(t,a){return t(h,{props:{edit:a.row.trecruitmentTargetList[1].isEdit,loading:a.row.trecruitmentTargetList[1].isLoading},on:{edit:function(){e.edit(a.row.trecruitmentTargetList[1])},cancel:function(){e.cancel(a.row.trecruitmentTargetList[1])},save:(r=Object(n.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.saveData(a.row.trecruitmentTargetList[1]);case 1:case"end":return t.stop()}}),t)}))),function(){return r.apply(this,arguments)})}});var r}}]},{title:"2021年4月",key:"date",align:"center",children:[{title:"招新目标(人次)",key:"newRecruitsNum",align:"right",minWidth:100,render:function(e,t){return e(c,{props:{max:9999,min:0,initCount:t.row.trecruitmentTargetList[2].newRecruitsNum,edit:t.row.trecruitmentTargetList[2].isEdit,isEditSelf:!1},on:{input:function(e){t.row.trecruitmentTargetList[2].newRecruitsNum=e}}})}},{title:"转化产品目标(人数)",key:"convertProductNum",align:"right",minWidth:120,render:function(e,t){return e(c,{props:{max:9999,min:0,initCount:t.row.trecruitmentTargetList[2].convertProductNum,edit:t.row.trecruitmentTargetList[2].isEdit,isEditSelf:!1},on:{input:function(e){t.row.trecruitmentTargetList[2].convertProductNum=e}}})}},{title:"加微信目标(人头)",key:"addWechatNum",align:"right",minWidth:110,render:function(e,t){return e(c,{props:{max:9999,min:0,initCount:t.row.trecruitmentTargetList[2].addWechatNum,edit:t.row.trecruitmentTargetList[2].isEdit,isEditSelf:!1},on:{input:function(e){t.row.trecruitmentTargetList[2].addWechatNum=e}}})}},{title:"缴费目标(人次)",key:"paymentTargetNum",align:"right",minWidth:100,render:function(e,t){return e(c,{props:{max:9999,min:0,initCount:t.row.trecruitmentTargetList[2].paymentTargetNum,edit:t.row.trecruitmentTargetList[2].isEdit,isEditSelf:!1},on:{input:function(e){t.row.trecruitmentTargetList[2].paymentTargetNum=e}}})}},{title:"操作",key:"addWechatNum",align:"right",width:120,render:function(t,a){return t(h,{props:{edit:a.row.trecruitmentTargetList[2].isEdit,loading:a.row.trecruitmentTargetList[2].isLoading},on:{edit:function(){e.edit(a.row.trecruitmentTargetList[2])},cancel:function(){e.cancel(a.row.trecruitmentTargetList[2])},save:(r=Object(n.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.saveData(a.row.trecruitmentTargetList[2]);case 1:case"end":return t.stop()}}),t)}))),function(){return r.apply(this,arguments)})}});var r}}]},{title:"2021年4月",key:"date",align:"center",children:[{title:"招新目标(人次)",key:"newRecruitsNum",align:"right",minWidth:100,render:function(e,t){return e(c,{props:{max:9999,min:0,initCount:t.row.trecruitmentTargetList[3].newRecruitsNum,edit:t.row.trecruitmentTargetList[3].isEdit,isEditSelf:!1},on:{input:function(e){t.row.trecruitmentTargetList[3].newRecruitsNum=e}}})}},{title:"转化产品目标(人数)",key:"convertProductNum",align:"right",minWidth:120,render:function(e,t){return e(c,{props:{max:9999,min:0,initCount:t.row.trecruitmentTargetList[3].convertProductNum,edit:t.row.trecruitmentTargetList[3].isEdit,isEditSelf:!1},on:{input:function(e){t.row.trecruitmentTargetList[3].convertProductNum=e}}})}},{title:"加微信目标(人头)",key:"addWechatNum",align:"right",minWidth:110,render:function(e,t){return e(c,{props:{max:9999,min:0,initCount:t.row.trecruitmentTargetList[3].addWechatNum,edit:t.row.trecruitmentTargetList[3].isEdit,isEditSelf:!1},on:{input:function(e){t.row.trecruitmentTargetList[3].addWechatNum=e}}})}},{title:"缴费目标(人次)",key:"paymentTargetNum",align:"right",minWidth:100,render:function(e,t){return e(c,{props:{max:9999,min:0,initCount:t.row.trecruitmentTargetList[3].paymentTargetNum,edit:t.row.trecruitmentTargetList[3].isEdit,isEditSelf:!1},on:{input:function(e){t.row.trecruitmentTargetList[3].paymentTargetNum=e}}})}},{title:"操作",key:"addWechatNum",align:"right",width:120,render:function(t,a){return t(h,{props:{edit:a.row.trecruitmentTargetList[3].isEdit,loading:a.row.trecruitmentTargetList[3].isLoading},on:{edit:function(){e.edit(a.row.trecruitmentTargetList[3])},cancel:function(){e.cancel(a.row.trecruitmentTargetList[3])},save:(r=Object(n.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.saveData(a.row.trecruitmentTargetList[3]);case 1:case"end":return t.stop()}}),t)}))),function(){return r.apply(this,arguments)})}});var r}}]}],columns2:[{title:"城市",key:"cityName",align:"center",fixed:"left",minWidth:80},{title:"服务中心",key:"areaName",align:"center",fixed:"left",minWidth:120},{title:"顾问姓名",key:"identityEmpName",align:"center",fixed:"left",minWidth:120},{title:"顾问工号",key:"identityEmpNo",align:"center",fixed:"left",minWidth:100},{title:"2021年4月",key:"date",align:"center",children:[{title:"招新目标(人次)",key:"newRecruitsNum",align:"right",minWidth:100,render:function(e,t){return e(c,{props:{max:9999,min:0,initCount:t.row.trecruitmentTargetList[0].newRecruitsNum,edit:t.row.trecruitmentTargetList[0].isEdit,isEditSelf:!1},on:{input:function(e){t.row.trecruitmentTargetList[0].newRecruitsNum=e}}})}},{title:"转化产品目标(人数)",key:"convertProductNum",align:"right",minWidth:120,render:function(e,t){return e(c,{props:{max:9999,min:0,initCount:t.row.trecruitmentTargetList[0].convertProductNum,edit:t.row.trecruitmentTargetList[0].isEdit,isEditSelf:!1},on:{input:function(e){t.row.trecruitmentTargetList[0].convertProductNum=e}}})}},{title:"加微信目标(人头)",key:"addWechatNum",align:"right",minWidth:110,render:function(e,t){return e(c,{props:{max:9999,min:0,initCount:t.row.trecruitmentTargetList[0].addWechatNum,edit:t.row.trecruitmentTargetList[0].isEdit,isEditSelf:!1},on:{input:function(e){t.row.trecruitmentTargetList[0].addWechatNum=e}}})}},{title:"缴费目标(人次)",key:"paymentTargetNum",align:"right",minWidth:100,render:function(e,t){return e(c,{props:{max:9999,min:0,initCount:t.row.trecruitmentTargetList[0].paymentTargetNum,edit:t.row.trecruitmentTargetList[0].isEdit,isEditSelf:!1},on:{input:function(e){t.row.trecruitmentTargetList[0].paymentTargetNum=e}}})}},{title:"操作",key:"addWechatNum",align:"right",width:120,render:function(t,a){return t(h,{props:{edit:a.row.trecruitmentTargetList[0].isEdit,loading:a.row.trecruitmentTargetList[0].isLoading},on:{edit:function(){e.edit(a.row.trecruitmentTargetList[0])},cancel:function(){e.cancel(a.row.trecruitmentTargetList[0])},save:(r=Object(n.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.saveData(a.row.trecruitmentTargetList[0]);case 1:case"end":return t.stop()}}),t)}))),function(){return r.apply(this,arguments)})}});var r}}]},{title:"2021年4月",key:"date",align:"center",children:[{title:"招新目标(人次)",key:"newRecruitsNum",align:"right",minWidth:100,render:function(e,t){return e(c,{props:{max:9999,min:0,initCount:t.row.trecruitmentTargetList[1].newRecruitsNum,edit:t.row.trecruitmentTargetList[1].isEdit,isEditSelf:!1},on:{input:function(e){t.row.trecruitmentTargetList[1].newRecruitsNum=e}}})}},{title:"转化产品目标(人数)",key:"convertProductNum",align:"right",minWidth:120,render:function(e,t){return e(c,{props:{max:9999,min:0,initCount:t.row.trecruitmentTargetList[1].convertProductNum,edit:t.row.trecruitmentTargetList[1].isEdit,isEditSelf:!1},on:{input:function(e){t.row.trecruitmentTargetList[1].convertProductNum=e}}})}},{title:"加微信目标(人头)",key:"addWechatNum",align:"right",minWidth:110,render:function(e,t){return e(c,{props:{max:9999,min:0,initCount:t.row.trecruitmentTargetList[1].addWechatNum,edit:t.row.trecruitmentTargetList[1].isEdit,isEditSelf:!1},on:{input:function(e){t.row.trecruitmentTargetList[1].addWechatNum=e}}})}},{title:"缴费目标(人次)",key:"paymentTargetNum",align:"right",minWidth:100,render:function(e,t){return e(c,{props:{max:9999,min:0,initCount:t.row.trecruitmentTargetList[1].paymentTargetNum,edit:t.row.trecruitmentTargetList[1].isEdit,isEditSelf:!1},on:{input:function(e){t.row.trecruitmentTargetList[1].paymentTargetNum=e}}})}},{title:"操作",key:"addWechatNum",align:"right",width:120,render:function(t,a){return t(h,{props:{edit:a.row.trecruitmentTargetList[1].isEdit,loading:a.row.trecruitmentTargetList[1].isLoading},on:{edit:function(){e.edit(a.row.trecruitmentTargetList[1])},cancel:function(){e.cancel(a.row.trecruitmentTargetList[1])},save:(r=Object(n.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.saveData(a.row.trecruitmentTargetList[1]);case 1:case"end":return t.stop()}}),t)}))),function(){return r.apply(this,arguments)})}});var r}}]},{title:"2021年4月",key:"date",align:"center",children:[{title:"招新目标(人次)",key:"newRecruitsNum",align:"right",minWidth:100,render:function(e,t){return e(c,{props:{max:9999,min:0,initCount:t.row.trecruitmentTargetList[2].newRecruitsNum,edit:t.row.trecruitmentTargetList[2].isEdit,isEditSelf:!1},on:{input:function(e){t.row.trecruitmentTargetList[2].newRecruitsNum=e}}})}},{title:"转化产品目标(人数)",key:"convertProductNum",align:"right",minWidth:120,render:function(e,t){return e(c,{props:{max:9999,min:0,initCount:t.row.trecruitmentTargetList[2].convertProductNum,edit:t.row.trecruitmentTargetList[2].isEdit,isEditSelf:!1},on:{input:function(e){t.row.trecruitmentTargetList[2].convertProductNum=e}}})}},{title:"加微信目标(人头)",key:"addWechatNum",align:"right",minWidth:110,render:function(e,t){return e(c,{props:{max:9999,min:0,initCount:t.row.trecruitmentTargetList[2].addWechatNum,edit:t.row.trecruitmentTargetList[2].isEdit,isEditSelf:!1},on:{input:function(e){t.row.trecruitmentTargetList[2].addWechatNum=e}}})}},{title:"缴费目标(人次)",key:"paymentTargetNum",align:"right",minWidth:100,render:function(e,t){return e(c,{props:{max:9999,min:0,initCount:t.row.trecruitmentTargetList[2].paymentTargetNum,edit:t.row.trecruitmentTargetList[2].isEdit,isEditSelf:!1},on:{input:function(e){t.row.trecruitmentTargetList[2].paymentTargetNum=e}}})}},{title:"操作",key:"addWechatNum",align:"right",width:120,render:function(t,a){return t(h,{props:{edit:a.row.trecruitmentTargetList[2].isEdit,loading:a.row.trecruitmentTargetList[2].isLoading},on:{edit:function(){e.edit(a.row.trecruitmentTargetList[2])},cancel:function(){e.cancel(a.row.trecruitmentTargetList[2])},save:(r=Object(n.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.saveData(a.row.trecruitmentTargetList[2]);case 1:case"end":return t.stop()}}),t)}))),function(){return r.apply(this,arguments)})}});var r}}]},{title:"2021年4月",key:"date",align:"center",children:[{title:"招新目标(人次)",key:"newRecruitsNum",align:"right",minWidth:100,render:function(e,t){return e(c,{props:{max:9999,min:0,initCount:t.row.trecruitmentTargetList[3].newRecruitsNum,edit:t.row.trecruitmentTargetList[3].isEdit,isEditSelf:!1},on:{input:function(e){t.row.trecruitmentTargetList[3].newRecruitsNum=e}}})}},{title:"转化产品目标(人数)",key:"convertProductNum",align:"right",minWidth:120,render:function(e,t){return e(c,{props:{max:9999,min:0,initCount:t.row.trecruitmentTargetList[3].convertProductNum,edit:t.row.trecruitmentTargetList[3].isEdit,isEditSelf:!1},on:{input:function(e){t.row.trecruitmentTargetList[3].convertProductNum=e}}})}},{title:"加微信目标(人头)",key:"addWechatNum",align:"right",minWidth:110,render:function(e,t){return e(c,{props:{max:9999,min:0,initCount:t.row.trecruitmentTargetList[3].addWechatNum,edit:t.row.trecruitmentTargetList[3].isEdit,isEditSelf:!1},on:{input:function(e){t.row.trecruitmentTargetList[3].addWechatNum=e}}})}},{title:"缴费目标(人次)",key:"paymentTargetNum",align:"right",minWidth:100,render:function(e,t){return e(c,{props:{max:9999,min:0,initCount:t.row.trecruitmentTargetList[3].paymentTargetNum,edit:t.row.trecruitmentTargetList[3].isEdit,isEditSelf:!1},on:{input:function(e){t.row.trecruitmentTargetList[3].paymentTargetNum=e}}})}},{title:"操作",key:"addWechatNum",align:"right",width:120,render:function(t,a){return t(h,{props:{edit:a.row.trecruitmentTargetList[3].isEdit,loading:a.row.trecruitmentTargetList[3].isLoading},on:{edit:function(){e.edit(a.row.trecruitmentTargetList[3])},cancel:function(){e.cancel(a.row.trecruitmentTargetList[3])},save:(r=Object(n.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.saveData(a.row.trecruitmentTargetList[3]);case 1:case"end":return t.stop()}}),t)}))),function(){return r.apply(this,arguments)})}});var r}}]}],tableData:[],tableConfig:{totalCount:100,pageSize:10,pageNo:1,tableLoading:!1},serviceCenterList:[],advisorEmpNos:[],formData:{serviceCenterId:null,empNo:null}}},mounted:function(){1===this.type?this.columns=this.columns1:this.columns=this.columns2,this.initData()},methods:{initData:(b=Object(n.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.cityCode||!this.roleId){e.next=6;break}if(2!==this.roleId){e.next=4;break}return e.next=4,this.queryDeptByAreaCode();case 4:2===this.type&&(2===this.roleId?this.getAdvisorEmpNos():4===this.roleId&&this.getAdvisorEmpNos(this.userInfo.crmDeptId)),this.getTableData();case 6:case"end":return e.stop()}}),e,this)}))),function(){return b.apply(this,arguments)}),edit:function(e){this.$set(e,"isEdit",!0)},cancel:function(e){this.$set(e,"isEdit",!1),this.resetData(e)},saveData:(y=Object(n.a)(regeneratorRuntime.mark((function e(t){var a,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return 1===this.type?Object(p.a)("15-5014",{servicecenter_id:t.serviceCenterId,Service_Centre:t.serviceCenterName,month:t.month,aimType:"--"}):2===this.type&&Object(p.a)("15-5018",{servicecenter_id:t.serviceCenterId,Service_Centre:t.serviceCenterName,month:t.month,aimType:"--"}),e.prev=1,a=g({},t),this.$set(t,"isLoading",!0),this.$set(t,"isEdit",!0),e.next=7,Object(u.b)(a);case 7:r=e.sent,t.id=r,t.newRecruitsNumBefore=t.newRecruitsNum,t.convertProductNumBefore=t.convertProductNum,t.addWechatNumBefore=t.addWechatNum,t.paymentTargetNumBefore=t.paymentTargetNum,this.$set(t,"isEdit",!1),this.$Message.success({content:"设置成功"}),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(1),this.$set(t,"isEdit",!0),this.$Message.error({content:"编辑数据失败: ".concat(e.t0.message),duration:5});case 21:this.$set(t,"isLoading",!1);case 22:case"end":return e.stop()}}),e,this,[[1,17]])}))),function(e){return y.apply(this,arguments)}),resetData:function(e){e.newRecruitsNum=e.newRecruitsNumBefore,e.convertProductNum=e.convertProductNumBefore,e.addWechatNum=e.addWechatNumBefore,e.paymentTargetNum=e.paymentTargetNumBefore},getAdvisorEmpNos:function(e){var t=this;Object(l.r)({areaCode:this.cityCode,roleId:5,deptId:e}).then((function(e){t.advisorEmpNos=e.filter((function(e){return e.empNo}))})).catch((function(e){t.$Message.error({content:"查询顾问级别列表失败:"+e.message,duration:5})}))},queryDeptByAreaCode:function(){var e=this;return Object(l.l)({areaCode:this.cityCode,isActive:1}).then((function(t){e.serviceCenterList=Object.freeze(t)})).catch((function(t){e.$message.error("查询服务中心列表错误："+t.message)}))},handleChangeAdvisor:function(){this.tableConfig.pageSize=10,this.tableConfig.pageNo=1,this.getTableData()},handleServiceCenterChange:function(e){if(2===this.type){var t={};e&&(t=this.serviceCenterList.filter((function(t){return t.id===e}))[0]),this.$emit("advsior-deptid-change",t),2===this.roleId&&(this.formData.empNo="",this.getAdvisorEmpNos(t.id))}this.tableConfig.pageSize=10,this.tableConfig.pageNo=1,this.getTableData()},changePage:function(e){this.tableConfig.pageNo=e,this.getTableData()},pageSizeChange:function(e){this.tableConfig.pageNo=1,this.tableConfig.pageSize=e,this.getTableData()},getTableData:(v=Object(n.a)(regeneratorRuntime.mark((function e(){var t,a,r,n,i,s,o,c,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=4===this.roleId?this.userInfo.crmDeptId:this.formData.serviceCenterId,a=g(g({areaCode:this.cityCode,type:this.type,deptId:t},this.tableConfig),{},{identityEmpNo:2===this.type?this.formData.empNo:null}),this.tableConfig.tableLoading=!0,e.next=6,Object(u.e)(a);case 6:r=e.sent,n=new Date,i=n.getFullYear(),s=n.getMonth()+1,(o=s-1)<1&&(o=12),(c=s+1)>12&&(c=1),(l=c+1)>12&&(l=1),this.columns[4].title="".concat(i,"年").concat(o,"月"),this.columns[5].title="".concat(i,"年").concat(s,"月"),this.columns[6].title="".concat(i,"年").concat(c,"月"),this.columns[7].title="".concat(i,"年").concat(l,"月"),r.records.forEach((function(e){e.trecruitmentTargetList.forEach((function(e){e.isEdit=!1,e.isLoading=!1,e.newRecruitsNumBefore=e.newRecruitsNum,e.convertProductNumBefore=e.convertProductNum,e.addWechatNumBefore=e.addWechatNum,e.paymentTargetNumBefore=e.paymentTargetNum}))})),this.tableData=r.records,this.tableConfig.totalCount=r.totalCount,e.next=28;break;case 25:e.prev=25,e.t0=e.catch(0),this.$Message.error({content:"获取目标失败: ".concat(e.t0.message),duration:5});case 28:this.tableConfig.tableLoading=!1;case 29:case"end":return e.stop()}}),e,this,[[0,25]])}))),function(){return v.apply(this,arguments)})}},D=(a("2b6f"),Object(o.a)(C,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"layout-card"},[a("div",{staticClass:"card-header"},[a("div",{staticClass:"left flex"},[a("h1",{staticClass:"f-16 title",staticStyle:{"margin-right":"16px"}},[e._v(e._s(1===e.type?"服务中心目标":"顾问目标"))]),e._v(" "),2===e.roleId?a("Select",{staticStyle:{width:"216px","margin-right":"16px"},attrs:{placeholder:"服务中心",filterable:"",clearable:""},on:{"on-change":e.handleServiceCenterChange,"on-clear":e.handleServiceCenterChange},model:{value:e.formData.serviceCenterId,callback:function(t){e.$set(e.formData,"serviceCenterId",t)},expression:"formData.serviceCenterId"}},e._l(e.serviceCenterList,(function(t,r){return a("Option",{key:r,attrs:{value:t.id}},[e._v(e._s(t.deptName))])})),1):e._e(),e._v(" "),2===e.type?a("Select",{staticStyle:{width:"216px"},attrs:{filterable:"",clearable:"","label-in-value":"",placeholder:"顾问"},on:{"on-change":e.handleChangeAdvisor},model:{value:e.formData.empNo,callback:function(t){e.$set(e.formData,"empNo",t)},expression:"formData.empNo"}},e._l(e.advisorEmpNos,(function(t){return a("Option",{key:t.empNo,attrs:{value:t.empNo}},[e._v(e._s(t.userName)+"-"+e._s(t.empNo))])})),1):e._e()],1),e._v(" "),a("div",{staticClass:"right"},[a("Button",{staticClass:"f-14",staticStyle:{"margin-right":"6px"},attrs:{type:"primary"},on:{click:function(t){return e.$emit("batch-setting",e.type)}}},[e._v("批量设置")]),e._v(" "),a("Button",{staticClass:"f-14",on:{click:function(t){return e.$emit("setting-record",e.type)}}},[e._v("设置记录")])],1)]),e._v(" "),a("Table",{staticStyle:{"margin-top":"21px"},attrs:{border:"",columns:e.columns,data:e.tableData,loading:e.tableConfig.tableLoading}}),e._v(" "),a("div",{staticClass:"flex",staticStyle:{"margin-top":"16px","margin-bottom":"12px"}},[a("span"),e._v(" "),a("Page",{attrs:{total:e.tableConfig.totalCount,"page-size":e.tableConfig.pageSize,current:e.tableConfig.pageNo,"show-elevator":"","show-sizer":"","show-total":"",transfer:""},on:{"update:current":function(t){return e.$set(e.tableConfig,"pageNo",t)},"on-page-size-change":e.pageSizeChange,"on-change":e.changePage}})],1)],1)}),[],!1,null,"c7b35c6e",null).exports),w=(a("7f7f"),a("6b54"),a("a481"),a("9dce")),k=a.n(w),_=a("3786"),S=a("fa7d"),T=a("a78e"),I=a.n(T),L={name:"FileUpload",props:{value:{type:Array,default:function(){return[]}},maxFileSize:{type:[Number,String],default:"5mb"},multiSelection:{type:Boolean,default:!1},multiLength:{type:Number,default:3},maxLength:{type:Number,default:99},extensions:{type:String,default:"pptx,ppt,pptm,xls,xlt,xlsx,xltx,xlsb,xlsm,xltm,doc,dot,wps,docx,dotx,docm,dotm,pdf,txt,jpg,png,pdf,jpeg,PPTX,PPT,PPTM,XLS,XLT,XLSX,XLTX,XLSB,XLSM,XLTM,DOC,DOT,WPS,DOCX,DOTX,DOCM,DOTM,PDF,TXT,JPG,PNG,PDF,JPEG"}},data:function(){return{btnName:"upload_btn_"+1e4*Math.random()}},computed:{fileList:{get:function(){return this.value||[]},set:function(e){this.$emit("input",e||this.value||[])}}},mounted:function(){var e=this;setTimeout((function(){e.initUploadFile()}),500)},methods:{guid:function(){return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},handleRemove:function(e){var t=this;this.uploader.files.forEach((function(a,r){a.name===e&&t.uploader.splice(r,1)})),this.fileList=this.fileList.filter((function(t){return t.name!==e})),this.$emit("on-change",this.fileList)},initUploadFile:function(){var e,t,a=this;(this.uploader=new k.a.Uploader({runtimes:"html5,html4",browse_button:a.btnName,multi_selection:a.multiSelection,url:"".concat("prod"===Object(S.i)()?"https":"http","://oss.aliyuncs.com"),filters:{mime_types:[{title:"extensions supprot",extensions:a.extensions}],max_file_size:a.maxFileSize,prevent_duplicates:!1},init:{PostInit:function(){},FilesAdded:(t=Object(n.a)(regeneratorRuntime.mark((function e(t,r){var n,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r.length>a.multiLength)){e.next=3;break}return a.$Message.warning({content:"最多同时上传".concat(a.multiLength,"个"),duration:5}),e.abrupt("return");case 3:return n=JSON.parse(I.a.get("columbusUserInfo")).id,e.prev=4,e.next=7,Object(_.c)({fileName:r[0].name,empNo:n});case 7:i=e.sent,a.authObj=i,s=!1,r.forEach((function(e){if(a.fileList.filter((function(t){return t.name===e.name})).length>0)a.$Message.warning({content:"图片".concat(e.name,"已上传，请勿重复上传"),duration:5}),t.removeFile(e);else{s=!0;var r=i.dir+a.guid()+"."+e.name.split(".")[1];e.key=r,a.fileList.push({path:"".concat(i.host,"/").concat(r),name:e.name,status:"uploading",percent:0,key:e.key})}s&&t.start()})),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(4),a.$Message.warning({content:"文件上传失败，请重新操作",duration:5});case 16:case"end":return e.stop()}}),e,null,[[4,13]])}))),function(e,a){return t.apply(this,arguments)}),BeforeUpload:(e=Object(n.a)(regeneratorRuntime.mark((function e(t,r){var n,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(n=a.authObj).expire-Date.now()/1e3<10&&(i=JSON.parse(I.a.get("columbusUserInfo")).id,Object(_.c)({fileName:r.name,empNo:i}).then((function(e){a.authObj=e})).catch((function(e){a.$Message.warning({content:"文件上传失败：".concat(e.message),duration:5})}))),r.key=n.dir+a.guid()+"."+r.name.split(".")[1],a.fileList.forEach((function(e){e.name===r.name&&(e.path="".concat(n.host,"/").concat(r.key))})),s={key:r.key,policy:n.policy,expire:n.expire,OSSAccessKeyId:n.accessid,success_action_status:"200",signature:n.signature},t.setOption({url:n.host,multipart_params:s});case 6:case"end":return e.stop()}}),e)}))),function(t,a){return e.apply(this,arguments)}),UploadProgress:function(e,t){var r=a.fileList.filter((function(e){return e.name===t.name}))[0];r&&(r.percent=t.percent)},FileUploaded:function(e,t,r){var n=a.fileList.filter((function(e){return e.name===t.name}))[0];n&&(n.status="finished",a.$emit("on-change",a.fileList),a.$emit("on-success"))},Error:function(e,t){console.log("err",t),a.fileList=a.fileList.filter((function(e){return e.name!==t.file.name})),-600===t.code?a.$Message.warning({content:"您上传的文件超过大小限制"+a.maxFileSize,duration:5}):-601===t.code?a.$Message.warning({content:"选择的文件格式错误，目前仅支持"+ExtensionsSupport,duration:5}):-602===t.code?a.$Message.warning({content:"这个文件已经上传过一遍了",duration:5}):a.$Message.warning({content:"上传错误，请稍后再试",duration:5})}}})).init()},handleClick:function(e){this.$Message.warning({content:"最多上传".concat(this.maxLength,"个文件"),duration:10})}}},x=(a("c2af"),Object(o.a)(L,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"upload-box"},[a("Row",{attrs:{align:"middle"}},[a("Col",{attrs:{span:"4"}},[a("div",{staticClass:"upload-btn",attrs:{id:e.btnName}},[a("Icon",{attrs:{size:"20",type:"ios-cloud-upload-outline"}}),e._v("上传附件\n        "),e.fileList.length>=e.maxLength?a("div",{staticClass:"prevent",on:{click:function(t){return t.stopPropagation(),e.handleClick(t)}}}):e._e()],1)])],1),e._v(" "),a("div",{staticClass:"attachement-list",staticStyle:{"margin-top":"20px"}},e._l(e.fileList,(function(t){return a("div",{key:t.key,staticClass:"attachement-list-item",staticStyle:{width:"450px"}},[a("a",{staticClass:"flex",attrs:{href:"finished"===t.status?t.path:"javascript:void(0)",target:"finished"===t.status?"_blank":""}},[a("div",[a("Icon",{attrs:{size:"14",type:"ios-link"}}),e._v("\n          "+e._s(t.name)+"\n        ")],1),e._v(" "),a("Icon",{attrs:{size:"24",type:"ios-close"},on:{click:function(a){return a.preventDefault(),e.handleRemove(t.name)}}})],1),e._v(" "),a("Progress",{attrs:{percent:t.percent,"hide-info":"","stroke-width":2,"stroke-color":"#2d8cf0"}})],1)})),0)],1)}),[],!1,null,"998729ae",null).exports),N=a("325c"),O={props:{type:{type:Number,default:1},data:{type:Array,default:function(){return[]}}},data:function(){return{columns:[],columns1:[{title:"城市",key:"areaName",align:"center",minWidth:80},{title:"区域",key:"deptPidName",align:"center",minWidth:100},{title:"服务中心",key:"deptName",align:"center",minWidth:140},{title:"服务中心编码",key:"deptCode",align:"center",minWidth:120},{title:"2021年4月",key:"date",align:"center",children:[{title:"招新目标",key:"newRecruitsNum",align:"right",minWidth:100,render:function(e,t){return e("span",t.row.monthOneList[0].newRecruitsNum)}},{title:"转化产品目标",key:"convertProductNum",align:"right",minWidth:110,render:function(e,t){return e("span",t.row.monthOneList[0].convertProductNum)}},{title:"加微信目标",key:"addWechatNum",align:"right",minWidth:100,render:function(e,t){return e("span",t.row.monthOneList[0].addWechatNum)}},{title:"缴费目标",key:"paymentTargetNum",align:"right",minWidth:100,render:function(e,t){return e("span",t.row.monthOneList[0].paymentTargetNum)}}]},{title:"2021年4月",key:"date",align:"center",children:[{title:"招新目标",key:"newRecruitsNum",align:"right",minWidth:100,render:function(e,t){return e("span",t.row.monthTwoList[0].newRecruitsNum)}},{title:"转化产品目标",key:"convertProductNum",align:"right",minWidth:110,render:function(e,t){return e("span",t.row.monthTwoList[0].convertProductNum)}},{title:"加微信目标",key:"addWechatNum",align:"right",minWidth:100,render:function(e,t){return e("span",t.row.monthTwoList[0].addWechatNum)}},{title:"缴费目标",key:"paymentTargetNum",align:"right",minWidth:100,render:function(e,t){return e("span",t.row.monthTwoList[0].paymentTargetNum)}}]},{title:"2021年4月",key:"date",align:"center",children:[{title:"招新目标",key:"newRecruitsNum",align:"right",minWidth:100,render:function(e,t){return e("span",t.row.monthThreeList[0].newRecruitsNum)}},{title:"转化产品目标",key:"convertProductNum",align:"right",minWidth:110,render:function(e,t){return e("span",t.row.monthThreeList[0].convertProductNum)}},{title:"加微信目标",key:"addWechatNum",align:"right",minWidth:100,render:function(e,t){return e("span",t.row.monthThreeList[0].addWechatNum)}},{title:"缴费目标",key:"paymentTargetNum",align:"right",minWidth:100,render:function(e,t){return e("span",t.row.monthThreeList[0].paymentTargetNum)}}]}],columns2:[{title:"城市",key:"areaName",align:"center",minWidth:80},{title:"服务中心",key:"deptName",align:"center",minWidth:100},{title:"顾问姓名",key:"userName",align:"center",minWidth:140},{title:"顾问工号",key:"userWorkCode",align:"center",minWidth:120},{title:"2021年4月",key:"date",align:"center",children:[{title:"招新目标",key:"newRecruitsNum",align:"right",minWidth:100,render:function(e,t){return e("span",t.row.monthOneList[0].newRecruitsNum)}},{title:"转化产品目标",key:"convertProductNum",align:"right",minWidth:110,render:function(e,t){return e("span",t.row.monthOneList[0].convertProductNum)}},{title:"加微信目标",key:"addWechatNum",align:"right",minWidth:100,render:function(e,t){return e("span",t.row.monthOneList[0].addWechatNum)}},{title:"缴费目标",key:"paymentTargetNum",align:"right",minWidth:100,render:function(e,t){return e("span",t.row.monthOneList[0].paymentTargetNum)}}]},{title:"2021年4月",key:"date",align:"center",children:[{title:"招新目标",key:"newRecruitsNum",align:"right",minWidth:100,render:function(e,t){return e("span",t.row.monthTwoList[0].newRecruitsNum)}},{title:"转化产品目标",key:"convertProductNum",align:"right",minWidth:110,render:function(e,t){return e("span",t.row.monthTwoList[0].convertProductNum)}},{title:"加微信目标",key:"addWechatNum",align:"right",minWidth:100,render:function(e,t){return e("span",t.row.monthTwoList[0].addWechatNum)}},{title:"缴费目标",key:"paymentTargetNum",align:"right",minWidth:100,render:function(e,t){return e("span",t.row.monthTwoList[0].paymentTargetNum)}}]},{title:"2021年4月",key:"date",align:"center",children:[{title:"招新目标",key:"newRecruitsNum",align:"right",minWidth:100,render:function(e,t){return e("span",t.row.monthThreeList[0].newRecruitsNum)}},{title:"转化产品目标",key:"convertProductNum",align:"right",minWidth:110,render:function(e,t){return e("span",t.row.monthThreeList[0].convertProductNum)}},{title:"加微信目标",key:"addWechatNum",align:"right",minWidth:100,render:function(e,t){return e("span",t.row.monthThreeList[0].addWechatNum)}},{title:"缴费目标",key:"paymentTargetNum",align:"right",minWidth:100,render:function(e,t){return e("span",t.row.monthThreeList[0].paymentTargetNum)}}]}]}},mounted:function(){if(this.data&&this.data.length){console.log(this.data);var e=this.data[0].monthOneList[0].year+"年"+this.data[0].monthOneList[0].month+"月",t=this.data[0].monthTwoList[0].year+"年"+this.data[0].monthTwoList[0].month+"月",a=this.data[0].monthThreeList[0].year+"年"+this.data[0].monthThreeList[0].month+"月";1===this.type?this.columns=this.columns1:this.columns=this.columns2,this.columns[4].title=e,this.columns[5].title=t,this.columns[6].title=a}}};a("3e56");function j(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function M(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?j(Object(a),!0).forEach((function(t){Object(i.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):j(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var $,R,P,A={name:"targetMgt",components:{TargetTable:D,FileUpload:x,ErrorTargetTable:Object(o.a)(O,(function(){var e=this.$createElement;return(this._self._c||e)("Table",{staticClass:"error-target-table",attrs:{border:"",columns:this.columns,data:this.data}})}),[],!1,null,"45461566",null).exports},computed:M({},Object(d.e)({userInfo:function(e){return e.roleRelativeData.userInfo},roleId:function(e){return e.roleRelativeData.userInfo.crmRoleId},cityCode:function(e){return e.roleRelativeData.userInfo.cityCode}})),watch:{cityCode:function(){this.initView()}},data:function(){return{openBatchSettings:!1,openSettingsRecord:!1,recordColumns:[{title:"批量设置",key:"target",align:"left",width:400,className:"service-name"},{title:" ",key:"message",align:"left",render:function(e,t){return e("span",t.row.yearMonth+" "+t.row.message)}}],uploading:!1,files:[],operateLog:[],remark:"",currentType:null,currentService:{},downloading:!1,tableConfig:{pageSize:10,pageNo:1,totalCount:0,tableLoading:!1},errorTargetData:[],nearlyMonth:[1,2,3]}},mounted:function(){this.initView(),Object(p.a)("15-5010",{title:"招新目标管理",tab_name:"tab_name",duration_time:0}),this.getNearlyMonth()},methods:{initView:function(){var e=this;this.$nextTick((function(){e.cityCode&&e.roleId&&(e.roleId,4===e.roleId||e.roleId)}))},getNearlyMonth:function(){var e=(new Date).getMonth()+1,t=e+1>12?1:e+1,a=t+1>12?1:t+1;this.nearlyMonth=[e,t,a]},handleUploadSuccess:function(e){this.$Message.success("上传成功")},downloadExcel:(P=Object(n.a)(regeneratorRuntime.mark((function e(){var t,a,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return 1===this.currentType?Object(p.a)("15-5012"):2===this.currentType&&Object(p.a)("15-5016"),e.prev=1,t={cityCode:this.cityCode,type:this.currentType,deptId:2===this.roleId?this.currentService.id:this.userInfo.crmDeptId,empNo:JSON.parse(I.a.get("columbusUserInfo")).id},this.downloading=!0,e.next=6,Object(u.a)(t);case 6:a=e.sent,r=1===this.currentType?"".concat(this.userInfo.authDeptName,"-服务中心目标模版.xlsx"):"".concat(this.currentService.deptName||this.userInfo.authDeptName,"-顾问目标模版.xlsx"),N.a.downloadBolbFile(a,r,"application/vnd.ms-excel;charset=utf-8"),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),this.$Message.error({content:"模版下载失败: ".concat(e.t0.message),duration:5});case 14:this.downloading=!1;case 15:case"end":return e.stop()}}),e,this,[[1,11]])}))),function(){return P.apply(this,arguments)}),closeUploadModal:function(){this.openBatchSettings=!1,this.remark="",this.files=[],this.errorTargetData=[]},handleUploadTargetData:(R=Object(n.a)(regeneratorRuntime.mark((function e(){var t,a,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(1===this.currentType?Object(p.a)("15-5013"):2===this.currentType&&Object(p.a)("15-5017"),0!==(t=this.files.filter((function(e){return"finished"===e.status}))||[]).length){e.next=4;break}return e.abrupt("return",this.$Message.warning({content:"请上传附件",duration:5}));case 4:if(!(t.length<this.files.length)){e.next=6;break}return e.abrupt("return",this.$Message.warning({content:"附件上传中，请稍后提交",duration:5}));case 6:if((a={fileUrl:t[0].path,remark:this.remark.trim(),type:this.currentType,cityCode:this.cityCode}).remark){e.next=9;break}return e.abrupt("return",this.$Message.warning({content:"请填写变更备注",duration:5}));case 9:return e.prev=9,this.uploading=!0,e.next=13,Object(u.g)(a);case 13:"2"===(r=e.sent).execResult?this.errorTargetData=r.messageData:(this.$refs["targetTable".concat(this.currentType)].getTableData(),this.closeUploadModal(),this.$Message.success("上传成功")),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(9),this.$Message.error({content:"批量设置失败: ".concat(e.t0.message),duration:5});case 20:this.uploading=!1;case 21:case"end":return e.stop()}}),e,this,[[9,17]])}))),function(){return R.apply(this,arguments)}),handleBatchSetting:function(e){this.openBatchSettings=!0,this.currentType=e,1===e?Object(p.a)("15-5011"):2===e&&Object(p.a)("15-5015")},handleSettingRecord:function(e){this.openSettingsRecord=!0,this.currentType=e,this.tableConfig.pageNo=1,this.tableConfig.pageSize=10,this.getOperateLog()},changePage:function(e){this.tableConfig.pageNo=e,this.getOperateLog()},pageSizeChange:function(e){this.tableConfig.pageNo=1,this.tableConfig.pageSize=e,this.getOperateLog()},getOperateLog:($=Object(n.a)(regeneratorRuntime.mark((function e(){var t,a,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=M({cityCode:this.cityCode},this.tableConfig),this.tableConfig.tableLoading=!0,this.operateLog=[],e.next=6,Object(u.d)(t);case 6:a=e.sent,n=function(e,t){return/^\d/.test(e)^/^\D/.test(t)?e>t?1:e===t?0:-1:e>t?-1:e===t?0:1},a.records.forEach((function(e){var t={};console.log("before",e.batchLogs.length),e.batchLogs=e.batchLogs.sort((function(e,t){var a=e.target.split("-"),r=t.target.split("-");return n(a[a.length-1],r[r.length-1])}))||[],e.batchLogs.forEach((function(e){t[e.target]?(e.targetCopy=e.target,e.target=""):t[e.target]=!0})),e.batchLogs.length>5&&(e.batchLogsMore=Object(r.a)(e.batchLogs),e.batchLogs=e.batchLogs.slice(0,5))})),this.operateLog=a.records,this.tableConfig.totalCount=a.totalCount,e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),this.$Message.error({content:"获取操作日志失败: ".concat(e.t0.message),duration:5});case 16:this.tableConfig.tableLoading=!1;case 17:case"end":return e.stop()}}),e,this,[[0,13]])}))),function(){return $.apply(this,arguments)})}},E=(a("ab94"),Object(o.a)(A,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"layout"},[r("Tabs",{attrs:{animated:!1}},[2===e.roleId?r("TabPane",{attrs:{label:"服务中心目标"}},[r("TargetTable",{ref:"targetTable1",attrs:{type:1},on:{"batch-setting":function(t){return e.handleBatchSetting(1)},"setting-record":function(t){return e.handleSettingRecord(1)}}})],1):e._e(),e._v(" "),2===e.roleId||4===e.roleId?r("TabPane",{attrs:{label:"顾问目标"}},[r("TargetTable",{ref:"targetTable2",attrs:{type:2},on:{"batch-setting":function(t){return e.handleBatchSetting(2)},"setting-record":function(t){return e.handleSettingRecord(2)},"advsior-deptid-change":function(t){e.currentService=t}}})],1):e._e()],1),e._v(" "),r("Modal",{attrs:{title:"设置记录",width:"1100px",height:"650px","mask-closable":!1},model:{value:e.openSettingsRecord,callback:function(t){e.openSettingsRecord=t},expression:"openSettingsRecord"}},[e.operateLog.length?r("div",{staticStyle:{"max-height":"60vh",overflow:"auto"}},[r("Timeline",e._l(e.operateLog,(function(t,a){return r("TimelineItem",{key:a},[r("Icon",{attrs:{slot:"dot",type:"ios-radio-button-on",color:"#3b7eff"},slot:"dot"}),e._v(" "),r("div",{staticClass:"setting-record"},[r("p",{staticClass:"operator"},[e._v("\n                  "+e._s(t.createEmpName)+"（"+e._s(t.createEmpNo)+"）\n                "),r("Time",{staticStyle:{"font-size":"12px",color:"rgba(0, 0, 0, 0.45)","font-weight":"normal"},attrs:{time:t.createDate,type:"datetime"}})],1),e._v(" "),r("Table",{staticClass:"table-no-border",attrs:{columns:e.recordColumns,data:t.batchLogs,"show-header":!1}},[r("template",{slot:"header"},[r("th",{staticClass:"service-name ivu-table-column-left"},[r("div",{staticClass:"ivu-table-cell",staticStyle:{width:"1042px",height:"40px",transform:"translate(0, -5px)"}},[r("span",[e._v(e._s(1===t.operateType?"批量设置":"编辑"))])])])])],2),e._v(" "),t.batchLogsMore&&t.batchLogs.length!==t.batchLogsMore.length?r("div",{staticClass:"more"},[r("a",{attrs:{href:"javascript: void(0);"},on:{click:function(e){t.batchLogs=t.batchLogsMore}}},[e._v("查看更多")])]):e._e(),e._v(" "),t.remark?r("p",{staticClass:"change-remark"},[e._v("变更备注:"+e._s(t.remark))]):e._e()],1)],1)})),1)],1):r("div",{staticClass:"no-data"},[r("img",{staticClass:"no-data-pic",attrs:{src:a("9684"),alt:""}})]),e._v(" "),e.tableConfig.tableLoading?r("div",{staticClass:"demo-spin-container"},[r("Spin",{attrs:{fix:""}})],1):e._e(),e._v(" "),e.operateLog.length?r("div",{staticClass:"flex",staticStyle:{"margin-top":"16px"}},[r("span"),e._v(" "),r("Page",{attrs:{total:e.tableConfig.totalCount,"page-size":e.tableConfig.pageSize,current:e.tableConfig.pageNo,"show-elevator":"","show-sizer":"","show-total":"",transfer:""},on:{"update:current":function(t){return e.$set(e.tableConfig,"pageNo",t)},"on-page-size-change":e.pageSizeChange,"on-change":e.changePage}})],1):e._e(),e._v(" "),r("div",{attrs:{slot:"footer"},slot:"footer"},[r("Button",{attrs:{type:"primary"},on:{click:function(t){e.openSettingsRecord=!1}}},[e._v("关闭")])],1)]),e._v(" "),r("Modal",{attrs:{title:1===e.currentType?"服务中心目标设置":"顾问目标设置",width:"650px",height:"650px",closable:!1,"mask-closable":!1},model:{value:e.openBatchSettings,callback:function(t){e.openBatchSettings=t},expression:"openBatchSettings"}},[r("div",{staticClass:"uploadIndications"},[r("h4",{staticClass:"uploadTitle"},[e._v("上传说明")]),e._v(" "),r("p",[e._v("1.模版表头不可更改和删除，上传过程请不要关闭弹窗")]),e._v(" "),r("p",[e._v("2.上传过程中系统会对内容参数的合法性进行校验，如失败则整个文件上传失败")]),e._v(" "),r("p",[e._v("3.模板初始化数据，会带有之前已经设置过的数据，未设置过默认为0")]),e._v(" "),r("p",[e._v("4.已经设置过目标的，如果目标数据发生变更，再次批量设置会覆盖之前数据，请仔细核对")]),e._v(" "),r("p",[e._v("5.设置时效：仅支持设置“2021年 "+e._s(e.nearlyMonth[0])+"月、2021年"+e._s(e.nearlyMonth[1])+"月、2021年"+e._s(e.nearlyMonth[2])+"月”，招新目标。")])]),e._v(" "),r("Button",{staticStyle:{marginTop:"12px",marginBottom:"24px"},attrs:{type:"primary",loading:e.downloading},on:{click:e.downloadExcel}},[e._v("下载模板")]),e._v(" "),r("div",{staticStyle:{display:"flex","justify-content":"center"},attrs:{slot:"footer"},slot:"footer"},[e.errorTargetData.length?[r("Button",{staticStyle:{"margin-right":"20px"},attrs:{size:"large"},on:{click:e.closeUploadModal}},[e._v("关闭")]),e._v(" "),r("Button",{attrs:{size:"large",type:"primary"},on:{click:function(t){e.errorTargetData=[]}}},[e._v("重新导入")])]:[r("Button",{staticStyle:{"margin-right":"20px"},attrs:{disabled:e.uploading,size:"large"},on:{click:e.closeUploadModal}},[e._v("关闭")]),e._v(" "),r("Button",{attrs:{loading:e.uploading,disabled:!(e.files.length&&e.remark.trim()),size:"large",type:"primary"},on:{click:e.handleUploadTargetData}},[e._v("确认上传")])]],2),e._v(" "),e.errorTargetData.length?[r("div",{staticClass:"error-box"},[r("p",{staticClass:"flex",staticStyle:{"justify-content":"flex-start","align-items":"center"}},[r("Icon",{staticStyle:{color:"red","font-size":"20px","font-weight":"bold","margin-right":"8px"},attrs:{type:"ios-close-circle-outline"}}),e._v(" "),r("b",[e._v("校验失败（"+e._s(e.errorTargetData.length)+"）")])],1),e._v(" "),e._l(e.errorTargetData,(function(t,a){return r("div",{key:a},[t.log?r("div",{staticClass:"error-name"},[e._v(e._s(t.message)+"（"+e._s(t.log.length)+"）")]):e._e(),e._v(" "),t.log?r("ErrorTargetTable",{attrs:{type:e.currentType,data:t.log}}):e._e()],1)}))],2)]:[r("div",{staticClass:"file-upload-box"},[r("FileUpload",{attrs:{multiSelection:!1,extensions:"xls,xlt,xlsx,xltx,xlsb,xlsm,xltm",maxLength:1},on:{"on-success":e.handleUploadSuccess},model:{value:e.files,callback:function(t){e.files=t},expression:"files"}})],1),e._v(" "),r("div",{staticClass:"ivu-form-item-required",staticStyle:{"margin-top":"16px"}},[r("b",{staticClass:"ivu-form-item-label",staticStyle:{"font-size":"14px"}},[e._v("变更备注:")]),e._v(" "),r("Input",{staticStyle:{"margin-top":"16px"},attrs:{type:"textarea",placeholder:"请输入此次变更原因"},model:{value:e.remark,callback:function(t){e.remark=t},expression:"remark"}})],1)]],2)],1)}),[],!1,null,"c809206c",null));t.default=E.exports},"844d":function(e,t,a){"use strict";var r=a("7022");a.n(r).a},"8a81":function(e,t,a){"use strict";var r=a("7726"),n=a("69a8"),i=a("9e1e"),s=a("5ca1"),o=a("2aba"),c=a("67ab").KEY,l=a("79e5"),u=a("5537"),d=a("7f20"),m=a("ca5a"),h=a("2b4c"),p=a("37c8"),f=a("3a72"),g=a("d4c0"),v=a("1169"),y=a("cb7c"),b=a("d3f4"),C=a("6821"),D=a("6a99"),w=a("4630"),k=a("2aeb"),_=a("7bbc"),S=a("11e9"),T=a("86cc"),I=a("0d58"),L=S.f,x=T.f,N=_.f,O=r.Symbol,j=r.JSON,M=j&&j.stringify,$=h("_hidden"),R=h("toPrimitive"),P={}.propertyIsEnumerable,A=u("symbol-registry"),E=u("symbols"),F=u("op-symbols"),q=Object.prototype,z="function"==typeof O,B=r.QObject,W=!B||!B.prototype||!B.prototype.findChild,U=i&&l((function(){return 7!=k(x({},"a",{get:function(){return x(this,"a",{value:7}).a}})).a}))?function(e,t,a){var r=L(q,t);r&&delete q[t],x(e,t,a),r&&e!==q&&x(q,t,r)}:x,V=function(e){var t=E[e]=k(O.prototype);return t._k=e,t},G=z&&"symbol"==typeof O.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof O},H=function(e,t,a){return e===q&&H(F,t,a),y(e),t=D(t,!0),y(a),n(E,t)?(a.enumerable?(n(e,$)&&e[$][t]&&(e[$][t]=!1),a=k(a,{enumerable:w(0,!1)})):(n(e,$)||x(e,$,w(1,{})),e[$][t]=!0),U(e,t,a)):x(e,t,a)},Q=function(e,t){y(e);for(var a,r=g(t=C(t)),n=0,i=r.length;i>n;)H(e,a=r[n++],t[a]);return e},Y=function(e){var t=P.call(this,e=D(e,!0));return!(this===q&&n(E,e)&&!n(F,e))&&(!(t||!n(this,e)||!n(E,e)||n(this,$)&&this[$][e])||t)},J=function(e,t){if(e=C(e),t=D(t,!0),e!==q||!n(E,t)||n(F,t)){var a=L(e,t);return!a||!n(E,t)||n(e,$)&&e[$][t]||(a.enumerable=!0),a}},X=function(e){for(var t,a=N(C(e)),r=[],i=0;a.length>i;)n(E,t=a[i++])||t==$||t==c||r.push(t);return r},K=function(e){for(var t,a=e===q,r=N(a?F:C(e)),i=[],s=0;r.length>s;)!n(E,t=r[s++])||a&&!n(q,t)||i.push(E[t]);return i};z||(o((O=function(){if(this instanceof O)throw TypeError("Symbol is not a constructor!");var e=m(arguments.length>0?arguments[0]:void 0),t=function(a){this===q&&t.call(F,a),n(this,$)&&n(this[$],e)&&(this[$][e]=!1),U(this,e,w(1,a))};return i&&W&&U(q,e,{configurable:!0,set:t}),V(e)}).prototype,"toString",(function(){return this._k})),S.f=J,T.f=H,a("9093").f=_.f=X,a("52a7").f=Y,a("2621").f=K,i&&!a("2d00")&&o(q,"propertyIsEnumerable",Y,!0),p.f=function(e){return V(h(e))}),s(s.G+s.W+s.F*!z,{Symbol:O});for(var Z="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),ee=0;Z.length>ee;)h(Z[ee++]);for(var te=I(h.store),ae=0;te.length>ae;)f(te[ae++]);s(s.S+s.F*!z,"Symbol",{for:function(e){return n(A,e+="")?A[e]:A[e]=O(e)},keyFor:function(e){if(!G(e))throw TypeError(e+" is not a symbol!");for(var t in A)if(A[t]===e)return t},useSetter:function(){W=!0},useSimple:function(){W=!1}}),s(s.S+s.F*!z,"Object",{create:function(e,t){return void 0===t?k(e):Q(k(e),t)},defineProperty:H,defineProperties:Q,getOwnPropertyDescriptor:J,getOwnPropertyNames:X,getOwnPropertySymbols:K}),j&&s(s.S+s.F*(!z||l((function(){var e=O();return"[null]"!=M([e])||"{}"!=M({a:e})||"{}"!=M(Object(e))}))),"JSON",{stringify:function(e){for(var t,a,r=[e],n=1;arguments.length>n;)r.push(arguments[n++]);if(a=t=r[1],(b(t)||void 0!==e)&&!G(e))return v(t)||(t=function(e,t){if("function"==typeof a&&(t=a.call(this,e,t)),!G(t))return t}),r[1]=t,M.apply(j,r)}}),O.prototype[R]||a("32e9")(O.prototype,R,O.prototype.valueOf),d(O,"Symbol"),d(Math,"Math",!0),d(r.JSON,"JSON",!0)},"8db1":function(e,t,a){"use strict";var r=a("fcff");a.n(r).a},"906f":function(e,t,a){},9289:function(e,t,a){"use strict";var r=a("ac99");a.n(r).a},"945d":function(e,t,a){"use strict";var r=a("da39");a.n(r).a},"965b":function(e,t,a){"use strict";var r=a("f660");a.n(r).a},9684:function(e,t,a){e.exports=a.p+"img/no_data.5ef034e2.png"},"9b61":function(e,t,a){"use strict";var r=a("bb2a");a.n(r).a},"9b89":function(e,t,a){},"9f56":function(e,t,a){},a176:function(e,t,a){"use strict";var r=a("58f2");a.n(r).a},a1d0:function(e,t,a){"use strict";var r=a("3377");a.n(r).a},a2e8:function(e,t,a){},a36e:function(e,t,a){"use strict";a("0d6d");var r=a("867e");t.a={data:function(){return{allCityList:[],allCityMap:{},classtimeList:[],classtimeTypeList:[],classTypeList:[],isSchoolTestList:[],yearList:[]}},methods:{isSchoolTestHandler:function(){var e=this;Object(r.r)({}).then((function(t){e.isSchoolTestList=Object.freeze(t)})).catch((function(t){console.log(t),e.$Message.warning({content:"获取是否入学测试失败:"+t.message,duration:5})}))},getAreaListHandler:function(e){return Object(r.c)(e)},getCityListHandler:function(){var e=this;Object(r.d)().then((function(t){e.allCityList=t})).catch((function(t){e.$Message.warning({content:"获取所有城市失败:"+t.message,duration:5})}))},getClassTypeHandler:function(){var e=this;Object(r.e)({}).then((function(t){e.classTypeList=Object.freeze(t)})).catch((function(t){e.$Message.warning({content:"获取授课类型失败:"+t.message,duration:5})}))},getLinkageHandler:function(e){return Object(r.h)(e)},getServiceCenterListHandler:function(e){return Object(r.j)(e)},getTeacherByNameFuzzyHandler:function(e){return Object(r.l)(e)},getTimeTypeListHandler:function(){var e=this;Object(r.n)({}).then((function(t){e.classtimeTypeList=Object.freeze(t)})).catch((function(t){e.$Message.warning({content:"获取上课时间类型失败:"+t.message,duration:5})}))},getTimeListHandler:function(){var e=this;Object(r.m)({}).then((function(t){e.classtimeList=Object.freeze(t)})).catch((function(t){e.$Message.warning({content:"获取上课时间失败:"+t.message,duration:5})}))},getVenueListHandler:function(e){return Object(r.p)(e)},getYearListHandler:function(){var e=this;Object(r.q)().then((function(t){e.yearList=Object.freeze(t)})).catch((function(t){e.$Message.warning({content:"获取年份失败:"+t.message,duration:5})}))}}}},a7fd:function(e,t,a){e.exports=a.p+"img/cuanban-qr-bg.5a9e63b9.png"},a826:function(e,t,a){},ab94:function(e,t,a){"use strict";var r=a("bfe0");a.n(r).a},abb5:function(e,t,a){},ac4d:function(e,t,a){a("3a72")("asyncIterator")},ac99:function(e,t,a){},b278:function(e,t,a){"use strict";var r=a("3a21");a.n(r).a},b412:function(e,t,a){"use strict";a.r(t);var r=a("7665"),n={name:"diagnosisImport",data:function(){return{dataSrc:""}},components:{TalIframe:a("0a03").a},mounted:function(){var e=this;Object(r.d)({}).then((function(t){e.dataSrc=t.url})).catch((function(t){e.$Message.error({content:t.message,duration:5})}))}},i=a("2877"),s=Object(i.a)(n,(function(){var e=this.$createElement,t=this._self._c||e;return t("Layout",{attrs:{id:"map"}},[t("TalIframe",{attrs:{"content-src":this.dataSrc}}),this._v(" "),t("div",{staticStyle:{height:"50px"}})],1)}),[],!1,null,null,null);t.default=s.exports},b515:function(e,t,a){"use strict";var r=a("906f");a.n(r).a},b8bc:function(e,t,a){},ba07:function(e,t,a){},bb2a:function(e,t,a){},bd2c:function(e,t,a){"use strict";var r=a("4203");a.n(r).a},bfe0:function(e,t,a){},c24f:function(e,t,a){"use strict";a.d(t,"e",(function(){return u})),a.d(t,"i",(function(){return d})),a.d(t,"o",(function(){return m})),a.d(t,"m",(function(){return h})),a.d(t,"d",(function(){return p})),a.d(t,"g",(function(){return f})),a.d(t,"l",(function(){return g})),a.d(t,"q",(function(){return v})),a.d(t,"f",(function(){return y})),a.d(t,"k",(function(){return b})),a.d(t,"b",(function(){return C})),a.d(t,"j",(function(){return D})),a.d(t,"a",(function(){return w})),a.d(t,"h",(function(){return k})),a.d(t,"n",(function(){return _})),a.d(t,"p",(function(){return S})),a.d(t,"c",(function(){return T}));var r=a("66df"),n=(a("54f3"),a("bc3a")),i=a.n(n),s=a("c276"),o=Object(s.n)(),c="";switch(o){case"dev":c="/SPLAT";break;case"external":c="http://beta-gateway-one.speiyou.cn/".concat("SPLAT","/");break;case"beta":c="http://gateway.one.speiyou.net/".concat("SPLAT","/");break;case"prod":c="https://gateway-one.speiyou.cn/".concat("SPLAT","/")}sessionStorage.setItem("currentEnv",o);var l=i.a.create({baseURL:c,withCredentials:!0,timeout:3e4,headers:{platform:"splat","X-Ca-platform":"service"},responseType:"blob"}),u=function(e){return l.request({url:"user/queryDimensionCode",method:"get",params:e,headers:{cityCode:e.cityCode}})};function d(e){return r.a.request({url:"user/queryPerformanceByCondition",method:"post",data:e})}function m(e){return r.a.request({url:"user/queryServicePerformance",method:"get",params:e})}function h(e){return r.a.request({url:"user/queryPersonalPerformance",method:"get",params:e})}function p(e){return r.a.request({url:"user/queryDateSection",method:"get",params:e})}function f(e){return r.a.request({url:"user/queryPerformDailyDetail",method:"post",data:e})}function g(e){return r.a.request({url:"user/queryPerformanceMonth",method:"get",params:e})}function v(e){return r.a.request({url:"user/saveAdvisorGroup",method:"post",data:e})}function y(e){return r.a.request({url:"user/queryGroupList",method:"get",params:e})}function b(e){return r.a.request({url:"user/queryPerformanceDetailId",method:"post",data:e})}function C(e){return r.a.request({url:"user/exprotPerformanceById",method:"get",params:e})}function D(e){return r.a.request({url:"user/queryPerformanceConsult",method:"get",params:e})}function w(e){return r.a.request({url:"user/exportById",method:"get",params:e})}function k(e){return r.a.request({url:"user/queryPerformRefundDetail",method:"post",data:e})}function _(e){return r.a.request({url:"user/queryRefundPerformanceDataPath",method:"post",data:e})}function S(e){return r.a.request({url:"user/queryStoreActivityLabelList",method:"get",params:e})}function T(e){return r.a.request({url:"user/getChannelUserInfo",method:"get",params:e})}},c2af:function(e,t,a){"use strict";var r=a("c8dd");a.n(r).a},c85f:function(e,t,a){"use strict";var r=a("404b");a.n(r).a},c8dd:function(e,t,a){},c99b:function(e,t,a){},cc55:function(e,t,a){"use strict";var r=a("a2e8");a.n(r).a},d0a8:function(e,t,a){"use strict";var r=a("13ac");a.n(r).a},d4c0:function(e,t,a){var r=a("0d58"),n=a("2621"),i=a("52a7");e.exports=function(e){var t=r(e),a=n.f;if(a)for(var s,o=a(e),c=i.f,l=0;o.length>l;)c.call(e,s=o[l++])&&t.push(s);return t}},d737:function(e,t,a){},d793:function(e,t,a){},da39:function(e,t,a){},db66:function(e,t,a){"use strict";var r=a("a826");a.n(r).a},dcb7:function(e,t,a){},e4de:function(e,t,a){"use strict";var r=a("ffe3");a.n(r).a},e566:function(e,t,a){"use strict";a.r(t);a("8e6e"),a("ac6a"),a("cadf"),a("456d"),a("f751"),a("7f7f"),a("0d6d"),a("386d"),a("96cf");var r=a("3b8d"),n=a("bd86"),i=a("0263"),s=a("7665"),o=a("530a"),c=(a("097d"),a("6762"),a("2fdb"),a("0ef6")),l=a("2801"),u=(a("c5f6"),a("c3a7"));function d(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function m(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?d(Object(a),!0).forEach((function(t){Object(n.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):d(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var h,p={name:"CancelAudition",props:{businessId:{type:[String,Number],default:""},appointmentId:{type:[String,Number],default:""},operationType:{type:Number,default:null},pyUid:{type:[String,Number],default:""},cityCode:{type:String,default:""}},data:function(){return{formValidate:{nextFollowTime:"",nextFollowTimeVal:"",cancelReason:"",cancelReasonExtra:""},dateOptions:{disabledDate:function(e){return e&&e.valueOf()<Date.now()-864e5}},btnLoading:!1,isShowOtherReason:!1,cancelReasons:[{id:1,label:"时间原因"},{id:2,label:"距离远"},{id:3,label:"已报名学而思课程"},{id:4,label:"已报名其他机构课程"},{id:5,label:"孩子不想来"},{id:6,label:"其他原因"}]}},methods:{onReasonChange:function(e){this.isShowOtherReason=6===e},dateChange:function(e,t){this.formValidate[t]=e},confirm:(h=Object(r.a)(regeneratorRuntime.mark((function e(){var t,a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.formValidate.cancelReason){e.next=3;break}return this.$Message.warning({content:"请选择取消原因"}),e.abrupt("return");case 3:if(6!==this.formValidate.cancelReason||this.formValidate.cancelReasonExtra.trim()){e.next=6;break}return this.$Message.warning({content:"请填写其他原因详细描述"}),e.abrupt("return");case 6:return t=m(m({},this.formValidate),{},{businessId:this.businessId,appointmentId:this.appointmentId,operationType:this.operationType,cancelType:this.operationType,pyUid:this.pyUid,cityCode:this.cityCode}),e.prev=7,this.btnLoading=!0,e.next=11,Object(u.b)(t);case 11:setTimeout((function(){a.btnLoading=!1,a.$Message.success({content:"取消试听成功"}),a.$emit("success"),a.cancel()}),2e3),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(7),this.btnLoading=!1,this.$Message.error({content:"取消试听失败: ".concat(e.t0.message)});case 18:case"end":return e.stop()}}),e,this,[[7,14]])}))),function(){return h.apply(this,arguments)}),cancel:function(){this.$emit("cancel")}}},f=a("2877"),g=Object(f.a)(p,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("Form",{attrs:{"label-width":120}},[a("FormItem",{attrs:{label:"下次跟进时间: "}},[a("DatePicker",{staticStyle:{width:"200px"},attrs:{type:"datetime",placeholder:"请选择",format:"yyyy-MM-dd HH:mm:ss",options:e.dateOptions},on:{"on-change":function(t){return e.dateChange(t,"nextFollowTime")}},model:{value:e.formValidate.nextFollowTimeVal,callback:function(t){e.$set(e.formValidate,"nextFollowTimeVal",t)},expression:"formValidate.nextFollowTimeVal"}})],1),e._v(" "),a("FormItem",{attrs:{label:"取消原因: ",required:""}},[a("Select",{staticStyle:{width:"200px"},attrs:{placeholder:"请选择"},on:{"on-change":e.onReasonChange},model:{value:e.formValidate.cancelReason,callback:function(t){e.$set(e.formValidate,"cancelReason",t)},expression:"formValidate.cancelReason"}},e._l(e.cancelReasons,(function(t,r){return a("Option",{key:r,attrs:{value:t.id}},[e._v(e._s(t.label))])})),1)],1),e._v(" "),e.isShowOtherReason?a("FormItem",{attrs:{label:" "}},[a("Input",{staticStyle:{width:"200px"},attrs:{type:"textarea",placeholder:"请输入其他原因"},model:{value:e.formValidate.cancelReasonExtra,callback:function(t){e.$set(e.formValidate,"cancelReasonExtra",t)},expression:"formValidate.cancelReasonExtra"}})],1):e._e()],1),e._v(" "),a("Row",{attrs:{type:"flex",justify:"center",gutter:20}},[a("Col",[a("Button",{on:{click:e.cancel}},[e._v("取消")])],1),e._v(" "),a("Col",[a("Button",{attrs:{type:"primary",loading:e.btnLoading},on:{click:e.confirm}},[e._v("提交")])],1)],1)],1)}),[],!1,null,null,null).exports;function v(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function y(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?v(Object(a),!0).forEach((function(t){Object(n.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):v(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var b={name:"ChangeAttendance",props:{auditionInfo:{type:Object,default:function(){return{}}}},data:function(){return{formValidate:{nextFollowTime:"",nextFollowTimeVal:"",reason:"",isAttend:1},dateOptions:{disabledDate:function(e){return e&&e.valueOf()<Date.now()-864e5}},btnLoading:!1}},mounted:function(){this.formValidate.isAttend=this.auditionInfo.isAttendance||0},methods:{dateChange:function(e,t){this.formValidate[t]=e},confirm:function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.formValidate.reason){e.next=3;break}return this.$Message.warning({content:"请填写修改原因"}),e.abrupt("return");case 3:return e.prev=3,t=y(y({},this.formValidate),{},{appointmentId:this.auditionInfo.id,auditionId:this.auditionInfo.auditionId,studentUid:this.auditionInfo.uid,curriculumNum:this.auditionInfo.curriculumNum,classId:this.auditionInfo.classId}),this.btnLoading=!0,e.next=8,Object(o.f)(t);case 8:this.btnLoading=!1,this.$emit("success"),this.$emit("cancel"),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(3),this.btnLoading=!1,this.$Message.error({content:"修改考勤失败: "+e.t0.message,duration:5});case 17:case"end":return e.stop()}}),e,this,[[3,13]])})));return function(){return e.apply(this,arguments)}}(),cancel:function(){this.$emit("cancel")}}},C=(a("f4b0"),Object(f.a)(b,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("p",{staticClass:"mgb-24"},[a("span",{staticClass:"mgl-30"},[e._v("试听课程: "+e._s(e.auditionInfo.className||"--"))]),e._v(" "),a("span",{staticClass:"mgl-30"},[e._v("课次: "+e._s(e.auditionInfo.curriculumNum||"--"))]),e._v(" "),a("span",{staticClass:"mgl-30"},[e._v("主讲老师: "+e._s(e.auditionInfo.teacherName||"--"))])]),e._v(" "),a("p",{staticClass:"mgb-24"},[a("span",{staticClass:"mgl-30"},[e._v("上课时间: "+e._s(e.auditionInfo.classTimeVal||"--"))]),e._v(" "),a("span",{staticClass:"mgl-30"},[e._v("服务中心: "+e._s(e.auditionInfo.serviceCenter||"--"))]),e._v(" "),a("span",{staticClass:"mgl-30"},[e._v("教室: "+e._s(e.auditionInfo.classroom||"--"))])]),e._v(" "),a("Form",{attrs:{"label-width":95,inline:""}},[a("FormItem",{attrs:{label:"考勤状态: "}},[a("RadioGroup",{model:{value:e.formValidate.isAttend,callback:function(t){e.$set(e.formValidate,"isAttend",t)},expression:"formValidate.isAttend"}},[a("Radio",{attrs:{label:1}},[e._v("准时上课")]),e._v(" "),a("Radio",{attrs:{label:2}},[e._v("迟到")]),e._v(" "),a("Radio",{attrs:{label:0}},[e._v("缺勤")])],1)],1),e._v(" "),a("div"),e._v(" "),a("FormItem",{attrs:{label:"是否有ITS考勤: "}},[e._v(e._s(1===e.auditionInfo.isItsAttendance?"有":"无"))]),e._v(" "),a("FormItem",{attrs:{label:"考勤时间: "}},[e._v(e._s(e.auditionInfo.attendanceTime||"--"))]),e._v(" "),a("FormItem",{attrs:{label:"下次跟进时间: "}},[a("DatePicker",{staticStyle:{width:"200px"},attrs:{type:"datetime",placeholder:"请选择",format:"yyyy-MM-dd HH:mm:ss",options:e.dateOptions},on:{"on-change":function(t){return e.dateChange(t,"nextFollowTime")}},model:{value:e.formValidate.nextFollowTimeVal,callback:function(t){e.$set(e.formValidate,"nextFollowTimeVal",t)},expression:"formValidate.nextFollowTimeVal"}})],1),e._v(" "),a("FormItem",{attrs:{label:"修改原因: ",required:""}},[a("Input",{staticStyle:{width:"300px"},attrs:{type:"textarea",placeholder:"请输入"},model:{value:e.formValidate.reason,callback:function(t){e.$set(e.formValidate,"reason",t)},expression:"formValidate.reason"}})],1)],1),e._v(" "),a("Row",{attrs:{type:"flex",justify:"center",gutter:20}},[a("Col",[a("Button",{attrs:{type:"primary",loading:e.btnLoading},on:{click:e.confirm}},[e._v("提交")])],1),e._v(" "),a("Col",[a("Button",{on:{click:e.cancel}},[e._v("取消")])],1)],1)],1)}),[],!1,null,"070dda88",null).exports),D=a("efbf"),w=a("3c8d"),k={name:"reservationRecord",mixins:[c.a,l.a],props:{formData:{type:Object,default:function(){return{}}}},components:{FollowRecord:D.a,CancelAudition:g,ChangeAttendance:C},data:function(){var e=this;return{tableLoading:!1,tableData:[],tableConfig:{pageSize:10,pageNo:1,totalCount:0},stuDetail:{uid:"",card:"",cityCode:"",areaCode:"",realName:"",gradeName:""},followUp:{showModal:!1,id:!1,operateType:1},cancelAuditionModal:{show:!1},changeAttendanceModal:{show:!1},attendenceStatus:{0:"缺勤",1:"准时上课",2:"迟到"},auditionInfo:{},columns:Object.freeze([{title:"操作",align:"center",width:"70",render:function(t,a){return t("div",[t("a",{on:{click:function(){e.stuDetail.uid=a.row.pyUid,e.stuDetail.card=a.row.stuCode,e.stuDetail.realName=a.row.stuRealName,e.stuDetail.cityCode=e.stuDetail.areaCode=e.formData.cityCode,e.stuDetail.gradeName=a.row.grade,e.followUp.id=a.row.id,e.followUp.appointmentApplyId=a.row.appointmentApplyId,e.followUp.showModal=!0}}},"跟进"),t("p"),5===a.row.appointmentStatus||1===a.row.curriculumStatus?t("span",{style:{color:"gray"}},"取消试听"):t("a",{on:{click:function(){e.cancelAudition(a.row)}}},"取消试听"),t("p"),1===a.row.isAttendanceRecordModified?t("span",{style:{color:"gray"}},"修改考勤"):t("a",{on:{click:function(){e.changeAttendance(a.row)}}},"修改考勤"),t("br"),a.row.evaluationUrl?t("a",{attrs:{href:a.row.evaluationUrl}},"试听反馈表"):t("span",{style:{color:"gray"}},"试听反馈表")])}},{title:"学员姓名",key:"stuRealName",align:"center",render:function(t,a){var r=[t("a",{on:{click:function(){var t={card:a.row.stuCode,cityCode:a.row.areaCode};e.goCustomerDetail(t)}}},a.row.stuRealName||"无"),t("Icon",{props:{custom:"iconfont icon-phone-fill"},style:{cursor:"pointer",marginLeft:"5px",display:e.callShow(a.row.areaCode)?"block":"none"},on:{click:function(){e.$store.state.app.callInstance.call(a.row.stuCityCode,a.row.pyUid)}}})];return t("div",{style:{display:"flex",alignItems:"center"}},r)}},{title:"联系电话",key:"phone",align:"center",width:120,render:function(e,t){return e(w.TalDecodeText,{props:{uid:t.row.pyUid,encodeText:t.row.phone,type:"phone"}})}},{title:"绑定顾问",key:"belongAdvisorName",align:"center",render:function(e,t){return e("span",t.row.belongAdvisorName||"无")}},{title:"预约顾问",key:"planAdvisorName",align:"center",render:function(e,t){return e("span",t.row.planAdvisorName||"无")}},{title:"接待顾问",key:"treatAdvisorName",align:"center",render:function(e,t){return e("span",t.row.treatAdvisorName||"无")}},{title:"渠道链接",key:"applyChannel",align:"center",render:function(e,t){return e("span",t.row.applyChannel||"无")}},{title:"是否领取伴手礼",key:"isGift",align:"center",render:function(e,t){return e("span",1===t.row.isGift?"是":"否")}},{title:"用户意向",key:"stuIntention",align:"center",render:function(e,t){return e("span",t.row.stuIntention||"无")}},{title:"渠道标签",key:"channel",align:"center",render:function(e,t){return e("span",t.row.channel||"无")}},{title:"创建时间",key:"createTime",align:"center",width:100,render:function(e,t){return e("span",t.row.createTime||"无")}},{title:"是否取消",key:"appointmentStatus",align:"center",render:function(e,t){return e("span",5===t.row.appointmentStatus?"是":"否")}},{title:"考勤状态",key:"isAttendance",align:"center",render:function(t,a){return t("span",e.attendenceStatus[a.row.isAttendance]||"--")}},{title:"年份",key:"year",align:"center",render:function(e,t){return e("span",t.row.year||"--")}},{title:"试听学期",key:"term",align:"center",render:function(e,t){return e("span",t.row.term||"--")}},{title:"试听学科",key:"subject",align:"center",render:function(e,t){return e("span",t.row.subject||"--")}},{title:"试听年级",key:"grade",align:"center",render:function(e,t){return e("span",t.row.grade||"--")}},{title:"试听课程",key:"className",align:"center",render:function(t,a){return a.row.className?t("a",{on:{click:function(){e.showClassDetail(a.row.classId)}}},a.row.className):t("span","--")}},{title:"试听课次",key:"curriculumNum",align:"center",render:function(e,t){return e("span",t.row.curriculumNum||"--")}},{title:"上课时间",key:"classTimeVal",align:"center",render:function(e,t){return e("span",t.row.classTimeVal||"--")}},{title:"试听服务中心",key:"serviceCenter",align:"center",render:function(e,t){return e("span",t.row.serviceCenter||"--")}},{title:"是否报名同学科长期班",key:"isRegist",align:"center",render:function(e,t){return e("span",1===t.row.isRegist?"是":"否")}},{title:"是否缴费同学科长期班",key:"isPay",align:"center",render:function(e,t){return e("span",1===t.row.isPay?"是":"否")}},{title:"跟进次数",key:"followCount",align:"center",render:function(e,t){return e("span",t.row.followCount)}}])}},methods:{callShow:function(e){var t=this.$store.state.app.callGrayCity;return!(t&&t.length&&!t.includes(e)||!this.$store.state.roleRelativeData.roleIds.includes(this.$store.state.roleRelativeData.userInfo.crmRoleId))},cancelAudition:function(e){this.cancelAuditionModal=Object.assign(this.cancelAuditionModal,e,{appointmentId:e.id}),this.cancelAuditionModal.show=!0},changeAttendance:function(e){this.changeAttendanceModal=Object.assign({},e,{show:!0,auditionId:e.businessId,uid:e.pyUid})},refreshSearch:function(){var e=this;this.followUp.showModal=!1,setTimeout((function(){e.getTableData()}),1500)},search:function(){if(!this.formData.cityCode)return this.$Message.warning({content:"请选择城市",duration:5});this.tableConfig.pageNo=1,this.tableConfig.pageSize=10,this.getTableData()},changePage:function(e){this.tableConfig.pageNo=e,this.getTableData()},pageSizeChange:function(e){this.tableConfig.pageNo=1,this.tableConfig.pageSize=e,this.getTableData()},getTableData:function(){var e=this;this.formData.hasOwnProperty("applyTime")&&(delete this.formData.applyTime,delete this.formData.createTime,delete this.formData.endTime);var t=Object.assign({},this.formData,this.tableConfig,{areaCode:this.formData.cityCode,auditionStartTime:this.formData.auditionStartTime?this.formData.auditionStartTime+" 00:00:00":"",auditionEndTime:this.formData.auditionEndTime?this.formData.auditionEndTime+" 23:59:59":"",createStartTime:this.formData.createStartTime?this.formData.createStartTime+" 00:00:00":"",createEndTime:this.formData.createEndTime?this.formData.createEndTime+" 23:59:59":""});this.tableLoading=!0,Object(o.b)(t).then((function(t){e.tableConfig.totalCount=t.totalCount,e.tableData=Object.freeze(t.auditionAppointmentResps)||[]})).catch((function(t){e.tableConfig.totalCount=0,e.$Message.error({content:t.message,duration:5})})).finally((function(){e.tableLoading=!1}))}}},_=Object(f.a)(k,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("Table",{ref:"selection",attrs:{border:"",loading:e.tableLoading,columns:e.columns,data:e.tableData}}),e._v(" "),a("div",{class:{"page-fix":e.tableData.length<3},staticStyle:{margin:"10px"}},[a("div",{staticClass:"page-box",staticStyle:{"text-align":"right"}},[a("Page",{attrs:{total:e.tableConfig.totalCount,"page-size":e.tableConfig.pageSize,current:e.tableConfig.pageNo,"show-elevator":"","show-sizer":"","show-total":""},on:{"update:current":function(t){return e.$set(e.tableConfig,"pageNo",t)},"on-page-size-change":e.pageSizeChange,"on-change":e.changePage}})],1)]),e._v(" "),a("tal-class-detail",{attrs:{"class-id":e.classDetail.id,show:e.classDetail.show},on:{close:function(t){e.classDetail.show=!1}}}),e._v(" "),a("Modal",{attrs:{"mask-closable":!1,title:"试听跟进","footer-hide":!0,width:"760px"},model:{value:e.followUp.showModal,callback:function(t){e.$set(e.followUp,"showModal",t)},expression:"followUp.showModal"}},[e.followUp.showModal?a("FollowRecord",{attrs:{appointmentId:e.followUp.id,studentDetail:e.stuDetail,operationType:1,appointmentApplyId:e.followUp.appointmentApplyId},on:{success:e.refreshSearch,close:function(t){e.followUp.showModal=!1}}}):e._e()],1),e._v(" "),a("Modal",{attrs:{"mask-closable":!1,title:"取消试听","footer-hide":!0,width:"460px"},model:{value:e.cancelAuditionModal.show,callback:function(t){e.$set(e.cancelAuditionModal,"show",t)},expression:"cancelAuditionModal.show"}},[e.cancelAuditionModal.show?a("CancelAudition",e._b({attrs:{operationType:1},on:{success:e.refreshSearch,cancel:function(t){e.cancelAuditionModal.show=!1}}},"CancelAudition",e.cancelAuditionModal,!1)):e._e()],1),e._v(" "),a("Modal",{attrs:{"mask-closable":!1,title:"修改考勤","footer-hide":!0,width:"560px"},model:{value:e.changeAttendanceModal.show,callback:function(t){e.$set(e.changeAttendanceModal,"show",t)},expression:"changeAttendanceModal.show"}},[e.changeAttendanceModal.show?a("ChangeAttendance",{attrs:{auditionInfo:e.changeAttendanceModal},on:{success:e.refreshSearch,cancel:function(t){e.changeAttendanceModal.show=!1}}}):e._e()],1)],1)}),[],!1,null,"12df09d6",null).exports,S=a("c7d4");function T(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function I(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?T(Object(a),!0).forEach((function(t){Object(n.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):T(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var L,x,N={name:"changeApplyStatus",props:{applyInfo:{type:Object,default:function(){return{}}}},data:function(){return{nextTime:"",nextTimeShow:!1,formData:{remark:"",applyType:1,preApplyStatus:0,nextFollowUpTime:""},applyStatusMap:{0:"未跟进",2:"跟进结束",3:"跟进中"},applySecondStatusMap:{1:"继续跟进",2:"未接通",3:"无意向",4:"已用其他账号预约",5:"已转化无需预约",6:"无匹配课程"},applyChangedRecord:[],cascaderValue:[],cascaderList:[{value:3,label:"跟进中",children:[{value:1,label:"继续跟进"},{value:2,label:"未接通"}]},{value:2,label:"跟进结束",children:[{value:3,label:"无意向"},{value:4,label:"已用其他账号预约"},{value:5,label:"已转化无需预约"},{value:6,label:"无匹配课程",children:[{value:7,label:"无时间匹配"},{value:8,label:"无课程匹配"}]}]}]}},watch:{cascaderValue:function(e){e&&e.length&&3===e[0]?this.nextTimeShow=!0:(this.nextTimeShow=!1,this.nextTime="",this.formData.nextFollowUpTime="")}},mounted:function(){var e=this;this.$nextTick((function(){e.formData.preApplyStatus=e.applyInfo.applyStatus,e.cascaderValue=[e.applyInfo.applyStatus,e.applyInfo.applySecondStatus,e.applyInfo.applyThirdStatus],e.formData.applyId=e.applyInfo.id,e.queryModifyRecords()}))},methods:{timeChange:function(e){this.formData.nextFollowUpTime=e},submit:(x=Object(r.a)(regeneratorRuntime.mark((function e(){var t,a,r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.cascaderValue[0]){e.next=2;break}return e.abrupt("return",this.$Message.warning("请选择状态"));case 2:if(this.formData.remark.trim()){e.next=4;break}return e.abrupt("return",this.$Message.warning("请填写备注"));case 4:if(t=this.cascaderValue[0],a=this.cascaderValue[1]||null,r=this.cascaderValue[2]||null,3!==t||this.formData.nextFollowUpTime){e.next=9;break}return e.abrupt("return",this.$Message.warning("请选择下次跟进时间"));case 9:return n=I(I({},this.formData),{},{currentApplyStatus:t,applySecondStatus:a,applyThirdStatus:r}),e.prev=10,e.next=13,Object(S.e)(n);case 13:this.$Message.success({content:"修改申请状态成功"}),this.$emit("success"),this.$emit("close"),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(10),this.$Message.error({content:"修改申请状态失败: ".concat(e.t0.message),duration:5});case 21:case"end":return e.stop()}}),e,this,[[10,18]])}))),function(){return x.apply(this,arguments)}),queryModifyRecords:(L=Object(r.a)(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={applyId:this.formData.applyId},e.next=4,Object(S.f)(t);case 4:a=e.sent,this.applyChangedRecord=Object.freeze(a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),this.$Message.error({content:"获取修申请改记录失败: ".concat(e.t0.message),duration:5});case 11:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(){return L.apply(this,arguments)})}},O=(a("c85f"),Object(f.a)(N,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("Form",{attrs:{"label-width":100}},[a("FormItem",{attrs:{label:"状态",required:""}},[a("Cascader",{staticStyle:{width:"200px",display:"inline-block"},attrs:{data:e.cascaderList},model:{value:e.cascaderValue,callback:function(t){e.cascaderValue=t},expression:"cascaderValue"}})],1),e._v(" "),e.nextTimeShow?a("FormItem",{attrs:{label:"下次跟进时间",required:""}},[a("DatePicker",{staticStyle:{width:"200px"},attrs:{type:"datetime",format:"yyyy-MM-dd HH:mm",placeholder:"请选择"},on:{"on-change":e.timeChange},model:{value:e.formData.nextTime,callback:function(t){e.$set(e.formData,"nextTime",t)},expression:"formData.nextTime"}})],1):e._e(),e._v(" "),a("FormItem",{attrs:{label:"备注",required:""}},[a("Input",{staticStyle:{width:"80%"},attrs:{placeholder:"请输入备注",type:"textarea",minlength:5},model:{value:e.formData.remark,callback:function(t){e.$set(e.formData,"remark",t)},expression:"formData.remark"}})],1)],1),e._v(" "),a("Row",{attrs:{type:"flex",justify:"center",gutter:20}},[a("Col",[a("Button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v("确定")])],1),e._v(" "),a("Col",[a("Button",{on:{click:function(t){return e.$emit("close")}}},[e._v("取消")])],1)],1),e._v(" "),e.applyChangedRecord.length?a("h3",{staticStyle:{margin:"16px 0"}},[e._v("修改记录")]):e._e(),e._v(" "),e._l(e.applyChangedRecord,(function(t,r){return a("Row",{key:r,staticStyle:{"padding-left":"24px"}},[a("Col",[e._v("状态: "+e._s(e.applyStatusMap[t.currentApplyStatus]))]),e._v(" "),a("Col",[e._v("备注: "+e._s(t.remark))]),e._v(" "),a("Col",{attrs:{span:"8"}},[e._v("操作人: "+e._s(t.modifyEmpName))]),e._v(" "),a("Col",{attrs:{span:"16"}},[e._v("操作时间: "+e._s(t.createTime))]),e._v(" "),a("Col",{attrs:{span:"24"}},[a("Divider")],1)],1)}))],2)}),[],!1,null,"6cea9488",null).exports),j=a("2f62"),M=a("a78e"),$=a.n(M);function R(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function P(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?R(Object(a),!0).forEach((function(t){Object(n.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):R(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var A={name:"applyRecord",mixins:[c.a],props:{formData:{type:Object,default:function(){return{}}}},computed:P({},Object(j.e)({deptId:function(e){return e.roleRelativeData.userInfo.crmDeptId},roleId:function(e){return e.roleRelativeData.userInfo.crmRoleId},cityCode:function(e){return e.roleRelativeData.userInfo.cityCode}})),components:{ChangeApplyStatus:O},data:function(){var e=this;return{tableLoading:!1,tableData:[],tableConfig:{pageSize:10,pageNo:1,totalCount:0},changeApplyStatusModal:{show:!1},auditionInfo:{},columns:[{title:"操作",align:"center",width:"70",render:function(t,a){return t("a",{on:{click:function(){e.changeApplyStatus(a.row)}}},"修改")}},{title:"学员姓名",key:"stuRealName",align:"center",render:function(t,a){var r=[t("a",{on:{click:function(){var t={card:a.row.stuCode,cityCode:a.row.stuCityCode};e.goCustomerDetail(t)}}},a.row.stuName||"--"),t("Icon",{props:{custom:"iconfont icon-phone-fill"},style:{cursor:"pointer",marginLeft:"5px",display:e.callShow(a.row.stuCityCode)?"block":"none"},on:{click:function(){e.$store.state.app.callInstance.call(a.row.stuCityCode,a.row.pyUid)}}})];return t("div",{style:{display:"flex",alignItems:"center"}},r)}},{title:"联系电话",key:"phone",align:"center",width:120,render:function(e,t){return e(w.TalDecodeText,{props:{uid:t.row.pyUid,encodeText:t.row.phone,type:"phone"}})}},{title:"维护顾问",key:"maintainerName",align:"center",render:function(e,t){return e("span",t.row.maintainerName||"--")}},{title:"跟进状态(一级)",key:"applyStatus",align:"center",render:function(t,a){return t("span",e.applyStatusMap[a.row.applyStatus]||"--")}},{title:"跟进状态(二级)",key:"applySecondStatus",align:"center",render:function(t,a){return t("span",e.applySecondStatusMap[a.row.applySecondStatus]||"--")}},{title:"最近跟进时间",key:"followTime",align:"center",render:function(e,t){return e("span",t.row.followTime||"--")}},{title:"跟进次数",key:"modifyCount",align:"center",render:function(e,t){return e("span",t.row.modifyCount||"--")}},{title:"渠道链接",key:"applyChannel",align:"center",render:function(e,t){return e("span",t.row.applyChannel||"--")}},{title:"申请时间",key:"createTime",align:"center",render:function(e,t){return e("span",t.row.createTime||"--")}},{title:"期望试听时间",key:"subTime",align:"center",render:function(e,t){return e("span",t.row.subTime||"--")}},{title:"推荐顾问",key:"referrerName",align:"center",render:function(e,t){return e("span",t.row.referrerName||"--")}},{title:"推荐学员",key:"referrerStuName",align:"center",render:function(t,a){return a.row.referrerStuCode?t("a",{on:{click:function(){var t={card:a.row.referrerStuCode,cityCode:a.row.referrerStuCityCode};e.goCustomerDetail(t)}}},a.row.referrerStuName||"无"):t("span",a.row.referrerStuName||"无")}},{title:"推荐学员编号",key:"referrerStuName",align:"center",render:function(e,t){return e("span",t.row.referrerStuCode||"")}},{title:"意向服务中心",key:"intendedServiceCenter",align:"center",render:function(e,t){return e("span",t.row.intendedServiceCenter||"--")}},{title:"年份",key:"year",align:"center",render:function(e,t){return e("span",t.row.year||"--")}},{title:"年级",key:"gradeName",align:"center",render:function(e,t){return e("span",t.row.gradeName||"--")}},{title:"学科",key:"subject",align:"center",render:function(e,t){return e("span",t.row.subject||"--")}},{title:"授课类型",key:"classType",align:"center",render:function(t,a){return t("span",e.classTypeMap[a.row.classType]||"--")}},{title:"是否跟进",key:"classType",align:"center",render:function(e,t){return e("span",t.row.modifyCount>0?"是":"否")}},{title:"是否跟进",key:"modifyCount",align:"center",render:function(e,t){return e("span",t.row.modifyCount>0?"是":"否")}}],applyStatusMap:{0:"未跟进",1:"已预约",2:"跟进结束",3:"跟进中"},applySecondStatusMap:{1:"继续跟进",2:"未接通",3:"无意向",4:"已用其他账号预约",5:"已转化无需预约",6:"无匹配课程"},classTypeMap:{1:"在线",2:"双师",4:"面授"}}},methods:{callShow:function(e){var t=this.$store.state.app.callGrayCity;return!(t&&t.length&&!t.includes(e)||!this.$store.state.roleRelativeData.roleIds.includes(this.$store.state.roleRelativeData.userInfo.crmRoleId))},changeApplyStatus:function(e){this.changeApplyStatusModal.show=!0,this.changeApplyStatusModal=Object.assign({},e,{show:!0})},refreshSearch:function(){var e=this;setTimeout((function(){e.getTableData()}),1500)},search:function(){this.tableConfig.pageNo=1,this.tableConfig.pageSize=10,this.getTableData()},changePage:function(e){this.tableConfig.pageNo=e,this.getTableData()},pageSizeChange:function(e){this.tableConfig.pageNo=1,this.tableConfig.pageSize=e,this.getTableData()},getTableData:function(){var e=this,t=P({isFollowFlag:1,cityCode:2===this.roleId?this.cityCode:null,stuRealName:this.formData.stuRealName,phone:this.formData.phone,stuCode:this.formData.stuCode,createTime:this.formData.createTime,endTime:this.formData.endTime,empNo:5===this.roleId?JSON.parse($.a.get("columbusUserInfo")).id:null,deptId:4===this.roleId?this.deptId:null,orderSortType:this.formData.orderSortType,applyStatusList:this.formData.applyStatusList},this.tableConfig);this.tableLoading=!0,Object(S.b)(t).then((function(t){e.tableConfig.totalCount=t.totalCount,e.tableData=Object.freeze(t.records)||[]})).catch((function(t){e.tableConfig.totalCount=0,e.$Message.error({content:t.message,duration:5})})).finally((function(){e.tableLoading=!1}))}}},E=Object(f.a)(A,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("Table",{ref:"selection",attrs:{border:"",loading:e.tableLoading,columns:e.columns,data:e.tableData}}),e._v(" "),a("div",{class:{"page-fix":e.tableData.length<3},staticStyle:{margin:"10px"}},[a("div",{staticClass:"page-box",staticStyle:{"text-align":"right"}},[a("Page",{attrs:{total:e.tableConfig.totalCount,"page-size":e.tableConfig.pageSize,current:e.tableConfig.pageNo,"show-elevator":"","show-sizer":"","show-total":""},on:{"update:current":function(t){return e.$set(e.tableConfig,"pageNo",t)},"on-page-size-change":e.pageSizeChange,"on-change":e.changePage}})],1)]),e._v(" "),a("Modal",{attrs:{"mask-closable":!1,title:"修改","footer-hide":!0,width:"560px"},model:{value:e.changeApplyStatusModal.show,callback:function(t){e.$set(e.changeApplyStatusModal,"show",t)},expression:"changeApplyStatusModal.show"}},[e.changeApplyStatusModal.show?a("ChangeApplyStatus",{attrs:{applyInfo:e.changeApplyStatusModal},on:{close:function(t){e.changeApplyStatusModal.show=!1},success:e.refreshSearch}}):e._e()],1)],1)}),[],!1,null,"6d648592",null).exports;function F(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}var q,z={name:"auditionMgt",mixins:[i.a],components:{ReservationRecord:_,ApplyRecord:E},computed:function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?F(Object(a),!0).forEach((function(t){Object(n.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):F(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},Object(j.e)({cityCode:function(e){return e.roleRelativeData.userInfo.cityCode},sideMenuTasks:function(e){return e.app.sideMenuTasks},roleId:function(e){return e.roleRelativeData.userInfo.crmRoleId},deptId:function(e){return e.roleRelativeData.userInfo.crmDeptId}})),data:function(){var e=this;return{conditions:{stuIntention:[],isNewStudent:[],isRegist:[],isPay:[],attendanceStatus:[],appointmentStatus:[]},setDefaultServiceCenter:!0,treatAdvisorEmpNos:[],formData:{year:"",planAdvisorNo:"",treatAdvisorNo:"",stuIntention:"",isRegist:"",isPay:"",appointmentStatus:"",isAttendance:"",stuRealName:"",phone:"",stuCode:"",createTime:"",createStartTime:"",createEndTime:"",auditionTime:"",auditionStartTime:"",auditionEndTime:"",applyTime:"",channelId:"",classType:"",orderSortType:0,applyStatusList:[]},btnLoading:!1,diagnosisChannels:[],auditionInfo:{},taskNum:0,customTabPaneLabel:function(t){return t("div",[t("span","试听申请记录"),t("Badge",{props:{count:e.$store.getters.getSideMenuTaskByRouterName("auditionMgt")}})])},activeTabName:"applyRecord",sortTypeList:[{value:1,label:"创建时间降序"},{value:2,label:"创建时间升序"},{value:3,label:"跟进时间降序"},{value:4,label:"跟进时间升序"}],qrCode:{showModal:!1,activityCodeUrl:""}}},mounted:function(){this.initView()},methods:{createRrCode:(q=Object(r.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(S.a)({cityCode:this.cityCode});case 3:t=e.sent,this.qrCode.activityCodeUrl=t.data,this.qrCode.showModal=!0,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),this.$Message.error({content:"获取老带新二维码失败: ".concat(e.t0.message),duration:5});case 11:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(){return q.apply(this,arguments)}),onSearch:function(){this.$refs[this.activeTabName].search()},queryDiagnosisChannels:function(){var e=this;Object(s.f)({}).then((function(t){e.diagnosisChannels=Object.freeze(t)})).catch((function(t){e.$Message.error({content:t.message,duration:5})}))},exportDataClick:function(){var e=this,t=this.allCityList.filter((function(t){return t.id===e.formData.cityCode}))[0].name,a=Object.assign({},this.formData,{areaCode:this.formData.cityCode,auditionStartTime:this.formData.auditionStartTime?this.formData.auditionStartTime+" 00:00:00":"",auditionEndTime:this.formData.auditionEndTime?this.formData.auditionEndTime+" 23:59:59":"",createStartTime:this.formData.createStartTime?this.formData.createStartTime+" 00:00:00":"",createEndTime:this.formData.createEndTime?this.formData.createEndTime+" 23:59:59":"",cityName:t,crmRoleId:this.$store.state.roleRelativeData.userInfo.crmRoleId});if(!a.createStartTime||!a.createEndTime)return this.$Message.warning({content:"请选择创建时间，最多支持选择三个月",duration:3});this.btnLoading=!0,Object(o.d)(a).then((function(t){var a=t.id;e.$Message.info({content:"正在导出excel，请勿关闭当前标签页",duration:5});var r=Date.now();!function e(t,a){if(Date.now()-r>3e5)return a.$Message.error({content:"导出失败，请重试"}),void(a.btnLoading=!1);Object(o.e)({id:t}).then((function(r){r.filePath?setTimeout((function(){window.open(r.filePath),a.btnLoading=!1}),500):a.timer=setTimeout((function(){e(t,a)}),2e3)})).catch((function(e){a.btnLoading=!1,a.$Message.error({content:e.message,duration:5})}))}(a,e)})).catch((function(t){e.btnLoading=!1,e.$Message.error({content:t.message,duration:5})}))},exportApplyDataClick:function(){var e=this,t=Object.assign({},{cityCode:2===this.roleId?this.cityCode:null,stuRealName:this.formData.stuRealName,phone:this.formData.phone,stuCode:this.formData.stuCode,empNo:5===this.roleId?JSON.parse($.a.get("columbusUserInfo")).id:null,deptId:4===this.roleId?this.deptId:null,createTime:this.formData.createTime,endTime:this.formData.endTime});if(!t.createTime||!t.endTime)return this.$Message.warning({content:"请选择申请时间，最多支持选择六个月",duration:3});this.btnLoading=!0,Object(o.a)(t).then((function(t){var a=t.id;e.$Message.info({content:"正在导出excel，请勿关闭当前标签页",duration:5});var r=Date.now();!function e(t,a){if(Date.now()-r>3e5)return a.$Message.error({content:"导出失败，请重试"}),void(a.btnLoading=!1);Object(o.c)({id:t,queryId:1471}).then((function(r){r.filePath?setTimeout((function(){window.open(r.filePath),a.btnLoading=!1}),500):a.timer=setTimeout((function(){e(t,a)}),2e3)})).catch((function(e){a.btnLoading=!1,a.$Message.error({content:e.message,duration:5})}))}(a,e)})).catch((function(t){e.btnLoading=!1,e.$Message.error({content:t.message,duration:5})}))},getTreatAdvisorEmpNos:function(e){var t=this,a={userName:e};Object(s.e)(a).then((function(e){t.treatAdvisorEmpNos=Object.freeze(e)})).catch((function(e){t.$Message.error({content:e.message,duration:5})}))},getCondition:function(){var e=this;Object(s.b)({}).then((function(t){e.conditions=Object.freeze(t)})).catch((function(t){e.$Message.error({content:t.message,duration:5})}))},initView:function(){this.getCitys(),this.getYears(),this.getCondition(),this.queryDiagnosisChannels()}}},B=(a("0bc1"),Object(f.a)(z,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{width:"100%",padding:"10px"}},[a("Form",{ref:"form",staticClass:"mrg-b filter-search",staticStyle:{padding:"10px 0",background:"#fff"},attrs:{model:e.formData,"label-position":"right","label-width":15,inline:""}},[a("div",{staticClass:"class_top clearfix"},["reservationRecord"===e.activeTabName?[a("FormItem",{attrs:{required:"",label:" "}},[a("Select",{staticStyle:{width:"120px"},attrs:{placeholder:"城市",filterable:""},on:{"on-change":e.cityYearChange},model:{value:e.formData.cityCode,callback:function(t){e.$set(e.formData,"cityCode",t)},expression:"formData.cityCode"}},e._l(e.allCityList,(function(t,r){return a("Option",{key:r,attrs:{value:t.id}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),a("FormItem",[a("Select",{staticStyle:{width:"150px"},attrs:{clearable:"",filterable:"",placeholder:"区域"},on:{"on-change":function(t){return e.changeArea()}},model:{value:e.formData.areaId,callback:function(t){e.$set(e.formData,"areaId",t)},expression:"formData.areaId"}},e._l(e.areaList,(function(t,r){return a("Option",{key:r,attrs:{value:t.schoolId}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),a("FormItem",[a("Select",{staticStyle:{width:"150px"},attrs:{clearable:"",filterable:"",placeholder:"服务中心"},model:{value:e.formData.serviceCenterId,callback:function(t){e.$set(e.formData,"serviceCenterId",t)},expression:"formData.serviceCenterId"}},e._l(e.serviceList,(function(t,r){return a("Option",{key:r,attrs:{value:t.schoolId}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),a("FormItem",[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:"",placeholder:"年份"},model:{value:e.formData.year,callback:function(t){e.$set(e.formData,"year",t)},expression:"formData.year"}},e._l(e.yearList,(function(t,r){return a("Option",{key:r,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),e._v(" "),a("FormItem",[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:"",placeholder:"试听学期"},on:{"on-change":e.changeTerm},model:{value:e.formData.termId,callback:function(t){e.$set(e.formData,"termId",t)},expression:"formData.termId"}},e._l(e.termList,(function(t,r){return a("Option",{key:r,attrs:{value:t.id}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),a("FormItem",[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:"",placeholder:"试听年部"},on:{"on-change":e.gradeTypeChange},model:{value:e.formData.gradeTypeId,callback:function(t){e.$set(e.formData,"gradeTypeId",t)},expression:"formData.gradeTypeId"}},e._l(e.gradeTypeList,(function(t,r){return a("Option",{key:r,attrs:{value:t.id}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),a("FormItem",[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:"",placeholder:"试听年级"},on:{"on-change":e.changeClasses},model:{value:e.formData.gradeId,callback:function(t){e.$set(e.formData,"gradeId",t)},expression:"formData.gradeId"}},e._l(e.gradeList,(function(t,r){return a("Option",{key:r,attrs:{value:t.id}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),a("FormItem",[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:"",placeholder:"试听学科"},on:{"on-change":e.changeSubject},model:{value:e.formData.subjectId,callback:function(t){e.$set(e.formData,"subjectId",t)},expression:"formData.subjectId"}},e._l(e.subjectList,(function(t,r){return a("Option",{key:r,attrs:{value:t.id}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),a("FormItem",[a("Select",{staticStyle:{width:"150px"},attrs:{filterable:"",clearable:"",remote:"","remote-method":e.getTreatAdvisorEmpNos,"label-in-value":"",loading:e.loading1,placeholder:"预约顾问"},model:{value:e.formData.planAdvisorNo,callback:function(t){e.$set(e.formData,"planAdvisorNo",t)},expression:"formData.planAdvisorNo"}},e._l(e.treatAdvisorEmpNos,(function(t){return a("Option",{key:t.userWorkCode,attrs:{value:t.userWorkCode}},[e._v(e._s(t.userName)+" - "+e._s(t.userWorkCode))])})),1)],1),e._v(" "),a("FormItem",[a("Select",{staticStyle:{width:"150px"},attrs:{filterable:"",clearable:"",remote:"","remote-method":e.getTreatAdvisorEmpNos,"label-in-value":"",loading:e.loading1,placeholder:"接待顾问"},model:{value:e.formData.treatAdvisorNo,callback:function(t){e.$set(e.formData,"treatAdvisorNo",t)},expression:"formData.treatAdvisorNo"}},e._l(e.treatAdvisorEmpNos,(function(t){return a("Option",{key:t.userWorkCode,attrs:{value:t.userWorkCode}},[e._v(e._s(t.userName)+" - "+e._s(t.userWorkCode))])})),1)],1),e._v(" "),a("FormItem",[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:"",placeholder:"用户意向"},on:{"on-change":e.changeSubject},model:{value:e.formData.stuIntention,callback:function(t){e.$set(e.formData,"stuIntention",t)},expression:"formData.stuIntention"}},e._l(e.conditions.stuIntention,(function(t,r){return a("Option",{key:r,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),e._v(" "),a("FormItem",[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:"",placeholder:"渠道标签"},model:{value:e.formData.channelId,callback:function(t){e.$set(e.formData,"channelId",t)},expression:"formData.channelId"}},e._l(e.diagnosisChannels,(function(t,r){return a("Option",{key:r,attrs:{value:t.id}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),a("FormItem",[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:"",placeholder:"授课类型"},model:{value:e.formData.classType,callback:function(t){e.$set(e.formData,"classType",t)},expression:"formData.classType"}},[a("Option",{attrs:{value:1}},[e._v("在线")]),e._v(" "),a("Option",{attrs:{value:4}},[e._v("面授")])],1)],1),e._v(" "),a("FormItem",[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:"",placeholder:"是否报名"},on:{"on-change":e.changeSubject},model:{value:e.formData.isRegist,callback:function(t){e.$set(e.formData,"isRegist",t)},expression:"formData.isRegist"}},e._l(e.conditions.isRegist,(function(t,r){return a("Option",{key:r,attrs:{value:t.id}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),a("FormItem",[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:"",placeholder:"是否缴费"},on:{"on-change":e.changeSubject},model:{value:e.formData.isPay,callback:function(t){e.$set(e.formData,"isPay",t)},expression:"formData.isPay"}},e._l(e.conditions.isPay,(function(t,r){return a("Option",{key:r,attrs:{value:t.id}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),a("FormItem",[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:"",placeholder:"是否取消"},on:{"on-change":e.changeSubject},model:{value:e.formData.appointmentStatus,callback:function(t){e.$set(e.formData,"appointmentStatus",t)},expression:"formData.appointmentStatus"}},e._l(e.conditions.appointmentStatus,(function(t,r){return a("Option",{key:r,attrs:{value:t.id}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),a("FormItem",[a("Select",{staticStyle:{width:"120px"},attrs:{clearable:"",placeholder:"考勤状态"},on:{"on-change":e.changeSubject},model:{value:e.formData.isAttendance,callback:function(t){e.$set(e.formData,"isAttendance",t)},expression:"formData.isAttendance"}},e._l(e.conditions.attendanceStatus,(function(t,r){return a("Option",{key:r,attrs:{value:t.id}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),a("FormItem",[a("DatePicker",{staticStyle:{width:"200px"},attrs:{type:"daterange",editable:!1,placeholder:"创建时间"},on:{"on-change":function(t){return e.optDateChange(t,"createStartTime","createEndTime")}},model:{value:e.formData.createTime,callback:function(t){e.$set(e.formData,"createTime",t)},expression:"formData.createTime"}})],1),e._v(" "),a("FormItem",[a("DatePicker",{staticStyle:{width:"200px"},attrs:{type:"daterange",editable:!1,placeholder:"试听时间"},on:{"on-change":function(t){return e.optDateChange(t,"auditionStartTime","auditionEndTime")}},model:{value:e.formData.auditionTime,callback:function(t){e.$set(e.formData,"auditionTime",t)},expression:"formData.auditionTime"}})],1)]:e._e(),e._v(" "),a("FormItem",[a("Input",{attrs:{clearable:"",placeholder:"学员姓名"},model:{value:e.formData.stuRealName,callback:function(t){e.$set(e.formData,"stuRealName",t)},expression:"formData.stuRealName"}})],1),e._v(" "),a("FormItem",[a("Input",{attrs:{number:"",clearable:"",placeholder:"学员手机号"},model:{value:e.formData.phone,callback:function(t){e.$set(e.formData,"phone",t)},expression:"formData.phone"}})],1),e._v(" "),a("FormItem",[a("Input",{attrs:{number:"",clearable:"",placeholder:"学员编号"},model:{value:e.formData.stuCode,callback:function(t){e.$set(e.formData,"stuCode",t)},expression:"formData.stuCode"}})],1),e._v(" "),"reservationRecord"!==e.activeTabName?[a("FormItem",[a("DatePicker",{staticStyle:{width:"200px"},attrs:{type:"daterange",editable:!1,placeholder:"申请时间"},on:{"on-change":function(t){return e.optDateChange(t,"createTime","endTime")}},model:{value:e.formData.applyTime,callback:function(t){e.$set(e.formData,"applyTime",t)},expression:"formData.applyTime"}})],1)]:e._e(),e._v(" "),a("div",{staticStyle:{"text-align":"right","margin-bottom":"10px","margin-top":"-30px"}},[5===e.roleId?a("Button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary"},on:{click:e.createRrCode}},[e._v("试听老带新二维码")]):e._e(),e._v(" "),a("Button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary"},on:{click:e.onSearch}},[e._v("查询")]),e._v(" "),"reservationRecord"===e.activeTabName?a("Button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary",loading:e.btnLoading},on:{click:e.exportDataClick}},[e._v("导出数据")]):e._e(),e._v(" "),"applyRecord"===e.activeTabName?a("Button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary",loading:e.btnLoading},on:{click:e.exportApplyDataClick}},[e._v("导出数据")]):e._e()],1)],2)]),e._v(" "),a("div",{staticStyle:{background:"#fff","margin-top":"20px",padding:"10px"}},[a("Tabs",{attrs:{type:"card",animated:!1,name:"audition"},model:{value:e.activeTabName,callback:function(t){e.activeTabName=t},expression:"activeTabName"}},[a("TabPane",{attrs:{label:e.customTabPaneLabel,name:"applyRecord"}},[a("div",{staticClass:"flex"},[a("span",{staticStyle:{"margin-right":"10px"}},[e._v("跟进状态: ")]),e._v(" "),a("CheckboxGroup",{on:{"on-change":e.onSearch},model:{value:e.formData.applyStatusList,callback:function(t){e.$set(e.formData,"applyStatusList",t)},expression:"formData.applyStatusList"}},[a("Checkbox",{attrs:{label:0}},[a("span",[e._v("未跟进")])]),e._v(" "),a("Checkbox",{attrs:{label:3}},[a("span",[e._v("跟进中")])]),e._v(" "),a("Checkbox",{attrs:{label:2}},[a("span",[e._v("跟进结束")])])],1)],1),e._v(" "),a("div",{staticClass:"flex"},[a("span",{staticStyle:{"margin-right":"10px"}},[e._v("排序列表: ")]),e._v(" "),a("Select",{staticStyle:{width:"150px"},on:{"on-change":e.onSearch},model:{value:e.formData.orderSortType,callback:function(t){e.$set(e.formData,"orderSortType",t)},expression:"formData.orderSortType"}},e._l(e.sortTypeList,(function(t,r){return a("Option",{key:r,attrs:{value:t.value}},[e._v(e._s(t.label))])})),1)],1),e._v(" "),a("ApplyRecord",{ref:"applyRecord",attrs:{formData:e.formData}})],1),e._v(" "),a("TabPane",{attrs:{label:"试听预约记录",name:"reservationRecord"}},[a("ReservationRecord",{ref:"reservationRecord",attrs:{formData:e.formData}})],1)],1)],1),e._v(" "),a("Modal",{attrs:{"mask-closable":!1,title:"老带新二维码","footer-hide":!0,width:"350px"},model:{value:e.qrCode.showModal,callback:function(t){e.$set(e.qrCode,"showModal",t)},expression:"qrCode.showModal"}},[a("div",[a("img",{staticStyle:{width:"100%"},attrs:{src:e.qrCode.activityCodeUrl,alt:""}})])])],1)}),[],!1,null,"afbf3c1a",null));t.default=B.exports},e87d:function(e,t,a){},ef6a:function(e,t,a){},f4b0:function(e,t,a){"use strict";var r=a("11c5");a.n(r).a},f660:function(e,t,a){},f717:function(e,t,a){e.exports=a.p+"img/cuanban-nodata.472f39f8.png"},fcff:function(e,t,a){},fed9:function(e,t,a){"use strict";var r=a("dcb7");a.n(r).a},ffe3:function(e,t,a){}}]);
//# sourceMappingURL=operative.9fd1d652.js.map