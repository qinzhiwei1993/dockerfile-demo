(window.webpackJsonp=window.webpackJsonp||[]).push([["applyWorkbench"],{"32a2":function(t,e,a){"use strict";a.r(e);a("7f7f"),a("c5f6");var s=a("867e"),n=a("6ec6"),r=a("a78e"),i=a.n(r),c={name:"applyWorkbench",mixins:[n.a],data:function(){return{applyShow:!1,searchStuForApplyModal:!1,tabsName:"classQuery",currentTabName:"classQuery",yearList:[],allCityList:[],hasStudentInfo:!0,studentDetail:{},showTab:{classQuery:!1,classRecord:!1,orderCenter:!1,performance:!1,attendance:!1,discount:!1,reserved:!1,backupRecords:!1},loaded:!1,reset:!1,multiApply:{classId:"",studentId:"",cityCode:"",empNo:JSON.parse(i.a.get("columbusUserInfo")).id},crmInfo:{}}},mounted:function(){this.getYearList(),this.getCityList(),this.$route.query.card||this.$route.query.cityCode||this.setDefaultView()},computed:{ifConsultantRole:function(){var t=this.$store.state.roleRelativeData.userInfo.crmRoleId,e=this.$store.state.roleRelativeData.roleInfo.identityId;return 5===t&&Number(e)===Number(this.crmInfo.belongIdentityId)&&!!this.crmInfo.nimAccid}},methods:{sendMsgEv:function(){var t=this.crmInfo.nimAccid;t?"sucess"===this.$store.state.imchat.status?this.$store.dispatch("imchat/startSession",t):this.$message({message:"im聊天窗口没有初始化成功",type:"error"}):this.$message({message:"学员没有云信ID没法聊天",type:"error"})},report:function(){this.$router.push({name:"prescribeddaily"})},getYearList:function(){var t=this;Object(s.q)().then((function(e){t.yearList=e})).catch((function(e){t.$Message.warning({content:"获取年份失败:"+e.message,duration:5})}))},getCityList:function(){var t=this;Object(s.d)().then((function(e){t.allCityList=e})).catch((function(e){t.$Message.warning({content:"获取所有城市失败:"+e.message,duration:5})}))},tabsChange:function(t,e){var a=this;console.log("tabsChange: ".concat(t)),console.log(this.tabsName);var s=null;switch(t){case"classQuery":s="15-3607";break;case"backupRecords":s="15-3621";break;case"discount":s="15-3628"}s&&XesAnalytics.track(s,{}),"classQuery"===t||this.currentTabName===t&&!e?this.currentTabName=t:(this.currentTabName=t,this.showTab[t]=!0,this.$nextTick((function(){a.$nextTick((function(){a.$refs[t].initView()}))})))},setCrmInfo:function(t){this.crmInfo=t},setStuInfo:function(t){var e=this;this.resetTabs(),this.$nextTick((function(){e.studentDetail=t,e.hasStudentInfo=!1,e.$route.query.tab?e.$nextTick((function(){e.tabsName=e.$route.query.tab,e.tabsChange(e.tabsName)})):(e.currentTabName="classQuery",e.tabsName="classQuery",e.$nextTick((function(){e.setDefaultView()})))}))},resetTabs:function(){this.showTab={classQuery:!0,classRecord:!1,orderCenter:!1,performance:!1,attendance:!1,discount:!1,reserved:!1,backupRecords:!1}},setDefaultView:function(){var t=this;this.showTab[this.tabsName]=!0,this.$nextTick((function(){t.$refs[t.tabsName].initView()}))},checkPayStatus:function(t){var e=this;t?(this.tabsName="",this.$nextTick((function(){e.tabsName="classRecord",e.tabsChange(e.tabsName)}))):(this.tabsName="orderCenter",this.tabsChange(this.tabsName))},printAttendance:function(t){top.open("/service/printAttendance?name=".concat(this.studentDetail.realName,"&card=").concat(this.studentDetail.card,"&sex=").concat(this.studentDetail.sexName,"&gradeName=").concat(this.studentDetail.gradeName,"&cityCode=").concat(this.studentDetail.cityCode,"&stuId=").concat(this.studentDetail.studentId,"&searchDate=").concat(t,"&print=true"))},applyChoiceHandle:function(t){this.multiApply.classId=t.id,this.searchStuForApplyModal=!0},setStuInfoForApplyHandle:function(t){this.multiApply.studentId=t.studentId,this.multiApply.cityCode=t.cityCode,this.applyShow=!0}}},o=(a("80a6"),a("2877")),u=Object(o.a)(c,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"applyManager gary fixBorder"},[a("TalStuSearch",{ref:"stuSearch",attrs:{addStu:"",stuDetail:"","stu-card":t.queryData.card,"stu-city-code":t.queryData.cityCode,showSendMsg:t.ifConsultantRole},on:{sendMsg:t.sendMsgEv,crmInfo:t.setCrmInfo,stuInfo:t.setStuInfo}}),t._v(" "),a("Tabs",{staticStyle:{"margin-top":"10px",background:"#fff"},attrs:{type:"card",animated:!1,name:"applyTabs"},on:{"on-click":t.tabsChange},model:{value:t.tabsName,callback:function(e){t.tabsName=e},expression:"tabsName"}},[a("TabPane",{attrs:{tab:"applyTabs",label:"班级查询",name:"classQuery"}},[t.showTab.classQuery?[a("TalApplyClassQuery",{ref:"classQuery",attrs:{studentDetail:t.studentDetail,years:t.yearList,citys:t.allCityList,classInfo:t.classInfo},on:{applyChoice:t.applyChoiceHandle}})]:t._e()],2),t._v(" "),a("TabPane",{attrs:{tab:"applyTabs",label:"报班记录",name:"classRecord",disabled:t.hasStudentInfo}},[t.showTab.classRecord?[a("TalApplyClassRecord",{ref:"classRecord",attrs:{yearList:t.yearList,studentDetail:t.studentDetail},on:{report:t.report,checkPayStatus:t.checkPayStatus}})]:t._e()],2),t._v(" "),a("TabPane",{attrs:{tab:"applyTabs",label:"订单中心",name:"orderCenter",disabled:t.hasStudentInfo}},[t.showTab.orderCenter?[a("TalApplyOrderCenter",{ref:"orderCenter",attrs:{studentDetail:t.studentDetail},on:{checkPayStatus:t.checkPayStatus}})]:t._e()],2),t._v(" "),a("TabPane",{attrs:{tab:"applyTabs",label:"候补记录",name:"backupRecords",disabled:t.hasStudentInfo}},[t.showTab.backupRecords?[a("TalApplyBackupRecords",{ref:"backupRecords",attrs:{yearList:t.yearList,studentDetail:t.studentDetail}})]:t._e()],2),t._v(" "),a("TabPane",{attrs:{tab:"applyTabs",label:"预留转班名额记录",name:"reserved",disabled:t.hasStudentInfo}},[t.showTab.reserved?[a("TalApplyReserved",{ref:"reserved",attrs:{yearList:t.yearList,studentDetail:t.studentDetail}})]:t._e()],2),t._v(" "),a("TabPane",{attrs:{tab:"applyTabs",label:"成绩查询",name:"performance",disabled:t.hasStudentInfo}},[t.showTab.performance?[a("TalScoreQuery",{ref:"performance",attrs:{from:"splat",stuId:t.studentDetail.studentId,cityCode:t.studentDetail.cityCode,stuCard:t.studentDetail.card,stuUid:t.studentDetail.uid,stuName:t.studentDetail.realName}})]:t._e()],2),t._v(" "),a("TabPane",{attrs:{tab:"applyTabs",label:"学员考勤",name:"attendance",disabled:t.hasStudentInfo}},[t.showTab.attendance?[a("TalApplyAttendance",{ref:"attendance",attrs:{studentDetail:t.studentDetail},on:{printAttendance:t.printAttendance}})]:t._e()],2),t._v(" "),a("TabPane",{attrs:{tab:"applyTabs",label:"优惠券",name:"discount",disabled:t.hasStudentInfo}},[t.showTab.discount?[a("TalDiscountCoupon",{ref:"discount",attrs:{studentDetail:t.studentDetail}})]:t._e()],2)],1),t._v(" "),a("TalApplyModal",{attrs:{show:t.applyShow,isEdit:!1,classId:t.multiApply.classId,stuId:t.multiApply.studentId,stuCityCode:t.multiApply.cityCode,creatorEmpNo:t.multiApply.empNo},on:{close:function(e){t.applyShow=!1}}}),t._v(" "),a("Modal",{attrs:{title:"查找报名学员",width:"800","footer-hide":!0},model:{value:t.searchStuForApplyModal,callback:function(e){t.searchStuForApplyModal=e},expression:"searchStuForApplyModal"}},[a("TalStuSearch",{ref:"stuSearchForApply",attrs:{attendanceSearch:!1,showDetail:!1,showCrmInfo:!1,"choice-btn-text":"报名"},on:{stuInfo:t.setStuInfoForApplyHandle}})],1)],1)}),[],!1,null,"6de07ff2",null);e.default=u.exports},"6ec6":function(t,e,a){"use strict";a("96cf");var s,n=a("3b8d"),r=a("2472");e.a={data:function(){return{queryData:{card:"",cityCode:""},classInfo:{type:Object,default:function(){return{}}}}},mounted:function(){this.initStu()},methods:{initStu:(s=Object(n.a)(regeneratorRuntime.mark((function t(){var e=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!this.$route.query){t.next=9;break}if(this.$route.query.card&&"undefined"!==this.$route.query.card&&(this.queryData.card=String(this.$route.query.card)),this.$route.query.cityCode&&"undefined"!==this.$route.query.cityCode&&(this.queryData.cityCode=String(this.$route.query.cityCode)),!this.$route.query.classId){t.next=8;break}return t.next=7,Object(r.d)({classId:this.$route.query.classId});case 7:this.classInfo=t.sent;case 8:this.queryData.card&&this.queryData.cityCode&&this.$nextTick((function(){e.$refs.stuSearch.searchStuByUid({card:e.queryData.card,realName:"",phone:"",cityCode:e.queryData.cityCode,current:1})}));case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(0),this.$Message.error("初始化错误："+t.t0||!1);case 14:case"end":return t.stop()}}),t,this,[[0,11]])}))),function(){return s.apply(this,arguments)})}}},"80a6":function(t,e,a){"use strict";var s=a("c640");a.n(s).a},c640:function(t,e,a){}}]);
//# sourceMappingURL=applyWorkbench.6f2d85a2.js.map