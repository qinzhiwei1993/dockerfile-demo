(window.webpackJsonp=window.webpackJsonp||[]).push([["pushmsg"],{"129a":function(t,e,a){"use strict";var s=a("2f79");a.n(s).a},"2f79":function(t,e,a){},5397:function(t,e,a){},"5eb5":function(t,e,a){"use strict";var s=a("5397");a.n(s).a},acf3:function(t,e,a){"use strict";a.r(e);a("0d6d"),a("7f7f"),a("c5f6"),a("ac6a"),a("96cf");var s,r,l,i,n,u=a("3b8d"),o=a("6167"),c=a("4be7"),d={name:"apppushmsg",data:function(){return{dialogVisible:!1,formStuStatus:{stuStatus:""},formStuFilter:{stuYear:"0",stuTerm:"0",stuClassGrade:[],stuSubject:""},formStuGrade:{stuClassGrade:[]},labelPosition:"right",formLabelAlign:{name:"",region:"",type:""},msgContent:"",msgImgUrl:"",filterData:{stuClassYear:{label:"在读年份",data:[]},stuStatus:{label:"在读状态",data:[]},stuClassTerm:{label:"在读学期",data:[]},stuClassGrade:{label:"在读年级",data:[]},stuClassSubject:{label:"在读学科",data:[]},stuGrade:{label:"学员年级",data:[]}},confirmMsgData:{msgContent:"",targetCount:"",targetObject:""},fileData:{},tabIndex:0,rules:{stuYear:[{required:!0,message:"请选择在读年份",trigger:"change"}],stuTerm:[{required:!0,message:"请选择在读学期",trigger:"change"}],stuClassGrade:[{required:!0,message:"请选择在读年级",trigger:"change"}],stuSubject:[{required:!0,message:"请选择在读学科",trigger:"change"}]},rulesGrade:{stuClassGrade:[{required:!0,message:"请选择在读年份",trigger:"change"}]},picLoading:!1,submitting:!1,allGrade:[],selectAllGrade:!1}},mounted:(n=Object(u.a)(regeneratorRuntime.mark((function t(){var e=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:Object(o.v)().then((function(t){e.formStuStatus.stuStatus="0",e.filterData=t,e.filterData.stuClassGrade.data.forEach((function(t){e.allGrade.push(t.classGradeId)})),console.log(e.allGrade)})).catch((function(t){e.$Message.warning({content:"获取年份失败:"+t.message,duration:5})}));case 1:case"end":return t.stop()}}),t)}))),function(){return n.apply(this,arguments)}),methods:{tabClickEv:function(t){this.tabIndex=Number(t.name)},uploadImgEv:function(){var t=this;this.picLoading=!0;var e=this.$refs.uploadImg;if(!/\.(png|jpg|bmp|jpeg|gif)$/i.test(e.value))return this.$message({message:"暂不支持发送该类型文件。",type:"warning"}),this.$refs.uploadImg.value="",void(this.picLoading=!1);e.value&&this.$store.dispatch("imchat/uploadImg",{fileInput:e}).then((function(e){t.picLoading=!1,t.msgImgUrl=e.url,t.fileData=e})).catch((function(e){t.$message({message:"上传失败 ".concat(e),type:"warning"}),t.picLoading=!1}))},formateParams:(i=Object(u.a)(regeneratorRuntime.mark((function t(){var e,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((e={}).stuStatus=this.formStuStatus.stuStatus,a="",""===e.stuStatus&&(a="请选择在读状态"),0===this.tabIndex?this.msgContent||(a="消息不能为空"):1===this.tabIndex&&(this.msgImgUrl||(a="图片不能为空")),!a){t.next=8;break}return this.$message({message:a,type:"error"}),t.abrupt("return");case 8:if("0"===e.stuStatus){t.next=14;break}return t.next=11,this.validateEv();case 11:if(t.sent){t.next=14;break}return t.abrupt("return",!1);case 14:return e.msg=0===this.tabIndex?this.msgContent:this.fileData.name,e.stuClassGradeIds=this.formStuFilter.stuClassGrade,e.stuClassSubjectid=this.formStuFilter.stuSubject,e.stuClassTerm=this.formStuFilter.stuTerm,e.stuClassYear=this.formStuFilter.stuYear,e.stuGradeId=this.formStuGrade.stuClassGrade.length?this.formStuGrade.stuClassGrade:"",t.abrupt("return",e);case 21:case"end":return t.stop()}}),t,this)}))),function(){return i.apply(this,arguments)}),validateEv:(l=Object(u.a)(regeneratorRuntime.mark((function t(){var e,a,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.formStuStatus.stuStatus,a="","1"===e?a="formStuFilter":"2"===e&&(a="formStuGrade"),t.next=5,this.formPromiseEv(a);case 5:return s=t.sent,t.abrupt("return",s);case 7:case"end":return t.stop()}}),t,this)}))),function(){return l.apply(this,arguments)}),formPromiseEv:function(t){var e=this;return new c.Promise((function(a,s){e.$refs[t].validate((function(t){a(t)}))}))},sendMsgEv:(r=Object(u.a)(regeneratorRuntime.mark((function t(){var e,a=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.formateParams();case 2:if(e=t.sent){t.next=5;break}return t.abrupt("return");case 5:Object(o.x)(e).then((function(t){a.confirmMsgData=t,0!==t.targetCount?(a.dialogVisible=!0,a.submitting=!1):a.$message({message:"没有符合要求的学员",type:"warning"})})).catch((function(t){a.$Message.warning({content:"发送失败:"+t.message,duration:5})}));case 6:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)}),completeSendMsgEv:(s=Object(u.a)(regeneratorRuntime.mark((function t(){var e,a,s,r=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.formateParams();case 2:if(e=t.sent){t.next=5;break}return t.abrupt("return");case 5:this.submitting=!0,a=this.tabIndex,s={},0===a?s.msg=this.msgContent:1===a&&(s=this.fileData),e.type=a,e.body=JSON.stringify(s),Object(o.t)(e).then((function(t){r.dialogVisible=!1,r.$Message.success("发送成功"),r.$router.push({name:"pushmsglist"}),r.resetEv()})).catch((function(t){r.submitting=!1,r.$Message.warning({content:"发送失败:"+t.message,duration:5})}));case 12:case"end":return t.stop()}}),t,this)}))),function(){return s.apply(this,arguments)}),uploadDelEv:function(){this.fileData={},this.msgImgUrl="",this.$refs.uploadImg.value=""},stuStatusChangeEv:function(t){"0"===t&&(this.formStuFilter={stuYear:"0",stuTerm:"0",stuClassGrade:[],stuSubject:""},this.formStuGrade={stuClassGrade:[]}),"1"===t&&(this.formStuGrade={stuClassGrade:[]}),"2"===t&&(this.formStuFilter={stuYear:"0",stuTerm:"0",stuClassGrade:[],stuSubject:""})},resetEv:function(){var t="",e=this.formStuStatus.stuStatus;"1"===e?t="formStuFilter":"2"===e&&(t="formStuGrade"),this.formStuStatus.stuStatus="0",this.$refs[t]&&this.$refs[t].resetFields(),this.msgContent="",this.uploadDelEv()},selectGradeHandler:function(t){var e=this.allGrade[0],a=this.allGrade.filter((function(t){return t!==e})),s=t[t.length-1],r=t.filter((function(t){return t!==e}));s!==e?r.length===a.length?this.selectAllGrade?(this.selectAllGrade=!1,this.formStuFilter.stuClassGrade=[]):(this.selectAllGrade=!0,this.formStuFilter.stuClassGrade=Object.freeze(this.allGrade)):(this.selectAllGrade=!1,this.formStuFilter.stuClassGrade=Object.freeze(r)):(this.selectAllGrade=!0,this.formStuFilter.stuClassGrade=Object.freeze(this.allGrade))}}},p=(a("129a"),a("2877")),g=Object(p.a)(d,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Layout",{staticClass:"appPushMsg overall-basic"},[a("div",[a("el-form",{ref:"formStuStatus",attrs:{model:t.formStuStatus,"label-position":"top","label-width":"80px"}},[a("el-form-item",{attrs:{label:t.filterData.stuStatus.label,prop:"stuStatus"}},[a("el-select",{attrs:{size:"small",placeholder:"请选择"},on:{change:t.stuStatusChangeEv},model:{value:t.formStuStatus.stuStatus,callback:function(e){t.$set(t.formStuStatus,"stuStatus",e)},expression:"formStuStatus.stuStatus"}},t._l(t.filterData.stuStatus.data,(function(t){return a("el-option",{key:t.stuStatusId,attrs:{label:t.stuStatusName,value:t.stuStatusId}})})),1)],1)],1),t._v(" "),a("el-form",{directives:[{name:"show",rawName:"v-show",value:"1"===t.formStuStatus.stuStatus,expression:"formStuStatus.stuStatus === '1'"}],ref:"formStuFilter",attrs:{model:t.formStuFilter,inline:!0,rules:t.rules,"label-position":"top","label-width":"80px"}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{staticStyle:{"min-width":"100px"},attrs:{span:3}},[a("el-form-item",{attrs:{label:t.filterData.stuClassYear.label,prop:"stuYear"}},[a("el-select",{attrs:{size:"small",filterable:"",placeholder:"请选择"},model:{value:t.formStuFilter.stuYear,callback:function(e){t.$set(t.formStuFilter,"stuYear",e)},expression:"formStuFilter.stuYear"}},t._l(t.filterData.stuClassYear.data,(function(t){return a("el-option",{key:t.classYearId,attrs:{label:t.classYearName,value:t.classYearId}})})),1)],1)],1),t._v(" "),a("el-col",{attrs:{span:3}},[a("el-form-item",{attrs:{label:t.filterData.stuClassTerm.label,prop:"stuTerm"}},[a("el-select",{attrs:{size:"small",filterable:"",placeholder:"请选择"},model:{value:t.formStuFilter.stuTerm,callback:function(e){t.$set(t.formStuFilter,"stuTerm",e)},expression:"formStuFilter.stuTerm"}},t._l(t.filterData.stuClassTerm.data,(function(t){return a("el-option",{key:t.classTermId,attrs:{label:t.classTermName,value:t.classTermId}})})),1)],1)],1),t._v(" "),a("el-col",{attrs:{span:15}},[a("el-form-item",{staticStyle:{width:"100%"},attrs:{label:t.filterData.stuClassGrade.label,prop:"stuClassGrade"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{size:"small",filterable:"",multiple:"",clearable:"",placeholder:"请选择"},on:{change:t.selectGradeHandler},model:{value:t.formStuFilter.stuClassGrade,callback:function(e){t.$set(t.formStuFilter,"stuClassGrade",e)},expression:"formStuFilter.stuClassGrade"}},t._l(t.filterData.stuClassGrade.data,(function(t){return a("el-option",{key:t.classGradeId,attrs:{label:t.classGradeName,value:t.classGradeId}})})),1)],1)],1),t._v(" "),a("el-col",{attrs:{span:3}},[a("el-form-item",{attrs:{label:t.filterData.stuClassSubject.label,prop:"stuSubject"}},[a("el-select",{attrs:{size:"small",filterable:"",placeholder:"请选择"},model:{value:t.formStuFilter.stuSubject,callback:function(e){t.$set(t.formStuFilter,"stuSubject",e)},expression:"formStuFilter.stuSubject"}},t._l(t.filterData.stuClassSubject.data,(function(t){return a("el-option",{key:t.classSubjectId,attrs:{label:t.classSubjectName,value:t.classSubjectId}})})),1)],1)],1)],1)],1),t._v(" "),a("el-form",{directives:[{name:"show",rawName:"v-show",value:"2"===t.formStuStatus.stuStatus,expression:"formStuStatus.stuStatus === '2'"}],ref:"formStuGrade",attrs:{model:t.formStuGrade,rules:t.rulesGrade,"label-position":"top","label-width":"80px"}},[a("el-form-item",{attrs:{label:t.filterData.stuGrade.label,prop:"stuClassGrade"}},[a("el-select",{attrs:{size:"small",filterable:"",placeholder:"请选择"},model:{value:t.formStuGrade.stuClassGrade,callback:function(e){t.$set(t.formStuGrade,"stuClassGrade",e)},expression:"formStuGrade.stuClassGrade"}},t._l(t.filterData.stuGrade.data,(function(t){return a("el-option",{key:t.stuGradeId,attrs:{label:t.stuGradeName,value:t.stuGradeId}})})),1)],1)],1)],1),t._v(" "),a("div",[a("el-tabs",{on:{"tab-click":t.tabClickEv}},[a("el-tab-pane",{attrs:{name:"0",label:"消息"}},[a("el-input",{staticClass:"formItemTextarea",attrs:{size:"small",rows:5,maxlength:300,type:"textarea",placeholder:"请输入内容"},model:{value:t.msgContent,callback:function(e){t.msgContent=e},expression:"msgContent"}})],1),t._v(" "),a("el-tab-pane",{attrs:{name:"1",label:"图片"}},[a("div",{staticClass:"appPushMsg-upload"},[a("div",{staticClass:"appPushMsg-upload__container"},[a("input",{ref:"uploadImg",staticClass:"appPushMsg-upload__uploadImg",attrs:{type:"file"},on:{change:t.uploadImgEv}}),t._v(" "),t.picLoading||t.msgImgUrl?t._e():a("div",{staticClass:"appPushMsg-upload__normal"},[a("div",{staticClass:"appPushMsg-upload__placeHolder el-icon-upload"}),t._v(" "),a("div",{staticClass:"appPushMsg-upload__text"},[t._v("点击上传")])]),t._v(" "),t.picLoading?a("div",{staticClass:"appPushMsg-upload__loading "},[a("div",{staticClass:"appPushMsg-upload__loadingIcon el-icon-loading"}),t._v(" "),a("div",{staticClass:"appPushMsg-upload__loadingtext"},[t._v("正在上传...")])]):t._e(),t._v(" "),!t.picLoading&&t.msgImgUrl?a("div",{staticClass:"appPushMsg-upload__sucess"},[a("img",{staticClass:"appPushMsg-upload__sucessImg",attrs:{src:t.msgImgUrl,alt:""}}),t._v(" "),a("div",{staticClass:"appPushMsg-upload__del el-icon-circle-close",on:{click:function(e){return e.stopPropagation(),t.uploadDelEv(e)}}})]):t._e()])])])],1)],1),t._v(" "),a("div",{staticClass:"appPushMsg-btnContainer"},[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.sendMsgEv}},[t._v("发送"+t._s(0===Number(t.tabIndex)?"消息":"图片"))]),t._v(" "),a("el-button",{attrs:{size:"small"},on:{click:t.resetEv}},[t._v("重置")])],1),t._v(" "),a("el-dialog",{attrs:{visible:t.dialogVisible,title:"发送确认",width:"50%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("div",{staticClass:"appPushMsg-dialog"},[a("div",{staticClass:"appPushMsg-dialog__item"},[a("span",{staticClass:"appPushMsg-dialog__title"},[t._v("接收对象：")]),t._v(t._s(t.confirmMsgData.targetObject)),a("span")]),t._v(" "),a("div",{staticClass:"appPushMsg-dialog__item"},[a("span",{staticClass:"appPushMsg-dialog__title"},[t._v("接收人数：")]),t._v(t._s(t.confirmMsgData.targetCount)),a("span")]),t._v(" "),a("div",{staticClass:"appPushMsg-dialog__item"},[a("span",{staticClass:"appPushMsg-dialog__title"},[t._v("消息内容：")]),t._v(t._s(t.confirmMsgData.msgContent)),a("span")])]),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{disabled:t.submitting,type:"primary"},on:{click:t.completeSendMsgEv}},[t._v("确认并发送")])],1)])],1)}),[],!1,null,"390eb432",null);e.default=g.exports},f435:function(t,e,a){"use strict";a.r(e);a("96cf");var s,r,l=a("3b8d"),i=(a("0808"),a("c82c")),n=a.n(i),u=a("6167"),o={data:function(){return{dialogStatusVisible:!1,status:"",options:[{value:"",label:"全部"},{value:"0",label:"成功"},{value:"1",label:"失败"}],tableData:{total:0,rows:[]},pageSize:40,pageNo:1,detailPageNo:1,detailPageSize:50,viewer:null,detailList:{total:0,rows:[]},detailConditon:{}}},mounted:function(){var t=this;this.$nextTick((function(){t.viewer=new n.a(t.$refs.image,{viewed:function(){this.viewer.zoomTo(.8)},navbar:0,toolbar:{zoomIn:4,zoomOut:4,oneToOne:0,reset:4,prev:0,play:{show:0,size:"large"},next:0,rotateLeft:4,rotateRight:4,flipHorizontal:4,flipVertical:4}}),t.gainData()}))},methods:{pageChangeEv:function(t){this.pageNo=t,this.gainData()},handleSizeChange:function(t){this.pageSize=t,this.gainData()},pageDetailChangeEv:function(t){this.detailPageNo=t,this.gainDetailData()},handleDetailSizeChange:function(t){this.detailPageSize=t,this.gainDetailData()},gainData:(r=Object(l.a)(regeneratorRuntime.mark((function t(){var e,a=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e={page:this.pageNo,pageSize:this.pageSize},Object(u.w)(e).then((function(t){a.tableData=t,a.$nextTick((function(){a.viewer.update()}))})).catch((function(t){a.$Message.error({content:"获取信息失败："+t.message,duration:5})}));case 2:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)}),gainDetailData:(s=Object(l.a)(regeneratorRuntime.mark((function t(){var e,a=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e={page:this.detailPageNo,pageSize:this.detailPageSize,massId:this.detailConditon.massId},Object(u.u)(e).then((function(t){a.detailList=t})).catch((function(t){a.$Message.error({content:"获取信息失败："+t.message,duration:5})}));case 2:case"end":return t.stop()}}),t,this)}))),function(){return s.apply(this,arguments)}),handleClick:function(t){this.dialogStatusVisible=!0,this.detailConditon=t,this.detailPageNo=1,this.gainDetailData()}}},c=(a("5eb5"),a("2877")),d=Object(c.a)(o,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Layout",{staticClass:"pushMsgLisg content-data"},[a("div",{staticClass:"content-data-card"},[a("div",{ref:"image",staticClass:"table-basic"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData.rows}},[a("el-table-column",{attrs:{prop:"date",label:"日期"}}),t._v(" "),a("el-table-column",{attrs:{prop:"userName",label:"发送人",width:"90"}}),t._v(" "),a("el-table-column",{attrs:{prop:"servicecenterName",label:"服务中心"}}),t._v(" "),a("el-table-column",{attrs:{prop:"account",label:"接收对象"}}),t._v(" "),a("el-table-column",{attrs:{prop:"msg",label:"消息内容"},scopedSlots:t._u([{key:"default",fn:function(e){return["文本"===e.row.type?a("div",[t._v(t._s(JSON.parse(e.row.msg).msg))]):a("div",{staticClass:"pushMsgLisg-tableImg"},[a("img",{attrs:{src:JSON.parse(e.row.msg).url,alt:""}})])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"count",align:"center",width:"90",label:"消息总条数"}}),t._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"90"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return t.handleClick(e.row)}}},[t._v("发送状态")])]}}])})],1)],1),t._v(" "),a("div",[a("el-dialog",{attrs:{visible:t.dialogStatusVisible,title:"发送状态"},on:{"update:visible":function(e){t.dialogStatusVisible=e}}},[a("div",[t._l(t.detailList.rows,(function(e){return a("el-badge",{key:e.stuId,staticClass:"pushMsgLisg-item",attrs:{value:e.state,type:"失败"===e.state?"sucess":"danger"}},[t._v("\n            "+t._s(e.stuName)+"\n          ")])})),t._v(" "),a("div",{staticClass:"pushMsgLisg-detail__pagination"},[t.detailList.total>t.detailList.rows.length?a("el-pagination",{attrs:{"page-size":t.detailPageSize,total:t.detailList.total,"current-page":t.detailPageNo,layout:"total, sizes, prev, pager, next, jumper"},on:{"update:currentPage":function(e){t.detailPageNo=e},"update:current-page":function(e){t.detailPageNo=e},"size-change":t.handleDetailSizeChange,"current-change":t.pageDetailChangeEv}}):t._e()],1)],2)])],1),t._v(" "),a("div",{},[t.tableData.total>t.tableData.rows.length?a("el-pagination",{attrs:{"page-size":t.pageSize,total:t.tableData.total,"current-page":t.pageNo,layout:"total, sizes, prev, pager, next, jumper"},on:{"update:currentPage":function(e){t.pageNo=e},"update:current-page":function(e){t.pageNo=e},"size-change":t.handleSizeChange,"current-change":t.pageChangeEv}}):t._e()],1)])])}),[],!1,null,"44833266",null);e.default=d.exports}}]);
//# sourceMappingURL=pushmsg.ef5153bf.js.map